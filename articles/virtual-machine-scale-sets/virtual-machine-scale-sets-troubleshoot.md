---
title: "Virtuálisgép-méretezési csoportok automatikusan skálázva hibaelhárítása |} Microsoft Docs"
description: "Hárítsa el a virtuálisgép-méretezési csoportok automatikusan skálázva. Ismerje meg észlelt jellemző problémákat és azok megoldását."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: bd45a0fb99a77851aa7b91d23bd4b830b6f5cc7b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="de91f-104">Virtuálisgép-méretezési csoportok automatikusan skálázva hibaelhárítása</span><span class="sxs-lookup"><span data-stu-id="de91f-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="de91f-105">**A probléma** – létrehozta az automatikus skálázás infrastruktúra az Azure Resource Manager használatával Virtuálisgép-méretezési készlet – például egy sablont ehhez hasonló telepítésével: https://github.com/Azure/azure-quickstart-templates/tree/master/201- a skálázási szabályok definiált vmss-bottle – automatikus skálázás – rendelkezik, és azt nagyszerű, azzal a különbséggel, hogy mekkora terhelés, akkor a virtuális gépek helyezni, függetlenül azok automatikus skálázás nem fog.</span><span class="sxs-lookup"><span data-stu-id="de91f-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on the VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="de91f-106">Hibaelhárítási lépések</span><span class="sxs-lookup"><span data-stu-id="de91f-106">Troubleshooting steps</span></span>
<span data-ttu-id="de91f-107">Szempontokat kell figyelembe venni a következők:</span><span class="sxs-lookup"><span data-stu-id="de91f-107">Some things to consider include:</span></span>

* <span data-ttu-id="de91f-108">Hány magok minden virtuális gép rendelkezik, és minden core betöltése?</span><span class="sxs-lookup"><span data-stu-id="de91f-108">How many cores does each VM have, and are you loading each core?</span></span>
  <span data-ttu-id="de91f-109">A fenti példa Azure gyors üzembe helyezési sablon do_work.php parancsfájl, amely betölti a egyetlen mag van.</span><span class="sxs-lookup"><span data-stu-id="de91f-109">The example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="de91f-110">Ha nagyobb, mint például Standard_A1 vagy D1 Virtuálisgép-méretet egyetlen mag virtuális Gépet használunk, akkor ez a betöltés többször futtatnia kell.</span><span class="sxs-lookup"><span data-stu-id="de91f-110">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need to run this load multiple times.</span></span> <span data-ttu-id="de91f-111">Ellenőrizze, hogy hány processzormag, a virtuális gépek megtekintésével [méretek a Windows virtuális gépek Azure-ban](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="de91f-111">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="de91f-112">A Virtuálisgép-méretezési csoportban lévő, hány virtuális gépek módon, az egyes munkaelem?</span><span class="sxs-lookup"><span data-stu-id="de91f-112">How many VMs in the VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="de91f-113">A bővített kapacitású esemény csak lépnek helyezze el, ha között az átlagos CPU **összes** a virtuális gépek méretezési csoportban lévő meghaladja a küszöbértéket, az időbeli belső definiálva az automatikus skálázási szabályok.</span><span class="sxs-lookup"><span data-stu-id="de91f-113">A scale out event will only take place when the average CPU across **all** the VMs in a scale set exceeds the threshold value, over the time internal defined in the autoscale rules.</span></span>
* <span data-ttu-id="de91f-114">Nem hagyott ki méretezési eseményeket?</span><span class="sxs-lookup"><span data-stu-id="de91f-114">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="de91f-115">Ellenőrizze, hogy a naplók az Azure-portálon méretezési események.</span><span class="sxs-lookup"><span data-stu-id="de91f-115">Check the audit logs in the Azure portal for scale events.</span></span> <span data-ttu-id="de91f-116">Lehet, hogy terjedő skálán fel és le, amely egy méretezési kimaradt.</span><span class="sxs-lookup"><span data-stu-id="de91f-116">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="de91f-117">Szűrhet "Méretezési"...</span><span class="sxs-lookup"><span data-stu-id="de91f-117">You can filter by “Scale”..</span></span>
  
    ![Naplók][audit]
* <span data-ttu-id="de91f-119">Eltérőek a méretezési és a kibővített küszöbértékeket megfelelően?</span><span class="sxs-lookup"><span data-stu-id="de91f-119">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="de91f-120">Tegyük fel, hogy úgy állítja be egy terjessze ki, ha az átlagos CPU 50 %-os több mint 5 perc és a skála 50 %-nál kisebb átlagos CPU esetén a szabályt.</span><span class="sxs-lookup"><span data-stu-id="de91f-120">Suppose you set a rule to scale out when average CPU is greater than 50% over 5 minutes, and to scale in when average CPU is less than 50%.</span></span> <span data-ttu-id="de91f-121">Emiatt egy "flapping" probléma esetén processzorhasználat megközelíti a küszöbérték skálázási műveletekhez folyamatosan növekvő, és a készlet méretének csökkentése.</span><span class="sxs-lookup"><span data-stu-id="de91f-121">This would cause a “flapping” problem when CPU usage is close to this threshold, with scale actions constantly increasing and decreasing the size of the set.</span></span> <span data-ttu-id="de91f-122">Emiatt az automatikus skálázás szolgáltatás megpróbálja tiltása "váltakozó állapotú", is jegyzékfájl nem skálázás, amely.</span><span class="sxs-lookup"><span data-stu-id="de91f-122">Because of this, the autoscale service tries to prevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="de91f-123">Ezért győződjön meg arról, hogy a kibővített és skálázási a küszöbértékeket megfelelően különböző lemezterületet Between skálázás engedélyezéséhez.</span><span class="sxs-lookup"><span data-stu-id="de91f-123">Therefore make sure your scale-out and scale-in thresholds are sufficiently different to allow some space in between scaling.</span></span>
* <span data-ttu-id="de91f-124">Volt-e írási saját JSON-sablon?</span><span class="sxs-lookup"><span data-stu-id="de91f-124">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="de91f-125">Könnyen vétett, így start hasonlóan működnek, és kis növekményes módosításokat bizonyítottan egyet, amely fölött a sablon is.</span><span class="sxs-lookup"><span data-stu-id="de91f-125">It is easy to make mistakes, so start with a template like the one above which is proven to work, and make small incremental changes.</span></span> 
* <span data-ttu-id="de91f-126">Ön manuálisan méretezhető bejövő vagy kimenő?</span><span class="sxs-lookup"><span data-stu-id="de91f-126">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="de91f-127">Próbálja meg újratelepíteni a Virtuálisgép-méretezési csoportban erőforrás manuálisan módosíthatja a virtuális gépek száma különböző "kapacitás" beállítással.</span><span class="sxs-lookup"><span data-stu-id="de91f-127">Try redeploying the VM Scale Set resource with a different “capacity” setting to change the number of VMs manually.</span></span> <span data-ttu-id="de91f-128">Egy példa sablon ehhez a következő helyen: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – ellenőrizze, hogy a gép méretének, a méretezési készlet által használt sablon szerkesztése szeretne.</span><span class="sxs-lookup"><span data-stu-id="de91f-128">An example template to do this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need to edit the template to make sure it has the same machine size as your Scale Set is using.</span></span> <span data-ttu-id="de91f-129">Ha a virtuális gépek számát manuálisan sikeresen módosítja, akkor tudja, automatikus skálázási okozza a problémát.</span><span class="sxs-lookup"><span data-stu-id="de91f-129">If you can successfully change the number of VMs manually, then you know the problem is isolated to autoscale.</span></span>
* <span data-ttu-id="de91f-130">Ellenőrizze a Microsoft.Compute/virtualMachineScaleSet és Microsoft.Insights erőforrások a [Azure erőforrás-kezelővel](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="de91f-130">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in the [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="de91f-131">Ez az egy elengedhetetlen hibaelhárítási eszköz, amely jelzi, hogy az Azure Resource Manager-erőforrások állapotát.</span><span class="sxs-lookup"><span data-stu-id="de91f-131">This is an indispensable troubleshooting tool which shows you the state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="de91f-132">Kattintson az előfizetését, és tekintse meg az erőforráscsoport hibaelhárítást.</span><span class="sxs-lookup"><span data-stu-id="de91f-132">Click on your subscription and look at the Resource Group you are troubleshooting.</span></span> <span data-ttu-id="de91f-133">A számítási erőforrás-szolgáltató tekintse meg a Virtuálisgép-méretezési csoportban létrehozott, és ellenőrizze a példányait tartalmazó nézetet, amely jelzi, hogy egy központi telepítésének állapotát.</span><span class="sxs-lookup"><span data-stu-id="de91f-133">Under the Compute resource provider look at the VM Scale Set you created and check the Instance View, which shows you the state of a deployment.</span></span> <span data-ttu-id="de91f-134">A Virtuálisgép-méretezési csoportban lévő virtuális gépek példányait tartalmazó nézetet is ellenőrizheti.</span><span class="sxs-lookup"><span data-stu-id="de91f-134">Also check the instance view of VMs in the VM Scale Set.</span></span> <span data-ttu-id="de91f-135">Ezután használja fel a Microsoft.Insights erőforrás-szolgáltató, és ellenőrizze, hogy az automatikus skálázási szabályok szépen.</span><span class="sxs-lookup"><span data-stu-id="de91f-135">Then go into the Microsoft.Insights resource provider and check the autoscale rules look good.</span></span>
* <span data-ttu-id="de91f-136">A diagnosztikai bővítmény működik és teljesítményadatokat kibocsátó?</span><span class="sxs-lookup"><span data-stu-id="de91f-136">Is the Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="de91f-137">**Frissítés:** Azure automatikus skálázás használatához telepíteni kell egy diagnosztikai bővítmény már nem igénylő állomás alapú metrikák adatcsatorna bővült.</span><span class="sxs-lookup"><span data-stu-id="de91f-137">**Update:** Azure autoscale has been enhanced to use a host based metrics pipeline which no longer requires a diagnostics extension to be installed.</span></span> <span data-ttu-id="de91f-138">Ez azt jelenti, hogy a következő néhány bekezdések már nem érvényes, ha létrehoz egy automatikus skálázás alkalmazást az új kimenetátirányításának segítségével.</span><span class="sxs-lookup"><span data-stu-id="de91f-138">This means the next few paragraphs no longer apply if you create an autoscaling application using the new pipeline.</span></span> <span data-ttu-id="de91f-139">Azure-sablonok, amely használata a gazdagép-feldolgozási folyamat konvertált például: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="de91f-139">An example of Azure templates which have been converted to use the host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="de91f-140">Állomásalapú metrikákat használ az automatikus skálázási célszerűbb a következők lehetnek az okai:</span><span class="sxs-lookup"><span data-stu-id="de91f-140">Using host based metrics for autoscale is better for the following reasons:</span></span>
  
  * <span data-ttu-id="de91f-141">Nincs diagnosztika kiterjesztéseket kevesebb mozgó elemeket kell telepíteni.</span><span class="sxs-lookup"><span data-stu-id="de91f-141">Fewer moving parts as no diagnostics extensions need to be installed.</span></span>
  * <span data-ttu-id="de91f-142">Egyszerűbb sablonok.</span><span class="sxs-lookup"><span data-stu-id="de91f-142">Simpler templates.</span></span> <span data-ttu-id="de91f-143">Elemzések automatikus skálázási szabályok csak hozzáadása egy meglévő sablon méretezési beállítása.</span><span class="sxs-lookup"><span data-stu-id="de91f-143">Just add insights autoscale rules to an existing scale set template.</span></span>
  * <span data-ttu-id="de91f-144">További megbízható reporting, és új virtuális gépek gyorsabb indítása.</span><span class="sxs-lookup"><span data-stu-id="de91f-144">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="de91f-145">A csak miatt előfordulhat, hogy szeretnék használni a diagnosztikai bővítmény lenne, ha szüksége memória diagnosztika reporting/méretezés.</span><span class="sxs-lookup"><span data-stu-id="de91f-145">The only reasons you might want to keep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="de91f-146">A gazdagép alapú metrikák nem jelentik a memória.</span><span class="sxs-lookup"><span data-stu-id="de91f-146">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="de91f-147">Vele szem előtt csak ha kövesse az ebben a cikkben a többi diagnosztikai bővítmények továbbra is használja az automatikus skálázást.</span><span class="sxs-lookup"><span data-stu-id="de91f-147">With that in mind, only follow the rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="de91f-148">Az Azure Resource Manager automatikus skálázás együttműködhet (de már nem rendelkezik) segítségével a virtuális gépek bővítmény a diagnosztika bővítmény neve.</span><span class="sxs-lookup"><span data-stu-id="de91f-148">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called the Diagnostics Extension.</span></span> <span data-ttu-id="de91f-149">Az megfelelően kibocsát egy tárfiókot, akkor meghatározhatja a sablonban teljesítményadatok.</span><span class="sxs-lookup"><span data-stu-id="de91f-149">It emits performance data to a storage account you define in the template.</span></span> <span data-ttu-id="de91f-150">Ezeket az adatokat az Azure-figyelő szolgáltatás majd összesíti.</span><span class="sxs-lookup"><span data-stu-id="de91f-150">This data is then aggregated by the Azure Monitor service.</span></span>
    
    <span data-ttu-id="de91f-151">Ha a Insights szolgáltatás nem tudja olvasni az adatokat a virtuális gépek, azt kellene küldjön egy e-mailt – például ha a virtuális gépeket le, így nézze meg leveleit, (egy az Azure-fiók létrehozásakor meghatározott).</span><span class="sxs-lookup"><span data-stu-id="de91f-151">If the Insights service can’t read data from the VMs, it is supposed to send you an email – for example if the VMs were down, so check your email (the one you specified when creating the Azure account).</span></span>
    
    <span data-ttu-id="de91f-152">Is megnyithatja, és keresse meg az adatok.</span><span class="sxs-lookup"><span data-stu-id="de91f-152">You can also go and look at the data yourself.</span></span> <span data-ttu-id="de91f-153">Tekintse meg az Azure storage-fiók egy cloud explorer használatával.</span><span class="sxs-lookup"><span data-stu-id="de91f-153">Look at the Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="de91f-154">Például a használatával a [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), jelentkezzen be, és mentse az Azure-előfizetés használata, és a diagnosztikai tárfiók neve a központi telepítési sablont diagnosztika bővítmény definíciójában hivatkozott...</span><span class="sxs-lookup"><span data-stu-id="de91f-154">For example using the [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick the Azure subscription you’re using, and the Diagnostics storage account name referenced in the Diagnostics extension definition in your deployment template..</span></span>
    
    ![Cloud Explorer][explorer]
    
    <span data-ttu-id="de91f-156">Itt jelenik meg az egyes virtuális gépek adatainak tárolására táblák egy csoportját.</span><span class="sxs-lookup"><span data-stu-id="de91f-156">Here you will see a bunch of tables where the data from each VM is being stored.</span></span> <span data-ttu-id="de91f-157">Linux és a CPU-metrika tegyük fel, keresse meg a legutóbbi sorok.</span><span class="sxs-lookup"><span data-stu-id="de91f-157">Taking Linux and the CPU metric as an example, look at the most recent rows.</span></span> <span data-ttu-id="de91f-158">A Visual Studio cloud explorer lekérdezésnyelvet támogatja, így például a lekérdezés futtatása "időbélyeg gt dátum és idő" 2016-02-02T21:20:00Z "" a ügyeljen arra, hogy a megtartott legutóbbi események (feltételezik időpontja UTC szerint).</span><span class="sxs-lookup"><span data-stu-id="de91f-158">The Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” to make sure you get the most recent events (assume time is in UTC).</span></span> <span data-ttu-id="de91f-159">Nem látható nem felel meg a skálázási szabályok állíthat be az adatokat?</span><span class="sxs-lookup"><span data-stu-id="de91f-159">Does the data you see in there correspond to the scale rules you set up?</span></span> <span data-ttu-id="de91f-160">Az alábbi példában a CPU, a gép 20 elindítva, az elmúlt 5 percben 100 %-os növelését...</span><span class="sxs-lookup"><span data-stu-id="de91f-160">In the example below, the CPU for machine 20 started increasing to 100% over the last 5 minutes..</span></span>
    
    ![Tárolási táblák][tables]
    
    <span data-ttu-id="de91f-162">Ha az adatok nem létezik, majd ez arra utalhat, a probléma van a virtuális gépeken futó diagnosztikai kiterjesztéssel.</span><span class="sxs-lookup"><span data-stu-id="de91f-162">If the data is not there, then it implies the problem is with the diagnostic extension running in the VMs.</span></span> <span data-ttu-id="de91f-163">Ha az adatok ott, ez arra utalhat, vagy probléma a skála szabályokkal, vagy a Insights szolgáltatással.</span><span class="sxs-lookup"><span data-stu-id="de91f-163">If the data is there, it implies there is either a problem with your scale rules, or with the Insights service.</span></span> <span data-ttu-id="de91f-164">Ellenőrizze [Azure állapot](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="de91f-164">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="de91f-165">Amennyiben azt, hogy a fenti lépéseket, ha továbbra is problémák automatikus skálázás próbálkozzon a fórumok [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), vagy [veremtúlcsordulás](http://stackoverflow.com/questions/tagged/azure), vagy a támogatási hívás.</span><span class="sxs-lookup"><span data-stu-id="de91f-165">Once you’ve been through these steps, if you are still having autoscale problems you could try the forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="de91f-166">Készüljön megosztani a sablont és a teljesítményadatokat nézetét.</span><span class="sxs-lookup"><span data-stu-id="de91f-166">Be prepared to share the template and a view of the performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png
