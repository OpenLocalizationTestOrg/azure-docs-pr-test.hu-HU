---
title: "aaaUsing elastic database ügyféloldali kódtár az Entity Framework |} Microsoft Docs"
description: "Elastic Database ügyféloldali kódtár és Entity Framework használja az adatbázisok kódolása"
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
editor: 
ms.assetid: b9c3065b-cb92-41be-aa7f-deba23e7e159
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/06/2017
ms.author: torsteng
ms.openlocfilehash: 917f6d28d9855c0b42afe2c008613a9bbb3ec6b6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="elastic-database-client-library-with-entity-framework"></a><span data-ttu-id="bd52b-103">Az Entity Framework rugalmas adatbázis ügyféloldali kódtár</span><span class="sxs-lookup"><span data-stu-id="bd52b-103">Elastic Database client library with Entity Framework</span></span>
<span data-ttu-id="bd52b-104">Ez a dokumentum hello módosítások mutatja az Entity Framework alkalmazásban, amelyek a hello szükséges toointegrate [skálázáshoz rugalmas adatbáziseszközöket](sql-database-elastic-scale-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="bd52b-104">This document shows hello changes in an Entity Framework application that are needed toointegrate with hello [Elastic Database tools](sql-database-elastic-scale-introduction.md).</span></span> <span data-ttu-id="bd52b-105">hello elsősorban összeállítása [shard térkép felügyeleti](sql-database-elastic-scale-shard-map-management.md) és [adatok függő útválasztási](sql-database-elastic-scale-data-dependent-routing.md) az Entity Framework hello **Code First** megközelítést.</span><span class="sxs-lookup"><span data-stu-id="bd52b-105">hello focus is on composing [shard map management](sql-database-elastic-scale-shard-map-management.md) and [data-dependent routing](sql-database-elastic-scale-data-dependent-routing.md) with hello Entity Framework **Code First** approach.</span></span> <span data-ttu-id="bd52b-106">Hello [Code először - új adatbázis](http://msdn.microsoft.com/data/jj193542.aspx) EF útmutató futó példánkban ez a dokumentum funkcionál.</span><span class="sxs-lookup"><span data-stu-id="bd52b-106">hello [Code First - New Database](http://msdn.microsoft.com/data/jj193542.aspx) tutorial for EF serves as our running example throughout this document.</span></span> <span data-ttu-id="bd52b-107">Ez a dokumentum kísérő hello mintakód minták a Visual Studio-Kódminták hello beállítása rugalmas adatbázis eszközök részét képezi.</span><span class="sxs-lookup"><span data-stu-id="bd52b-107">hello sample code accompanying this document is part of elastic database tools' set of samples in hello Visual Studio Code Samples.</span></span>

## <a name="downloading-and-running-hello-sample-code"></a><span data-ttu-id="bd52b-108">Töltsön le és futtasson hello mintakód</span><span class="sxs-lookup"><span data-stu-id="bd52b-108">Downloading and Running hello Sample Code</span></span>
<span data-ttu-id="bd52b-109">Ez a cikk toodownload hello kódját:</span><span class="sxs-lookup"><span data-stu-id="bd52b-109">toodownload hello code for this article:</span></span>

* <span data-ttu-id="bd52b-110">A Visual Studio 2012 vagy újabb rendszer szükséges.</span><span class="sxs-lookup"><span data-stu-id="bd52b-110">Visual Studio 2012 or later is required.</span></span> 
* <span data-ttu-id="bd52b-111">Töltse le a hello [rugalmas adatbázis-eszközök az Azure SQL - entitás Keretrendszeri integrációját minta](https://code.msdn.microsoft.com/windowsapps/Elastic-Scale-with-Azure-bae904ba) msdn.</span><span class="sxs-lookup"><span data-stu-id="bd52b-111">Download hello [Elastic DB Tools for Azure SQL - Entity Framework Integration sample](https://code.msdn.microsoft.com/windowsapps/Elastic-Scale-with-Azure-bae904ba) from MSDN.</span></span> <span data-ttu-id="bd52b-112">Bontsa ki a hello minta tooa helye a.</span><span class="sxs-lookup"><span data-stu-id="bd52b-112">Unzip hello sample tooa location of your choosing.</span></span>
* <span data-ttu-id="bd52b-113">Indítsa el a Visual Studiót.</span><span class="sxs-lookup"><span data-stu-id="bd52b-113">Start Visual Studio.</span></span> 
* <span data-ttu-id="bd52b-114">A Visual Studio alkalmazásban válassza ki a fájl -> Nyissa meg a projekt/megoldás.</span><span class="sxs-lookup"><span data-stu-id="bd52b-114">In Visual Studio, select File -> Open Project/Solution.</span></span> 
* <span data-ttu-id="bd52b-115">A hello **projekt megnyitása** párbeszédpanelen keresse meg a letöltött toohello mintát, és válassza ki **EntityFrameworkCodeFirst.sln** tooopen hello minta.</span><span class="sxs-lookup"><span data-stu-id="bd52b-115">In hello **Open Project** dialog, navigate toohello sample you downloaded and select **EntityFrameworkCodeFirst.sln** tooopen hello sample.</span></span> 

<span data-ttu-id="bd52b-116">toorun hello minta toocreate három üres adatbázist, az Azure SQL Database kell:</span><span class="sxs-lookup"><span data-stu-id="bd52b-116">toorun hello sample, you need toocreate three empty databases in Azure SQL Database:</span></span>

* <span data-ttu-id="bd52b-117">A shard térkép Manager-adatbázis</span><span class="sxs-lookup"><span data-stu-id="bd52b-117">Shard Map Manager database</span></span>
* <span data-ttu-id="bd52b-118">A shard 1 adatbázis</span><span class="sxs-lookup"><span data-stu-id="bd52b-118">Shard 1 database</span></span>
* <span data-ttu-id="bd52b-119">A shard 2 adatbázis</span><span class="sxs-lookup"><span data-stu-id="bd52b-119">Shard 2 database</span></span>

<span data-ttu-id="bd52b-120">Miután létrehozta ezeket az adatbázisokat, töltse ki hello hely tulajdonosainak **Program.cs** az Azure SQL adatbázis-kiszolgáló neve, hello adatbázis nevét és a hitelesítő adatok tooconnect toohello adatbázisok.</span><span class="sxs-lookup"><span data-stu-id="bd52b-120">Once you have created these databases, fill in hello place holders in **Program.cs** with your Azure SQL DB server name, hello database names and your credentials tooconnect toohello databases.</span></span> <span data-ttu-id="bd52b-121">A Visual Studio hello megoldás felépítéséhez.</span><span class="sxs-lookup"><span data-stu-id="bd52b-121">Build hello solution in Visual Studio.</span></span> <span data-ttu-id="bd52b-122">A Visual Studio szükséges hello NuGet-csomagok hello elastic database ügyféloldali kódtárának, Entity Framework és átmeneti hiba kezelése hello felépítési folyamat részeként fogja letölteni.</span><span class="sxs-lookup"><span data-stu-id="bd52b-122">Visual Studio will download hello required NuGet packages for hello elastic database client library, Entity Framework, and Transient Fault handling as part of hello build process.</span></span> <span data-ttu-id="bd52b-123">Győződjön meg arról, hogy a megoldás NuGet-csomagok visszaállítására engedélyezve.</span><span class="sxs-lookup"><span data-stu-id="bd52b-123">Make sure that restoring NuGet packages is enabled for your solution.</span></span> <span data-ttu-id="bd52b-124">Kattintson a jobb gombbal a hello megoldásfájlt a Visual Studio Solution Explorer hello engedélyezheti ezt a beállítást.</span><span class="sxs-lookup"><span data-stu-id="bd52b-124">You can enable this setting by right-clicking on hello solution file in hello Visual Studio Solution Explorer.</span></span> 

## <a name="entity-framework-workflows"></a><span data-ttu-id="bd52b-125">Entity Framework munkafolyamatai</span><span class="sxs-lookup"><span data-stu-id="bd52b-125">Entity Framework workflows</span></span>
<span data-ttu-id="bd52b-126">Entitás-keretrendszer fejlesztői támaszkodjon a következő négy munkafolyamatok toobuild alkalmazások és alkalmazás objektumának tooensure megőrzését hello egyikét:</span><span class="sxs-lookup"><span data-stu-id="bd52b-126">Entity Framework developers rely on one of hello following four workflows toobuild applications and tooensure persistence for application objects:</span></span> 

* <span data-ttu-id="bd52b-127">**Első (új adatbázis) code**: hello EF fejlesztői hello alkalmazáskód hello modell hoz létre, és ezután EF generál, hello adatbázis.</span><span class="sxs-lookup"><span data-stu-id="bd52b-127">**Code First (New Database)**: hello EF developer creates hello model in hello application code and then EF generates hello database from it.</span></span> 
* <span data-ttu-id="bd52b-128">**Első (meglévő adatbázis) code**: hello fejlesztői lehetővé teszi, hogy az EF hello alkalmazáskód hello modell generálása egy meglévő adatbázist.</span><span class="sxs-lookup"><span data-stu-id="bd52b-128">**Code First (Existing Database)**: hello developer lets EF generate hello application code for hello model from an existing database.</span></span>
* <span data-ttu-id="bd52b-129">**A modell első**: hello fejlesztői hello EF designer hello modell hoz létre, és ezután EF hoz létre hello adatbázis hello modellből.</span><span class="sxs-lookup"><span data-stu-id="bd52b-129">**Model First**: hello developer creates hello model in hello EF designer and then EF creates hello database from hello model.</span></span>
* <span data-ttu-id="bd52b-130">**Adatbázis-első**: hello fejlesztő EF tooling eszköz tooinfer hello modellt egy meglévő adatbázist.</span><span class="sxs-lookup"><span data-stu-id="bd52b-130">**Database First**: hello developer uses EF tooling tooinfer hello model from an existing database.</span></span> 

<span data-ttu-id="bd52b-131">Ezek a módszerek hello DbContext osztályt tootransparently támaszkodnak az összes adatbázis-kapcsolatok és adatbázisséma egy alkalmazás kezelése.</span><span class="sxs-lookup"><span data-stu-id="bd52b-131">All these approaches rely on hello DbContext class tootransparently manage database connections and database schema for an application.</span></span> <span data-ttu-id="bd52b-132">Ismertetik részletesebben hello dokumentum későbbi szakaszában hello DbContext alaposztályban különböző konstruktorok lehetővé teszik a különböző szintű kapcsolat létrehozásakor, ellenőrzésre adatbázis rendszerindítása és séma létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="bd52b-132">As we will discuss in more detail later in hello document, different constructors on hello DbContext base class allow for different levels of control over connection creation, database bootstrapping and schema creation.</span></span> <span data-ttu-id="bd52b-133">Kihívást erednek elsősorban hello tényt, hogy hello adatbázis kapcsolat kezelése EF által biztosított metszi hello kapcsolat kezelésére alkalmas hello adatok függő útválasztási felületek megadott hello elastic database ügyféloldali kódtár által.</span><span class="sxs-lookup"><span data-stu-id="bd52b-133">Challenges arise primarily from hello fact that hello database connection management provided by EF intersects with hello connection management capabilities of hello data dependent routing interfaces provided by hello elastic database client library.</span></span> 

## <a name="elastic-database-tools-assumptions"></a><span data-ttu-id="bd52b-134">A rugalmas adatbázis eszközök Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="bd52b-134">Elastic database tools assumptions</span></span>
<span data-ttu-id="bd52b-135">Kifejezés-definíciók, lásd: [rugalmas adatbázis eszközök szószedet](sql-database-elastic-scale-glossary.md).</span><span class="sxs-lookup"><span data-stu-id="bd52b-135">For term definitions, see [Elastic Database tools glossary](sql-database-elastic-scale-glossary.md).</span></span>

<span data-ttu-id="bd52b-136">A rugalmas adatbázis ügyféloldali kódtár az alkalmazásadatok shardlets nevű partíciója határozza meg.</span><span class="sxs-lookup"><span data-stu-id="bd52b-136">With elastic database client library, you define partitions of your application data called shardlets.</span></span> <span data-ttu-id="bd52b-137">Shardlets egy horizontális skálázási kulcs azonosítják, és a csatlakoztatott toospecific adatbázis.</span><span class="sxs-lookup"><span data-stu-id="bd52b-137">Shardlets are identified by a sharding key and are mapped toospecific databases.</span></span> <span data-ttu-id="bd52b-138">Az alkalmazások előfordulhat, hogy annyi adatbázis igény szerint és terjesztése hello shardlets tooprovide elég kapacitás vagy a teljesítmény aktuális üzleti követelmények.</span><span class="sxs-lookup"><span data-stu-id="bd52b-138">An application may have as many databases as needed and distribute hello shardlets tooprovide enough capacity or performance given current business requirements.</span></span> <span data-ttu-id="bd52b-139">horizontális kulcsértékei toohello adatbázisok hello leképezése egy hello rugalmas adatbázis-ügyfél API-k által megadott shard leképezés tárolja.</span><span class="sxs-lookup"><span data-stu-id="bd52b-139">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello elastic database client APIs.</span></span> <span data-ttu-id="bd52b-140">Ez a funkció hívása **Shard térkép felügyeleti**, vagy röviden SMM.</span><span class="sxs-lookup"><span data-stu-id="bd52b-140">We call this capability **Shard Map Management**, or SMM for short.</span></span> <span data-ttu-id="bd52b-141">hello shard térkép hello broker az adatbázis-kapcsolatok a kéréseket, amelyben egy horizontális skálázási kulcsot is funkcionál.</span><span class="sxs-lookup"><span data-stu-id="bd52b-141">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="bd52b-142">Toothis funkció szerint irányítjuk **adatok függő útválasztási**.</span><span class="sxs-lookup"><span data-stu-id="bd52b-142">We refer toothis capability as **data-dependent routing**.</span></span> 

<span data-ttu-id="bd52b-143">hello shard térkép kezelő felhasználók védi a inkonzisztens nézetek, amely akkor fordulhat elő, amikor párhuzamos shardlet felügyeleti műveletek (például egy shard tooanother költöztetésére adatait) hogy shardlet adatokká.</span><span class="sxs-lookup"><span data-stu-id="bd52b-143">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations (such as relocating data from one shard tooanother) are happening.</span></span> <span data-ttu-id="bd52b-144">toodo tehát hello hello ügyfél könyvtár broker hello Helyadatbázis-kapcsolatot az alkalmazás által kezelt shard leképezések.</span><span class="sxs-lookup"><span data-stu-id="bd52b-144">toodo so, hello shard maps managed by hello client library broker hello database connections for an application.</span></span> <span data-ttu-id="bd52b-145">Ez lehetővé teszi, hogy hello shard leképezés funkció tooautomatically kill adatbázis-kapcsolat amikor shard felügyeleti műveletek jelentős hatással lehet a hello shardlet hello kapcsolat számára lett létrehozva.</span><span class="sxs-lookup"><span data-stu-id="bd52b-145">This allows hello shard map functionality tooautomatically kill a database connection when shard management operations could impact hello shardlet that hello connection has been created for.</span></span> <span data-ttu-id="bd52b-146">Ez a megközelítés kell toointegrate egyes EF-EK funkciókat, például új kapcsolatok létrehozása egy létező egy toocheck az adatbázis létezését.</span><span class="sxs-lookup"><span data-stu-id="bd52b-146">This approach needs toointegrate with some of EF’s functionality, such as creating new connections from an existing one toocheck for database existence.</span></span> <span data-ttu-id="bd52b-147">Általában a megfigyelés le lett, hogy hello szabványos DbContext konstruktorok csak működik megbízhatóan biztonságosan klónozható lezárt adatbázis-kapcsolatok az EF munka.</span><span class="sxs-lookup"><span data-stu-id="bd52b-147">In general, our observation has been that hello standard DbContext constructors only work reliably for closed database connections that can safely be cloned for EF work.</span></span> <span data-ttu-id="bd52b-148">rugalmas kialakítás elve hello helyette tooonly megnyitott broker kapcsolatok.</span><span class="sxs-lookup"><span data-stu-id="bd52b-148">hello design principle of elastic database instead is tooonly broker opened connections.</span></span> <span data-ttu-id="bd52b-149">Egy hiszi, hogy egy előtt átadása akkor toohello EF DbContext hello ügyféloldali kódtár által közvetítőalapú kapcsolat bezárása előfordulhat, hogy a probléma megoldására.</span><span class="sxs-lookup"><span data-stu-id="bd52b-149">One might think that closing a connection brokered by hello client library before handing it over toohello EF DbContext may solve this issue.</span></span> <span data-ttu-id="bd52b-150">Azonban hello kapcsolat bezárása, és a függő EF toore-megnyitáskor, egy foregoes hello érvényesítési és konzisztencia-ellenőrzést hello szalagtár végzi.</span><span class="sxs-lookup"><span data-stu-id="bd52b-150">However, by closing hello connection and relying on EF toore-open it, one foregoes hello validation and consistency checks performed by hello library.</span></span> <span data-ttu-id="bd52b-151">hello áttelepítések funkció EF, azonban használja ezeket az alapul szolgáló adatbázisséma oly módon, hogy transzparens toohello alkalmazás kapcsolatok toomanage hello.</span><span class="sxs-lookup"><span data-stu-id="bd52b-151">hello migrations functionality in EF, however, uses these connections toomanage hello underlying database schema in a way that is transparent toohello application.</span></span> <span data-ttu-id="bd52b-152">Ideális esetben azt kívánja tooretain, majd minden ezeket a képességeket hello elastic database ügyféloldali kódtár és EF a hello egyesítése ugyanahhoz az alkalmazáshoz.</span><span class="sxs-lookup"><span data-stu-id="bd52b-152">Ideally, we would like tooretain and combine all these capabilities from both hello elastic database client library and EF in hello same application.</span></span> <span data-ttu-id="bd52b-153">hello alábbi szakasz ismerteti ezek a tulajdonságok és részletes követelményeket.</span><span class="sxs-lookup"><span data-stu-id="bd52b-153">hello following section discusses these properties and requirements in more detail.</span></span> 

## <a name="requirements"></a><span data-ttu-id="bd52b-154">Követelmények</span><span class="sxs-lookup"><span data-stu-id="bd52b-154">Requirements</span></span>
<span data-ttu-id="bd52b-155">Hello elastic database ügyféloldali kódtárának és a Entity Framework API-k használata, ha azt szeretnénk, ha tooretain hello következő tulajdonságai:</span><span class="sxs-lookup"><span data-stu-id="bd52b-155">When working with both hello elastic database client library and Entity Framework APIs, we want tooretain hello following properties:</span></span> 

* <span data-ttu-id="bd52b-156">**Kibővített**: hello adatrétegbeli alkalmazási hello szilánkos hello kapacitás iránti igények kielégítése érdekében a megfelelő hello alkalmazás tooadd vagy a remove-adatbázisok.</span><span class="sxs-lookup"><span data-stu-id="bd52b-156">**Scale-out**: tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> <span data-ttu-id="bd52b-157">Ez azt jelenti, hogy az ellenőrzése alatt tartja a adatbázisok és hello rugalmas adatbázis shard térkép manager API-k toomanage adatbázisok és shardlets leképezéseit segítségével hello hello létrehozását és törlését.</span><span class="sxs-lookup"><span data-stu-id="bd52b-157">This means control over hello hello creation and deletion of databases and using hello elastic database shard map manager APIs toomanage databases, and mappings of shardlets.</span></span> 
* <span data-ttu-id="bd52b-158">**Konzisztencia**: hello alkalmazás horizontális alkalmazza, és használja az adatok függő útválasztási képességek hello ügyféloldali kódtár hello.</span><span class="sxs-lookup"><span data-stu-id="bd52b-158">**Consistency**: hello application employs sharding, and uses hello data dependent routing capabilities of hello client library.</span></span> <span data-ttu-id="bd52b-159">tooavoid sérülés vagy hibás lekérdezések eredményeit, kapcsolatok keresztül van-e közvetítőalapú hello shard térkép manager.</span><span class="sxs-lookup"><span data-stu-id="bd52b-159">tooavoid corruption or wrong query results, connections are brokered through hello shard map manager.</span></span> <span data-ttu-id="bd52b-160">Ez megőrzi a érvényesítése és a konzisztencia is.</span><span class="sxs-lookup"><span data-stu-id="bd52b-160">This also retains validation and consistency.</span></span>
* <span data-ttu-id="bd52b-161">**Első Code**: az EF-EK kód első paradigma tooretain hello kényelmi célokat szolgál.</span><span class="sxs-lookup"><span data-stu-id="bd52b-161">**Code First**: tooretain hello convenience of EF’s code first paradigm.</span></span> <span data-ttu-id="bd52b-162">A kód első osztályok hello alkalmazás átlátható módon vannak leképezve az alapul szolgáló adatbázis felépítését toohello.</span><span class="sxs-lookup"><span data-stu-id="bd52b-162">In Code First, classes in hello application are mapped transparently toohello underlying database structures.</span></span> <span data-ttu-id="bd52b-163">hello alkalmazáskód, amely a legtöbb területét az alapul szolgáló adatbázis-feldolgozási hello részt maszkolnia DbSets kommunikál.</span><span class="sxs-lookup"><span data-stu-id="bd52b-163">hello application code interacts with DbSets that mask most aspects involved in hello underlying database processing.</span></span>
* <span data-ttu-id="bd52b-164">**Séma**: Entity Framework kezdeti adatbázis-séma létrehozása és későbbi séma alakulása áttelepítések keresztül kezeli.</span><span class="sxs-lookup"><span data-stu-id="bd52b-164">**Schema**: Entity Framework handles initial database schema creation and subsequent schema evolution through migrations.</span></span> <span data-ttu-id="bd52b-165">Megtartja ezeket a képességeket, az alkalmazás testreszabásához az adatok fejlődésének hello legkönnyebben.</span><span class="sxs-lookup"><span data-stu-id="bd52b-165">By retaining these capabilities, adapting your app is easy as hello data evolves.</span></span> 

<span data-ttu-id="bd52b-166">hello következő útmutatást arra utasítja a hogyan toosatisfy rugalmas adatbáziseszközöket Code First alkalmazásokhoz követelménynek.</span><span class="sxs-lookup"><span data-stu-id="bd52b-166">hello following guidance instructs how toosatisfy these requirements for Code First applications using elastic database tools.</span></span> 

## <a name="data-dependent-routing-using-ef-dbcontext"></a><span data-ttu-id="bd52b-167">Az adatok függő útválasztás EF DbContext használata</span><span class="sxs-lookup"><span data-stu-id="bd52b-167">Data dependent routing using EF DbContext</span></span>
<span data-ttu-id="bd52b-168">Adatbázis-kapcsolatok az Entity Framework általában kezelhetők alosztályokat **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="bd52b-168">Database connections with Entity Framework are typically managed through subclasses of **DbContext**.</span></span> <span data-ttu-id="bd52b-169">Hozzon létre a alosztályok származó **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="bd52b-169">Create these subclasses by deriving from **DbContext**.</span></span> <span data-ttu-id="bd52b-170">Itt adhatja meg azt a **DbSets** amelyek megvalósítják az hello adatbázisról biztonsági objektumok gyűjteményeit adják CLR az alkalmazáshoz.</span><span class="sxs-lookup"><span data-stu-id="bd52b-170">This is where you define your **DbSets** that implement hello database-backed collections of CLR objects for your application.</span></span> <span data-ttu-id="bd52b-171">Az adatok függő útválasztási hello a környezetben azt nem feltétlenül vonatkozik az egyéb EF code első alkalmazás forgatókönyvek, amelyek számos hasznos tulajdonság azonosíthatja:</span><span class="sxs-lookup"><span data-stu-id="bd52b-171">In hello context of data dependent routing, we can identify several helpful properties that do not necessarily hold for other EF code first application scenarios:</span></span> 

* <span data-ttu-id="bd52b-172">hello adatbázis már létezik, és hello rugalmas adatbázis shard leképezés regisztrálva van.</span><span class="sxs-lookup"><span data-stu-id="bd52b-172">hello database already exists and has been registered in hello elastic database shard map.</span></span> 
* <span data-ttu-id="bd52b-173">hello séma hello alkalmazás már üzembe helyezett toohello adatbázis (alábbi leírásban is).</span><span class="sxs-lookup"><span data-stu-id="bd52b-173">hello schema of hello application has already been deployed toohello database (explained below).</span></span> 
* <span data-ttu-id="bd52b-174">Adatok függő útválasztási kapcsolatok toohello adatbázis által hello shard térkép vannak közvetítőalapú.</span><span class="sxs-lookup"><span data-stu-id="bd52b-174">Data-dependent routing connections toohello database are brokered by hello shard map.</span></span> 

<span data-ttu-id="bd52b-175">toointegrate **DbContexts** kibővített az útválasztási adatok függő:</span><span class="sxs-lookup"><span data-stu-id="bd52b-175">toointegrate **DbContexts** with data-dependent routing for scale-out:</span></span>

1. <span data-ttu-id="bd52b-176">Hello shard térkép Manager hello rugalmas adatbázis ügyfél felületeken keresztül fizikai adatbázis-kapcsolatok létrehozása</span><span class="sxs-lookup"><span data-stu-id="bd52b-176">Create physical database connections through hello elastic database client interfaces of hello shard map manager,</span></span> 
2. <span data-ttu-id="bd52b-177">Hello hello kapcsolatot burkolása **DbContext** alosztálya lesz</span><span class="sxs-lookup"><span data-stu-id="bd52b-177">Wrap hello connection with hello **DbContext** subclass</span></span>
3. <span data-ttu-id="bd52b-178">Hello kapcsolat továbbítja hello **DbContext** osztályok tooensure összes hello feldolgozási hello EF oldalon történik is létrehozhatja.</span><span class="sxs-lookup"><span data-stu-id="bd52b-178">Pass hello connection down into hello **DbContext** base classes tooensure all hello processing on hello EF side happens as well.</span></span> 

<span data-ttu-id="bd52b-179">a következő példakód hello mutatja be ezt a módszert használja.</span><span class="sxs-lookup"><span data-stu-id="bd52b-179">hello following code example illustrates this approach.</span></span> <span data-ttu-id="bd52b-180">(Ez a kód egyben a Visual Studio-projekt kísérő hello)</span><span class="sxs-lookup"><span data-stu-id="bd52b-180">(This code is also in hello accompanying Visual Studio project)</span></span>

    public class ElasticScaleContext<T> : DbContext
    {
    public DbSet<Blog> Blogs { get; set; }
    …

        // C'tor for data dependent routing. This call will open a validated connection 
        // routed toohello proper shard by hello shard map manager. 
        // Note that hello base class c'tor call will fail for an open connection
        // if migrations need toobe done and SQL credentials are used. This is hello reason for hello 
        // separation of c'tors into hello data-dependent routing case (this c'tor) and hello internal c'tor for new shards.
        public ElasticScaleContext(ShardMap shardMap, T shardingKey, string connectionStr)
            : base(CreateDDRConnection(shardMap, shardingKey, connectionStr), 
            true /* contextOwnsConnection */)
        {
        }

        // Only static methods are allowed in calls into base class c'tors.
        private static DbConnection CreateDDRConnection(
        ShardMap shardMap, 
        T shardingKey, 
        string connectionStr)
        {
            // No initialization
            Database.SetInitializer<ElasticScaleContext<T>>(null);

            // Ask shard map toobroker a validated connection for hello given key
            SqlConnection conn = shardMap.OpenConnectionForKey<T>
                                (shardingKey, connectionStr, ConnectionOptions.Validate);
            return conn;
        }    

## <a name="main-points"></a><span data-ttu-id="bd52b-181">Főbb pontjai</span><span class="sxs-lookup"><span data-stu-id="bd52b-181">Main points</span></span>
* <span data-ttu-id="bd52b-182">Egy új konstruktor a felváltja a hello DbContext alosztály hello alapértelmezett konstruktor</span><span class="sxs-lookup"><span data-stu-id="bd52b-182">A new constructor replaces hello default constructor in hello DbContext subclass</span></span> 
* <span data-ttu-id="bd52b-183">hello új konstruktor argumentummal hello szükséges adatok függő útválasztási elastic database ügyféloldali kódtárának keresztül:</span><span class="sxs-lookup"><span data-stu-id="bd52b-183">hello new constructor takes hello arguments that are required for data dependent routing through elastic database client library:</span></span>
  
  * <span data-ttu-id="bd52b-184">hello shard térkép tooaccess hello adatok függő útválasztási felületek,</span><span class="sxs-lookup"><span data-stu-id="bd52b-184">hello shard map tooaccess hello data-dependent routing interfaces,</span></span>
  * <span data-ttu-id="bd52b-185">hello horizontális kulcs tooidentify hello shardlet</span><span class="sxs-lookup"><span data-stu-id="bd52b-185">hello sharding key tooidentify hello shardlet,</span></span>
  * <span data-ttu-id="bd52b-186">a kapcsolati karakterlánc hello adatok függő útválasztási kapcsolat toohello shard hello hitelesítő adatait.</span><span class="sxs-lookup"><span data-stu-id="bd52b-186">a connection string with hello credentials for hello data-dependent routing connection toohello shard.</span></span> 
* <span data-ttu-id="bd52b-187">hello hívás toohello alaposztály konstruktor veszi egy detour statikus metódus, amely minden hello lépéseket végzi el az adatok függő útválasztási szükséges.</span><span class="sxs-lookup"><span data-stu-id="bd52b-187">hello call toohello base class constructor takes a detour into a static method that performs all hello steps necessary for data-dependent routing.</span></span> 
  
  * <span data-ttu-id="bd52b-188">Hello OpenConnectionForKey hívás hello rugalmas adatbázis ügyfél felületek használ a hello shard térkép tooestablish nyitott kapcsolat.</span><span class="sxs-lookup"><span data-stu-id="bd52b-188">It uses hello OpenConnectionForKey call of hello elastic database client interfaces on hello shard map tooestablish an open connection.</span></span>
  * <span data-ttu-id="bd52b-189">hello shard térkép hello nyitott kapcsolat toohello shard, amely tárolja a megadott horizontális skálázási kulcs hello hello shardlet hoz létre.</span><span class="sxs-lookup"><span data-stu-id="bd52b-189">hello shard map creates hello open connection toohello shard that holds hello shardlet for hello given sharding key.</span></span>
  * <span data-ttu-id="bd52b-190">A megnyitott kapcsolat hátsó toohello alaposztály konstruktorának, hogy ez a kapcsolat nem ahelyett, hogy automatikusan hozzon létre egy új kapcsolatot EF EF által használt toobe DbContext tooindicate lett átadva.</span><span class="sxs-lookup"><span data-stu-id="bd52b-190">This open connection is passed back toohello base class constructor of DbContext tooindicate that this connection is toobe used by EF instead of letting EF create a new connection automatically.</span></span> <span data-ttu-id="bd52b-191">A módszer hello kapcsolat címkézett hello rugalmas adatbázis ügyfél API-t, hogy garantálják, hogy a shard térkép felügyeleti műveletek konzisztencia.</span><span class="sxs-lookup"><span data-stu-id="bd52b-191">This way hello connection has been tagged by hello elastic database client API so that it can guarantee consistency under shard map management operations.</span></span>

<span data-ttu-id="bd52b-192">Új konstruktor hello használata helyett hello alapértelmezett konstruktor a kódban a DbContext alosztálya.</span><span class="sxs-lookup"><span data-stu-id="bd52b-192">Use hello new constructor for your DbContext subclass instead of hello default constructor in your code.</span></span> <span data-ttu-id="bd52b-193">Például:</span><span class="sxs-lookup"><span data-stu-id="bd52b-193">Here is an example:</span></span> 

    // Create and save a new blog.

    Console.Write("Enter a name for a new blog: "); 
    var name = Console.ReadLine(); 

    using (var db = new ElasticScaleContext<int>( 
                            sharding.ShardMap,  
                            tenantId1,  
                            connStrBldr.ConnectionString)) 
    { 
        var blog = new Blog { Name = name }; 
        db.Blogs.Add(blog); 
        db.SaveChanges(); 

        // Display all Blogs for tenant 1 
        var query = from b in db.Blogs 
                    orderby b.Name 
                    select b; 
     … 
    }

<span data-ttu-id="bd52b-194">hello új konstruktor hello kapcsolat toohello shard hello értékének által azonosított hello shardlet hello adatokat tároló megnyitása **tenantid1**.</span><span class="sxs-lookup"><span data-stu-id="bd52b-194">hello new constructor opens hello connection toohello shard that holds hello data for hello shardlet identified by hello value of **tenantid1**.</span></span> <span data-ttu-id="bd52b-195">hello kód hello **használatával** blokk marad változatlan tooaccess hello **DbSet** az EF szalaghasználata hello shard a blogok **tenantid1**.</span><span class="sxs-lookup"><span data-stu-id="bd52b-195">hello code in hello **using** block stays unchanged tooaccess hello **DbSet** for blogs using EF on hello shard for **tenantid1**.</span></span> <span data-ttu-id="bd52b-196">Ez módosítja szemantikáját blokkot használ, úgy, hogy az összes művelet most hello hello kód hatókörű toohello egy shard ahol **tenantid1** maradnak.</span><span class="sxs-lookup"><span data-stu-id="bd52b-196">This changes semantics for hello code in hello using block such that all database operations are now scoped toohello one shard where **tenantid1** is kept.</span></span> <span data-ttu-id="bd52b-197">Például a LINQ lekérdezés keresztül hello blogok **DbSet** volna csak térjen vissza a hello aktuális shard tárolt blogok, de nem hello azokat, egyéb szilánkok tárolja.</span><span class="sxs-lookup"><span data-stu-id="bd52b-197">For instance, a LINQ query over hello blogs **DbSet** would only return blogs stored on hello current shard, but not hello ones stored on other shards.</span></span>  

#### <a name="transient-faults-handling"></a><span data-ttu-id="bd52b-198">Átmeneti hibák kezelése</span><span class="sxs-lookup"><span data-stu-id="bd52b-198">Transient faults handling</span></span>
<span data-ttu-id="bd52b-199">hello Microsoft Patterns & eljárások csapat közzétett hello [hello átmeneti hiba kezelési alkalmazás blokk](https://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="bd52b-199">hello Microsoft Patterns & Practices team published hello [hello Transient Fault Handling Application Block](https://msdn.microsoft.com/library/dn440719.aspx).</span></span> <span data-ttu-id="bd52b-200">hello könyvtár a rugalmas bővítést ügyféloldali kódtár EF együtt használatos.</span><span class="sxs-lookup"><span data-stu-id="bd52b-200">hello library is used with elastic scale client library in combination with EF.</span></span> <span data-ttu-id="bd52b-201">Azonban ügyeljen arra, hogy a átmeneti kivételen tooa hely, ahol azt is ellenőrizze, hogy hello új konstruktor használja egy átmeneti hiba után, hogy minden új kapcsolódási kísérlet történik, azt kell tweaked hello konstruktorok használatával adja vissza.</span><span class="sxs-lookup"><span data-stu-id="bd52b-201">However, ensure that any transient exception returns tooa place where we can ensure that hello new constructor is being used after a transient fault so that any new connection attempt is made using hello constructors we have tweaked.</span></span> <span data-ttu-id="bd52b-202">Ellenkező esetben a kapcsolat helyes szilánkok nem garantált, és hello kapcsolat nélküli biztosítékok nincsenek toohello megmarad, módosítás toohello shard térkép fordulhat elő.</span><span class="sxs-lookup"><span data-stu-id="bd52b-202">Otherwise, a connection toohello correct shard is not guaranteed, and there are no assurances hello connection is maintained as changes toohello shard map occur.</span></span> 

<span data-ttu-id="bd52b-203">hello következő mintakód bemutatja, hogyan SQL újrapróbálkozási házirendje használható körül hello új **DbContext** alosztály konstruktorok:</span><span class="sxs-lookup"><span data-stu-id="bd52b-203">hello following code sample illustrates how a SQL retry policy can be used around hello new **DbContext** subclass constructors:</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() => 
    { 
        using (var db = new ElasticScaleContext<int>( 
                                sharding.ShardMap,  
                                tenantId1,  
                                connStrBldr.ConnectionString)) 
            { 
                    var blog = new Blog { Name = name }; 
                    db.Blogs.Add(blog); 
                    db.SaveChanges(); 
            … 
            } 
        }); 

<span data-ttu-id="bd52b-204">**SqlDatabaseUtils.SqlRetryPolicy** hello a fenti kódot típusúként van definiálva egy **SqlDatabaseTransientErrorDetectionStrategy** újrapróbálkozás-szám 10-es és 5 másodperc várjon az újrapróbálkozások között eltelt idő.</span><span class="sxs-lookup"><span data-stu-id="bd52b-204">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="bd52b-205">Ez a megközelítés hasonló toohello útmutató EF és a felhasználó által kezdeményezett tranzakció (lásd: [korlátozásai a végrehajtási stratégiák újrapróbálkozás (EF6 és újabb verziók esetében)](http://msdn.microsoft.com/data/dn307226).</span><span class="sxs-lookup"><span data-stu-id="bd52b-205">This approach is similar toohello guidance for EF and user-initiated transactions (see [Limitations with Retrying Execution Strategies (EF6 onwards)](http://msdn.microsoft.com/data/dn307226).</span></span> <span data-ttu-id="bd52b-206">Mindkét esetben szükséges, hogy hello alkalmazás program vezérli hello hatókör toowhich hello átmeneti kivételt adja vissza: tooeither nyissa meg újra a tranzakciót hello, vagy (ahogy) hozza létre újból, hogy a használt rugalmas adatbázis hello hello megfelelő konstruktor a hello környezetben ügyféloldali kódtárára.</span><span class="sxs-lookup"><span data-stu-id="bd52b-206">Both situations require that hello application program controls hello scope toowhich hello transient exception returns: tooeither reopen hello transaction, or (as shown) recreate hello context from hello proper constructor that uses hello elastic database client library.</span></span>

<span data-ttu-id="bd52b-207">hello kell toocontrol, ahol átmeneti kivételek a hálózatról, biztonsági hatókör is kizárja hello használata hello beépített **SqlAzureExecutionStrategy** az EF elérhető lesz.</span><span class="sxs-lookup"><span data-stu-id="bd52b-207">hello need toocontrol where transient exceptions take us back in scope also precludes hello use of hello built-in **SqlAzureExecutionStrategy** that comes with EF.</span></span> <span data-ttu-id="bd52b-208">**SqlAzureExecutionStrategy** volna nyissa meg újra a kapcsolatot, de nem használható **OpenConnectionForKey** , és ezért minden hello érvényesítési hello részeként végzett **OpenConnectionForKey** hívható meg.</span><span class="sxs-lookup"><span data-stu-id="bd52b-208">**SqlAzureExecutionStrategy** would reopen a connection but not use **OpenConnectionForKey** and therefore bypass all hello validation that is performed as part of hello **OpenConnectionForKey** call.</span></span> <span data-ttu-id="bd52b-209">Ehelyett használja az hello kódminta a hello beépített **DefaultExecutionStrategy** az EF is elérhető lesz.</span><span class="sxs-lookup"><span data-stu-id="bd52b-209">Instead, hello code sample uses hello built-in **DefaultExecutionStrategy** that also comes with EF.</span></span> <span data-ttu-id="bd52b-210">Túl adatkötetekkel**SqlAzureExecutionStrategy**, megfelelően hello újrapróbálkozási házirendje kezeljen átmeneti hiba együtt működik.</span><span class="sxs-lookup"><span data-stu-id="bd52b-210">As opposed too**SqlAzureExecutionStrategy**, it works correctly in combination with hello retry policy from Transient Fault Handling.</span></span> <span data-ttu-id="bd52b-211">hello végrehajtási házirend beállítása a hello **ElasticScaleDbConfiguration** osztály.</span><span class="sxs-lookup"><span data-stu-id="bd52b-211">hello execution policy is set in hello **ElasticScaleDbConfiguration** class.</span></span> <span data-ttu-id="bd52b-212">Vegye figyelembe, hogy nem toouse döntöttünk **DefaultSqlExecutionStrategy** óta azt javasolja, hogy toouse **SqlAzureExecutionStrategy** átmeneti kivételek esetén – amely vezetne toowrong viselkedés című szakaszban leírtaknak megfelelően.</span><span class="sxs-lookup"><span data-stu-id="bd52b-212">Note that we decided not toouse **DefaultSqlExecutionStrategy** since it suggests toouse **SqlAzureExecutionStrategy** if transient exceptions occur - which would lead toowrong behavior as discussed.</span></span> <span data-ttu-id="bd52b-213">Hello különböző újrapróbálkozásos házirendek és EF további információkért lásd: [kapcsolati rugalmasságot az EF](http://msdn.microsoft.com/data/dn456835.aspx).</span><span class="sxs-lookup"><span data-stu-id="bd52b-213">For more information on hello different retry policies and EF, see [Connection Resiliency in EF](http://msdn.microsoft.com/data/dn456835.aspx).</span></span>     

#### <a name="constructor-rewrites"></a><span data-ttu-id="bd52b-214">Konstruktor újraírások</span><span class="sxs-lookup"><span data-stu-id="bd52b-214">Constructor rewrites</span></span>
<span data-ttu-id="bd52b-215">hello fenti hitelesítésikód-példák bemutatják hello alapértelmezett konstruktor átírja rendelés toouse adatok függő entitás-keretrendszer hello útválasztással az alkalmazáshoz szükséges.</span><span class="sxs-lookup"><span data-stu-id="bd52b-215">hello code examples above illustrate hello default constructor re-writes required for your application in order toouse  data dependent routing with hello Entity Framework.</span></span> <span data-ttu-id="bd52b-216">a következő táblázat hello használatúvá Ez a megközelítés tooother konstruktor.</span><span class="sxs-lookup"><span data-stu-id="bd52b-216">hello following table generalizes this approach tooother constructors.</span></span> 

| <span data-ttu-id="bd52b-217">Aktuális konstruktor</span><span class="sxs-lookup"><span data-stu-id="bd52b-217">Current Constructor</span></span> | <span data-ttu-id="bd52b-218">Az adatok egy átírt konstruktor</span><span class="sxs-lookup"><span data-stu-id="bd52b-218">Rewritten Constructor for data</span></span> | <span data-ttu-id="bd52b-219">Alap konstruktor</span><span class="sxs-lookup"><span data-stu-id="bd52b-219">Base Constructor</span></span> | <span data-ttu-id="bd52b-220">Megjegyzések</span><span class="sxs-lookup"><span data-stu-id="bd52b-220">Notes</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="bd52b-221">MyContext()</span><span class="sxs-lookup"><span data-stu-id="bd52b-221">MyContext()</span></span> |<span data-ttu-id="bd52b-222">ElasticScaleContext (ShardMap, TKey)</span><span class="sxs-lookup"><span data-stu-id="bd52b-222">ElasticScaleContext(ShardMap, TKey)</span></span> |<span data-ttu-id="bd52b-223">DbContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="bd52b-223">DbContext(DbConnection, bool)</span></span> |<span data-ttu-id="bd52b-224">hello kapcsolat toobe hello shard térkép és hello adatok függő útválasztási kulcs szükséges.</span><span class="sxs-lookup"><span data-stu-id="bd52b-224">hello connection needs toobe a function of hello shard map and hello data-dependent routing key.</span></span> <span data-ttu-id="bd52b-225">Tooby-fázis automatikus kapcsolat létrehozásának EF kell, és inkább a hello shard térkép toobroker hello kapcsolat.</span><span class="sxs-lookup"><span data-stu-id="bd52b-225">You need tooby-pass automatic connection creation by EF and instead use hello shard map toobroker hello connection.</span></span> |
| <span data-ttu-id="bd52b-226">MyContext(string)</span><span class="sxs-lookup"><span data-stu-id="bd52b-226">MyContext(string)</span></span> |<span data-ttu-id="bd52b-227">ElasticScaleContext (ShardMap, TKey)</span><span class="sxs-lookup"><span data-stu-id="bd52b-227">ElasticScaleContext(ShardMap, TKey)</span></span> |<span data-ttu-id="bd52b-228">DbContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="bd52b-228">DbContext(DbConnection, bool)</span></span> |<span data-ttu-id="bd52b-229">hello kapcsolat hello shard térkép és hello adatok függő útválasztási kulcs.</span><span class="sxs-lookup"><span data-stu-id="bd52b-229">hello connection is a function of hello shard map and hello data-dependent routing key.</span></span> <span data-ttu-id="bd52b-230">A rögzített adatbázis neve vagy a kapcsolati karakterlánc nem fognak működni azok kihagyva érvényesítési hello shard térkép által.</span><span class="sxs-lookup"><span data-stu-id="bd52b-230">A fixed database name or connection string will not work as they by-pass validation by hello shard map.</span></span> |
| <span data-ttu-id="bd52b-231">MyContext(DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="bd52b-231">MyContext(DbCompiledModel)</span></span> |<span data-ttu-id="bd52b-232">ElasticScaleContext (ShardMap, TKey, DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="bd52b-232">ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</span></span> |<span data-ttu-id="bd52b-233">DbContext (DbConnection, DbCompiledModel, logikai)</span><span class="sxs-lookup"><span data-stu-id="bd52b-233">DbContext(DbConnection, DbCompiledModel, bool)</span></span> |<span data-ttu-id="bd52b-234">hello kapcsolat hello shard térkép és horizontális kulcs megadott megadott hello modellt a rendszer létrehozza.</span><span class="sxs-lookup"><span data-stu-id="bd52b-234">hello connection will get created for hello given shard map and sharding key with hello model provided.</span></span> <span data-ttu-id="bd52b-235">hello lefordított modell toohello alap c'tor átadásra kerül.</span><span class="sxs-lookup"><span data-stu-id="bd52b-235">hello compiled model will be passed on toohello base c’tor.</span></span> |
| <span data-ttu-id="bd52b-236">MyContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="bd52b-236">MyContext(DbConnection, bool)</span></span> |<span data-ttu-id="bd52b-237">ElasticScaleContext (ShardMap, TKey, logikai)</span><span class="sxs-lookup"><span data-stu-id="bd52b-237">ElasticScaleContext(ShardMap, TKey, bool)</span></span> |<span data-ttu-id="bd52b-238">DbContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="bd52b-238">DbContext(DbConnection, bool)</span></span> |<span data-ttu-id="bd52b-239">hello kapcsolat hello shard térkép és hello kulcs következtetni toobe igényel.</span><span class="sxs-lookup"><span data-stu-id="bd52b-239">hello connection needs toobe inferred from hello shard map and hello key.</span></span> <span data-ttu-id="bd52b-240">Azt nem adható meg bemenetként (kivéve, ha a bemenetet hello shard térkép és hello kulcs már használja).</span><span class="sxs-lookup"><span data-stu-id="bd52b-240">It cannot be provided as an input (unless that input was already using hello shard map and hello key).</span></span> <span data-ttu-id="bd52b-241">logikai érték hello átadásra kerül.</span><span class="sxs-lookup"><span data-stu-id="bd52b-241">hello Boolean will be passed on.</span></span> |
| <span data-ttu-id="bd52b-242">MyContext (karakterlánc, DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="bd52b-242">MyContext(string, DbCompiledModel)</span></span> |<span data-ttu-id="bd52b-243">ElasticScaleContext (ShardMap, TKey, DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="bd52b-243">ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</span></span> |<span data-ttu-id="bd52b-244">DbContext (DbConnection, DbCompiledModel, logikai)</span><span class="sxs-lookup"><span data-stu-id="bd52b-244">DbContext(DbConnection, DbCompiledModel, bool)</span></span> |<span data-ttu-id="bd52b-245">hello kapcsolat hello shard térkép és hello kulcs következtetni toobe igényel.</span><span class="sxs-lookup"><span data-stu-id="bd52b-245">hello connection needs toobe inferred from hello shard map and hello key.</span></span> <span data-ttu-id="bd52b-246">Azt nem adható meg bemenetként (kivéve, ha a bemenetet használt hello shard térkép és hello kulcs).</span><span class="sxs-lookup"><span data-stu-id="bd52b-246">It cannot be provided as an input (unless that input was using hello shard map and hello key).</span></span> <span data-ttu-id="bd52b-247">hello lefordított modell átadásra kerül.</span><span class="sxs-lookup"><span data-stu-id="bd52b-247">hello compiled model will be passed on.</span></span> |
| <span data-ttu-id="bd52b-248">MyContext (ObjectContext, bool)</span><span class="sxs-lookup"><span data-stu-id="bd52b-248">MyContext(ObjectContext, bool)</span></span> |<span data-ttu-id="bd52b-249">ElasticScaleContext (ShardMap, TKey, ObjectContext, bool)</span><span class="sxs-lookup"><span data-stu-id="bd52b-249">ElasticScaleContext(ShardMap, TKey, ObjectContext, bool)</span></span> |<span data-ttu-id="bd52b-250">DbContext (ObjectContext, bool)</span><span class="sxs-lookup"><span data-stu-id="bd52b-250">DbContext(ObjectContext, bool)</span></span> |<span data-ttu-id="bd52b-251">hello új konstruktort, amely bármilyen kapcsolatot hello ObjectContext átadott bemeneti adatokként a rugalmas bővítést által kezelt átirányítását tooa kapcsolat tooensure kell.</span><span class="sxs-lookup"><span data-stu-id="bd52b-251">hello new constructor needs tooensure that any connection in hello ObjectContext passed as an input is re-routed tooa connection managed by Elastic Scale.</span></span> <span data-ttu-id="bd52b-252">Részletes leírását az ObjectContexts nem ez a dokumentum hello terjed.</span><span class="sxs-lookup"><span data-stu-id="bd52b-252">A detailed discussion of ObjectContexts is beyond hello scope of this document.</span></span> |
| <span data-ttu-id="bd52b-253">MyContext (DbConnection, DbCompiledModel, logikai)</span><span class="sxs-lookup"><span data-stu-id="bd52b-253">MyContext(DbConnection, DbCompiledModel,bool)</span></span> |<span data-ttu-id="bd52b-254">ElasticScaleContext (ShardMap, TKey, DbCompiledModel, bool)</span><span class="sxs-lookup"><span data-stu-id="bd52b-254">ElasticScaleContext(ShardMap, TKey, DbCompiledModel, bool)</span></span> |<span data-ttu-id="bd52b-255">DbContext (DbConnection, DbCompiledModel, logikai);</span><span class="sxs-lookup"><span data-stu-id="bd52b-255">DbContext(DbConnection, DbCompiledModel, bool);</span></span> |<span data-ttu-id="bd52b-256">hello kapcsolat hello shard térkép és hello kulcs következtetni toobe igényel.</span><span class="sxs-lookup"><span data-stu-id="bd52b-256">hello connection needs toobe inferred from hello shard map and hello key.</span></span> <span data-ttu-id="bd52b-257">hello kapcsolat nem adható meg bemenetként (kivéve, ha a bemenetet hello shard térkép és hello kulcs már használja).</span><span class="sxs-lookup"><span data-stu-id="bd52b-257">hello connection cannot be provided as an input (unless that input was already using hello shard map and hello key).</span></span> <span data-ttu-id="bd52b-258">Modell és logikai toohello alaposztály konstruktorának átadott.</span><span class="sxs-lookup"><span data-stu-id="bd52b-258">Model and Boolean are passed on toohello base class constructor.</span></span> |

## <a name="shard-schema-deployment-through-ef-migrations"></a><span data-ttu-id="bd52b-259">A shard séma telepítési keresztül EF-áttelepítések</span><span class="sxs-lookup"><span data-stu-id="bd52b-259">Shard schema deployment through EF migrations</span></span>
<span data-ttu-id="bd52b-260">Automatikus séma-kezelés a hello entitás-keretrendszer által biztosított, a könnyebb elérhetőség érdekében.</span><span class="sxs-lookup"><span data-stu-id="bd52b-260">Automatic schema management is a convenience provided by hello Entity Framework.</span></span> <span data-ttu-id="bd52b-261">A rugalmas adatbázis-eszközt használó alkalmazások hello környezetében szeretnénk tooretain ezen képesség tooautomatically rendelkezés hello séma létrehozott toonewly szilánkok adatbázisok hozzáadásakor toohello szilánkos alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="bd52b-261">In hello context of applications using elastic database tools, we want tooretain this capability tooautomatically provision hello schema toonewly created shards when databases are added toohello sharded application.</span></span> <span data-ttu-id="bd52b-262">hello elsődleges használati eset hello adatrétegbeli szilánkos alkalmazásokhoz EF-tooincrease kapacitás.</span><span class="sxs-lookup"><span data-stu-id="bd52b-262">hello primary use case is tooincrease capacity at hello data tier for sharded applications using EF.</span></span> <span data-ttu-id="bd52b-263">Hello adatbázis felügyeleti elérhető EF-EK képességet biztosít a séma felügyeleti hagyatkoznia csökkenti EF épülő szilánkos alkalmazással.</span><span class="sxs-lookup"><span data-stu-id="bd52b-263">Relying on EF’s capabilities for schema management reduces hello database administration effort with a sharded application built on EF.</span></span> 

<span data-ttu-id="bd52b-264">Séma telepítési EF áttelepítések keresztül működik a legjobban a **ilyen formában kapcsolatok**.</span><span class="sxs-lookup"><span data-stu-id="bd52b-264">Schema deployment through EF migrations works best on **unopened connections**.</span></span> <span data-ttu-id="bd52b-265">Ez a ezzel szemben toohello forgatókönyvben az adatok függő továbbításához hello rugalmas adatbázis ügyfél API által megadott hello megnyitott kapcsolat támaszkodik.</span><span class="sxs-lookup"><span data-stu-id="bd52b-265">This is in contrast toohello scenario for data dependent routing that relies on hello opened connection provided by hello elastic database client API.</span></span> <span data-ttu-id="bd52b-266">Egy másik különbség hello konzisztencia követelmény: az összes adat-függő útválasztási kapcsolatok tooprotect egyidejű shard térkép manipuláció elleni kívánatos tooensure konzisztenciát, miközben még nincs egy kezdeti séma telepítési tooa új adatbázis kapcsolatos probléma amely még nincs regisztrálva a hello shard térkép, és le lett foglalva a toohold shardlets még nem rendelkezik.</span><span class="sxs-lookup"><span data-stu-id="bd52b-266">Another difference is hello consistency requirement: While desirable tooensure consistency for all data-dependent routing connections tooprotect against concurrent shard map manipulation, it is not a concern with initial schema deployment tooa new database that has not yet been registered in hello shard map, and not yet been allocated toohold shardlets.</span></span> <span data-ttu-id="bd52b-267">Ezért azt is támaszkodnak rendszeres adatbázis-kapcsolatok a forgatókönyvek szerint megakadályozását toodata függő útválasztási.</span><span class="sxs-lookup"><span data-stu-id="bd52b-267">We can therefore rely on regular database connections for this scenarios, as opposed toodata-dependent routing.</span></span>  

<span data-ttu-id="bd52b-268">Ennek eredménye tooan megközelítés ahol séma telepítési keresztül EF áttelepítések szorosan együtt használja hello regisztrációs hello új adatbázis, a shard hello alkalmazás shard leképezés.</span><span class="sxs-lookup"><span data-stu-id="bd52b-268">This leads tooan approach where schema deployment through EF migrations is tightly coupled with hello registration of hello new database as a shard in hello application’s shard map.</span></span> <span data-ttu-id="bd52b-269">Ez a következő előfeltételek hello támaszkodik:</span><span class="sxs-lookup"><span data-stu-id="bd52b-269">This relies on hello following prerequisites:</span></span> 

* <span data-ttu-id="bd52b-270">hello adatbázis már létezik.</span><span class="sxs-lookup"><span data-stu-id="bd52b-270">hello database has already been created.</span></span> 
* <span data-ttu-id="bd52b-271">hello adatbázis - magánál tartja nincs felhasználói séma és a nem felhasználói adatokat.</span><span class="sxs-lookup"><span data-stu-id="bd52b-271">hello database is empty - it holds no user schema and no user data.</span></span>
* <span data-ttu-id="bd52b-272">hello adatbázis nem még elérhetőek hello rugalmas adatbázis ügyfél API-k az adatok függő továbbításához.</span><span class="sxs-lookup"><span data-stu-id="bd52b-272">hello database cannot yet be accessed through hello elastic database client APIs for data-dependent routing.</span></span> 

<span data-ttu-id="bd52b-273">Az előfeltételek teljesülnek, a szokványos létrehozhatjuk megbízhatatlan megnyitott **SqlConnection** tookick ki EF áttelepítések séma központi telepítéshez.</span><span class="sxs-lookup"><span data-stu-id="bd52b-273">With these prerequisites in place, we can create a regular un-opened **SqlConnection** tookick off EF migrations for schema deployment.</span></span> <span data-ttu-id="bd52b-274">a következő példakód hello szemlélteti ezt a módszert használja.</span><span class="sxs-lookup"><span data-stu-id="bd52b-274">hello following code sample illustrates this approach.</span></span> 

        // Enter a new shard - i.e. an empty database - toohello shard map, allocate a first tenant tooit  
        // and kick off EF intialization of hello database toodeploy schema 

        public void RegisterNewShard(string server, string database, string connStr, int key) 
        { 

            Shard shard = this.ShardMap.CreateShard(new ShardLocation(server, database)); 

            SqlConnectionStringBuilder connStrBldr = new SqlConnectionStringBuilder(connStr); 
            connStrBldr.DataSource = server; 
            connStrBldr.InitialCatalog = database; 

            // Go into a DbContext tootrigger migrations and schema deployment for hello new shard. 
            // This requires an un-opened connection. 
            using (var db = new ElasticScaleContext<int>(connStrBldr.ConnectionString)) 
            { 
                // Run a query tooengage EF migrations 
                (from b in db.Blogs 
                    select b).Count(); 
            } 

            // Register hello mapping of hello tenant toohello shard in hello shard map. 
            // After this step, data-dependent routing on hello shard map can be used 

            this.ShardMap.CreatePointMapping(key, shard); 
        } 


<span data-ttu-id="bd52b-275">Ez a példa bemutatja hello metódus **RegisterNewShard** , hogy a regisztereket hello shard leképezés, shard hello hello séma EF áttelepítések keresztül telepíti, és egy egy horizontális skálázási kulcs toohello szilánkok leképezése tárolja.</span><span class="sxs-lookup"><span data-stu-id="bd52b-275">This sample shows hello method **RegisterNewShard** that registers hello shard in hello shard map, deploys hello schema through EF migrations, and stores a mapping of a sharding key toohello shard.</span></span> <span data-ttu-id="bd52b-276">Hello konstruktor támaszkodnak **DbContext** alosztály (**ElasticScaleContext** hello mintában) bemenetként SQL kapcsolati karakterlánc időt vesz igénybe.</span><span class="sxs-lookup"><span data-stu-id="bd52b-276">It relies on a constructor of hello **DbContext** subclass (**ElasticScaleContext** in hello sample) that takes a SQL connection string as input.</span></span> <span data-ttu-id="bd52b-277">Ez a konstruktor hello kódját egyszerű feladat, mint a következő példa azt mutatja meg hello:</span><span class="sxs-lookup"><span data-stu-id="bd52b-277">hello code of this constructor is straight-forward, as hello following example shows:</span></span> 

        // C'tor toodeploy schema and migrations tooa new shard 
        protected internal ElasticScaleContext(string connectionString) 
            : base(SetInitializerForConnection(connectionString)) 
        { 
        } 

        // Only static methods are allowed in calls into base class c'tors 
        private static string SetInitializerForConnection(string connnectionString) 
        { 
            // We want existence checks so that hello schema can get deployed 
            Database.SetInitializer<ElasticScaleContext<T>>( 
        new CreateDatabaseIfNotExists<ElasticScaleContext<T>>()); 

            return connnectionString; 
        } 

<span data-ttu-id="bd52b-278">Előfordulhat, hogy egy használt öröklődés forrása: hello alaposztály hello konstruktor hello verzióját.</span><span class="sxs-lookup"><span data-stu-id="bd52b-278">One might have used hello version of hello constructor inherited from hello base class.</span></span> <span data-ttu-id="bd52b-279">De az EF alapértelmezett inicializáló hello hello kódot kell tooensure kapcsolódás esetén használatos.</span><span class="sxs-lookup"><span data-stu-id="bd52b-279">But hello code needs tooensure that hello default initializer for EF is used when connecting.</span></span> <span data-ttu-id="bd52b-280">Ezért hello rövid detour hello statikus metódusnak hello alaposztály konstruktornak hello kapcsolati karakterlánccal hívása előtt.</span><span class="sxs-lookup"><span data-stu-id="bd52b-280">Hence hello short detour into hello static method before calling into hello base class constructor with hello connection string.</span></span> <span data-ttu-id="bd52b-281">Vegye figyelembe, hogy a szilánkok hello regisztrációs az EF hello inicializáló beállítások nem ütköznek egy másik tartomány vagy a folyamat tooensure kell futtatni.</span><span class="sxs-lookup"><span data-stu-id="bd52b-281">Note that hello registration of shards should run in a different app domain or process tooensure that hello initializer settings for EF do not conflict.</span></span> 

## <a name="limitations"></a><span data-ttu-id="bd52b-282">Korlátozások</span><span class="sxs-lookup"><span data-stu-id="bd52b-282">Limitations</span></span>
<span data-ttu-id="bd52b-283">Ebben a dokumentumban leírt hello megközelítések néhány korlátozásokkal jár:</span><span class="sxs-lookup"><span data-stu-id="bd52b-283">hello approaches outlined in this document entail a couple of limitations:</span></span> 

* <span data-ttu-id="bd52b-284">EF használó alkalmazások **LocalDb** először toomigrate tooa rendszeres SQL Server-adatbázis elastic database ügyféloldali kódtár használata előtt.</span><span class="sxs-lookup"><span data-stu-id="bd52b-284">EF applications that use **LocalDb** first need toomigrate tooa regular SQL Server database before using elastic database client library.</span></span> <span data-ttu-id="bd52b-285">A rugalmas bővítést ki egy alkalmazást a horizontális skálázás nincs lehetőség a **LocalDb**.</span><span class="sxs-lookup"><span data-stu-id="bd52b-285">Scaling out an application through sharding with Elastic Scale is not possible with **LocalDb**.</span></span> <span data-ttu-id="bd52b-286">Vegye figyelembe, hogy fejlesztési továbbra is használhatja **LocalDb**.</span><span class="sxs-lookup"><span data-stu-id="bd52b-286">Note that development can still use **LocalDb**.</span></span> 
* <span data-ttu-id="bd52b-287">Bármely, amelyek azt sugallják adatbázis változás történt változások toohello alkalmazás keresztül az összes szilánkok EF áttelepítések toogo kell.</span><span class="sxs-lookup"><span data-stu-id="bd52b-287">Any changes toohello application that imply database schema changes need toogo through EF migrations on all shards.</span></span> <span data-ttu-id="bd52b-288">hello mintakód a dokumentum nem bemutatják, hogyan toodo ez.</span><span class="sxs-lookup"><span data-stu-id="bd52b-288">hello sample code for this document does not demonstrate how toodo this.</span></span> <span data-ttu-id="bd52b-289">Érdemes lehet az adatbázis-frissítés és a ConnectionString paraméter tooiterate keresztül minden szilánkok; vagy a kivonat hello T-SQL parancsfájl használata a frissítés-adatbázis migrálása függőben hello hello - parancsfájl a beállítást, és hello T-SQL parancsfájl tooyour szilánkok alkalmazni.</span><span class="sxs-lookup"><span data-stu-id="bd52b-289">Consider using Update-Database with a ConnectionString parameter tooiterate over all shards; or extract hello T-SQL script for hello pending migration using Update-Database with hello -Script option and apply hello T-SQL script tooyour shards.</span></span>  
* <span data-ttu-id="bd52b-290">A kérelemben megadott, feltételezzük, hogy az adatbázis-feldolgozási mindegyikét tartalmazza egyetlen shard hello kérelem által biztosított hello horizontális kulcs által meghatározott.</span><span class="sxs-lookup"><span data-stu-id="bd52b-290">Given a request, it is assumed that all of its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="bd52b-291">Azonban ez a feltételezés nem mindig tartsa igaz.</span><span class="sxs-lookup"><span data-stu-id="bd52b-291">However, this assumption does not always hold true.</span></span> <span data-ttu-id="bd52b-292">Például, ha nincs lehetséges toomake egy horizontális skálázási kulcsát.</span><span class="sxs-lookup"><span data-stu-id="bd52b-292">For example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="bd52b-293">tooaddress a, hello ügyféloldali kódtár biztosít hello **MultiShardQuery** osztály, amely a kapcsolat absztrakciós több szilánkok keresztül lekérdezése.</span><span class="sxs-lookup"><span data-stu-id="bd52b-293">tooaddress this, hello client library provides hello **MultiShardQuery** class that implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="bd52b-294">Tanulási toouse hello **MultiShardQuery** EF együtt nem ez a dokumentum hello terjed</span><span class="sxs-lookup"><span data-stu-id="bd52b-294">Learning toouse hello **MultiShardQuery** in combination with EF is beyond hello scope of this document</span></span>

## <a name="conclusion"></a><span data-ttu-id="bd52b-295">Összegzés</span><span class="sxs-lookup"><span data-stu-id="bd52b-295">Conclusion</span></span>
<span data-ttu-id="bd52b-296">Hello a jelen dokumentumban leírt lépéseket, keresztül EF alkalmazások hello elastic database ügyféloldali kódtár funkció segítségével az adatok függő hello konstruktora újrabontása útválasztást **DbContext** hello EF használt alosztályok az alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="bd52b-296">Through hello steps outlined in this document, EF applications can use hello elastic database client library's capability for data dependent routing by refactoring constructors of hello **DbContext** subclasses used in hello EF application.</span></span> <span data-ttu-id="bd52b-297">Ezen korlátok hello módosítások szükséges toothose helyének **DbContext** osztályok már léteznek.</span><span class="sxs-lookup"><span data-stu-id="bd52b-297">This limits hello  changes required toothose places where **DbContext** classes already exist.</span></span> <span data-ttu-id="bd52b-298">Ezenkívül EF alkalmazások továbbra is az automatikus séma telepítésből toobenefit hello szükséges EF áttelepítések hello regisztrálása új szilánkok és hello shard leképezés tartalmazó meghívása hello lépéseket kombinálásával.</span><span class="sxs-lookup"><span data-stu-id="bd52b-298">In addition, EF applications can continue toobenefit from automatic schema deployment by combining hello steps that invoke hello necessary EF migrations with hello registration of new shards and mappings in hello shard map.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-use-entity-framework-applications-visual-studio/sample.png
