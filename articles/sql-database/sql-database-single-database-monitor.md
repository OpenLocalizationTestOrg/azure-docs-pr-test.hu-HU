---
title: "az Azure SQL Database adatbázis teljesítményének aaaMonitoring |} Microsoft Docs"
description: "További tudnivalók a figyelheti az adatbázisokat Azure-eszközökkel és dinamikus felügyeleti nézetekkel hello-beállítások."
keywords: "adatbázis-megfigyelés, felhőalapú adatbázis teljesítménye"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: b13771183d4ccf37f58e2fc518b9b14de38212dc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="d3be4-104">Adatbázis teljesítményének figyelése Azure SQL Database adatbázisokban</span><span class="sxs-lookup"><span data-stu-id="d3be4-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="d3be4-105">Az Azure SQL-adatbázis hello teljesítményfigyeléshez hello Erőforrás kihasználtsága relatív toohello szintű adatbázis teljesítményszintjéhez figyelésével kezdődik.</span><span class="sxs-lookup"><span data-stu-id="d3be4-105">Monitoring hello performance of a SQL database in Azure starts with monitoring hello resource utilization relative toohello level of database performance you choose.</span></span> <span data-ttu-id="d3be4-106">Figyelés segítségével határozza meg, hogy az adatbázis többletkapacitással rendelkezik, vagy mert erőforrások amelyek kihasználtságában nehézségekkel küzd a, és majd eldönteni, hogy idő tooadjust hello teljesítményszintet és [szolgáltatásréteg](sql-database-service-tiers.md) az adatbázis.</span><span class="sxs-lookup"><span data-stu-id="d3be4-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time tooadjust hello performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="d3be4-107">Az adatbázis hello grafikus eszközök használatával figyelheti [Azure-portálon](https://portal.azure.com) vagy az SQL [dinamikus felügyeleti nézetekkel](https://msdn.microsoft.com/library/ms188754.aspx).</span><span class="sxs-lookup"><span data-stu-id="d3be4-107">You can monitor your database using graphical tools in hello [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-hello-azure-portal"></a><span data-ttu-id="d3be4-108">Adatbázisok figyelése hello Azure-portál használatával</span><span class="sxs-lookup"><span data-stu-id="d3be4-108">Monitor databases using hello Azure portal</span></span>
<span data-ttu-id="d3be4-109">A hello [Azure-portálon](https://portal.azure.com/), jelölje ki az adatbázist, kattintson a hello figyelheti egy önálló adatbázist Erőforrás kihasználtsága **figyelés** diagram.</span><span class="sxs-lookup"><span data-stu-id="d3be4-109">In hello [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking hello **Monitoring** chart.</span></span> <span data-ttu-id="d3be4-110">Ekkor megjelenik egy **metrika** ablak, amely hello kattintva módosíthatja **diagram szerkesztése** gombra.</span><span class="sxs-lookup"><span data-stu-id="d3be4-110">This brings up a **Metric** window that you can change by clicking hello **Edit chart** button.</span></span> <span data-ttu-id="d3be4-111">Adja hozzá a következő metrikák hello:</span><span class="sxs-lookup"><span data-stu-id="d3be4-111">Add hello following metrics:</span></span>

* <span data-ttu-id="d3be4-112">Processzorhasználat (%)</span><span class="sxs-lookup"><span data-stu-id="d3be4-112">CPU percentage</span></span>
* <span data-ttu-id="d3be4-113">DTU-kihasználtság (%)</span><span class="sxs-lookup"><span data-stu-id="d3be4-113">DTU percentage</span></span>
* <span data-ttu-id="d3be4-114">Adat IO kihasználtsága (%)</span><span class="sxs-lookup"><span data-stu-id="d3be4-114">Data IO percentage</span></span>
* <span data-ttu-id="d3be4-115">Adatbázis méretének kihasználtsága</span><span class="sxs-lookup"><span data-stu-id="d3be4-115">Database size percentage</span></span>

<span data-ttu-id="d3be4-116">Fenti metrikák hozzáadása után továbbra tooview őket a hello **figyelés** további részleteket a hello diagramot **metrika** ablak.</span><span class="sxs-lookup"><span data-stu-id="d3be4-116">Once you’ve added these metrics, you can continue tooview them in hello **Monitoring** chart with more details on hello **Metric** window.</span></span> <span data-ttu-id="d3be4-117">Négy metrika hello átlagos kihasználtság százalékos relatív toohello **DTU** az adatbázis.</span><span class="sxs-lookup"><span data-stu-id="d3be4-117">All four metrics show hello average utilization percentage relative toohello **DTU** of your database.</span></span> <span data-ttu-id="d3be4-118">Lásd: hello [szolgáltatásszintek](sql-database-service-tiers.md) szóló cikkben olvashat a dtu-inak száma.</span><span class="sxs-lookup"><span data-stu-id="d3be4-118">See hello [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Adatbázis-teljesítményének szolgáltatásszint-figyelése.](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="d3be4-120">Riasztások hello teljesítménymutatók is elvégezheti.</span><span class="sxs-lookup"><span data-stu-id="d3be4-120">You can also configure alerts on hello performance metrics.</span></span> <span data-ttu-id="d3be4-121">Kattintson a hello **riasztás hozzáadása** hello gombjára **metrika** ablak.</span><span class="sxs-lookup"><span data-stu-id="d3be4-121">Click hello **Add alert** button in hello **Metric** window.</span></span> <span data-ttu-id="d3be4-122">Kövesse a varázsló tooconfigure hello a riasztás.</span><span class="sxs-lookup"><span data-stu-id="d3be4-122">Follow hello wizard tooconfigure your alert.</span></span> <span data-ttu-id="d3be4-123">Ha hello metrikák túllépnek egy bizonyos küszöböt, vagy ha a meghatározott küszöbérték alá esnek hello hello beállítás tooalert rendelkezik.</span><span class="sxs-lookup"><span data-stu-id="d3be4-123">You have hello option tooalert if hello metrics exceed a certain threshold or if hello metric falls below a certain threshold.</span></span>

<span data-ttu-id="d3be4-124">Például ha az adatbázis toogrow a várt hello munkaterhelés, választhat tooconfigure az e-mail riasztások amikor eléri a 80 % bármely hello teljesítménymutatók.</span><span class="sxs-lookup"><span data-stu-id="d3be4-124">For example, if you expect hello workload on your database toogrow, you can choose tooconfigure an email alert whenever your database reaches 80% on any of hello performance metrics.</span></span> <span data-ttu-id="d3be4-125">Ez egy korai figyelmeztető toofigure, ha lehetséges, hogy tooswitch toohello következő magasabb teljesítményszintre védelemként is alkalmazhatják.</span><span class="sxs-lookup"><span data-stu-id="d3be4-125">You can use this as an early warning toofigure out when you might have tooswitch toohello next higher performance level.</span></span>

<span data-ttu-id="d3be4-126">hello teljesítménymutatók segítségével meghatározhatja, hogy ha képes toodowngrade tooa alacsonyabb teljesítményszintre.</span><span class="sxs-lookup"><span data-stu-id="d3be4-126">hello performance metrics can also help you determine if you are able toodowngrade tooa lower performance level.</span></span> <span data-ttu-id="d3be4-127">Tegyük fel, a Standard S2 adatbázist használ, és minden adatbázis hello átlagos teljesítmény metrikák megjelenítése nem használja több mint 10 % egy adott időpontban.</span><span class="sxs-lookup"><span data-stu-id="d3be4-127">Assume you are using a Standard S2 database and all performance metrics show that hello database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="d3be4-128">Valószínű, hogy hello az adatbázis is megfelelően standard szintű, S1 fog működni.</span><span class="sxs-lookup"><span data-stu-id="d3be4-128">It is likely that hello database will work well in Standard S1.</span></span> <span data-ttu-id="d3be4-129">Azonban figyelembe, amely hirtelen megugró vagy ingadozó hello döntési toomove tooa alacsonyabb teljesítményszintre elvégzése előtt.</span><span class="sxs-lookup"><span data-stu-id="d3be4-129">However, be aware of workloads that spike or fluctuate before making hello decision toomove tooa lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="d3be4-130">Adatbázisok figyelése dinamikus felügyeleti nézetek használatával</span><span class="sxs-lookup"><span data-stu-id="d3be4-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="d3be4-131">hello azonos elérhető metrikák hello portálon keresztül is elérhetők rendszernézetek: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) a logikai hello **fő** a kiszolgálói és [sys.dm_db_ resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) hello felhasználói adatbázisban.</span><span class="sxs-lookup"><span data-stu-id="d3be4-131">hello same metrics that are exposed in hello portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in hello logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in hello user database.</span></span> <span data-ttu-id="d3be4-132">Használjon **sys.resource_stats** Ha idő hosszabb ideig kevesebb részletes adatot toomonitor van szüksége.</span><span class="sxs-lookup"><span data-stu-id="d3be4-132">Use **sys.resource_stats** if you need toomonitor less granular data across a longer period of time.</span></span> <span data-ttu-id="d3be4-133">Használjon **sys.dm_db_resource_stats** Ha toomonitor van szüksége egy kisebb időkereten belül több részletes adatot.</span><span class="sxs-lookup"><span data-stu-id="d3be4-133">Use **sys.dm_db_resource_stats** if you need toomonitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="d3be4-134">További információkat az [Útmutató az Azure SQL Database teljesítményfigyeléséhez](sql-database-single-database-monitor.md#monitor-resource-use) részben talál.</span><span class="sxs-lookup"><span data-stu-id="d3be4-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="d3be4-135">A **sys.dm_db_resource_stats** eredményhalmaza üres lesz, ha a kivezetett Web vagy Business kiadású adatbázisokra alkalmazzák.</span><span class="sxs-lookup"><span data-stu-id="d3be4-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="d3be4-136">A figyelő erőforrás-használat</span><span class="sxs-lookup"><span data-stu-id="d3be4-136">Monitor resource use</span></span>

<span data-ttu-id="d3be4-137">Erőforrás-használat használatával figyelheti [SQL adatbázis-lekérdezési Terheléselemző](sql-database-query-performance.md) és [Lekérdezéstár](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="d3be4-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="d3be4-138">Használati használatával két nézetet is végezhet figyelést:</span><span class="sxs-lookup"><span data-stu-id="d3be4-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="d3be4-139">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="d3be4-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="d3be4-140">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="d3be4-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="d3be4-141">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="d3be4-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="d3be4-142">Használhatja a hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) nézetben minden SQL-adatbázis.</span><span class="sxs-lookup"><span data-stu-id="d3be4-142">You can use hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="d3be4-143">Hello **sys.dm_db_resource_stats** a nézet jeleníti meg a legutóbbi erőforrás használja adatok relatív toohello szolgáltatási rétegben.</span><span class="sxs-lookup"><span data-stu-id="d3be4-143">hello **sys.dm_db_resource_stats** view shows recent resource use data relative toohello service tier.</span></span> <span data-ttu-id="d3be4-144">Átlagos CPU, az adatok i/o, a napló írása és a memória százalékos 15 másodpercenként tárolja, és 1 óráig megmaradjanak.</span><span class="sxs-lookup"><span data-stu-id="d3be4-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="d3be4-145">Mivel ez a nézet biztosít egy részletesebb erőforrás használata, **sys.dm_db_resource_stats** első bármely jelenlegi-állapot elemzéshez vagy hibaelhárítási.</span><span class="sxs-lookup"><span data-stu-id="d3be4-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="d3be4-146">Ez a lekérdezés például látható hello átlagos és maximális erőforrás használ az aktuális adatbázis hello hello elmúlt egy órában:</span><span class="sxs-lookup"><span data-stu-id="d3be4-146">For example, this query shows hello average and maximum resource use for hello current database over hello past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="d3be4-147">Más lekérdezések példák hello a [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="d3be4-147">For other queries, see hello examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="d3be4-148">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="d3be4-148">sys.resource_stats</span></span>
<span data-ttu-id="d3be4-149">Hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) hello nézet **fő** adatbázis tartalmaz további információkat, melyek segíthetnek az SQL-adatbázis, az adott szolgáltatás és teljesítményszintet szinten hello teljesítményének figyeléséhez .</span><span class="sxs-lookup"><span data-stu-id="d3be4-149">hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in hello **master** database has additional information that can help you monitor hello performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="d3be4-150">hello adatokat gyűjtött 5 percenként, és körülbelül 35 napon változatlan marad.</span><span class="sxs-lookup"><span data-stu-id="d3be4-150">hello data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="d3be4-151">Ebben a nézetben a hosszabb távú előzményadatok elemzése hogyan az SQL-adatbázis erőforrást használ, érdemes használni.</span><span class="sxs-lookup"><span data-stu-id="d3be4-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="d3be4-152">hello az ábra mutatja hello CPU erőforrások felhasználását hello P2 teljesítményszintet Premium adatbázis esetén minden egy hét múlva.</span><span class="sxs-lookup"><span data-stu-id="d3be4-152">hello following graph shows hello CPU resource use for a Premium database with hello P2 performance level for each hour in a week.</span></span> <span data-ttu-id="d3be4-153">Ehhez a diagramhoz egy hétfőn kezdődő, 5 munkanapok jeleníti meg, és megjeleníti a hétvégi, ha sok kevésbé hello alkalmazástól történik.</span><span class="sxs-lookup"><span data-stu-id="d3be4-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on hello application.</span></span>

![SQL-adatbázis erőforrás-használat](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="d3be4-155">Hello adatokból, az adatbázis jelenleg tartalmaz egy csúcsterhelés CPU Processzor csak több mint 50 %-a relatív toohello P2 teljesítményszintet (kedd délig) használatával.</span><span class="sxs-lookup"><span data-stu-id="d3be4-155">From hello data, this database currently has a peak CPU load of just over 50 percent CPU use relative toohello P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="d3be4-156">Ha CPU hello meghatározó tényező hello alkalmazás erőforrás-profilba, majd dönthet úgy, hogy P2-e a megfelelő teljesítmény szintű tooguarantee mindig hello munkaterhelés megfelelő hello.</span><span class="sxs-lookup"><span data-stu-id="d3be4-156">If CPU is hello dominant factor in hello application’s resource profile, then you might decide that P2 is hello right performance level tooguarantee that hello workload always fits.</span></span> <span data-ttu-id="d3be4-157">Egy alkalmazás toogrow idővel várhatóan, esetén a jó ötlet toohave egy további erőforrás puffer, hogy hello alkalmazás soha nem eléri hello teljesítményszintet határértéket.</span><span class="sxs-lookup"><span data-stu-id="d3be4-157">If you expect an application toogrow over time, it's a good idea toohave an extra resource buffer so that hello application doesn't ever reach hello performance-level limit.</span></span> <span data-ttu-id="d3be4-158">Hello teljesítményszintet növeli, ha elkerülheti felhasználói által látható a hibákat, akkor fordulhat elő, ha egy adatbázis nem tartalmaz elég power tooprocess kérelmek hatékonyan, különösen a késésre érzékeny környezetekben.</span><span class="sxs-lookup"><span data-stu-id="d3be4-158">If you increase hello performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power tooprocess requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="d3be4-159">Példa: egy adatbázist, amely támogatja az adatbázis-hívások hello eredményei alapján weblapok festi alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="d3be4-159">An example is a database that supports an application that paints webpages based on hello results of database calls.</span></span>

<span data-ttu-id="d3be4-160">Más alkalmazástípusok azonos másképp diagramot hello előfordulhat, hogy értelmezni.</span><span class="sxs-lookup"><span data-stu-id="d3be4-160">Other application types might interpret hello same graph differently.</span></span> <span data-ttu-id="d3be4-161">Például ha egy alkalmazás megpróbál tooprocess Bérlista adatok naponta, és rendelkezik hello ugyanabban a diagramban, ez kind "kötegelt" modell előfordulhat, hogy tegye részletes, P1 teljesítményszint szükséges.</span><span class="sxs-lookup"><span data-stu-id="d3be4-161">For example, if an application tries tooprocess payroll data each day and has hello same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="d3be4-162">hello P1 teljesítményszint szükséges rendelkezik 100 képest Dtu too200 dtu-k hello P2 teljesítményszint szükséges.</span><span class="sxs-lookup"><span data-stu-id="d3be4-162">hello P1 performance level has 100 DTUs compared too200 DTUs at hello P2 performance level.</span></span> <span data-ttu-id="d3be4-163">hello P1 teljesítményszint szükséges fele hello teljesítményt biztosít a hello P2 teljesítményszint szükséges.</span><span class="sxs-lookup"><span data-stu-id="d3be4-163">hello P1 performance level provides half hello performance of hello P2 performance level.</span></span> <span data-ttu-id="d3be4-164">Igen P2 a CPU-használat az 50 % egyenlő P1 a CPU-használat 100 százalék.</span><span class="sxs-lookup"><span data-stu-id="d3be4-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="d3be4-165">Ha hello alkalmazás nem rendelkezik időtúllépések, előfordulhat, hogy nem számít, hogy a feladat végrehajtásához szükséges, 2 óra vagy 2,5 óra toofinish, ha ma kapja meg.</span><span class="sxs-lookup"><span data-stu-id="d3be4-165">If hello application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours toofinish, if it gets done today.</span></span> <span data-ttu-id="d3be4-166">Egy alkalmazás ebbe a kategóriába tartozó valószínűleg használhat P1 teljesítményszint szükséges.</span><span class="sxs-lookup"><span data-stu-id="d3be4-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="d3be4-167">Kihasználhatja hello tényt, hogy vannak-e időszakokra, erőforrás-használat esetén alacsonyabb, úgy, hogy a "nagy csúcs" lehet, hogy kerülnek oszthatók hello csatornák később hello napon belül hello nap alatt.</span><span class="sxs-lookup"><span data-stu-id="d3be4-167">You can take advantage of hello fact that there are periods of time during hello day when resource use is lower, so that any "big peak" might spill over into one of hello troughs later in hello day.</span></span> <span data-ttu-id="d3be4-168">hello P1 teljesítményszint szükséges mindaddig, amíg hello feladatok befejezéséhez minden nap idővel lehet jó az adott alkalmazás (és a Mentés pénzt).</span><span class="sxs-lookup"><span data-stu-id="d3be4-168">hello P1 performance level might be good for that kind of application (and save money), as long as hello jobs can finish on time each day.</span></span>

<span data-ttu-id="d3be4-169">A felhasználása előtt minden aktív adatbázis hello az erőforrás-információkat az Azure SQL Database tesz elérhetővé **sys.resource_stats** hello ábrázolása **fő** adatbázisban az egyes kiszolgálókon.</span><span class="sxs-lookup"><span data-stu-id="d3be4-169">Azure SQL Database exposes consumed resource information for each active database in hello **sys.resource_stats** view of hello **master** database in each server.</span></span> <span data-ttu-id="d3be4-170">hello adatok hello tábla 5 perces időközönként céljából összesíti.</span><span class="sxs-lookup"><span data-stu-id="d3be4-170">hello data in hello table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="d3be4-171">Hello Basic, Standard és Premium szolgáltatásszintek hello adatokat is tarthat, több mint 5 perc tooappear hello tábla, így ezek az adatok közel valós idejű elemzési helyett korábbi elemzés hasznos.</span><span class="sxs-lookup"><span data-stu-id="d3be4-171">With hello Basic, Standard, and Premium service tiers, hello data can take more than 5 minutes tooappear in hello table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="d3be4-172">Lekérdezés hello **sys.resource_stats** toosee hello egy adatbázis és azt szeretné, hogy szükség esetén hello teljesítmény e hello foglalás úgy döntött, hogy kézbesíteni toovalidate legutóbbi előzményeinek megtekintése.</span><span class="sxs-lookup"><span data-stu-id="d3be4-172">Query hello **sys.resource_stats** view toosee hello recent history of a database and toovalidate whether hello reservation you chose delivered hello performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="d3be4-173">Csatlakoztatott toohello kell **fő** adatbázisának az SQL database logikai kiszolgáló tooquery **sys.resource_stats** a következő példák hello.</span><span class="sxs-lookup"><span data-stu-id="d3be4-173">You must be connected toohello **master** database of your logical SQL database server tooquery **sys.resource_stats** in hello following examples.</span></span>
> 
> 

<span data-ttu-id="d3be4-174">Ez a példa bemutatja, hogyan hello adat ebben a nézetben van közzétéve:</span><span class="sxs-lookup"><span data-stu-id="d3be4-174">This example shows you how hello data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![hello sys.resource_stats katalógusnézet használatával derítheti ki](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="d3be4-176">hello következő példa bemutatja, hogy különböző módon használható hello **sys.resource_stats** katalógus tooget adatainak megtekintése az SQL-adatbázis hogyan erőforrást használ:</span><span class="sxs-lookup"><span data-stu-id="d3be4-176">hello next example shows you different ways that you can use hello **sys.resource_stats** catalog view tooget information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="d3be4-177">a múltbeli heti erőforrás hello toolook hello adatbázis userdb1 használja, ez a lekérdezés futtatása:</span><span class="sxs-lookup"><span data-stu-id="d3be4-177">toolook at hello past week’s resource use for hello database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="d3be4-178">mennyire a munkaterhelés megfelelő hello teljesítményszintet tooevaluate kell toodrill le be minden szempontját hello erőforrás metrikáit: CPU, olvasási, írási, munkavállalók száma és munkamenetek száma.</span><span class="sxs-lookup"><span data-stu-id="d3be4-178">tooevaluate how well your workload fits hello performance level, you need toodrill down into each aspect of hello resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="d3be4-179">Ez egy új lekérdezés használatával **sys.resource_stats** tooreport hello erőforrás metrikákat átlagos és maximális értékeit:</span><span class="sxs-lookup"><span data-stu-id="d3be4-179">Here's a revised query using **sys.resource_stats** tooreport hello average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="d3be4-180">Ezen információk átlagos és maximális értékek hello minden erőforrás mérőszám felmérheti, mennyire illeszkedik az a munkaterhelés úgy döntött, hogy hello teljesítményszint szükséges.</span><span class="sxs-lookup"><span data-stu-id="d3be4-180">With this information about hello average and maximum values of each resource metric, you can assess how well your workload fits into hello performance level you chose.</span></span> <span data-ttu-id="d3be4-181">Általában a átlagérték **sys.resource_stats** Önnek egy jó alapterv toouse hello célméretet ellen.</span><span class="sxs-lookup"><span data-stu-id="d3be4-181">Usually, average values from **sys.resource_stats** give you a good baseline toouse against hello target size.</span></span> <span data-ttu-id="d3be4-182">Az elsődleges mérési memóriás kell lennie.</span><span class="sxs-lookup"><span data-stu-id="d3be4-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="d3be4-183">Például előfordulhat, hogy használni hello szabványos szolgáltatási réteg az S2 teljesítményszint szükséges.</span><span class="sxs-lookup"><span data-stu-id="d3be4-183">For an example, you might be using hello Standard service tier with S2 performance level.</span></span> <span data-ttu-id="d3be4-184">hello átlagos százalékos használata a Processzor- és i/o-olvasási és írási műveleteket a rendszer alatt 40 %-kal hello munkavállalók átlagos száma nem éri el 50 és hello munkamenetek átlagos száma nem éri el 200.</span><span class="sxs-lookup"><span data-stu-id="d3be4-184">hello average use percentages for CPU and I/O reads and writes are below 40 percent, hello average number of workers is below 50, and hello average number of sessions is below 200.</span></span> <span data-ttu-id="d3be4-185">A számítási feladatok hello S1 teljesítményszinttel előfordulhat, hogy illeszkedik.</span><span class="sxs-lookup"><span data-stu-id="d3be4-185">Your workload might fit into hello S1 performance level.</span></span> <span data-ttu-id="d3be4-186">Egyszerű toosee is, hogy az adatbázis megfelelő hello munkavégző és munkamenet-korlátozásait.</span><span class="sxs-lookup"><span data-stu-id="d3be4-186">It's easy toosee whether your database fits in hello worker and session limits.</span></span> <span data-ttu-id="d3be4-187">tooCPU, olvasási és írási műveletekről, hogy az adatbázis az alacsonyabb teljesítményszintre illeszkedik tekintetében toosee hello DTU száma hello alacsonyabb teljesítményszintre nullával hello DTU száma a jelenlegi teljesítményszintje, és hello eredmény megszorozza 100:</span><span class="sxs-lookup"><span data-stu-id="d3be4-187">toosee whether a database fits into a lower performance level with regards tooCPU, reads, and writes, divide hello DTU number of hello lower performance level by hello DTU number of your current performance level, and then multiply hello result by 100:</span></span>
   
    <span data-ttu-id="d3be4-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="d3be4-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="d3be4-189">hello eredménye hello relatív teljesítménybeli különbség hello százalékban két teljesítményszintek között.</span><span class="sxs-lookup"><span data-stu-id="d3be4-189">hello result is hello relative performance difference between hello two performance levels in percentage.</span></span> <span data-ttu-id="d3be4-190">Ha az erőforrások felhasználását nem haladhatja meg ezt a mennyiséget, a munkaterhelés hello alacsonyabb teljesítményszintre előfordulhat, hogy illeszkedik.</span><span class="sxs-lookup"><span data-stu-id="d3be4-190">If your resource use doesn't exceed this amount, your workload might fit into hello lower performance level.</span></span> <span data-ttu-id="d3be4-191">Azonban Ön toolook, erőforrás-használati értékek összes tartományát, és határozza meg, százalékos, milyen gyakran szeretné felelnek meg az adatbázisban munkaterhelés hello alacsonyabb teljesítményszintre.</span><span class="sxs-lookup"><span data-stu-id="d3be4-191">However, you need toolook at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into hello lower performance level.</span></span> <span data-ttu-id="d3be4-192">hello következő lekérdezés kimenete hello elférjen százalékos erőforrás dimenziónként hello küszöbérték azt ebben a példában számított 40 %-kal alapján:</span><span class="sxs-lookup"><span data-stu-id="d3be4-192">hello following query outputs hello fit percentage per resource dimension, based on hello threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="d3be4-193">Az adatbázis szolgáltatásiszint-célkitűzés (SLO) alapuló, eldöntheti, hogy a munkaterhelés illeszkedik hello alacsonyabb teljesítményszintre.</span><span class="sxs-lookup"><span data-stu-id="d3be4-193">Based on your database service level objective (SLO), you can decide whether your workload fits into hello lower performance level.</span></span> <span data-ttu-id="d3be4-194">Ha az adatbázis munkaterhelés SLO 99,9 % és hello előző lekérdezés visszaadja az értékek összes három erőforrás dimenzió 99,9 %-nál nagyobb, a munkaterhelés valószínűleg hello alacsonyabb teljesítményszintre illeszkedik.</span><span class="sxs-lookup"><span data-stu-id="d3be4-194">If your database workload SLO is 99.9 percent and hello preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into hello lower performance level.</span></span>
   
    <span data-ttu-id="d3be4-195">Hello elférjen százalékos megnézi is lehetővé teszi az e telepítse át a toohello következő magasabb teljesítmény szintű toomeet a SLO betekintést.</span><span class="sxs-lookup"><span data-stu-id="d3be4-195">Looking at hello fit percentage also gives you insight into whether you should move toohello next higher performance level toomeet your SLO.</span></span> <span data-ttu-id="d3be4-196">Például a userdb1 hello CPU-használat hello a múlt hét a következő látható:</span><span class="sxs-lookup"><span data-stu-id="d3be4-196">For example, userdb1 shows hello following CPU use for hello past week:</span></span>
   
   | <span data-ttu-id="d3be4-197">Átlagos CPU-százaléka</span><span class="sxs-lookup"><span data-stu-id="d3be4-197">Average CPU percent</span></span> | <span data-ttu-id="d3be4-198">CPU maximális százalék</span><span class="sxs-lookup"><span data-stu-id="d3be4-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="d3be4-199">24.5</span><span class="sxs-lookup"><span data-stu-id="d3be4-199">24.5</span></span> |<span data-ttu-id="d3be4-200">100.00</span><span class="sxs-lookup"><span data-stu-id="d3be4-200">100.00</span></span> |
   
    <span data-ttu-id="d3be4-201">átlagos CPU hello hello teljesítményszint szükséges, amely jól illeszkedik hello teljesítményszintjének hello adatbázis hello legfeljebb negyedéves tárgya.</span><span class="sxs-lookup"><span data-stu-id="d3be4-201">hello average CPU is about a quarter of hello limit of hello performance level, which would fit well into hello performance level of hello database.</span></span> <span data-ttu-id="d3be4-202">De hello maximális értéket jeleníti meg, hogy hello hello teljesítményszintet hello legfeljebb eléri.</span><span class="sxs-lookup"><span data-stu-id="d3be4-202">But, hello maximum value shows that hello database reaches hello limit of hello performance level.</span></span> <span data-ttu-id="d3be4-203">Kell-e toomove toohello következő magasabb teljesítményszintre?</span><span class="sxs-lookup"><span data-stu-id="d3be4-203">Do you need toomove toohello next higher performance level?</span></span> <span data-ttu-id="d3be4-204">Olvassa sokszor a munkaterhelés eléri 100 % lesz, és hasonlítsa össze tooyour adatbázis munkaterhelés slo-t.</span><span class="sxs-lookup"><span data-stu-id="d3be4-204">Look at how many times your workload reaches 100 percent, and then compare it tooyour database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="d3be4-205">Ha a lekérdezés által visszaadott érték legalább 99,9 %-bármelyik hello három erőforrás dimenzió, fontolja meg vagy áthelyezése toohello következő magasabb teljesítményszintre vagy alkalmazás hangolási módszerek tooreduce hello betöltése hello SQL Database.</span><span class="sxs-lookup"><span data-stu-id="d3be4-205">If this query returns a value less than 99.9 percent for any of hello three resource dimensions, consider either moving toohello next higher performance level or use application-tuning techniques tooreduce hello load on hello SQL database.</span></span>
4. <span data-ttu-id="d3be4-206">Ebben a gyakorlatban is figyelembe veszi a hello tervezett munkaterhelési növekedése jövőbeli.</span><span class="sxs-lookup"><span data-stu-id="d3be4-206">This exercise also considers your projected workload increase in hello future.</span></span>

<span data-ttu-id="d3be4-207">A rugalmas figyelheti az ebben a szakaszban ismertetett hello technikák hello készlet egyes adatbázisait.</span><span class="sxs-lookup"><span data-stu-id="d3be4-207">For elastic pools, you can monitor individual databases in hello pool with hello techniques described in this section.</span></span> <span data-ttu-id="d3be4-208">De ugyanígy figyelheti hello adatbáziskészlet egészét.</span><span class="sxs-lookup"><span data-stu-id="d3be4-208">But you can also monitor hello pool as a whole.</span></span> <span data-ttu-id="d3be4-209">További információkért lásd: [Rugalmas készlet figyelése és kezelése](sql-database-elastic-pool-manage-portal.md).</span><span class="sxs-lookup"><span data-stu-id="d3be4-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="d3be4-210">Egyidejű kérelmek maximális száma</span><span class="sxs-lookup"><span data-stu-id="d3be4-210">Maximum concurrent requests</span></span>
<span data-ttu-id="d3be4-211">egyidejű kérelmek száma toosee hello az SQL-adatbázis a Transact-SQL-lekérdezés futtatása:</span><span class="sxs-lookup"><span data-stu-id="d3be4-211">toosee hello number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="d3be4-212">tooanalyze hello munkaterhelés egy a helyszíni SQL Server-adatbázis, módosítsa a lekérdezést toofilter tooanalyze kívánt hello adott adatbázison.</span><span class="sxs-lookup"><span data-stu-id="d3be4-212">tooanalyze hello workload of an on-premises SQL Server database, modify this query toofilter on hello specific database you want tooanalyze.</span></span> <span data-ttu-id="d3be4-213">Például ha egy helyi adatbázist használ nevű adatbázis, a Transact-SQL lekérdezés által visszaadott hello egyidejű kérelmek száma az adatbázis:</span><span class="sxs-lookup"><span data-stu-id="d3be4-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns hello count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="d3be4-214">Ez az csak egy ponton pillanatkép időben.</span><span class="sxs-lookup"><span data-stu-id="d3be4-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="d3be4-215">a munkaterhelés és egyidejűleg futtatható kérelmek követelmények jobb megértése tooget, szüksége lesz toocollect adott idő alatt sok minták.</span><span class="sxs-lookup"><span data-stu-id="d3be4-215">tooget a better understanding of your workload and concurrent request requirements, you'll need toocollect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="d3be4-216">Maximális párhuzamos bejelentkezések</span><span class="sxs-lookup"><span data-stu-id="d3be4-216">Maximum concurrent logins</span></span>
<span data-ttu-id="d3be4-217">A felhasználó és az alkalmazás minták tooget hello gyakoriság bejelentkezések képet is elemezheti.</span><span class="sxs-lookup"><span data-stu-id="d3be4-217">You can analyze your user and application patterns tooget an idea of hello frequency of logins.</span></span> <span data-ttu-id="d3be4-218">Is futtathatja valós betölti a tesztelési környezet toomake meg arról, hogy Ön éppen nem elérte-e ez vagy más korlátok, a cikkben arról lesz szó.</span><span class="sxs-lookup"><span data-stu-id="d3be4-218">You also can run real-world loads in a test environment toomake sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="d3be4-219">Nincs egyetlen lekérdezés vagy dinamikus kezelési nézetet (DMV), amely meg tudja jeleníteni az egyidejű bejelentkezési száma vagy előzményeit.</span><span class="sxs-lookup"><span data-stu-id="d3be4-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="d3be4-220">Ha több ügyfél használja hello ugyanazt a kapcsolati karakterláncot, hello szolgáltatást minden egyes bejelentkezés hitelesíti.</span><span class="sxs-lookup"><span data-stu-id="d3be4-220">If multiple clients use hello same connection string, hello service authenticates each login.</span></span> <span data-ttu-id="d3be4-221">Ha egyszerre kapcsolódó 10 olyan felhasználót tooa adatbázis használatával hello ugyanazt a felhasználónevet és jelszót, nem lenne 10 egyidejű bejelentkezések.</span><span class="sxs-lookup"><span data-stu-id="d3be4-221">If 10 users simultaneously connect tooa database by using hello same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="d3be4-222">Ezt a határt csak toohello időtartama hello bejelentkezési és hitelesítési vonatkozik.</span><span class="sxs-lookup"><span data-stu-id="d3be4-222">This limit applies only toohello duration of hello login and authentication.</span></span> <span data-ttu-id="d3be4-223">Ha azonos 10 hello a felhasználók csatlakozni toohello adatbázis egymás után, hello száma párhuzamos bejelentkezések soha nem lenne 1-nél nagyobb.</span><span class="sxs-lookup"><span data-stu-id="d3be4-223">If hello same 10 users connect toohello database sequentially, hello number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="d3be4-224">Ezt a határt jelenleg nem vonatkozik a rugalmas készletek toodatabases.</span><span class="sxs-lookup"><span data-stu-id="d3be4-224">Currently, this limit does not apply toodatabases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="d3be4-225">Munkamenetek maximális száma</span><span class="sxs-lookup"><span data-stu-id="d3be4-225">Maximum sessions</span></span>
<span data-ttu-id="d3be4-226">toosee hello aktuális aktív munkamenetek számát, az SQL-adatbázis a Transact-SQL-lekérdezés futtatása:</span><span class="sxs-lookup"><span data-stu-id="d3be4-226">toosee hello number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="d3be4-227">Ha egy helyi SQL Server munkaterhelés most elemzése, módosítsa a hello lekérdezés toofocus egy adott adatbázison.</span><span class="sxs-lookup"><span data-stu-id="d3be4-227">If you're analyzing an on-premises SQL Server workload, modify hello query toofocus on a specific database.</span></span> <span data-ttu-id="d3be4-228">Ez a lekérdezés segít meghatározni a hello adatbázis munkamenet funkciókra van szüksége, ha tervezi, helyezze át tooAzure SQL-adatbázis.</span><span class="sxs-lookup"><span data-stu-id="d3be4-228">This query helps you determine possible session needs for hello database if you are considering moving it tooAzure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="d3be4-229">Ebben az esetben ezeket a lekérdezéseket vissza időpontban számot eredményez.</span><span class="sxs-lookup"><span data-stu-id="d3be4-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="d3be4-230">Ha adott idő alatt több mintához gyűjt, akkor kell hello legjobb ismertetése a munkamenet használja.</span><span class="sxs-lookup"><span data-stu-id="d3be4-230">If you collect multiple samples over time, you’ll have hello best understanding of your session use.</span></span>

<span data-ttu-id="d3be4-231">SQL-adatbázis elemzéshez kaphat a korábbi statisztika munkamenetek hello lekérdezésével [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) nézet, és ellenőrizze az hello **active_session_count** oszlop.</span><span class="sxs-lookup"><span data-stu-id="d3be4-231">For SQL Database analysis, you can get historical statistics on sessions by querying hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing hello **active_session_count** column.</span></span> 
