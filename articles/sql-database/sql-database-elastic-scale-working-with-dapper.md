---
title: "A rugalmas adatbázis ügyféloldali kódtár használata Dapper |} Microsoft Docs"
description: "A rugalmas adatbázis ügyféloldali kódtár Dapper használja."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: f0efd37a39c1a60eee7b47304483c27727ca8833
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 07/11/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="581dd-103">A rugalmas adatbázis ügyféloldali kódtár használata Dapper</span><span class="sxs-lookup"><span data-stu-id="581dd-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="581dd-104">Ez a dokumentum a fejlesztők olyan alkalmazásokat készíthetnek Dapper alapulnak, de is kívánja bevezetni a van [elastic database tooling](sql-database-elastic-scale-introduction.md) alkalmazásokat hozhat létre, hogy megvalósítása horizontális kibővített az adatréteg számára.</span><span class="sxs-lookup"><span data-stu-id="581dd-104">This document is for developers that rely on Dapper to build applications, but also want to embrace [elastic database tooling](sql-database-elastic-scale-introduction.md) to create applications that implement sharding to scale-out their data tier.</span></span>  <span data-ttu-id="581dd-105">Ez a dokumentum Dapper-alapú alkalmazásokat, amelyek szükségesek a rugalmas adatbáziseszközöket integrálása változásait mutatja be.</span><span class="sxs-lookup"><span data-stu-id="581dd-105">This document illustrates the changes in Dapper-based applications that are necessary to integrate with elastic database tools.</span></span> <span data-ttu-id="581dd-106">A fókusz értéke a rugalmas adatbázis shard felügyelete és az adatok függő összeállítása a útválasztással Dapper.</span><span class="sxs-lookup"><span data-stu-id="581dd-106">Our focus is on composing the elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="581dd-107">**Példakód**: [rugalmas adatbáziseszközöket az Azure SQL Database - Dapper integrációs](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="581dd-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="581dd-108">Integrálása **Dapper** és **DapperExtensions** a rugalmas adatbáziskészlettel könnyen az Azure SQL Database ügyféloldali kódtárára.</span><span class="sxs-lookup"><span data-stu-id="581dd-108">Integrating **Dapper** and **DapperExtensions** with the elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="581dd-109">Az alkalmazások használhatják a függő útválasztási módosítása a létrehozása és megnyitásakor az új adatok [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objektumok használata a [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) felelnek meg, és a [ügyféloldalikódtár](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="581dd-109">Your applications can use data dependent routing by changing the creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects to use the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from the [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="581dd-110">Ezzel a módosítások csak az alkalmazás korlátozza, ahol az új kapcsolatok létrehozása és megnyitni.</span><span class="sxs-lookup"><span data-stu-id="581dd-110">This limits changes in your application to only where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="581dd-111">Dapper áttekintése</span><span class="sxs-lookup"><span data-stu-id="581dd-111">Dapper overview</span></span>
<span data-ttu-id="581dd-112">**Dapper** egy objektum relációs leképező van.</span><span class="sxs-lookup"><span data-stu-id="581dd-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="581dd-113">Leképezi a .NET-objektumokat az alkalmazás egy relációs adatbázisban (és fordítva).</span><span class="sxs-lookup"><span data-stu-id="581dd-113">It maps .NET objects from your application to a relational database (and vice versa).</span></span> <span data-ttu-id="581dd-114">A mintakód első része azt mutatja be, hogyan integrálható a rugalmas adatbázis ügyféloldali kódtár Dapper-alapú alkalmazások.</span><span class="sxs-lookup"><span data-stu-id="581dd-114">The first part of the sample code illustrates how you can integrate the elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="581dd-115">Második része a mintakód bemutatja, hogyan integrálásához Dapper és a DapperExtensions használatakor.</span><span class="sxs-lookup"><span data-stu-id="581dd-115">The second part of the sample code illustrates how to integrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="581dd-116">Eseményleképező a Dapper biztosít a kiterjesztésmetódusok adatbázis kapcsolatok használata esetén, amelyek megkönnyítik a küldő T-SQL utasítás végrehajtása, vagy az adatbázis lekérdezése.</span><span class="sxs-lookup"><span data-stu-id="581dd-116">The mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying the database.</span></span> <span data-ttu-id="581dd-117">Például Dapper megkönnyíti, hogy a .NET-objektumokat és az SQL-utasítás paramétereit közötti **Execute** hívások, vagy az SQL-lekérdezések eredményének felhasználásához .NET objektumokba **lekérdezés** Dapper hívásait.</span><span class="sxs-lookup"><span data-stu-id="581dd-117">For instance, Dapper makes it easy to map between your .NET objects and the parameters of SQL statements for **Execute** calls, or to consume the results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="581dd-118">Ha DapperExtensions, már nincs szüksége arra, hogy az SQL-utasításokat.</span><span class="sxs-lookup"><span data-stu-id="581dd-118">When using DapperExtensions, you no longer need to provide the SQL statements.</span></span> <span data-ttu-id="581dd-119">Bővítmények módszerek **GetList** vagy **beszúrása** keresztül az adatbázis-kapcsolat létrehozása az SQL-utasítások a háttérben.</span><span class="sxs-lookup"><span data-stu-id="581dd-119">Extensions methods such as **GetList** or **Insert** over the database connection create the SQL statements behind the scenes.</span></span>

<span data-ttu-id="581dd-120">Egy másik Dapper, és DapperExtensions előnye, hogy az alkalmazás szabályozza-e az adatbázis-kapcsolat létrehozását.</span><span class="sxs-lookup"><span data-stu-id="581dd-120">Another benefit of Dapper and also DapperExtensions is that the application controls the creation of the database connection.</span></span> <span data-ttu-id="581dd-121">Ez segít a brókerek adatbázis-kapcsolatok az adatbázisok shardlets a leképezésen alapuló rugalmas adatbázis ügyfél tár kommunikál.</span><span class="sxs-lookup"><span data-stu-id="581dd-121">This helps interact with the elastic database client library which brokers database connections based on the mapping of shardlets to databases.</span></span>

<span data-ttu-id="581dd-122">Ahhoz, hogy a Dapper szerelvényeket, lásd: [Dapper pont nettó](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="581dd-122">To get the Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="581dd-123">A Dapper bővítmények, lásd: [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="581dd-123">For the Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-the-elastic-database-client-library"></a><span data-ttu-id="581dd-124">A rugalmas adatbázis ügyféloldali kódtár gyors áttekintése</span><span class="sxs-lookup"><span data-stu-id="581dd-124">A quick Look at the elastic database client library</span></span>
<span data-ttu-id="581dd-125">A rugalmas adatbázis ügyféloldali kódtára a szolgáltatás megadhatja az alkalmazásadatok nevű partíciója *shardlets* adatbázisok való hozzárendelése és azonosításához által *horizontális kulcsok*.</span><span class="sxs-lookup"><span data-stu-id="581dd-125">With the elastic database client library, you define partitions of your application data called *shardlets* , map them to databases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="581dd-126">Tetszőleges számú adatbázist kell, és a shardlets szét ezeket az adatbázisokat is.</span><span class="sxs-lookup"><span data-stu-id="581dd-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="581dd-127">Az adatbázisok horizontális kulcsértékei leképezése a szalagtár API-k által biztosított shard térkép tárolja.</span><span class="sxs-lookup"><span data-stu-id="581dd-127">The mapping of sharding key values to the databases is stored by a shard map provided by the library’s APIs.</span></span> <span data-ttu-id="581dd-128">Ez a funkció neve **shard térkép felügyeleti**.</span><span class="sxs-lookup"><span data-stu-id="581dd-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="581dd-129">A szilánkok térkép is szolgál az átvitelszervező adatbázis-kapcsolatok a kéréseket, amelyben egy horizontális skálázási kulcsot.</span><span class="sxs-lookup"><span data-stu-id="581dd-129">The shard map also serves as the broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="581dd-130">Ez a funkció nevezzük **adatok függő útválasztási**.</span><span class="sxs-lookup"><span data-stu-id="581dd-130">This capability is referred to as **data dependent routing**.</span></span>

![A shard leképezések és az adatok függő útválasztási][1]

<span data-ttu-id="581dd-132">A szilánkok térkép-kezelő felhasználók védi a inkonzisztens nézetek, amely akkor fordulhat elő, ha az adatbázisok hogy egyidejű shardlet felügyeleti műveletek shardlet adatokká.</span><span class="sxs-lookup"><span data-stu-id="581dd-132">The shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on the databases.</span></span> <span data-ttu-id="581dd-133">Ehhez a shard maps replikaszervező az adatbázis-kapcsolatok a szalagtár-val készült alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="581dd-133">To do so, the shard maps broker the database connections for an application built with the library.</span></span> <span data-ttu-id="581dd-134">A shard felügyeleti műveletek jelentős hatással lehet a shardlet, a shard leképezés funkció automatikusan leállítani az adatbázis-kapcsolat lehetővé teszi.</span><span class="sxs-lookup"><span data-stu-id="581dd-134">When shard management operations could impact the shardlet, this allows the shard map functionality to automatically kill a database connection.</span></span> 

<span data-ttu-id="581dd-135">A hagyományos módon Dapper kapcsolatok létrehozása helyett igazolnia kell használni a [OpenConnectionForKey metódus](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="581dd-135">Instead of using the traditional way to create connections for Dapper, we need to use the [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="581dd-136">Ez biztosítja, hogy az ellenőrzés akkor történik meg, és kapcsolatok felügyelt megfelelően Ha adatokat szilánkok között helyezi.</span><span class="sxs-lookup"><span data-stu-id="581dd-136">This ensures that all the validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="581dd-137">Dapper integrációs követelményei</span><span class="sxs-lookup"><span data-stu-id="581dd-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="581dd-138">A rugalmas adatbázis ügyféloldali kódtár és a a Dapper API-k használata, ha azt szeretnénk tartsa meg az alábbi tulajdonságokat:</span><span class="sxs-lookup"><span data-stu-id="581dd-138">When working with both the elastic database client library and the Dapper APIs, we want to retain the following properties:</span></span>

* <span data-ttu-id="581dd-139">**Scaleout**: hozzáadhat vagy eltávolíthat adatbázisok a szilánkos az alkalmazás a kapacitás iránti igények kielégítése érdekében a megfelelő, az alkalmazás az adatréteg szeretnénk.</span><span class="sxs-lookup"><span data-stu-id="581dd-139">**Scaleout**: We want to add or remove databases from the data tier of the sharded application as necessary for the capacity demands of the application.</span></span> 
* <span data-ttu-id="581dd-140">**Konzisztencia**: mivel az alkalmazás horizontálisan horizontális használatával, hajtsa végre az adatok függő útválasztási kell.</span><span class="sxs-lookup"><span data-stu-id="581dd-140">**Consistency**: Since our application is scaled out using sharding, we need to perform data dependent routing.</span></span> <span data-ttu-id="581dd-141">Azt szeretnénk, ehhez az függő útválasztási képességek a szalagtár használatára.</span><span class="sxs-lookup"><span data-stu-id="581dd-141">We want to use the Data dependent routing capabilities of the library to do so.</span></span> <span data-ttu-id="581dd-142">Különösen szeretnénk tartsa meg az ellenőrzést, és konzisztencia biztosítja, hogy sérült vagy helytelen lekérdezési eredmények elkerülése érdekében a shard térkép keresztül van közvetítőalapú kapcsolatok számát biztosítja.</span><span class="sxs-lookup"><span data-stu-id="581dd-142">In particular, we want to retain the validation and consistency guarantees provided by connections that are brokered through the shard map manager in order to avoid corruption or wrong query results.</span></span> <span data-ttu-id="581dd-143">Ez biztosítja, hogy egy adott shardlet kapcsolatok elutasították vagy leállt, ha (például) a shardlet jelenleg átkerül egy másik shard vegyes/egyesítés API-k használatával.</span><span class="sxs-lookup"><span data-stu-id="581dd-143">This ensures that connections to a given shardlet are rejected or stopped if (for instance) the shardlet is currently moved to a different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="581dd-144">**Objektum leképezésének**: tartsa meg a megfeleltetéseket, az alkalmazásban osztályok és az alapjául szolgáló adatbázis felépítését közötti lefordítani Dapper által biztosított kényelmi szeretnénk.</span><span class="sxs-lookup"><span data-stu-id="581dd-144">**Object Mapping**: We want to retain the convenience of the mappings provided by Dapper to translate between classes in the application and the underlying database structures.</span></span> 

<span data-ttu-id="581dd-145">A következő szakaszban ezek a követelmények alapján alkalmazások útmutatást nyújt **Dapper** és **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="581dd-145">The following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="581dd-146">Műszaki útmutató</span><span class="sxs-lookup"><span data-stu-id="581dd-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="581dd-147">Függő Dapper az útválasztási adatok</span><span class="sxs-lookup"><span data-stu-id="581dd-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="581dd-148">Dapper az alkalmazás általában létrehozásáért és a kapcsolatok adatbázis megnyitása.</span><span class="sxs-lookup"><span data-stu-id="581dd-148">With Dapper, the application is typically responsible for creating and opening the connections to the underlying database.</span></span> <span data-ttu-id="581dd-149">Az alkalmazás által T típus adott, Dapper eredményeket ad vissza lekérdezés, T. Dapper típusú .NET gyűjteményekre leképezése végez a T-SQL sorok T. típusú objektumokhoz Dapper hasonlóan SQL értékek vagy adatok adatkezelési nyelv utasítások paramétereinek leképezi a .NET-objektumokat.</span><span class="sxs-lookup"><span data-stu-id="581dd-149">Given a type T by the application, Dapper returns query results as .NET collections of type T. Dapper performs the mapping from the T-SQL result rows to the objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="581dd-150">Dapper nyújt ez a funkció a normál a kiterjesztésmetódusok keresztül [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) ADO .NET SQL ügyfél függvénytárak objektum.</span><span class="sxs-lookup"><span data-stu-id="581dd-150">Dapper offers this functionality via extension methods on the regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from the ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="581dd-151">Az SQL-kapcsolatot az adatfelderítési rekordok a rugalmas, méretezhető API-k által visszaadott megtalálhatók rendszeres [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objektumok.</span><span class="sxs-lookup"><span data-stu-id="581dd-151">The SQL connection returned by the Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="581dd-152">Ez lehetővé teszi, hogy közvetlenül keresztül használja a Dapper bővítmények az ügyféloldali kódtár DDR API-t által visszaadott típussal, mert is egyszerű SQL ügyfél kapcsolat.</span><span class="sxs-lookup"><span data-stu-id="581dd-152">This allows us to directly use Dapper extensions over the type returned by the client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="581dd-153">E megfigyelések ellenőrizze a rugalmas adatbázis ügyféloldali kódtár által Dapper a(z) közvetítőalapú kapcsolatok használata egyszerű.</span><span class="sxs-lookup"><span data-stu-id="581dd-153">These observations make it straightforward to use connections brokered by the elastic database client library for Dapper.</span></span>

<span data-ttu-id="581dd-154">Ez a Kódpélda (a mintából kísérő) a módszert, ahol a horizontális kulcs biztosítja az alkalmazás a könyvtárhoz a kapcsolatot a megfelelő shard replikaszervező mutatja be.</span><span class="sxs-lookup"><span data-stu-id="581dd-154">This code example (from the accompanying sample) illustrates the approach where the sharding key is provided by the application to the library to broker the connection to the right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="581dd-155">A hívás a [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API a felváltja az alapértelmezett létrehozása és egy ügyfél SQL-kapcsolat megnyitása.</span><span class="sxs-lookup"><span data-stu-id="581dd-155">The call to the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces the default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="581dd-156">A [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) hívás a argumentummal szükséges adatok függő útválasztás:</span><span class="sxs-lookup"><span data-stu-id="581dd-156">The [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes the arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="581dd-157">A szilánkok térkép elérni az adatok függő útválasztási felületek</span><span class="sxs-lookup"><span data-stu-id="581dd-157">The shard map to access the data dependent routing interfaces</span></span>
* <span data-ttu-id="581dd-158">A horizontális kulcs a shardlet azonosításához</span><span class="sxs-lookup"><span data-stu-id="581dd-158">The sharding key to identify the shardlet</span></span>
* <span data-ttu-id="581dd-159">A hitelesítő adatok (felhasználónév és jelszó) a shard való kapcsolódáshoz</span><span class="sxs-lookup"><span data-stu-id="581dd-159">The credentials (user name and password) to connect to the shard</span></span>

<span data-ttu-id="581dd-160">A szilánkok térkép objektum kapcsolatot hoz létre, amely tárolja a megadott horizontális skálázási kulcs shardlet a szilánkcímtárban.</span><span class="sxs-lookup"><span data-stu-id="581dd-160">The shard map object creates a connection to the shard that holds the shardlet for the given sharding key.</span></span> <span data-ttu-id="581dd-161">A rugalmas adatbázis-ügyfél API-kat is címke valósítja meg a konzisztencia biztosítja a kapcsolatot.</span><span class="sxs-lookup"><span data-stu-id="581dd-161">The elastic database client APIs also tag the connection to implement its consistency guarantees.</span></span> <span data-ttu-id="581dd-162">Hívása [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) rendszeres SQL ügyfélkapcsolati objektumot, a későbbi hívásakor adja vissza a **Execute** kiterjesztésmetódus a Dapper követi a szabványos Dapper eljárás.</span><span class="sxs-lookup"><span data-stu-id="581dd-162">Since the call to [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, the subsequent call to the **Execute** extension method from Dapper follows the standard Dapper practice.</span></span>

<span data-ttu-id="581dd-163">Lekérdezések használhatók nagyon hasonlóan – először nyitja meg a kapcsolat használatával [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) az ügyfél API-t.</span><span class="sxs-lookup"><span data-stu-id="581dd-163">Queries work very much the same way - you first open the connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from the client API.</span></span> <span data-ttu-id="581dd-164">Akkor használja a rendszeres Dapper kiterjesztésmetódusok az SQL-lekérdezés eredményei hozzárendelését a .NET-objektumokba:</span><span class="sxs-lookup"><span data-stu-id="581dd-164">Then you use the regular Dapper extension methods to map the results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="581dd-165">Vegye figyelembe, hogy a **használatával** a DDR-kapcsolat hatókörökhöz letiltása a egy shard, ahol az tenantId1 tárolni a letiltás belül az összes művelet.</span><span class="sxs-lookup"><span data-stu-id="581dd-165">Note that the **using** block with the DDR connection scopes all database operations within the block to the one shard where tenantId1 is kept.</span></span> <span data-ttu-id="581dd-166">A lekérdezés csak az aktuális shard tárolt blogok, de nem tárolt bármely más szilánkok megfelelően adja vissza.</span><span class="sxs-lookup"><span data-stu-id="581dd-166">The query only returns blogs stored on the current shard, but not the ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="581dd-167">Függő Dapper és DapperExtensions útválasztási adatok</span><span class="sxs-lookup"><span data-stu-id="581dd-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="581dd-168">További kiterjesztések biztosíthat további kényelmi és absztrakciós az adatbázisból, adatbázis-alkalmazások fejlesztése során az ökoszisztéma Dapper tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="581dd-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from the database when developing database applications.</span></span> <span data-ttu-id="581dd-169">DapperExtensions csak példaként szolgál.</span><span class="sxs-lookup"><span data-stu-id="581dd-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="581dd-170">Az alkalmazásban használt DapperExtensions nem változik, hogyan adatbázis-kapcsolatok létrehozása és kezelése.</span><span class="sxs-lookup"><span data-stu-id="581dd-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="581dd-171">Feladata továbbra is az alkalmazást nyitott kapcsolatot, és rendszeres SQL ügyfél kapcsolatobjektumok által a kiterjesztésmetódusok várható.</span><span class="sxs-lookup"><span data-stu-id="581dd-171">It is still the application’s responsibility to open connections, and regular SQL Client connection objects are expected by the extension methods.</span></span> <span data-ttu-id="581dd-172">Azt is használhat a [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) fent leírt módon.</span><span class="sxs-lookup"><span data-stu-id="581dd-172">We can rely on the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="581dd-173">A következő mintakódok látható, a mindössze annyi a változás, hogy már nem tudunk a T-SQL-utasítások írása:</span><span class="sxs-lookup"><span data-stu-id="581dd-173">As the following code samples show, the only change is that we do no longer have to write the T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="581dd-174">És ez a kódminta, a lekérdezés:</span><span class="sxs-lookup"><span data-stu-id="581dd-174">And here is the code sample for the query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="581dd-175">Átmeneti kezelése</span><span class="sxs-lookup"><span data-stu-id="581dd-175">Handling transient faults</span></span>
<span data-ttu-id="581dd-176">A Microsoft Patterns & eljárások csapat közzé a [átmeneti hiba kezelési alkalmazás blokk](http://msdn.microsoft.com/library/hh680934.aspx) alkalmazásfejlesztők észlelt, amikor a felhőben futó közös átmeneti hiba feltételek csökkentése érdekében.</span><span class="sxs-lookup"><span data-stu-id="581dd-176">The Microsoft Patterns & Practices team published the [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) to help application developers mitigate common transient fault conditions encountered when running in the cloud.</span></span> <span data-ttu-id="581dd-177">További információkért lásd: [Perseverance, a titkos kulcs az összes Triumphs: az átmeneti hiba kezelési alkalmazás-blokk használata](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="581dd-177">For more information, see [Perseverance, Secret of All Triumphs: Using the Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="581dd-178">A mintakód átmeneti hibák elleni védelem érdekében az átmeneti hiba könyvtár támaszkodik.</span><span class="sxs-lookup"><span data-stu-id="581dd-178">The code sample relies on the transient fault library to protect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="581dd-179">**SqlDatabaseUtils.SqlRetryPolicy** a kódban van definiálva, egy **SqlDatabaseTransientErrorDetectionStrategy** újrapróbálkozás-szám 10-es és 5 másodperc várjon az újrapróbálkozások között eltelt idő.</span><span class="sxs-lookup"><span data-stu-id="581dd-179">**SqlDatabaseUtils.SqlRetryPolicy** in the code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="581dd-180">Ha tranzakciók használ, győződjön meg arról, hogy az újra gombra hatókör visszatér egy átmeneti hiba esetén a tranzakció kezdete.</span><span class="sxs-lookup"><span data-stu-id="581dd-180">If you are using transactions, make sure that your retry scope goes back to the beginning of the transaction in the case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="581dd-181">Korlátozások</span><span class="sxs-lookup"><span data-stu-id="581dd-181">Limitations</span></span>
<span data-ttu-id="581dd-182">A jelen dokumentumban ismertetett módszerekkel néhány korlátozásokkal jár:</span><span class="sxs-lookup"><span data-stu-id="581dd-182">The approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="581dd-183">A mintakód a dokumentum nem bemutatják, hogyan kezeli a séma szilánkok.</span><span class="sxs-lookup"><span data-stu-id="581dd-183">The sample code for this document does not demonstrate how to manage schema across shards.</span></span>
* <span data-ttu-id="581dd-184">A kérelemben megadott, feltételezzük, hogy az adatbázis-feldolgozási tartalmazza egyetlen shard a kérelem által biztosított horizontális kulcs által meghatározott.</span><span class="sxs-lookup"><span data-stu-id="581dd-184">Given a request, we assume that all its database processing is contained within a single shard as identified by the sharding key provided by the request.</span></span> <span data-ttu-id="581dd-185">Azonban ez a feltételezés nem mindig tartsa, például ha nincs lehetőség egy horizontális skálázási kulcs elérhetővé.</span><span class="sxs-lookup"><span data-stu-id="581dd-185">However, this assumption does not always hold, for example, when it is not possible to make a sharding key available.</span></span> <span data-ttu-id="581dd-186">A rugalmas adatbázis ügyféloldali kódtára tartalmaz orvoslása érdekében a [MultiShardQuery osztály](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="581dd-186">To address this, the elastic database client library includes the [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="581dd-187">Az osztály megvalósít egy kapcsolat absztrakciós több szilánkok keresztül lekérdezése.</span><span class="sxs-lookup"><span data-stu-id="581dd-187">The class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="581dd-188">Ez a dokumentum nem MultiShardQuery Dapper együttes alkalmazásával van.</span><span class="sxs-lookup"><span data-stu-id="581dd-188">Using MultiShardQuery in combination with Dapper is beyond the scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="581dd-189">Összegzés</span><span class="sxs-lookup"><span data-stu-id="581dd-189">Conclusion</span></span>
<span data-ttu-id="581dd-190">Alkalmazás Dapper és DapperExtensions könnyen is kihasználhatja a rugalmas adatbázis-eszközt az Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="581dd-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="581dd-191">Az ebben a dokumentumban leírt lépések, ezeket az alkalmazásokat is használhat az eszköz funkció függő útválasztási módosítása a létrehozása és megnyitásakor az új adatok [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objektumok használata a [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) hívás a rugalmas adatbázis ügyféloldali kódtár.</span><span class="sxs-lookup"><span data-stu-id="581dd-191">Through the steps outlined in this document, those applications can use the tool's capability for data dependent routing by changing the creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects to use the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of the elastic database client library.</span></span> <span data-ttu-id="581dd-192">Ez korlátozza az alkalmazás módosítások új kapcsolatok létrehozása és megnyitni ezeket helyeken szükséges.</span><span class="sxs-lookup"><span data-stu-id="581dd-192">This limits the application changes required to those places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png
