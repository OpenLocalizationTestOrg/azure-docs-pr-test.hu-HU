---
title: "aaaUsing elastic database ügyféloldali kódtára a Dapper |} Microsoft Docs"
description: "A rugalmas adatbázis ügyféloldali kódtár Dapper használja."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: c22ece2a977265e93850f0ad3f3ca48f0a8733ac
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="8d0da-103">A rugalmas adatbázis ügyféloldali kódtár használata Dapper</span><span class="sxs-lookup"><span data-stu-id="8d0da-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="8d0da-104">Ez a dokumentum a fejlesztők számára, amely Dapper toobuild alkalmazások alapulnak, de azt is szeretnék tooembrace van [elastic database tooling](sql-database-elastic-scale-introduction.md) toocreate alkalmazások, amelyek megvalósítják horizontális tooscale kibővített az adatréteg.</span><span class="sxs-lookup"><span data-stu-id="8d0da-104">This document is for developers that rely on Dapper toobuild applications, but also want tooembrace [elastic database tooling](sql-database-elastic-scale-introduction.md) toocreate applications that implement sharding tooscale-out their data tier.</span></span>  <span data-ttu-id="8d0da-105">Ez a dokumentum Dapper-alapú alkalmazások, amelyek a rugalmas adatbáziseszközöket szükséges toointegrate hello változásait mutatja be.</span><span class="sxs-lookup"><span data-stu-id="8d0da-105">This document illustrates hello changes in Dapper-based applications that are necessary toointegrate with elastic database tools.</span></span> <span data-ttu-id="8d0da-106">A fókusz van a hello rugalmas adatbázis shard felügyelete és az adatok függő összeállítása útválasztással Dapper.</span><span class="sxs-lookup"><span data-stu-id="8d0da-106">Our focus is on composing hello elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="8d0da-107">**Példakód**: [rugalmas adatbáziseszközöket az Azure SQL Database - Dapper integrációs](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="8d0da-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="8d0da-108">Integrálása **Dapper** és **DapperExtensions** hello az Azure SQL Database elastic database ügyféloldali kódtár nem könnyű.</span><span class="sxs-lookup"><span data-stu-id="8d0da-108">Integrating **Dapper** and **DapperExtensions** with hello elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="8d0da-109">Az alkalmazások adatokat függő hello létrehozása módosítása, illetve új megnyitását útválasztást használhatja [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objektumok toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) hello hívja [ügyfél szalagtár](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="8d0da-109">Your applications can use data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from hello [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="8d0da-110">Ez korlátozza az alkalmazás tooonly, ahol új kapcsolatok létrehozása és megnyitott változásairól.</span><span class="sxs-lookup"><span data-stu-id="8d0da-110">This limits changes in your application tooonly where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="8d0da-111">Dapper áttekintése</span><span class="sxs-lookup"><span data-stu-id="8d0da-111">Dapper overview</span></span>
<span data-ttu-id="8d0da-112">**Dapper** egy objektum relációs leképező van.</span><span class="sxs-lookup"><span data-stu-id="8d0da-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="8d0da-113">Leképezi a .NET-objektumokat az alkalmazás tooa relációs adatbázisból (és fordítva).</span><span class="sxs-lookup"><span data-stu-id="8d0da-113">It maps .NET objects from your application tooa relational database (and vice versa).</span></span> <span data-ttu-id="8d0da-114">hello első része hello mintakód bemutatja, hogyan integrálható hello elastic database ügyféloldali kódtárának Dapper-alapú alkalmazások.</span><span class="sxs-lookup"><span data-stu-id="8d0da-114">hello first part of hello sample code illustrates how you can integrate hello elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="8d0da-115">második része hello hello mintakód bemutatja, hogyan toointegrate Dapper és a DapperExtensions használatakor.</span><span class="sxs-lookup"><span data-stu-id="8d0da-115">hello second part of hello sample code illustrates how toointegrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="8d0da-116">hello leképező funkcióit Dapper kiterjesztésmetódusok biztosít, amelyek megkönnyítik a küldő T-SQL-utasítások végrehajtása vagy a lekérdező hello adatbázis adatbázis-kapcsolatok.</span><span class="sxs-lookup"><span data-stu-id="8d0da-116">hello mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying hello database.</span></span> <span data-ttu-id="8d0da-117">Például Dapper teszi, hogy a .NET-objektumokat és az SQL-utasításainak hello paraméterei között könnyen toomap **Execute** hívások vagy a .NET objektumokba SQL-lekérdezések eredményeinek tooconsume hello **lekérdezés**Dapper hívásait.</span><span class="sxs-lookup"><span data-stu-id="8d0da-117">For instance, Dapper makes it easy toomap between your .NET objects and hello parameters of SQL statements for **Execute** calls, or tooconsume hello results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="8d0da-118">DapperExtensions használatakor nem kell többé tooprovide hello SQL-utasításokat.</span><span class="sxs-lookup"><span data-stu-id="8d0da-118">When using DapperExtensions, you no longer need tooprovide hello SQL statements.</span></span> <span data-ttu-id="8d0da-119">Bővítmények módszerek **GetList** vagy **beszúrása** hello adatbázis-kapcsolaton keresztül hello SQL-utasítások létrehozásához hello színfalak mögött.</span><span class="sxs-lookup"><span data-stu-id="8d0da-119">Extensions methods such as **GetList** or **Insert** over hello database connection create hello SQL statements behind hello scenes.</span></span>

<span data-ttu-id="8d0da-120">Egy másik Dapper, és DapperExtensions előnye, hogy hello alkalmazás vezérlők hello hello adatbázis-kapcsolat létrehozását.</span><span class="sxs-lookup"><span data-stu-id="8d0da-120">Another benefit of Dapper and also DapperExtensions is that hello application controls hello creation of hello database connection.</span></span> <span data-ttu-id="8d0da-121">Ezzel a megoldással hello elastic database ügyféloldali kódtár brókerek adatbázis-kapcsolatok shardlets toodatabases hello leképezése alapján, amely interakciót.</span><span class="sxs-lookup"><span data-stu-id="8d0da-121">This helps interact with hello elastic database client library which brokers database connections based on hello mapping of shardlets toodatabases.</span></span>

<span data-ttu-id="8d0da-122">tooget hello Dapper szerelvényeket, lásd: [Dapper pont nettó](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="8d0da-122">tooget hello Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="8d0da-123">Hello Dapper bővítmények, lásd: [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="8d0da-123">For hello Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-hello-elastic-database-client-library"></a><span data-ttu-id="8d0da-124">Hello elastic database ügyféloldali kódtárának gyors áttekintése</span><span class="sxs-lookup"><span data-stu-id="8d0da-124">A quick Look at hello elastic database client library</span></span>
<span data-ttu-id="8d0da-125">Hello elastic database ügyféloldali kódtár, a szolgáltatás megadhatja az alkalmazásadatok nevű partíciója *shardlets* oldalváltozókhoz toodatabases és azonosításához által *horizontális kulcsok*.</span><span class="sxs-lookup"><span data-stu-id="8d0da-125">With hello elastic database client library, you define partitions of your application data called *shardlets* , map them toodatabases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="8d0da-126">Tetszőleges számú adatbázist kell, és a shardlets szét ezeket az adatbázisokat is.</span><span class="sxs-lookup"><span data-stu-id="8d0da-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="8d0da-127">horizontális kulcsértékei toohello adatbázisok hello leképezése hello könyvtár API-k által biztosított shard térkép tárolja.</span><span class="sxs-lookup"><span data-stu-id="8d0da-127">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello library’s APIs.</span></span> <span data-ttu-id="8d0da-128">Ez a funkció neve **shard térkép felügyeleti**.</span><span class="sxs-lookup"><span data-stu-id="8d0da-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="8d0da-129">hello shard térkép hello broker az adatbázis-kapcsolatok a kéréseket, amelyben egy horizontális skálázási kulcsot is funkcionál.</span><span class="sxs-lookup"><span data-stu-id="8d0da-129">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="8d0da-130">Ez a lehetőség a hivatkozott tooas **adatok függő útválasztási**.</span><span class="sxs-lookup"><span data-stu-id="8d0da-130">This capability is referred tooas **data dependent routing**.</span></span>

![A shard leképezések és az adatok függő útválasztási][1]

<span data-ttu-id="8d0da-132">hello shard térkép kezelő felhasználók védi a inkonzisztens nézetek hello adatbázisok hogy egyidejű shardlet felügyeleti műveletek során esetlegesen előforduló shardlet adatokká.</span><span class="sxs-lookup"><span data-stu-id="8d0da-132">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on hello databases.</span></span> <span data-ttu-id="8d0da-133">toodo tehát hello shard maps broker hello adatbázis-kapcsolatok hello könyvtár-val készült alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="8d0da-133">toodo so, hello shard maps broker hello database connections for an application built with hello library.</span></span> <span data-ttu-id="8d0da-134">A shard felügyeleti műveletek jelentős hatással lehet a hello shardlet, lehetővé teszi hello shard leképezés funkció tooautomatically kill egy adatbázis-kapcsolatot.</span><span class="sxs-lookup"><span data-stu-id="8d0da-134">When shard management operations could impact hello shardlet, this allows hello shard map functionality tooautomatically kill a database connection.</span></span> 

<span data-ttu-id="8d0da-135">Hello hagyományos módon toocreate kapcsolatok helyett a Dapper, igazolnia kell toouse hello [OpenConnectionForKey metódus](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="8d0da-135">Instead of using hello traditional way toocreate connections for Dapper, we need toouse hello [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="8d0da-136">Ez biztosítja, hogy minden hello érvényesítési történik, és kapcsolatok felügyelt megfelelően Ha adatokat szilánkok között helyezi.</span><span class="sxs-lookup"><span data-stu-id="8d0da-136">This ensures that all hello validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="8d0da-137">Dapper integrációs követelményei</span><span class="sxs-lookup"><span data-stu-id="8d0da-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="8d0da-138">Hello elastic database ügyféloldali kódtárának és a hello Dapper API-k használata, ha azt szeretnénk, ha tooretain hello következő tulajdonságai:</span><span class="sxs-lookup"><span data-stu-id="8d0da-138">When working with both hello elastic database client library and hello Dapper APIs, we want tooretain hello following properties:</span></span>

* <span data-ttu-id="8d0da-139">**Scaleout**: azt szeretné, hogy tooadd, vagy távolítsa el adatbázisok hello adatrétegbeli alkalmazási hello szilánkos hello kapacitás iránti igények kielégítése érdekében a megfelelő hello alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="8d0da-139">**Scaleout**: We want tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> 
* <span data-ttu-id="8d0da-140">**Konzisztencia**: mivel az alkalmazás horizontálisan horizontális használatával, igazolnia kell tooperform adatok függő útválasztást.</span><span class="sxs-lookup"><span data-stu-id="8d0da-140">**Consistency**: Since our application is scaled out using sharding, we need tooperform data dependent routing.</span></span> <span data-ttu-id="8d0da-141">Ezért szeretnénk toouse hello adatok függő útválasztási képességeit hello könyvtár toodo.</span><span class="sxs-lookup"><span data-stu-id="8d0da-141">We want toouse hello Data dependent routing capabilities of hello library toodo so.</span></span> <span data-ttu-id="8d0da-142">Különösen azt szeretnénk, ha tooretain hello érvényesítés, és konzisztencia biztosítja, hogy a hello shard térkép manager rendelés tooavoid sérülés vagy hibás lekérdezések eredményeit a rendszer közvetítőalapú kapcsolatok számát biztosítja.</span><span class="sxs-lookup"><span data-stu-id="8d0da-142">In particular, we want tooretain hello validation and consistency guarantees provided by connections that are brokered through hello shard map manager in order tooavoid corruption or wrong query results.</span></span> <span data-ttu-id="8d0da-143">Ez biztosítja, hogy kapcsolatok tooa shardlet megadott elutasították vagy leállt, ha (például) hello shardlet jelenleg áthelyezett tooa különböző shard vegyes/egyesítés API-k használatával.</span><span class="sxs-lookup"><span data-stu-id="8d0da-143">This ensures that connections tooa given shardlet are rejected or stopped if (for instance) hello shardlet is currently moved tooa different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="8d0da-144">**Objektum leképezésének**: szeretnénk hello alkalmazásban osztályok és az alapul szolgáló adatbázis felépítését hello közötti Dapper tootranslate által biztosított hello megfeleltetéseket tooretain hello kényelmi célokat szolgál.</span><span class="sxs-lookup"><span data-stu-id="8d0da-144">**Object Mapping**: We want tooretain hello convenience of hello mappings provided by Dapper tootranslate between classes in hello application and hello underlying database structures.</span></span> 

<span data-ttu-id="8d0da-145">hello következő szakasz útmutatást nyújt a alapuló alkalmazások követelménynek **Dapper** és **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="8d0da-145">hello following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="8d0da-146">Műszaki útmutató</span><span class="sxs-lookup"><span data-stu-id="8d0da-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="8d0da-147">Függő Dapper az útválasztási adatok</span><span class="sxs-lookup"><span data-stu-id="8d0da-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="8d0da-148">Dapper hello alkalmazás általában létrehozásáért és hello kapcsolatok toohello az alapul szolgáló adatbázis megnyitása.</span><span class="sxs-lookup"><span data-stu-id="8d0da-148">With Dapper, hello application is typically responsible for creating and opening hello connections toohello underlying database.</span></span> <span data-ttu-id="8d0da-149">T típus megadott hello alkalmazás, Dapper eredményeket ad vissza lekérdezés, T. Dapper típusú .NET gyűjteményekre hello leképezés a hello T-SQL sorok toohello eredményobjektumok T. típusú hajt végre. Dapper hasonlóan SQL értékek vagy adatok adatkezelési nyelv utasítások paramétereinek leképezi a .NET-objektumokat.</span><span class="sxs-lookup"><span data-stu-id="8d0da-149">Given a type T by hello application, Dapper returns query results as .NET collections of type T. Dapper performs hello mapping from hello T-SQL result rows toohello objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="8d0da-150">Dapper nyújt ez a funkció a rendszeres hello kiterjesztésmetódusok keresztül [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) hello ADO .NET SQL klienskódtárak objektumot.</span><span class="sxs-lookup"><span data-stu-id="8d0da-150">Dapper offers this functionality via extension methods on hello regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from hello ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="8d0da-151">hello DDR hello rugalmas, méretezhető API-k által visszaküldött SQL kapcsolódási megtalálhatók rendszeres [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objektumok.</span><span class="sxs-lookup"><span data-stu-id="8d0da-151">hello SQL connection returned by hello Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="8d0da-152">Ez lehetővé teszi toodirectly használata Dapper bővítmények hello ügyféloldali kódtár DDR API-t által visszaadott hello típus keresztül, mert is egyszerű SQL ügyfél kapcsolat.</span><span class="sxs-lookup"><span data-stu-id="8d0da-152">This allows us toodirectly use Dapper extensions over hello type returned by hello client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="8d0da-153">E megfigyelések hello elastic database ügyféloldali kódtár által Dapper a(z) közvetítőalapú egyszerű toouse kapcsolatok révén.</span><span class="sxs-lookup"><span data-stu-id="8d0da-153">These observations make it straightforward toouse connections brokered by hello elastic database client library for Dapper.</span></span>

<span data-ttu-id="8d0da-154">Ez a Kódpélda (a minta kísérő hello) mutatja be, ahol hello horizontális kulcs hello alkalmazás toohello könyvtár toobroker hello kapcsolat toohello jobb shard által biztosított hello megközelítés.</span><span class="sxs-lookup"><span data-stu-id="8d0da-154">This code example (from hello accompanying sample) illustrates hello approach where hello sharding key is provided by hello application toohello library toobroker hello connection toohello right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="8d0da-155">hello hívás toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API a felváltja hello alapértelmezett létrehozása és egy ügyfél SQL-kapcsolat megnyitása.</span><span class="sxs-lookup"><span data-stu-id="8d0da-155">hello call toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces hello default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="8d0da-156">Hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) hívás argumentummal hello szükséges adatok függő útválasztás:</span><span class="sxs-lookup"><span data-stu-id="8d0da-156">hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes hello arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="8d0da-157">hello shard térkép tooaccess hello adatok függő útválasztási felületek</span><span class="sxs-lookup"><span data-stu-id="8d0da-157">hello shard map tooaccess hello data dependent routing interfaces</span></span>
* <span data-ttu-id="8d0da-158">hello horizontális kulcs tooidentify hello shardlet</span><span class="sxs-lookup"><span data-stu-id="8d0da-158">hello sharding key tooidentify hello shardlet</span></span>
* <span data-ttu-id="8d0da-159">hello hitelesítő adatokat (felhasználónév és jelszó) tooconnect toohello shard</span><span class="sxs-lookup"><span data-stu-id="8d0da-159">hello credentials (user name and password) tooconnect toohello shard</span></span>

<span data-ttu-id="8d0da-160">hello shard térkép objektum hoz létre a kapcsolat toohello shard, amely tárolja a megadott horizontális skálázási kulcs hello hello shardlet.</span><span class="sxs-lookup"><span data-stu-id="8d0da-160">hello shard map object creates a connection toohello shard that holds hello shardlet for hello given sharding key.</span></span> <span data-ttu-id="8d0da-161">hello rugalmas adatbázis ügyfél API-kat is hello kapcsolat tooimplement a konzisztencia biztosítja, hogy címkét.</span><span class="sxs-lookup"><span data-stu-id="8d0da-161">hello elastic database client APIs also tag hello connection tooimplement its consistency guarantees.</span></span> <span data-ttu-id="8d0da-162">Hello óta hívása túl[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) adja vissza a normál SQL ügyfélkapcsolati objektumot, hello későbbi hívás toohello **Execute** kiterjesztésmetódus Dapper követi a szabványos Dapper hello ajánlott.</span><span class="sxs-lookup"><span data-stu-id="8d0da-162">Since hello call too[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, hello subsequent call toohello **Execute** extension method from Dapper follows hello standard Dapper practice.</span></span>

<span data-ttu-id="8d0da-163">Lekérdezések munkahelyi túlságosan azok hello azonos módon - először megnyitja hello kapcsolat használatával [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) hello ügyfél API-t.</span><span class="sxs-lookup"><span data-stu-id="8d0da-163">Queries work very much hello same way - you first open hello connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from hello client API.</span></span> <span data-ttu-id="8d0da-164">.NET-objektumokba használhatják a hello rendszeres Dapper bővítmény módszerek toomap hello eredményeit az SQL-lekérdezés:</span><span class="sxs-lookup"><span data-stu-id="8d0da-164">Then you use hello regular Dapper extension methods toomap hello results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="8d0da-165">Vegye figyelembe, hogy hello **használatával** hello DDR kapcsolat hatókörökhöz blokkolása hello blokk toohello egy shard ahol tenantId1 tartják belül az összes művelet.</span><span class="sxs-lookup"><span data-stu-id="8d0da-165">Note that hello **using** block with hello DDR connection scopes all database operations within hello block toohello one shard where tenantId1 is kept.</span></span> <span data-ttu-id="8d0da-166">hello lekérdezés csak tárolt hello aktuális shard, de nem megfelelően tárolt bármely más szilánkok hello blogok adja vissza.</span><span class="sxs-lookup"><span data-stu-id="8d0da-166">hello query only returns blogs stored on hello current shard, but not hello ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="8d0da-167">Függő Dapper és DapperExtensions útválasztási adatok</span><span class="sxs-lookup"><span data-stu-id="8d0da-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="8d0da-168">További kiterjesztések biztosíthat további kényelmi és absztrakciós hello adatbázisból, adatbázis-alkalmazások fejlesztése során az ökoszisztéma Dapper tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="8d0da-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from hello database when developing database applications.</span></span> <span data-ttu-id="8d0da-169">DapperExtensions csak példaként szolgál.</span><span class="sxs-lookup"><span data-stu-id="8d0da-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="8d0da-170">Az alkalmazásban használt DapperExtensions nem változik, hogyan adatbázis-kapcsolatok létrehozása és kezelése.</span><span class="sxs-lookup"><span data-stu-id="8d0da-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="8d0da-171">Még mindig hello alkalmazás felelősségi tooopen kapcsolatokat, és rendszeres SQL ügyfél kapcsolatobjektumok hello kiterjesztésmetódusok által várható.</span><span class="sxs-lookup"><span data-stu-id="8d0da-171">It is still hello application’s responsibility tooopen connections, and regular SQL Client connection objects are expected by hello extension methods.</span></span> <span data-ttu-id="8d0da-172">A Microsoft hello támaszkodhat [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) fent leírt módon.</span><span class="sxs-lookup"><span data-stu-id="8d0da-172">We can rely on hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="8d0da-173">Mint hello következő mintakódok jelzik, hello mindössze annyi a változás, azt már nem rendelkezik toowrite hello T-SQL utasítások:</span><span class="sxs-lookup"><span data-stu-id="8d0da-173">As hello following code samples show, hello only change is that we do no longer have toowrite hello T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="8d0da-174">És itt hello kódminta hello lekérdezés:</span><span class="sxs-lookup"><span data-stu-id="8d0da-174">And here is hello code sample for hello query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="8d0da-175">Átmeneti kezelése</span><span class="sxs-lookup"><span data-stu-id="8d0da-175">Handling transient faults</span></span>
<span data-ttu-id="8d0da-176">hello Microsoft Patterns & eljárások csapat közzétett hello [átmeneti hiba kezelési alkalmazás blokk](http://msdn.microsoft.com/library/hh680934.aspx) toohelp alkalmazásfejlesztők mérséklése észlelt, amikor hello felhőben futó közös átmeneti hiba feltételeket.</span><span class="sxs-lookup"><span data-stu-id="8d0da-176">hello Microsoft Patterns & Practices team published hello [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) toohelp application developers mitigate common transient fault conditions encountered when running in hello cloud.</span></span> <span data-ttu-id="8d0da-177">További információkért lásd: [Perseverance, minden Triumphs titkos: átmeneti hiba kezelési alkalmazás blokk hello segítségével](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="8d0da-177">For more information, see [Perseverance, Secret of All Triumphs: Using hello Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="8d0da-178">hello kódminta támaszkodik hello átmeneti hiba könyvtár tooprotect átmeneti hibák ellen.</span><span class="sxs-lookup"><span data-stu-id="8d0da-178">hello code sample relies on hello transient fault library tooprotect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="8d0da-179">**SqlDatabaseUtils.SqlRetryPolicy** hello a fenti kódot típusúként van definiálva egy **SqlDatabaseTransientErrorDetectionStrategy** újrapróbálkozás-szám 10-es és 5 másodperc várjon az újrapróbálkozások között eltelt idő.</span><span class="sxs-lookup"><span data-stu-id="8d0da-179">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="8d0da-180">Ha tranzakciók használ, győződjön meg arról, hogy az újra gombra hatókör Visszalépés toohello hello tranzakció hello esetben egy átmeneti hiba verziótól.</span><span class="sxs-lookup"><span data-stu-id="8d0da-180">If you are using transactions, make sure that your retry scope goes back toohello beginning of hello transaction in hello case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="8d0da-181">Korlátozások</span><span class="sxs-lookup"><span data-stu-id="8d0da-181">Limitations</span></span>
<span data-ttu-id="8d0da-182">Ebben a dokumentumban leírt hello megközelítések néhány korlátozásokkal jár:</span><span class="sxs-lookup"><span data-stu-id="8d0da-182">hello approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="8d0da-183">hello mintakód a dokumentum nem bemutatják, hogyan toomanage séma szilánkok között.</span><span class="sxs-lookup"><span data-stu-id="8d0da-183">hello sample code for this document does not demonstrate how toomanage schema across shards.</span></span>
* <span data-ttu-id="8d0da-184">A kérelemben megadott, feltételezzük, hogy az adatbázis-feldolgozási tartalmazza egyetlen shard hello kérelem által biztosított hello horizontális kulcs által meghatározott.</span><span class="sxs-lookup"><span data-stu-id="8d0da-184">Given a request, we assume that all its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="8d0da-185">Azonban ez azt feltételezi mindig tartalmaz, például ha az nem lehetséges toomake egy horizontális skálázási kulcsát.</span><span class="sxs-lookup"><span data-stu-id="8d0da-185">However, this assumption does not always hold, for example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="8d0da-186">tooaddress a, hello elastic database ügyféloldali kódtára tartalmaz hello [MultiShardQuery osztály](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="8d0da-186">tooaddress this, hello elastic database client library includes hello [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="8d0da-187">hello osztály megvalósít egy kapcsolat absztrakciós több szilánkok keresztül lekérdezése.</span><span class="sxs-lookup"><span data-stu-id="8d0da-187">hello class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="8d0da-188">MultiShardQuery Dapper együttes alkalmazásával nem ez a dokumentum hello terjed.</span><span class="sxs-lookup"><span data-stu-id="8d0da-188">Using MultiShardQuery in combination with Dapper is beyond hello scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="8d0da-189">Összegzés</span><span class="sxs-lookup"><span data-stu-id="8d0da-189">Conclusion</span></span>
<span data-ttu-id="8d0da-190">Alkalmazás Dapper és DapperExtensions könnyen is kihasználhatja a rugalmas adatbázis-eszközt az Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="8d0da-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="8d0da-191">Ebben a dokumentumban leírt hello lépéseit, ezeket az alkalmazásokat is használhat hello eszköz funkció függő útválasztási módosítása hello létrehozása és megnyitásakor az új adatok [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objektumok toouse hello [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) hello elastic database ügyféloldali kódtár hívás.</span><span class="sxs-lookup"><span data-stu-id="8d0da-191">Through hello steps outlined in this document, those applications can use hello tool's capability for data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of hello elastic database client library.</span></span> <span data-ttu-id="8d0da-192">Ez korlátozza az új kapcsolatok létrehozása és megnyitott hello alkalmazás módosítások szükséges toothose helyeken.</span><span class="sxs-lookup"><span data-stu-id="8d0da-192">This limits hello application changes required toothose places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png
