---
title: "a több-bérlős alkalmazások által használt Azure SQL adatbázis új bérlők aaaProvision |} Microsoft Docs"
description: "Ismerje meg, hogyan tooprovision és a katalógus új bérlők hello Wingtip SaaS-alkalmazás"
keywords: "sql database-oktatóanyag"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: eb26f523305650c2124e36707d187dfcdad06fcc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="provision-new-tenants-and-register-them-in-hello-catalog"></a><span data-ttu-id="72ab1-104">Új bérlők kiépíteni, és regisztrálja őket hello katalógusban</span><span class="sxs-lookup"><span data-stu-id="72ab1-104">Provision new tenants and register them in hello catalog</span></span>

<span data-ttu-id="72ab1-105">Ebben az oktatóanyagban elsajátíthatja hello kiépítése és a katalógus SaaS mintákat és a hogyan végrehajtásuk hello Wingtip SaaS-alkalmazáshoz.</span><span class="sxs-lookup"><span data-stu-id="72ab1-105">In this tutorial, you learn about hello provision and catalog SaaS patterns, and how they are implemented in hello Wingtip SaaS application.</span></span> <span data-ttu-id="72ab1-106">Hozzon létre és új bérlő adatbázisok inicializálása, és regisztrálja őket hello alkalmazás bérlői katalógusban.</span><span class="sxs-lookup"><span data-stu-id="72ab1-106">You create and initialize new tenant databases, and register them in hello application’s tenant catalog.</span></span> <span data-ttu-id="72ab1-107">hello katalógus egy adatbázis hello leképezést hello SaaS-alkalmazáshoz tartozó sok bérlők és az adatok között.</span><span class="sxs-lookup"><span data-stu-id="72ab1-107">hello catalog is a database that maintains hello mapping between hello SaaS application's many tenants and their data.</span></span> <span data-ttu-id="72ab1-108">hello katalógus arra utasíthatja a megfelelő adatbázis-alkalmazás kérelmek toohello fontos szerepet játszik.</span><span class="sxs-lookup"><span data-stu-id="72ab1-108">hello catalog plays an important role directing application requests toohello correct database.</span></span>  

<span data-ttu-id="72ab1-109">Eben az oktatóanyagban az alábbiakkal fog megismerkedni:</span><span class="sxs-lookup"><span data-stu-id="72ab1-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="72ab1-110">Egy új bérlőt, beleértve a lépésenkénti végrehajtás hogyan ez van megvalósítva kiépítése</span><span class="sxs-lookup"><span data-stu-id="72ab1-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="72ab1-111">További bérlők kötegelt kiépítése</span><span class="sxs-lookup"><span data-stu-id="72ab1-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="72ab1-112">Ebben az oktatóanyagban a következő előfeltételek győződjön meg arról, hogy hello elvégzése toocomplete:</span><span class="sxs-lookup"><span data-stu-id="72ab1-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="72ab1-113">hello Wingtip SaaS-alkalmazás telepítve van.</span><span class="sxs-lookup"><span data-stu-id="72ab1-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="72ab1-114">toodeploy öt percen belül, lásd: [központi telepítése és felfedezése hello Wingtip SaaS-alkalmazáshoz](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="72ab1-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="72ab1-115">Az Azure PowerShell telepítve van.</span><span class="sxs-lookup"><span data-stu-id="72ab1-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="72ab1-116">A részletekért lásd: [Ismerkedés az Azure PowerShell-lel](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="72ab1-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-toohello-saas-catalog-pattern"></a><span data-ttu-id="72ab1-117">Bevezetés toohello Szolgáltatottszoftver-katalógus minta</span><span class="sxs-lookup"><span data-stu-id="72ab1-117">Introduction toohello SaaS Catalog pattern</span></span>

<span data-ttu-id="72ab1-118">Egy adatbázis biztonsági több-bérlős SaaS-alkalmazáshoz hogy a rendszer az egyes bérlők számára adatokat tároló fontos tooknow.</span><span class="sxs-lookup"><span data-stu-id="72ab1-118">In a database-backed multi-tenant SaaS application, it's important tooknow where information for each tenant is stored.</span></span> <span data-ttu-id="72ab1-119">Hello SaaS katalógus mintában a katalógus adatbázisa használt toohold hello leképezési között az egyes bérlők és az adatok tárolására.</span><span class="sxs-lookup"><span data-stu-id="72ab1-119">In hello SaaS catalog pattern, a catalog database is used toohold hello mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="72ab1-120">hello Wingtip SaaS-alkalmazás használja a single-bérlő másodpercenkénti adatbázis-architektúra, de hello alapvető szerkezet bérlői adatbázis-leképezés tárolása a katalógus vonatkozik, hogy egy több-bérlős vagy egy bérlői adatbázist használja.</span><span class="sxs-lookup"><span data-stu-id="72ab1-120">hello Wingtip SaaS app uses a single-tenant per database architecture, but hello basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="72ab1-121">Mindegyik bérlő hozzá van rendelve egy kulcs, amely azonosítja azokat hello katalógusban, és amely hello megfelelő adatbázis toohello helye leképezve.</span><span class="sxs-lookup"><span data-stu-id="72ab1-121">Each tenant is assigned a key that identifies them in hello catalog and which is mapped toohello location of hello appropriate database.</span></span> <span data-ttu-id="72ab1-122">Hello Wingtip SaaS-alkalmazás hello kulcs formátuma a hello bérlő neve kivonatát.</span><span class="sxs-lookup"><span data-stu-id="72ab1-122">In hello Wingtip SaaS app, hello key is formed from a hash of hello tenant’s name.</span></span> <span data-ttu-id="72ab1-123">Ez lehetővé teszi, hogy hello bérlői részét hello alkalmazás URL-cím toobe használt tooconstruct hello kulcs.</span><span class="sxs-lookup"><span data-stu-id="72ab1-123">This allows hello tenant name portion of hello application URL toobe used tooconstruct hello key.</span></span> <span data-ttu-id="72ab1-124">Más bérlői kulcs rendszerek is használható.</span><span class="sxs-lookup"><span data-stu-id="72ab1-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="72ab1-125">hello katalógus lehetővé teszi, hogy hello nevét vagy helyét hello adatbázis toobe gyakorolt minimális hatás mellett a hello alkalmazás módosult.</span><span class="sxs-lookup"><span data-stu-id="72ab1-125">hello catalog allows hello name or location of hello database toobe changed with minimal impact on hello application.</span></span>  <span data-ttu-id="72ab1-126">Egy adatbázis több-bérlős modell ez is biztosítja az "" a bérlő közötti áthelyezése adatbázisok.</span><span class="sxs-lookup"><span data-stu-id="72ab1-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="72ab1-127">hello katalógus is lehet használt tooindicate, hogy a bérlő vagy adatbázis karbantartási és egyéb műveletek offline állapotban.</span><span class="sxs-lookup"><span data-stu-id="72ab1-127">hello catalog can also be used tooindicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="72ab1-128">Ez az írja le hello [egybérlős oktatóanyag visszaállítása](sql-database-saas-tutorial-restore-single-tenant.md).</span><span class="sxs-lookup"><span data-stu-id="72ab1-128">This is explored in hello [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="72ab1-129">Ezenkívül hello katalógus, amely lényegében egy felügyeleti adatbázis egy SaaS-alkalmazáshoz, tárolhatja a bérlő vagy az adatbázis metaadatokat, például a hello réteg a rendszer vagy egy adatbázist, a séma verziója, a service-csomag vagy a szolgáltatásiszint-szerződések kínált tootenants és egyéb adatait, amely lehetővé teszi a felügyeleti alkalmazás, ügyfél-támogatási vagy devops folyamatok.</span><span class="sxs-lookup"><span data-stu-id="72ab1-129">In addition, hello catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as hello tier or edition of a database, schema version, service plan, or SLAs offered tootenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="72ab1-130">Hello SaaS-alkalmazáshoz, túl hello katalógus adatbázis eszközök használatával engedélyezheti.</span><span class="sxs-lookup"><span data-stu-id="72ab1-130">Beyond hello SaaS application, hello catalog can enable database tools.</span></span>  <span data-ttu-id="72ab1-131">Hello Wingtip SaaS minta hello katalógus használt tooenable több-bérlős lekérdezés írja le hello [alkalmi analytics oktatóanyag](sql-database-saas-tutorial-adhoc-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="72ab1-131">In hello Wingtip SaaS sample, hello catalog is used tooenable cross-tenant query, explored in hello [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="72ab1-132">Adatbázisok közötti feladatkezelés van írja le hello [séma felügyeleti](sql-database-saas-tutorial-schema-management.md) és [analytics bérlői](sql-database-saas-tutorial-tenant-analytics.md) oktatóanyagok.</span><span class="sxs-lookup"><span data-stu-id="72ab1-132">Cross-database job management is explored in hello [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="72ab1-133">Hello Wingtip SaaS-alkalmazás hello katalógus segítségével van megvalósítva hello Shard kezelési funkciókat hello [rugalmas adatbázis ügyfél könyvtár (EDCL)](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="72ab1-133">In hello Wingtip SaaS app, hello catalog is implemented using hello Shard Management features of hello [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="72ab1-134">hello EDCL lehetővé teszi, hogy egy alkalmazás toocreate, kezelése és egy adatbázis biztonsági shard leképezéssel.</span><span class="sxs-lookup"><span data-stu-id="72ab1-134">hello EDCL enables an application toocreate, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="72ab1-135">A szilánkok térkép szilánkok (adatbázisok) és a kulcsok (bérlőkkel) és az adatbázisok közötti hello leképezés listáját tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="72ab1-135">A shard map contains a list of shards (databases) and hello mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="72ab1-136">EDCL funkciók bérlő kiépítésének toocreate hello bejegyzések hello shard leképezés közben használható alkalmazások vagy a PowerShell-parancsfájlok, valamint az alkalmazások tooefficiently elérheti a toohello megfelelő adatbázishoz.</span><span class="sxs-lookup"><span data-stu-id="72ab1-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning toocreate hello entries in hello shard map, and from applications tooefficiently connect toohello correct database.</span></span> <span data-ttu-id="72ab1-137">EDCL gyorsítótárba helyezi azt a kapcsolati adatokat toominimize hello forgalom toohello katalógus adatbázis és hello alkalmazás felgyorsítható.</span><span class="sxs-lookup"><span data-stu-id="72ab1-137">EDCL caches connection information toominimize hello traffic toohello catalog database and speed up hello application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="72ab1-138">hello hozzárendelési adatok érhető hello katalógus adatbázisban, de *nem szerkesztése*!</span><span class="sxs-lookup"><span data-stu-id="72ab1-138">hello mapping data is accessible in hello catalog database, but *don't edit it*!</span></span> <span data-ttu-id="72ab1-139">A társítási adatokat kizárólag az Elastic Database-ügyfélkódtár API-jaival szerkessze.</span><span class="sxs-lookup"><span data-stu-id="72ab1-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="72ab1-140">Az adatbázis közvetlen módosítása hello hozzárendelési adatok hello rongál kockázatok katalógusban, és nem támogatott.</span><span class="sxs-lookup"><span data-stu-id="72ab1-140">Directly manipulating hello mapping data risks corrupting hello catalog and is not supported.</span></span>


## <a name="introduction-toohello-saas-provisioning-pattern"></a><span data-ttu-id="72ab1-141">Bevezetés toohello Szolgáltatottszoftver-kialakítási minta</span><span class="sxs-lookup"><span data-stu-id="72ab1-141">Introduction toohello SaaS Provisioning pattern</span></span>

<span data-ttu-id="72ab1-142">Ha egy új bérlő adatbázis egyetlen-bérlő adatbázis modellt használ az SaaS-alkalmazás egy új bérlő bevezetési ki kell építenie.</span><span class="sxs-lookup"><span data-stu-id="72ab1-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="72ab1-143">Hello megfelelő helyet és a szolgáltatási rétegben, megfelelő séma- és referenciainformációkat adatokkal inicializálva, és regisztrálja hello katalógus hello megfelelő bérlői kulcs alatt kell létrehozni.</span><span class="sxs-lookup"><span data-stu-id="72ab1-143">It must be created in hello appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in hello catalog under hello appropriate tenant key.</span></span>  

<span data-ttu-id="72ab1-144">Különböző szempontok kiépítés, amelyek tartalmazhatnak SQL-parancsfájlok végrehajtása, egy bacpac telepítéséhez, vagy "arany" sablon adatbázis másolása használt toodatabase lehet.</span><span class="sxs-lookup"><span data-stu-id="72ab1-144">Different approaches can be used toodatabase provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="72ab1-145">hello kiépítési módszert használ a teljes séma kezelési stratégiában, amely győződjön meg arról, hogy új adatbázist a hello legújabb séma kiépített kell értelmezhető.</span><span class="sxs-lookup"><span data-stu-id="72ab1-145">hello provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with hello latest schema.</span></span>  <span data-ttu-id="72ab1-146">Ez az írja le hello [séma felügyeleti oktatóanyag](sql-database-saas-tutorial-schema-management.md).</span><span class="sxs-lookup"><span data-stu-id="72ab1-146">This is explored in hello [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="72ab1-147">hello Wingtip SaaS app szánt új bérlők által arany adatbázis másolása nevű basetenantdb hello katalógus kiszolgálóján telepítve.</span><span class="sxs-lookup"><span data-stu-id="72ab1-147">hello Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on hello catalog server.</span></span>  <span data-ttu-id="72ab1-148">Kiépítés sikertelen kell egy előfizetési élmény részeként hello alkalmazásba integrált, és/vagy támogatott offline állapotba a parancsfájlok segítségével.</span><span class="sxs-lookup"><span data-stu-id="72ab1-148">Provisioning could be integrated into hello application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="72ab1-149">Ez az oktatóanyag néhány kiépítése a PowerShell használatával.</span><span class="sxs-lookup"><span data-stu-id="72ab1-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="72ab1-150">hello üzembe helyezési parancsfájlok hello basetenantdb toocreate új bérlő adatbázis másolása a rugalmas készlethez, majd inicializálni a bérlő vonatkozó információval, és regisztrálja azt hello katalógus shard leképezés.</span><span class="sxs-lookup"><span data-stu-id="72ab1-150">hello provisioning scripts copy hello basetenantdb toocreate a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in hello catalog shard map.</span></span>  <span data-ttu-id="72ab1-151">Hello mintaalkalmazást, az adatbázisok hello bérlő neve, alapján kap, de ez nem az hello mintát fontos szerepet – hello katalógus hello használata lehetővé teszi bármely hozzárendelt toobe toohello adatbázisát. +</span><span class="sxs-lookup"><span data-stu-id="72ab1-151">In hello sample app, databases are given names based on hello tenant name, but this is not a critical part of hello pattern – hello use of hello catalog allows any name toobe assigned toohello database.+</span></span> 


## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="72ab1-152">Hello Wingtip alkalmazás parancsfájlok beolvasása</span><span class="sxs-lookup"><span data-stu-id="72ab1-152">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="72ab1-153">hello Wingtip Szolgáltatottszoftver-parancsfájlok és az alkalmazás forráskódjához találhatók hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github-tárház.</span><span class="sxs-lookup"><span data-stu-id="72ab1-153">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="72ab1-154">[Lépések toodownload hello Wingtip SaaS parancsfájlok](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="72ab1-154">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="72ab1-155">Részletes útmutató a kiépítéshez és katalógusba vételhez</span><span class="sxs-lookup"><span data-stu-id="72ab1-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="72ab1-156">toounderstand hogyan hello alkalmazás valósít meg új bérlő kiépítésének Wingtip, töréspont, és hello munkafolyamaton keresztül egy bérlő kiépítése során. lépés:</span><span class="sxs-lookup"><span data-stu-id="72ab1-156">toounderstand how hello Wingtip application implements new tenant provisioning, add a breakpoint and step through hello workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="72ab1-157">Nyissa meg... \\Tanulási modulok\\ProvisionAndCatalog\\_bemutató-ProvisionAndCatalog.ps1_ és hello beállítása a következő paramétereket:</span><span class="sxs-lookup"><span data-stu-id="72ab1-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set hello following parameters:</span></span>
   * <span data-ttu-id="72ab1-158">**$TenantName** = hello új helyszínére hello neve (például *Bushwillow kékek*).</span><span class="sxs-lookup"><span data-stu-id="72ab1-158">**$TenantName** = hello name of hello new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="72ab1-159">**$VenueType** = hello előre definiált helyszínére típusok egyikét: *kékek*, classicalmusic, tánc, jazz, judo, motorracing, többcélú, opera, rockmusic, foci.</span><span class="sxs-lookup"><span data-stu-id="72ab1-159">**$VenueType** = one of hello pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="72ab1-160">**$DemoScenario** = **1**, túl beállíthatja**1** túl*kiépíteni egy egybérlős*.</span><span class="sxs-lookup"><span data-stu-id="72ab1-160">**$DemoScenario** = **1**, Set too**1** too*Provision a single tenant*.</span></span>

1. <span data-ttu-id="72ab1-161">A kurzor bárhol tegyen sor 48, hello sor, amely szerint adja hozzá a töréspont: *New-bérlő "*, és nyomja le az ENTER **F9**.</span><span class="sxs-lookup"><span data-stu-id="72ab1-161">Add a breakpoint by putting your cursor anywhere on line 48, hello line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![töréspont](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="72ab1-163">toorun hello parancsfájl nyomja le az **F5**.</span><span class="sxs-lookup"><span data-stu-id="72ab1-163">toorun hello script press **F5**.</span></span>

1. <span data-ttu-id="72ab1-164">Hello parancsfájl végrehajtása hello töréspont megáll, után nyomja le az **F11** toostep hello kódba.</span><span class="sxs-lookup"><span data-stu-id="72ab1-164">After hello script execution stops at hello breakpoint, press **F11** toostep into hello code.</span></span>

   ![töréspont](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="72ab1-166">Nyomkövetési hello hello parancsfájl végrehajtását **Debug** menüpontok - **F10** és **F11** toostep keresztül vagy hello függvények hívása.</span><span class="sxs-lookup"><span data-stu-id="72ab1-166">Trace hello script's execution using hello **Debug** menu options - **F10** and **F11** toostep over or into hello called functions.</span></span> <span data-ttu-id="72ab1-167">PowerShell-parancsfájlok hibakereső kapcsolatban további információkért lásd: [kezelése és a PowerShell-parancsfájlok hibakeresési tippeket](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span><span class="sxs-lookup"><span data-stu-id="72ab1-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="72ab1-168">hello a következők nem tooexplicitly hajtsa végre a lépéseket, de annak magyarázatát, hello munkafolyamat hello parancsprogram-hibakeresés során lépéseit:</span><span class="sxs-lookup"><span data-stu-id="72ab1-168">hello following are not steps tooexplicitly follow, but an explanation of hello workflow you step through while debugging hello script:</span></span>

1. <span data-ttu-id="72ab1-169">**Importálás hello SubscriptionManagement.psm1** tooAzure bejelentkezés és hello Azure-előfizetés dolgozunk kiválasztásával funkciók tartalmazó modult.</span><span class="sxs-lookup"><span data-stu-id="72ab1-169">**Import hello SubscriptionManagement.psm1** module that contains functions for signing in tooAzure and selecting hello Azure subscription you are working with.</span></span>
1. <span data-ttu-id="72ab1-170">**Importálás hello CatalogAndDatabaseManagement.psm1** modul, amely a katalógus és a bérlői szintű absztrakció keresztül hello [Shard felügyeleti](sql-database-elastic-scale-shard-map-management.md) funkciók.</span><span class="sxs-lookup"><span data-stu-id="72ab1-170">**Import hello CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over hello [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="72ab1-171">Ez az egyik fontos modul, amely magában foglalja a legtöbb hello katalógus mintát, és érdemes felfedezése.</span><span class="sxs-lookup"><span data-stu-id="72ab1-171">This is an important module that encapsulates much of hello catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="72ab1-172">**Lekéri a konfigurációs részleteket**.</span><span class="sxs-lookup"><span data-stu-id="72ab1-172">**Get configuration details**.</span></span> <span data-ttu-id="72ab1-173">Lépjen be a Get-konfigurációra (F11), és tekintse meg, hogyan hello alkalmazások konfigurációja van megadva.</span><span class="sxs-lookup"><span data-stu-id="72ab1-173">Step into Get-Configuration (with F11) and see how hello app config is specified.</span></span> <span data-ttu-id="72ab1-174">Erőforrás és más alkalmazás-specifikus értékeket az itt megadott, de nem módosíthatja a következő értékek még nem ismeri a hello parancsfájlok.</span><span class="sxs-lookup"><span data-stu-id="72ab1-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with hello scripts.</span></span>
1. <span data-ttu-id="72ab1-175">**Hello katalógus objektum**.</span><span class="sxs-lookup"><span data-stu-id="72ab1-175">**Get hello catalog object**.</span></span> <span data-ttu-id="72ab1-176">Lépjen be a Get-katalógus, amely composes és a katalógus objektumot használt hello magasabb szintű parancsfájlban.</span><span class="sxs-lookup"><span data-stu-id="72ab1-176">Step into Get-Catalog which composes and returns a catalog object that is used in hello higher-level script.</span></span>  <span data-ttu-id="72ab1-177">Ez a funkció a Shard felügyeleti funkciók rendszerből importált **AzureShardManagement.psm1**.</span><span class="sxs-lookup"><span data-stu-id="72ab1-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="72ab1-178">hello katalógus objektum hello következő áll:</span><span class="sxs-lookup"><span data-stu-id="72ab1-178">hello catalog object is composed of hello following:</span></span>
   * <span data-ttu-id="72ab1-179">$catalogServerFullyQualifiedName összeállított hello szabványos stem és a felhasználói név: _katalógus -\<felhasználói\>. database.windows.net_.</span><span class="sxs-lookup"><span data-stu-id="72ab1-179">$catalogServerFullyQualifiedName is constructed using hello standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="72ab1-180">$catalogDatabaseName lekért hello config: *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="72ab1-180">$catalogDatabaseName is retrieved from hello config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="72ab1-181">hello katalógus adatbázisból $shardMapManager objektum inicializálása.</span><span class="sxs-lookup"><span data-stu-id="72ab1-181">$shardMapManager object is initialized from hello catalog database.</span></span>
   * <span data-ttu-id="72ab1-182">$shardMap objektum inicializálása a hello *tenantcatalog* shard térkép hello katalógus adatbázisban.</span><span class="sxs-lookup"><span data-stu-id="72ab1-182">$shardMap object is initialized from hello *tenantcatalog* shard map in hello catalog database.</span></span>
   <span data-ttu-id="72ab1-183">A katalógus objektum összetevői és adott vissza, és a hello magasabb szintű parancsfájl alkalmazva.</span><span class="sxs-lookup"><span data-stu-id="72ab1-183">A catalog object is composed and returned, and used in hello higher-level script.</span></span>
1. <span data-ttu-id="72ab1-184">**Kiszámítja új bérlőkulcs hello**.</span><span class="sxs-lookup"><span data-stu-id="72ab1-184">**Calculate hello new tenant key**.</span></span> <span data-ttu-id="72ab1-185">A kivonatoló függvényt használt toocreate hello bérlőkulcsát hello bérlő neve.</span><span class="sxs-lookup"><span data-stu-id="72ab1-185">A hash function is used toocreate hello tenant key from hello tenant name.</span></span>
1. <span data-ttu-id="72ab1-186">**Ellenőrizze, hogy léteznek-e már hello bérlőkulcs**.</span><span class="sxs-lookup"><span data-stu-id="72ab1-186">**Check if hello tenant key already exists**.</span></span> <span data-ttu-id="72ab1-187">hello katalógus be van jelölve, tooensure hello nem áll rendelkezésre.</span><span class="sxs-lookup"><span data-stu-id="72ab1-187">hello catalog is checked tooensure hello key is available.</span></span>
1. <span data-ttu-id="72ab1-188">**Új-TenantDatabase hello bérlői adatbázis ki van építve.**</span><span class="sxs-lookup"><span data-stu-id="72ab1-188">**hello tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="72ab1-189">Használjon **F11** a toostep és az hogyan hello adatbázis használó kiépítve egy [Azure Resource Manager-sablon](../azure-resource-manager/resource-manager-template-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="72ab1-189">Use **F11** toostep in and see how hello database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="72ab1-190">hello bérlő neve toomake, törölje a jelet mely shard tartozik toowhich bérlői értékekből összeállított hello adatbázis neve.</span><span class="sxs-lookup"><span data-stu-id="72ab1-190">hello database name is constructed from hello tenant name toomake it clear which shard belongs toowhich tenant.</span></span> <span data-ttu-id="72ab1-191">(Más stratégiák adatbázis elnevezési is könnyen használható.) + A Resource Manager-sablon (baseTenantDB) arany adatbázis másolása hello katalóguskiszolgálóhoz használt toocreate egy tenant adatbázisban.</span><span class="sxs-lookup"><span data-stu-id="72ab1-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used toocreate a tenant database by copying a golden database (baseTenantDB) on hello catalog server.</span></span> <span data-ttu-id="72ab1-192">Egy másik módszert is toocreate egy üres adatbázist és majd inicializálnia egy bacpac vagy tooexecute importálásával egy inicializálási parancsfájlja jól ismert helyről.</span><span class="sxs-lookup"><span data-stu-id="72ab1-192">An alternative approach could be toocreate an empty database and then initialize it by importing a bacpac, or tooexecute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="72ab1-193">hello Resource Manager-sablon hello ...\Learning Modules\Common\ mappában van: *tenantdatabasecopytemplate.json*</span><span class="sxs-lookup"><span data-stu-id="72ab1-193">hello Resource Manager template is in hello …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="72ab1-194">Hello bérlői adatbázis létrehozása után azt is majd **hello helyszínére (bérlői) nevű és hello helyszínére típusú inicializálva**.</span><span class="sxs-lookup"><span data-stu-id="72ab1-194">After hello tenant database is created, it is then further **initialized with hello venue (tenant) name and hello venue type**.</span></span> <span data-ttu-id="72ab1-195">Ezen a ponton további inicializálások is elvégezhetők.</span><span class="sxs-lookup"><span data-stu-id="72ab1-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="72ab1-196">Hello **hello katalógusban regisztrálva bérlői adatbázis** rendelkező *Add-TenantDatabaseToCatalog* hello bérlői kulcs használatával.</span><span class="sxs-lookup"><span data-stu-id="72ab1-196">hello **tenant database is registered in hello catalog** with *Add-TenantDatabaseToCatalog* using hello tenant key.</span></span> <span data-ttu-id="72ab1-197">Használjon **F11** hello részleteinek toostep:</span><span class="sxs-lookup"><span data-stu-id="72ab1-197">Use **F11** toostep into hello details:</span></span>

* <span data-ttu-id="72ab1-198">hello katalógus-adatbázis szerepel-toohello shard térkép (hello adatbázislistáinak ismert).</span><span class="sxs-lookup"><span data-stu-id="72ab1-198">hello catalog database is added toohello shard map (hello list of known databases).</span></span>
* <span data-ttu-id="72ab1-199">a hivatkozások hello kulcsérték toohello szilánkok leképezése hello jön létre.</span><span class="sxs-lookup"><span data-stu-id="72ab1-199">hello mapping that links hello key value toohello shard is created.</span></span>
* <span data-ttu-id="72ab1-200">További meta adatait (hello helyszínére neve) hello bérlői kerül toohello bérlők tábla hello katalógusban.</span><span class="sxs-lookup"><span data-stu-id="72ab1-200">Additional meta data (hello venue's name) about hello tenant is added toohello Tenants table in hello catalog.</span></span>  <span data-ttu-id="72ab1-201">hello bérlők tábla nincs hello ShardManagement séma része, és hello EDCL szerint nincs telepítve.</span><span class="sxs-lookup"><span data-stu-id="72ab1-201">hello Tenants table is not part of hello ShardManagement schema and is not installed by hello EDCL.</span></span>  <span data-ttu-id="72ab1-202">A következő táblázat bemutatja, hogyan hello katalógus adatbázis bővíthető toosupport további alkalmazásspecifikus adatait.</span><span class="sxs-lookup"><span data-stu-id="72ab1-202">This table illustrates how hello Catalog database can be extended toosupport additional application-specific data.</span></span>   


<span data-ttu-id="72ab1-203">Kiépítés befejezése után végrehajtási adja vissza toohello eredeti *bemutató-ProvisionAndCatalog* parancsfájl, amely megnyitja hello **események** hello új bérlő hello böngészőben lap:</span><span class="sxs-lookup"><span data-stu-id="72ab1-203">After provisioning completes, execution returns toohello original *Demo-ProvisionAndCatalog* script, which opens hello **Events** page for hello new tenant in hello browser:</span></span>

   ![események](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="72ab1-205">Egy kötegben, a bérlő kiépítése</span><span class="sxs-lookup"><span data-stu-id="72ab1-205">Provision a batch of tenants</span></span>

<span data-ttu-id="72ab1-206">Ebben a gyakorlatban egy kötegelt 17 bérlő látja el.</span><span class="sxs-lookup"><span data-stu-id="72ab1-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="72ab1-207">A kötegelt bérlő kiépítése többi Wingtip SaaS oktatóanyag elindítása, így a több mint pár adatbázisok toowork előtt ajánlott.</span><span class="sxs-lookup"><span data-stu-id="72ab1-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases toowork with.</span></span>

1. <span data-ttu-id="72ab1-208">Nyissa meg... \\Tanulási modulok\\ProvisionAndCatalog\\*bemutató-ProvisionAndCatalog.ps1* a hello *PowerShell ISE* , és módosítsa a hello *$ DemoScenario* paraméter too3:</span><span class="sxs-lookup"><span data-stu-id="72ab1-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in hello *PowerShell ISE* and change hello *$DemoScenario* parameter too3:</span></span>
   * <span data-ttu-id="72ab1-209">**$DemoScenario** = **3**, túl módosítása**3** túl*kiépíteni a bérlő köteg*.</span><span class="sxs-lookup"><span data-stu-id="72ab1-209">**$DemoScenario** = **3**, change too**3** too*Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="72ab1-210">Nyomja le az **F5** és hello parancsprogrammal.</span><span class="sxs-lookup"><span data-stu-id="72ab1-210">Press **F5** and run hello script.</span></span>

<span data-ttu-id="72ab1-211">hello parancsfájl egy kötegelt további bérlő telepíti.</span><span class="sxs-lookup"><span data-stu-id="72ab1-211">hello script deploys a batch of additional tenants.</span></span> <span data-ttu-id="72ab1-212">Használja az [Azure Resource Manager sablon](../azure-resource-manager/resource-manager-template-walkthrough.md) , amely hello kötegelt vezérli, és majd az összes adatbázis tooa csatolt sablon üzembe delegálja.</span><span class="sxs-lookup"><span data-stu-id="72ab1-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls hello batch and then delegates provisioning of each database tooa linked template.</span></span> <span data-ttu-id="72ab1-213">Ily módon sablonok használata lehetővé teszi, hogy Azure Resource Manager toobroker hello létesítésének folyamatát kell használnia a parancsfájlt.</span><span class="sxs-lookup"><span data-stu-id="72ab1-213">Using templates in this way allows Azure Resource Manager toobroker hello provisioning process for your script.</span></span> <span data-ttu-id="72ab1-214">Sablonok kiépítése adatbázisok párhuzamos, ahol, és szükség esetén az újrapróbálkozások kezeli a teljes folyamat hello optimalizálása.</span><span class="sxs-lookup"><span data-stu-id="72ab1-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing hello overall process.</span></span> <span data-ttu-id="72ab1-215">parancsfájl hello van idempotent, ha meghibásodik, vagy ha valamilyen okból leáll futtassa újból.</span><span class="sxs-lookup"><span data-stu-id="72ab1-215">hello script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-hello-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="72ab1-216">Ellenőrizze a hello kötegelt bérlők telepítése sikerült.</span><span class="sxs-lookup"><span data-stu-id="72ab1-216">Verify hello batch of tenants successfully deployed</span></span>

* <span data-ttu-id="72ab1-217">Nyitott hello *tenants1* server keresse meg azt a hello kiszolgálók tooyour listája [Azure-portálon](https://portal.azure.com), kattintson a **SQL-adatbázisok**, és ellenőrizheti, hello kötegelt 17 további adatbázisok most hello listában:</span><span class="sxs-lookup"><span data-stu-id="72ab1-217">Open hello *tenants1* server by browsing tooyour list of servers in hello [Azure portal](https://portal.azure.com), click **SQL databases**, and verify hello batch of 17 additional databases are now in hello list:</span></span>

   ![adatbázislista](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="72ab1-219">Egyéb kiépítési minták</span><span class="sxs-lookup"><span data-stu-id="72ab1-219">Other provisioning patterns</span></span>

<span data-ttu-id="72ab1-220">Az ebben az oktatóanyagban nem ismertetett egyéb kiépítési minták közé tartoznak a következők:</span><span class="sxs-lookup"><span data-stu-id="72ab1-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="72ab1-221">**Adatbázisok előzetes kiépítése.**</span><span class="sxs-lookup"><span data-stu-id="72ab1-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="72ab1-222">hello előre kialakítási mintája kihasználja a hello tény hozzáadott adatbázisok rugalmas készlethez nem kapcsolódik további költség.</span><span class="sxs-lookup"><span data-stu-id="72ab1-222">hello pre-provisioning pattern exploits hello fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="72ab1-223">Számlázási hello rugalmas készlet, nem hello az adatbázisokat, és inaktív adatbázisok nem erőforrást.</span><span class="sxs-lookup"><span data-stu-id="72ab1-223">Billing is for hello elastic pool, not hello databases, and idle databases consume no resources.</span></span> <span data-ttu-id="72ab1-224">Előzetes kiépítése adatbázis készletben, és lefoglalása őket, amikor szükséges, a bérlő bevezetési idő jelentősen csökkenthető.</span><span class="sxs-lookup"><span data-stu-id="72ab1-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="72ab1-225">előzetes kiosztása adatbázisok hello száma sikerült igazítani, mivel a szükséges tookeep hello alkalmas puffer várható sebesség kiépítés.</span><span class="sxs-lookup"><span data-stu-id="72ab1-225">hello number of databases pre-provisioned could be adjusted as needed tookeep a buffer suitable for hello anticipated provisioning rate.</span></span>

<span data-ttu-id="72ab1-226">**Automatikus kiépítés.**</span><span class="sxs-lookup"><span data-stu-id="72ab1-226">**Auto-provisioning.**</span></span> <span data-ttu-id="72ab1-227">Hello automatikus kialakítási mintában a dedikált létesítési szolgáltatás olyan használt tooprovision kiszolgálók, a készletek és a adatbázisok automatikusan szükség – többek között a előre létesítési adatbázisok rugalmas készletek igény szerint.</span><span class="sxs-lookup"><span data-stu-id="72ab1-227">In hello auto-provisioning pattern, a dedicated provisioning service is used tooprovision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="72ab1-228">És adatbázisok való üzembe helyezése és törlése, ha a rugalmas készletek hézagok meghatározása érdekében tetszés szerint szolgáltatás kiépítését hello ki kell töltenie.</span><span class="sxs-lookup"><span data-stu-id="72ab1-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by hello provisioning service as desired.</span></span> <span data-ttu-id="72ab1-229">Ilyen szolgáltatás lehet egyszerű vagy összetett – például létesíteni, több földrajzi kezelése és beállíthat georeplikáció automatikusan Ha vész-helyreállítási stratégia használatban van.</span><span class="sxs-lookup"><span data-stu-id="72ab1-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="72ab1-230">Mintával hello automatikus kiépítés egy ügyfélalkalmazás vagy parancsfájl kellene elküldeni egy üzembe helyezési kérelem tooa várólista toobe hello szolgáltatás kiépítését által feldolgozott, és szeretné majd kérdezze le a hello szolgáltatás toodetermine befejezését.</span><span class="sxs-lookup"><span data-stu-id="72ab1-230">With hello auto-provisioning pattern, a client application or script would submit a provisioning request tooa queue toobe processed by hello provisioning service, and would then poll hello service toodetermine completion.</span></span> <span data-ttu-id="72ab1-231">Kiépítés előtti használata esetén kérelmek kezelése hello háttérben futó helyettesítő adatbázis kiépítés hello szolgáltatásban gyorsan volna kezeli.</span><span class="sxs-lookup"><span data-stu-id="72ab1-231">If pre-provisioning is used, requests would be handled quickly with hello service managing provisioning of a replacement database running in hello background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="72ab1-232">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="72ab1-232">Next steps</span></span>

<span data-ttu-id="72ab1-233">Ez az oktatóanyag bemutatta, hogyan végezheti el az alábbi műveleteket:</span><span class="sxs-lookup"><span data-stu-id="72ab1-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="72ab1-234">Egyetlen új bérlő kiépítése</span><span class="sxs-lookup"><span data-stu-id="72ab1-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="72ab1-235">További bérlők kötegelt kiépítése</span><span class="sxs-lookup"><span data-stu-id="72ab1-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="72ab1-236">Lépjen be a bérlők kiépítés, és regisztrálja őket hello katalógusba hello részleteit</span><span class="sxs-lookup"><span data-stu-id="72ab1-236">Step into hello details of provisioning tenants, and registering them into hello catalog</span></span>

<span data-ttu-id="72ab1-237">Próbálja meg hello [teljesítmény figyelési oktatóanyag](sql-database-saas-tutorial-performance-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="72ab1-237">Try hello [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="72ab1-238">További források</span><span class="sxs-lookup"><span data-stu-id="72ab1-238">Additional Resources</span></span>

* <span data-ttu-id="72ab1-239">További [oktatóprogramot kínál, amelyek hello Wingtip SaaS-alkalmazás épül](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="72ab1-239">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="72ab1-240">Elastic Database-ügyfélkódtár</span><span class="sxs-lookup"><span data-stu-id="72ab1-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="72ab1-241">Hogyan tooDebug parancsfájlok, a Windows PowerShell ISE</span><span class="sxs-lookup"><span data-stu-id="72ab1-241">How tooDebug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
