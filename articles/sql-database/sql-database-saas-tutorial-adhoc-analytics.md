---
title: "aaaRun alkalmi elemzési lekérdezések több Azure SQL-adatbázisok közötti |} Microsoft Docs"
description: "Ad hoc elemzési lekérdezések futtatása több SQL-adatbázisok hello Wingtip SaaS több-bérlős alkalmazásban."
keywords: "sql database-oktatóanyag"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/23/2017
ms.author: billgib; sstein
ms.openlocfilehash: 140cd51fdd03b5a548147282b51ceb0ad80c944d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="run-ad-hoc-analytics-queries-across-all-wingtip-saas-tenants"></a><span data-ttu-id="1c701-104">Minden Wingtip Szolgáltatottszoftver-bérlők alkalmi elemzési lekérdezések futtatása</span><span class="sxs-lookup"><span data-stu-id="1c701-104">Run ad-hoc analytics queries across all Wingtip SaaS tenants</span></span>

<span data-ttu-id="1c701-105">Ebben az oktatóanyagban futtatja az elosztott lekérdezések hello teljes készlete bérlői adatbázisok között tooenable alkalmi elemzés.</span><span class="sxs-lookup"><span data-stu-id="1c701-105">In this tutorial, you run distributed queries across hello entire set of tenant databases tooenable ad-hoc analytics.</span></span> <span data-ttu-id="1c701-106">Rugalmas lekérdezési használt tooenable elosztott lekérdezések, ami megköveteli azt egy további elemzés adatbázis központi telepítése (toohello katalóguskiszolgáló).</span><span class="sxs-lookup"><span data-stu-id="1c701-106">Elastic Query is used tooenable distributed queries, which requires an additional analytics database is deployed (toohello catalog server).</span></span> <span data-ttu-id="1c701-107">Ezeket a lekérdezéseket hello Wingtip SaaS-alkalmazás működési adatok napi hello megbúvó insights nyerhet ki.</span><span class="sxs-lookup"><span data-stu-id="1c701-107">These queries can extract insights buried in hello day-to-day operational data of hello Wingtip SaaS app.</span></span>


<span data-ttu-id="1c701-108">Eben az oktatóanyagban az alábbiakkal fog megismerkedni:</span><span class="sxs-lookup"><span data-stu-id="1c701-108">In this tutorial you learn:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="1c701-109">Hello globális nézetek az egyes adatbázisok, kapcsolatban, amelyek lehetővé bérlők között hatékony lekérdezése</span><span class="sxs-lookup"><span data-stu-id="1c701-109">About hello global views in each database, that enable efficient querying across tenants</span></span>
> * <span data-ttu-id="1c701-110">Hogyan toodeploy egy ad hoc elemzési adatbázis</span><span class="sxs-lookup"><span data-stu-id="1c701-110">How toodeploy an ad-hoc analytics database</span></span>
> * <span data-ttu-id="1c701-111">Hogyan toorun elosztott lekérdezések összes bérlői adatbázis</span><span class="sxs-lookup"><span data-stu-id="1c701-111">How toorun distributed queries across all tenant databases</span></span>



<span data-ttu-id="1c701-112">Ebben az oktatóanyagban a következő előfeltételek győződjön meg arról, hogy hello elvégzése toocomplete:</span><span class="sxs-lookup"><span data-stu-id="1c701-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="1c701-113">hello Wingtip SaaS-alkalmazás telepítve van.</span><span class="sxs-lookup"><span data-stu-id="1c701-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="1c701-114">toodeploy öt percen belül, lásd: [központi telepítése és felfedezése hello Wingtip SaaS-alkalmazáshoz](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="1c701-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="1c701-115">Az Azure PowerShell telepítve van.</span><span class="sxs-lookup"><span data-stu-id="1c701-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="1c701-116">A részletekért lásd: [Ismerkedés az Azure PowerShell-lel](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span><span class="sxs-lookup"><span data-stu-id="1c701-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="1c701-117">SQL Server Management Studio (SSMS) telepítve van.</span><span class="sxs-lookup"><span data-stu-id="1c701-117">SQL Server Management Studio (SSMS) is installed.</span></span> <span data-ttu-id="1c701-118">toodownload és telepítési SSMS, lásd: [töltse le az SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span><span class="sxs-lookup"><span data-stu-id="1c701-118">toodownload and install SSMS, see [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span></span>


## <a name="ad-hoc-analytics-pattern"></a><span data-ttu-id="1c701-119">Ad hoc analytics minta</span><span class="sxs-lookup"><span data-stu-id="1c701-119">Ad-hoc analytics pattern</span></span>

<span data-ttu-id="1c701-120">Hello kiváló lehetőségek SaaS-alkalmazásokhoz az egyik toouse hello túlnyomó bérlői tárolt adatok mennyisége központilag hello felhőben.</span><span class="sxs-lookup"><span data-stu-id="1c701-120">One of hello great opportunities with SaaS applications is toouse hello vast amount of tenant data stored centrally in hello cloud.</span></span> <span data-ttu-id="1c701-121">Használja az adatok toogain betekintést hello művelet, valamint a az alkalmazás, a bérlők számára, a felhasználók, beállítások, viselkedés stb. Ezek insights szolgáltatás fejlesztési, használhatóság fejlesztések és egyéb befektetések az alkalmazások és szolgáltatások is ismerteti.</span><span class="sxs-lookup"><span data-stu-id="1c701-121">Use this data toogain insights into hello operation and usage of your application, your tenants, their users, preferences, behaviors, etc. These insights can guide feature development, usability improvements, and other investments in your apps and services.</span></span>

<span data-ttu-id="1c701-122">Ezeknek az adatoknak egyetlen több bérlős adatbázisban történő elérése könnyű, de nem olyan egyszerű, ha méretezve akár több ezer adatbázis között vannak elosztva.</span><span class="sxs-lookup"><span data-stu-id="1c701-122">Accessing this data in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="1c701-123">Egy megoldás, toouse [rugalmas lekérdezési](sql-database-elastic-query-overview.md), amely lehetővé teszi, hogy a közös séma adatbázisok elosztott készleteit között lekérdezése.</span><span class="sxs-lookup"><span data-stu-id="1c701-123">One approach is toouse [Elastic Query](sql-database-elastic-query-overview.md), which enables querying across a distributed set of databases with common schema.</span></span> <span data-ttu-id="1c701-124">Rugalmas lekérdezés használja egyetlen *head* , amelyben külső táblázatokat, hogy a tükör tábláit vagy nézeteit hello terjesztése (bérlői) adatbázisok adatbázis.</span><span class="sxs-lookup"><span data-stu-id="1c701-124">Elastic Query uses a single *head* database in which external tables are defined that mirror tables or views in hello distributed (tenant) databases.</span></span> <span data-ttu-id="1c701-125">Lekérdezések elküldése toothis head adatbázis lefordított tooproduce elosztott lekérdezéstervet, igény szerint toohello bérlői adatbázisok le leküldött hello lekérdezés részekkel vannak.</span><span class="sxs-lookup"><span data-stu-id="1c701-125">Queries submitted toothis head database are compiled tooproduce a distributed query plan, with portions of hello query pushed down toohello tenant databases as needed.</span></span> <span data-ttu-id="1c701-126">Rugalmas lekérdezési hello shard térkép hello adatbázis tooprovide hello katalógushelyre hello bérlői adatbázisok használja.</span><span class="sxs-lookup"><span data-stu-id="1c701-126">Elastic Query uses hello shard map in hello catalog database tooprovide hello location of hello tenant databases.</span></span> <span data-ttu-id="1c701-127">A telepítő és a lekérdezés is egyszerű szabványos [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), és támogatja az ad hoc az eszközök, például a Power BI és Excel lekérdezése.</span><span class="sxs-lookup"><span data-stu-id="1c701-127">Setup and query are straightforward using standard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), and support ad-hoc querying from tools like Power BI and Excel.</span></span>

<span data-ttu-id="1c701-128">Lekérdezések hello bérlői adatbázisok közötti elosztásával rugalmas lekérdezési élő termelési adatok azonnali betekintést nyújt.</span><span class="sxs-lookup"><span data-stu-id="1c701-128">By distributing queries across hello tenant databases, Elastic Query provides immediate insight into live production data.</span></span> <span data-ttu-id="1c701-129">Azonban rugalmas lekérdezési potenciálisan sok adatbázisok adatait kéri le, mert a késés néha lehet magasabb, mint a megfelelő lekérdezések lekérdezés tooa egy több-bérlős adatbázis elküldése megtörtént.</span><span class="sxs-lookup"><span data-stu-id="1c701-129">However, as Elastic Query pulls data from potentially many databases, query latency can sometimes be higher than for equivalent queries submitted tooa single multi-tenant database.</span></span> <span data-ttu-id="1c701-130">Figyelmet kell fordítani, amikor designing lekérdezi toominimize hello visszaadott adatokat.</span><span class="sxs-lookup"><span data-stu-id="1c701-130">Care should be taken when designing queries toominimize hello data that is returned.</span></span> <span data-ttu-id="1c701-131">Rugalmas lekérdezési gyakran leginkább megfelelő, kis mennyiségű valós idejű adatok lekérdezése, gyakran használt megakadályozását toobuilding vagy összetett elemzési lekérdezések a jelentéseket.</span><span class="sxs-lookup"><span data-stu-id="1c701-131">Elastic Query is often best suited for querying small amounts of real-time data, as opposed toobuilding frequently used or complex analytics queries or reports.</span></span> <span data-ttu-id="1c701-132">Ha lekérdezéseket is hajtsa végre a nem, nézze meg hello [végrehajtási terv](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee hello lekérdezés részét rendelkezik lett leküldött toohello távoli adatbázis és mennyi adatot ad vissza.</span><span class="sxs-lookup"><span data-stu-id="1c701-132">If queries don't perform well, look at hello [execution plan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee what part of hello query has been pushed down toohello remote database and how much data is being returned.</span></span> <span data-ttu-id="1c701-133">Lehet, hogy bonyolult elemzésfeldolgozási jobb igénylő lekérdezések bizonyos esetekben bérlői adatok csomagolja ki dedikált adatbázis vagy adatraktár-elemzési lekérdezések optimalizálva szolgálja ki.</span><span class="sxs-lookup"><span data-stu-id="1c701-133">Queries that require complex analytical processing may be better served in some cases by extracting tenant data into a dedicated database or data warehouse optimized for analytics queries.</span></span> <span data-ttu-id="1c701-134">Ebben a mintában az ismertetése hello [bérlői analytics oktatóanyag](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="1c701-134">This pattern is explained in hello [tenant analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md).</span></span> 

## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="1c701-135">Hello Wingtip alkalmazás parancsfájlok beolvasása</span><span class="sxs-lookup"><span data-stu-id="1c701-135">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="1c701-136">hello Wingtip Szolgáltatottszoftver-parancsfájlok és az alkalmazás forráskódjához találhatók hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github-tárház.</span><span class="sxs-lookup"><span data-stu-id="1c701-136">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="1c701-137">[Lépések toodownload hello Wingtip SaaS parancsfájlok](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="1c701-137">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-ticket-sales-data"></a><span data-ttu-id="1c701-138">A jegy értékesítési adatok létrehozása</span><span class="sxs-lookup"><span data-stu-id="1c701-138">Create ticket sales data</span></span>

<span data-ttu-id="1c701-139">hello szolgáltatásjegy-generátor futtatásával toorun lekérdezi az érdekesebb adatok összevetéssel létrehozhat jegy értékesítési adatait.</span><span class="sxs-lookup"><span data-stu-id="1c701-139">toorun queries against a more interesting data set, create ticket sales data by running hello ticket-generator.</span></span>

1. <span data-ttu-id="1c701-140">A hello *PowerShell ISE*, nyissa meg hello... \\Tanulási modulok\\működési Analytics\\ad hoc Analytics\\*bemutató-AdhocAnalytics.ps1* parancsfájlt, és állítsa be a következő értékek hello:</span><span class="sxs-lookup"><span data-stu-id="1c701-140">In hello *PowerShell ISE*, open hello ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* script and set hello following values:</span></span>
   * <span data-ttu-id="1c701-141">**$DemoScenario** = 1, **események minden helyszínek, a jegyektől beszerzési**.</span><span class="sxs-lookup"><span data-stu-id="1c701-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues**.</span></span>
2. <span data-ttu-id="1c701-142">Nyomja le az **F5** hello parancsfájl futtatása és a jegyet értékesítési generálásához.</span><span class="sxs-lookup"><span data-stu-id="1c701-142">Press **F5** to run hello script and generate ticket sales.</span></span> <span data-ttu-id="1c701-143">Hello parancsfájl futtatása közben továbbra is hello lépéseit az oktatóanyag.</span><span class="sxs-lookup"><span data-stu-id="1c701-143">While hello script is running, continue hello steps in this tutorial.</span></span> <span data-ttu-id="1c701-144">hello jegy adatok lekérdeznek hello *elosztott ad hoc lekérdezéseket futtathat* területen, várjon, amíg hello jegy generátor toocomplete Ha még mindig fut. amikor toothat a gyakorlatban.</span><span class="sxs-lookup"><span data-stu-id="1c701-144">hello ticket data is queried in hello *Run ad-hoc distributed queries* section, so wait for hello ticket generator toocomplete if it's still running when you get toothat exercise.</span></span>

## <a name="explore-hello-global-views"></a><span data-ttu-id="1c701-145">Globális nézetek hello felfedezés</span><span class="sxs-lookup"><span data-stu-id="1c701-145">Explore hello global views</span></span>

<span data-ttu-id="1c701-146">hello Wingtip SaaS-alkalmazás-t egy bérlő-adatbázis-modell, ezért hello bérlői adatbázis sémát single-bérlő szempontjából.</span><span class="sxs-lookup"><span data-stu-id="1c701-146">hello Wingtip SaaS application is built using a tenant-per-database model, so hello tenant database schema is defined from a single-tenant perspective.</span></span> <span data-ttu-id="1c701-147">Egy tábla létezik bérlői-specifikus adatait *helyszínére*, amely mindig egyetlen sort, és valósul meg egy halommemóriában, egy elsődleges kulcs nélkül.</span><span class="sxs-lookup"><span data-stu-id="1c701-147">Tenant-specific information exists in one table, *Venue*, which always has a single row, and is implemented as a heap, without a primary key.</span></span> <span data-ttu-id="1c701-148">Hello séma levő többi táblázat nem kell a kapcsolódó toobe toohello *helyszínére* táblázatra, mert a szokásos kétséges soha nem minden bérlő hello adatok tartozik.</span><span class="sxs-lookup"><span data-stu-id="1c701-148">Other tables in hello schema don't need toobe related toohello *Venue* table, because in normal use, there is never any doubt which tenant hello data belongs to.</span></span>

<span data-ttu-id="1c701-149">Azonban minden az adatbázisok közötti lekérdezésekor fontos, hogy rugalmas lekérdezési hello adatok is kezelheti, mintha a bérlő szilánkos egyetlen logikai adatbázis része.</span><span class="sxs-lookup"><span data-stu-id="1c701-149">However, when querying across all databases, it's important that Elastic Query can treat hello data as if it is part of a single logical database sharded by tenant.</span></span> <span data-ttu-id="1c701-150">tooachieve, ez a "global" nézetet kínál hozzáadott toohello bérlői adatbázis, amely mindegyik hello-táblázatot, amely globálisan a rendszer megkérdezi a bérlő azonosítója projektre.</span><span class="sxs-lookup"><span data-stu-id="1c701-150">tooachieve this, a set of 'global' views are added toohello tenant database that project a tenant id into each of hello tables that are queried globally.</span></span> <span data-ttu-id="1c701-151">Például hello *VenueEvents* nézet hozzáadása egy számított *VenueId* toohello oszlopok hello a tervezett *események* tábla.</span><span class="sxs-lookup"><span data-stu-id="1c701-151">For example, hello *VenueEvents* view adds a computed *VenueId* toohello columns projected from hello *Events* table.</span></span> <span data-ttu-id="1c701-152">Külső tábla hello hello központi adatbázis keresztül meghatározásával *VenueEvents* (ahelyett, hogy az alapul szolgáló hello *események* táblázat), rugalmas lekérdezés nem tud toopush alapján illesztések le *VenueId* , azok az összes távoli adatbázisra (és nem a hello központi adatbázis) párhuzamos hajtható végre.</span><span class="sxs-lookup"><span data-stu-id="1c701-152">By defining hello external table in hello head database over *VenueEvents* (rather than hello underlying *Events* table), Elastic Query is able toopush down joins based on *VenueId* so they can be executed in parallel on each remote database (rather than on hello head database).</span></span> <span data-ttu-id="1c701-153">Ez jelentősen csökkenti a hello adatmennyiséget ad vissza, amely sok lekérdezések teljesítményének jelentős növekedése eredményez.</span><span class="sxs-lookup"><span data-stu-id="1c701-153">This dramatically reduces hello amount of data that is returned, which results in a substantial increase in performance for many queries.</span></span> <span data-ttu-id="1c701-154">Ezek a globális nézetek volt előre létrehozott összes bérlői adatbázisokban (és a *basetenantdb*).</span><span class="sxs-lookup"><span data-stu-id="1c701-154">These global views have been pre-created in all tenant databases (and in *basetenantdb*).</span></span>

1. <span data-ttu-id="1c701-155">Nyissa meg a szolgáltatáshoz az SSMS és [csatlakozás toohello tenants1 -&lt;felhasználói&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span><span class="sxs-lookup"><span data-stu-id="1c701-155">Open SSMS and [connect toohello tenants1-&lt;USER&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span></span>
2. <span data-ttu-id="1c701-156">Bontsa ki a **adatbázisok**, kattintson a jobb gombbal **contosoconcerthall**, és válassza ki **új lekérdezés**.</span><span class="sxs-lookup"><span data-stu-id="1c701-156">Expand **Databases**, right-click **contosoconcerthall**, and select **New Query**.</span></span>
3. <span data-ttu-id="1c701-157">Futtassa a következő lekérdezések tooexplore hello különbség hello single-tenant táblákban és hello globális nézetek hello:</span><span class="sxs-lookup"><span data-stu-id="1c701-157">Run hello following queries tooexplore hello difference between hello single-tenant tables and hello global views:</span></span>

   ```T-SQL
   -- hello base Venue table, that has no VenueId associated.
   SELECT * FROM Venue

   -- Notice hello plural name 'Venues'. This view projects a VenueId column.
   SELECT * FROM Venues

   -- hello base Events table, which has no VenueId column.
   SELECT * FROM Events

   -- This view projects hello VenueId retrieved from hello Venues table.
   SELECT * FROM VenueEvents
   ```

<span data-ttu-id="1c701-158">Ezekben a nézetekben hello *VenueId* kiszámítása kivonatát a hello helyszínére nevét, de bármely megközelítés lehet használt toointroduce egyedi értéket.</span><span class="sxs-lookup"><span data-stu-id="1c701-158">In these views, hello *VenueId* is computed as a hash of hello Venue name, but any approach could be used toointroduce a unique value.</span></span> <span data-ttu-id="1c701-159">Ez a megközelítés módja a hasonló toohello hello bérlőkulcs számított hello katalógus használható.</span><span class="sxs-lookup"><span data-stu-id="1c701-159">This approach is similar toohello way hello tenant key is computed for use in hello catalog.</span></span>

<span data-ttu-id="1c701-160">hello tooexamine hello definíciója *helyszínek* megtekintése:</span><span class="sxs-lookup"><span data-stu-id="1c701-160">tooexamine hello definition of hello *Venues* view:</span></span>

1. <span data-ttu-id="1c701-161">A **Object Explorer**, bontsa ki a **contosoconcethall** > **nézetek**:</span><span class="sxs-lookup"><span data-stu-id="1c701-161">In **Object Explorer**, expand **contosoconcethall** > **Views**:</span></span>

   ![nézetek](media/sql-database-saas-tutorial-adhoc-analytics/views.png)

2. <span data-ttu-id="1c701-163">Kattintson a jobb gombbal **dbo. Helyszínek**.</span><span class="sxs-lookup"><span data-stu-id="1c701-163">Right-click **dbo.Venues**.</span></span>
3. <span data-ttu-id="1c701-164">Válassza ki **nézetként parancsfájl** > **hozhat létre** > **új Lekérdezésszerkesztő ablak**</span><span class="sxs-lookup"><span data-stu-id="1c701-164">Select **Script View as** > **CREATE To** > **New Query Editor Window**</span></span>

<span data-ttu-id="1c701-165">Parancsfájl-bármely más hello *helyszínére* toosee nézetek hogyan adnak hozzá hello *VenueId*.</span><span class="sxs-lookup"><span data-stu-id="1c701-165">Script any of hello other *Venue* views toosee how they add hello *VenueId*.</span></span>

## <a name="deploy-hello-database-used-for-ad-hoc-distributed-queries"></a><span data-ttu-id="1c701-166">Ad hoc elosztott lekérdezésekhez használt hello adatbázis központi telepítése</span><span class="sxs-lookup"><span data-stu-id="1c701-166">Deploy hello database used for ad-hoc distributed queries</span></span>

<span data-ttu-id="1c701-167">Ebben a gyakorlatban telepíti hello *adhocanalytics* adatbázis.</span><span class="sxs-lookup"><span data-stu-id="1c701-167">This exercise deploys hello *adhocanalytics* database.</span></span> <span data-ttu-id="1c701-168">Ez az összes bérlői az adatbázisok közötti lekérdezéshez használt hello séma tartalmazó hello központi adatbázis.</span><span class="sxs-lookup"><span data-stu-id="1c701-168">This is hello head database that will contain hello schema used for querying across all tenant databases.</span></span> <span data-ttu-id="1c701-169">hello adatbázisa katalógus kiszolgálón, amely az adatbázisok felügyelettel kapcsolatos összes hello mintaalkalmazás használt hello kiszolgáló meglévő telepített toohello.</span><span class="sxs-lookup"><span data-stu-id="1c701-169">hello database is deployed toohello existing catalog server, which is hello server used for all management-related databases in hello sample app.</span></span>

1. <span data-ttu-id="1c701-170">Nyissa meg... \\Tanulási modulok\\működési Analytics\\ad hoc Analytics\\*bemutató-AdhocAnalytics.ps1* a hello *PowerShell ISE* és hello beállítása a következő értékeket:</span><span class="sxs-lookup"><span data-stu-id="1c701-170">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* in hello *PowerShell ISE* and set hello following values:</span></span>
   * <span data-ttu-id="1c701-171">**$DemoScenario** = 2, **Alkalmi elemzési adatbázis üzembe helyezése**.</span><span class="sxs-lookup"><span data-stu-id="1c701-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span></span>

2. <span data-ttu-id="1c701-172">Nyomja le az **F5** toorun hello parancsfájlt, és hozzon létre hello *adhocanalytics* adatbázis.</span><span class="sxs-lookup"><span data-stu-id="1c701-172">Press **F5** toorun hello script and create hello *adhocanalytics* database.</span></span>

<span data-ttu-id="1c701-173">Hello a következő szakaszban hozzáadhat séma toohello adatbázis, a használt toorun elosztott lekérdezések lehet.</span><span class="sxs-lookup"><span data-stu-id="1c701-173">In hello next section, you add schema toohello database so it can be used toorun distributed queries.</span></span>

## <a name="configure-hello-database-for-running-distributed-queries"></a><span data-ttu-id="1c701-174">Elosztott lekérdezések futtatását hello adatbázis konfigurálása</span><span class="sxs-lookup"><span data-stu-id="1c701-174">Configure hello database for running distributed queries</span></span>

<span data-ttu-id="1c701-175">Ebben a gyakorlatban hozzáadja a séma (külső adatforrás hello és külső definíciói) toohello alkalmi elemzési adatbázis, amely lehetővé teszi, hogy minden bérlő az adatbázisok közötti lekérdezése.</span><span class="sxs-lookup"><span data-stu-id="1c701-175">This exercise adds schema (hello external data source and external table definitions) toohello ad-hoc analytics database that enables querying across all tenant databases.</span></span>

1. <span data-ttu-id="1c701-176">Nyissa meg az SQL Server Management Studio eszközt, és csatlakoztassa toohello hello előző lépésben létrehozott ad hoc elemzési adatbázis.</span><span class="sxs-lookup"><span data-stu-id="1c701-176">Open SQL Server Management Studio, and connect toohello Adhoc Analytics database you created in hello previous step.</span></span> <span data-ttu-id="1c701-177">hello adatbázis neve hello adhocanalytics lesz.</span><span class="sxs-lookup"><span data-stu-id="1c701-177">hello name of hello database will be adhocanalytics.</span></span>
2. <span data-ttu-id="1c701-178">Nyissa meg a ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* szolgáltatáshoz az ssms.</span><span class="sxs-lookup"><span data-stu-id="1c701-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span></span>
3. <span data-ttu-id="1c701-179">Tekintse át a hello SQL-parancsfájlt, és vegye figyelembe a következőket hello:</span><span class="sxs-lookup"><span data-stu-id="1c701-179">Review hello SQL script and note hello following:</span></span>

   <span data-ttu-id="1c701-180">Rugalmas lekérdezés egy adatbázis-alapú kötődő hitelesítési tooaccess minden hello bérlői adatbázisok használja.</span><span class="sxs-lookup"><span data-stu-id="1c701-180">Elastic Query uses a database-scoped credential tooaccess each of hello tenant databases.</span></span> <span data-ttu-id="1c701-181">Ezeket a hitelesítő adatokat kell toobe összes hello adatbázis elérhető, és általában adható hello minimális jogosultságokkal szükséges tooenable a ad hoc lekérdezéseket.</span><span class="sxs-lookup"><span data-stu-id="1c701-181">This credential needs toobe available in all hello databases and should normally be granted hello minimum rights required tooenable these ad-hoc queries.</span></span>

    ![hitelesítő adatok létrehozása](media/sql-database-saas-tutorial-adhoc-analytics/create-credential.png)

   <span data-ttu-id="1c701-183">hello külső adatforrás, amely toouse hello bérlői shard térkép adatbázisban definiált hello katalógus.</span><span class="sxs-lookup"><span data-stu-id="1c701-183">hello external data source, that is defined toouse hello tenant shard map in hello catalog database.</span></span> <span data-ttu-id="1c701-184">Segítségével hello külső adatforrásaként, lekérdezések elosztott tooall adatbázisok hello katalógusban regisztrált hello lekérdezés futásakor.</span><span class="sxs-lookup"><span data-stu-id="1c701-184">By using this as hello external data source, queries are distributed tooall databases registered in hello catalog when hello query is run.</span></span> <span data-ttu-id="1c701-185">Kiszolgáló neve nem egyezik az egyes központi telepítések, mert az inicializálási parancsfájlja hello aktuális server lekérésével hello katalógus adatbázis helyének hello lekérdezi (@@servername) ahol hello parancsfájl végrehajtása.</span><span class="sxs-lookup"><span data-stu-id="1c701-185">Because server names are different for each deployment, this initialization script gets hello location of hello catalog database by retrieving hello current server (@@servername) where hello script is executed.</span></span>

    ![külső adatforrás létrehozása](media/sql-database-saas-tutorial-adhoc-analytics/create-external-data-source.png)

   <span data-ttu-id="1c701-187">külső táblákra hivatkozó hello globális nézetek hello előző szakaszban leírt, és definiálva hello **TERJESZTÉSI = SHARDED(VenueId)**.</span><span class="sxs-lookup"><span data-stu-id="1c701-187">hello external tables that reference hello global views described in hello previous section, and defined with **DISTRIBUTION = SHARDED(VenueId)**.</span></span> <span data-ttu-id="1c701-188">Mivel minden egyes *VenueId* leképezhető tooa egyetlen adatbázis, Ez javítja a teljesítményt a sok forgatókönyvben hello a következő szakaszban látható.</span><span class="sxs-lookup"><span data-stu-id="1c701-188">Because each *VenueId* maps tooa single database, this improves performance for many scenarios as shown in hello next section.</span></span>

    ![külső táblák létrehozása](media/sql-database-saas-tutorial-adhoc-analytics/external-tables.png)

   <span data-ttu-id="1c701-190">hello helyi tábla *VenueTypes* , amely létre és töltődik fel.</span><span class="sxs-lookup"><span data-stu-id="1c701-190">hello local table *VenueTypes* that is created and populated.</span></span> <span data-ttu-id="1c701-191">A táblázatban az összes bérlői adatbázis közös, így ide helyi táblaként, ki van töltve a közös adatok hello ábrázolhatók.</span><span class="sxs-lookup"><span data-stu-id="1c701-191">This reference data table is common in all tenant databases, so it can be represented here as a local table and populated with hello common data.</span></span> <span data-ttu-id="1c701-192">Az egyes lekérdezések Ez csökkentheti a hello adatmennyiség hello bérlői adatbázisok és hello közötti áthelyezése *adhocanalytics* adatbázis.</span><span class="sxs-lookup"><span data-stu-id="1c701-192">For some queries this may reduce hello amount of data moved between hello tenant databases and hello *adhocanalytics* database.</span></span>

    ![tábla létrehozása](media/sql-database-saas-tutorial-adhoc-analytics/create-table.png)

   <span data-ttu-id="1c701-194">Ha hivatkozási táblák ezen a módon kikapcsolja, mindig meg arról, hogy tooupdate hello táblaséma és adatok amikor hello bérlői adatbázisok frissítése.</span><span class="sxs-lookup"><span data-stu-id="1c701-194">If you include reference tables in this manner, be sure tooupdate hello table schema and data whenever you update hello tenant databases.</span></span>

4. <span data-ttu-id="1c701-195">Nyomja le az **F5** toorun parancsfájl hello és hello inicializálása *adhocanalytics* adatbázis.</span><span class="sxs-lookup"><span data-stu-id="1c701-195">Press **F5** toorun hello script and initialize hello *adhocanalytics* database.</span></span> 

<span data-ttu-id="1c701-196">Most elosztott lekérdezések futtatását, valamint insights összegyűjtése minden bérlők között!</span><span class="sxs-lookup"><span data-stu-id="1c701-196">Now you can run distributed queries, and gather insights across all tenants!</span></span>

## <a name="run-ad-hoc-distributed-queries"></a><span data-ttu-id="1c701-197">Ad hoc elosztott lekérdezések futtatása</span><span class="sxs-lookup"><span data-stu-id="1c701-197">Run ad-hoc distributed queries</span></span>

<span data-ttu-id="1c701-198">Most, hogy hello *adhocanalytics* adatbázis állított be, lépjen tovább, és néhány elosztott lekérdezések futtatása.</span><span class="sxs-lookup"><span data-stu-id="1c701-198">Now that hello *adhocanalytics* database is set up, go ahead and run some distributed queries.</span></span> <span data-ttu-id="1c701-199">Például hello végrehajtási terv kra, ha hello a lekérdezés feldolgozása zajlik.</span><span class="sxs-lookup"><span data-stu-id="1c701-199">Include hello execution plan for a better understanding of where hello query processing is happening.</span></span> 

<span data-ttu-id="1c701-200">Hello terv ikonok részletes vizsgálatakor ellenőrizze hello végrehajtási terv, mutasson.</span><span class="sxs-lookup"><span data-stu-id="1c701-200">When inspecting hello execution plan, hover over hello plan icons for details.</span></span> 

<span data-ttu-id="1c701-201">Fontos toonote, egy adott beállítás **TERJESZTÉSI = SHARDED(VenueId)** meghatározott hello külső adatforrás, amikor növeli a számos forgatókönyv teljesítményét.</span><span class="sxs-lookup"><span data-stu-id="1c701-201">Important toonote, is that setting **DISTRIBUTION = SHARDED(VenueId)** when we defined hello external data source, improves performance for many scenarios.</span></span> <span data-ttu-id="1c701-202">Mivel minden egyes *VenueId* tooa leképezhető egyetlen adatbázis szűrése csak egyszerűen távolról kész, adatszolgáltató csak hello adatokat kell.</span><span class="sxs-lookup"><span data-stu-id="1c701-202">Because each *VenueId* maps tooa single database, filtering is easily done remotely, returning only hello data we need.</span></span>

1. <span data-ttu-id="1c701-203">Nyissa meg a ...\\Tanulási modulok\\Működési elemzések\\Alkalmi elemzések\\*Demo-AdhocAnalyticsQueries.sql* fájlt az SSMS-ben.</span><span class="sxs-lookup"><span data-stu-id="1c701-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span></span>
2. <span data-ttu-id="1c701-204">Hogy biztosan csatlakoztatott toohello **adhocanalytics** adatbázis.</span><span class="sxs-lookup"><span data-stu-id="1c701-204">Ensure you are connected toohello **adhocanalytics** database.</span></span>
3. <span data-ttu-id="1c701-205">Jelölje be hello **lekérdezés** menüre, majd **tényleges végrehajtási terv tartalmazza**</span><span class="sxs-lookup"><span data-stu-id="1c701-205">Select hello **Query** menu and click **Include Actual Execution Plan**</span></span>
4. <span data-ttu-id="1c701-206">Jelölje ki a hello *mely helyszínek jelenleg regisztrált?* lekérdezést, és nyomja le az **F5**.</span><span class="sxs-lookup"><span data-stu-id="1c701-206">Highlight hello *Which venues are currently registered?* query, and press **F5**.</span></span>

   <span data-ttu-id="1c701-207">hello lekérdezés hello teljes helyszínére listát, hogyan ábrázoló ad vissza, és könnyen tooquery összes bérlők és az egyes bérlők visszatérési adatai.</span><span class="sxs-lookup"><span data-stu-id="1c701-207">hello query returns hello entire venue list, illustrating how quick and easy it is tooquery across all tenants and return data from each tenant.</span></span>

   <span data-ttu-id="1c701-208">Vizsgálja meg a hello terv, hello teljes költsége van-e hello távoli lekérdezés mert egyszerűen folyamatos tooeach bérlői adatbázist, majd válassza a hello helyszínére adatokat a rendszer.</span><span class="sxs-lookup"><span data-stu-id="1c701-208">Inspect hello plan and see that hello entire cost is hello remote query because we're simply going tooeach tenant database and selecting hello venue information.</span></span>

   ![Válassza ki * a dbo. Helyszínek](media/sql-database-saas-tutorial-adhoc-analytics/query1-plan.png)

5. <span data-ttu-id="1c701-210">SELECT hello tovább lekérdezés, és nyomja le az **F5**.</span><span class="sxs-lookup"><span data-stu-id="1c701-210">Select hello next query, and press **F5**.</span></span>

   <span data-ttu-id="1c701-211">Ez a lekérdezés illesztése hello bérlői adatbázisokból és hello helyi adatok *VenueTypes* tábla (helyi, mert van egy olyan táblázatában hello *adhocanalytics* adatbázis).</span><span class="sxs-lookup"><span data-stu-id="1c701-211">This query joins data from hello tenant databases and hello local *VenueTypes* table (local, as its a table in hello *adhocanalytics* database).</span></span>

   <span data-ttu-id="1c701-212">Vizsgálja meg a hello terv, tekintse meg, hogy hello költség többsége hello távoli lekérdezés, mivel azt a bérlő helyszínére info (dbo. Helyszínek), majd hajtsa végre a gyors helyi csatlakoztatás hello helyi *VenueTypes* tábla toodisplay hello rövid nevét.</span><span class="sxs-lookup"><span data-stu-id="1c701-212">Inspect hello plan and see that hello majority of cost is hello remote query because we query each tenant's venue info (dbo.Venues), and then do a quick local join with hello local *VenueTypes* table toodisplay hello friendly name.</span></span>

   ![Csatlakozás a helyi és távoli adatokkal](media/sql-database-saas-tutorial-adhoc-analytics/query2-plan.png)

6. <span data-ttu-id="1c701-214">Immár hello *mely napján volt a legtöbb jegyek értékesített hello?* lekérdezést, és nyomja le az **F5**.</span><span class="sxs-lookup"><span data-stu-id="1c701-214">Now select hello *On which day were hello most tickets sold?* query, and press **F5**.</span></span>

   <span data-ttu-id="1c701-215">Ez a lekérdezés egy kicsit bonyolultabb csatlakoztatása és összesítési beállítások végzi.</span><span class="sxs-lookup"><span data-stu-id="1c701-215">This query does a bit more complex joining and aggregation.</span></span> <span data-ttu-id="1c701-216">Mi az, hogy fontos toonote, hogy a legtöbb hello feldolgozási távolról történik, és ebben az esetben azt vissza csak hello sorok igazolnia kell, az egyes helyszínekkel összesített jegy pénztári száma naponta csak egyetlen sort ad vissza.</span><span class="sxs-lookup"><span data-stu-id="1c701-216">What's important toonote is that most of hello processing is done remotely, and once again, we bring back only hello rows we need, returning just a single row for each venue's aggregate ticket sale count per day.</span></span>

   ![lekérdezés](media/sql-database-saas-tutorial-adhoc-analytics/query3-plan.png)


## <a name="next-steps"></a><span data-ttu-id="1c701-218">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="1c701-218">Next steps</span></span>

<span data-ttu-id="1c701-219">Ez az oktatóanyag bemutatta, hogyan végezheti el az alábbi műveleteket:</span><span class="sxs-lookup"><span data-stu-id="1c701-219">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="1c701-220">Elosztott lekérdezések futtatása az összes bérlői adatbázison</span><span class="sxs-lookup"><span data-stu-id="1c701-220">Run distributed queries across all tenant databases</span></span>
> * <span data-ttu-id="1c701-221">Az ad hoc analytics adatbázis központi telepítése, és adja hozzá a séma tooit toorun elosztott lekérdezések.</span><span class="sxs-lookup"><span data-stu-id="1c701-221">Deploy an ad-hoc analytics database and add schema tooit toorun distributed queries.</span></span>


<span data-ttu-id="1c701-222">Próbálja meg hello [bérlői Analytics oktatóanyag](sql-database-saas-tutorial-tenant-analytics.md) adatok tooa külön analytics adatbázis összetettebb analytics feldolgozásra kibontása tooexplore...</span><span class="sxs-lookup"><span data-stu-id="1c701-222">Now try hello [Tenant Analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extracting data tooa separate analytics database for more complex analytics processing...</span></span>

## <a name="additional-resources"></a><span data-ttu-id="1c701-223">További források</span><span class="sxs-lookup"><span data-stu-id="1c701-223">Additional resources</span></span>

* <span data-ttu-id="1c701-224">További [oktatóprogramot kínál, amelyek hello Wingtip SaaS-alkalmazás épül](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="1c701-224">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="1c701-225">Elastic Query</span><span class="sxs-lookup"><span data-stu-id="1c701-225">Elastic Query</span></span>](sql-database-elastic-query-overview.md)
