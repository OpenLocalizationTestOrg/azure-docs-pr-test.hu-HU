---
title: "Az Azure SQL Database TSQL:initiate feladatátvételi |} Microsoft Docs"
description: "Kezdeményezzen tervezett vagy nem tervezett feladatátvételt az Azure SQL Database Transact-SQL használatával"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="977a6-103">Kezdeményezzen tervezett vagy nem tervezett feladatátvételt az Azure SQL Database Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="977a6-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="977a6-104">Ez a cikk bemutatja, hogyan tooinitiate feladatátvételi tooa másodlagos SQL-adatbázis a Transact-SQL használatával.</span><span class="sxs-lookup"><span data-stu-id="977a6-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="977a6-105">tooconfigure georeplikáció, lásd: [georeplikáció konfigurálása az Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="977a6-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="977a6-106">a feladatátvétel tooinitiate következőkre lesz szüksége hello:</span><span class="sxs-lookup"><span data-stu-id="977a6-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="977a6-107">A bejelentkezési azonosítót, amely a DBManager az elsődleges hello</span><span class="sxs-lookup"><span data-stu-id="977a6-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="977a6-108">Hello helyi adatbázis földrajzi-replikálás fogja végrehajtani db_ownership rendelkezik</span><span class="sxs-lookup"><span data-stu-id="977a6-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="977a6-109">A georeplikáció konfigurálja a DBManager lehet hello partner kiszolgáló(k) toowhich</span><span class="sxs-lookup"><span data-stu-id="977a6-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="977a6-110">Legújabb verziója az SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="977a6-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="977a6-111">Javasoljuk, hogy mindig használjon hello Azure és az SQL-adatbázis a frissítések tooMicrosoft szinkronizálva tooremain Management Studio legújabb verzióját.</span><span class="sxs-lookup"><span data-stu-id="977a6-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="977a6-112">[Az SQL Server Management Studio frissítése](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="977a6-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="977a6-113">Egy másodlagos adatbázis toobecome hello új elsődleges előléptetni egy tervezett feladatátvételt kezdeményezni</span><span class="sxs-lookup"><span data-stu-id="977a6-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="977a6-114">Használhatja a hello **ALTER DATABASE** utasítás toopromote egy másodlagos adatbázis toobecome hello új elsődleges adatbázis hello meglévő elsődleges toobecome lefokozásához, a tervezett módon egy másodlagos.</span><span class="sxs-lookup"><span data-stu-id="977a6-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="977a6-115">Az utasítás végrehajtása hello főadatbázis hello Azure SQL Database logikai kiszolgáló, mely hello georeplikált másodlagos adatbázis, amely az előléptetendő található.</span><span class="sxs-lookup"><span data-stu-id="977a6-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="977a6-116">Ez a funkció célja a tervezett feladatátvétel, többek között során hello vész-Helyreállítási gyakorlatokat, és hogy hello az elsődleges adatbázis rendelkezésre kell lenniük.</span><span class="sxs-lookup"><span data-stu-id="977a6-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="977a6-117">hello parancs a következő munkafolyamat hello hajtja végre:</span><span class="sxs-lookup"><span data-stu-id="977a6-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="977a6-118">Ideiglenesen kapcsolók replikációs toosynchronous módban, amely az összes nyitott tranzakciók toobe kiürített toohello másodlagos, és blokkolja az összes új tranzakciók;</span><span class="sxs-lookup"><span data-stu-id="977a6-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="977a6-119">Kapcsolók hello hello két adatbázis hello georeplikáció együttműködve szerepkörök.</span><span class="sxs-lookup"><span data-stu-id="977a6-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="977a6-120">Ebben a sorozatban biztosítja, hogy az adott hello két adatbázis szinkronizálva előtt hello szerepkörök váltson, és így nincs adatvesztés történik.</span><span class="sxs-lookup"><span data-stu-id="977a6-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="977a6-121">Egy rövid időszak során, ami két adatbázis nem érhető el (a 0 too25 másodperc hello sorrendben) közben hello szerepkörök bekapcsolt állapotban van.</span><span class="sxs-lookup"><span data-stu-id="977a6-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="977a6-122">Ha a hello elsődleges adatbázis több másodlagos adatbázist, hello parancs lesz automatikusan reconfigure hello más másodlagos tooconnect toohello új elsődleges.</span><span class="sxs-lookup"><span data-stu-id="977a6-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="977a6-123">hello teljes műveletet kell végrehajtani kisebb, mint egy perc toocomplete normál körülmények között.</span><span class="sxs-lookup"><span data-stu-id="977a6-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="977a6-124">További információkért lásd: [(Transact-SQL) adatbázis módosítása](https://msdn.microsoft.com/library/mt574871.aspx) és [szolgáltatásszintek](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="977a6-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="977a6-125">A következő lépéseket tooinitiate egy tervezett feladatátvételt hello használata.</span><span class="sxs-lookup"><span data-stu-id="977a6-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="977a6-126">A Management Studio eszközben csatlakozzon a toohello Azure SQL Database logikai kiszolgáló, amely egy georeplikált másodlagos adatbázis található.</span><span class="sxs-lookup"><span data-stu-id="977a6-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="977a6-127">Nyissa meg a hello adatbázismappát, és bontsa ki a hello **Rendszeradatbázisokban** mappát, kattintson a jobb gombbal a **fő**, és kattintson a **új lekérdezés**.</span><span class="sxs-lookup"><span data-stu-id="977a6-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="977a6-128">Hello következő **ALTER DATABASE** utasítás tooswitch hello másodlagos adatbázis toohello elsődleges szerepkör.</span><span class="sxs-lookup"><span data-stu-id="977a6-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="977a6-129">Kattintson a **Execute** toorun hello lekérdezés.</span><span class="sxs-lookup"><span data-stu-id="977a6-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="977a6-130">Bizonyos ritkán előforduló esetekben akkor lehetséges, hogy hello művelet nem hajtható végre, és a lefagyott jelennek meg.</span><span class="sxs-lookup"><span data-stu-id="977a6-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="977a6-131">Ebben az esetben hello felhasználói hello kényszerített feladatátvételi parancs végrehajtása és fogadja el az adatvesztés.</span><span class="sxs-lookup"><span data-stu-id="977a6-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="977a6-132">Hello elsődleges adatbázis toohello másodlagos adatbázis egy nem tervezett feladatátvételt kezdeményezni</span><span class="sxs-lookup"><span data-stu-id="977a6-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="977a6-133">Használhatja a hello **ALTER DATABASE** utasítás toopromote egy másodlagos adatbázis toobecome hello új elsődleges adatbázis hello meglévő elsődleges toobecome hello lefokozása kényszerítése, egy nem tervezett módon másodlagos egyszerre amikor hello elsődleges adatbázis már nem érhető el.</span><span class="sxs-lookup"><span data-stu-id="977a6-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="977a6-134">Az utasítás végrehajtása hello főadatbázis hello Azure SQL Database logikai kiszolgáló, mely hello georeplikált másodlagos adatbázis, amely az előléptetendő található.</span><span class="sxs-lookup"><span data-stu-id="977a6-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="977a6-135">Ez a funkció a vész-helyreállítási szolgál, ha fontos hello adatbázis visszaállítási rendelkezésre állását és adatvesztést elfogadható.</span><span class="sxs-lookup"><span data-stu-id="977a6-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="977a6-136">Kényszerített feladatátvételi meghívásakor hello megadott másodlagos adatbázis azonnal hello elsődleges adatbázis válik, és írási tranzakción elfogadása kezdődik.</span><span class="sxs-lookup"><span data-stu-id="977a6-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="977a6-137">Amint hello eredeti elsődleges adatbázis képes tooreconnect az új elsődleges adatbázissal, a növekményes biztonsági mentés születik hello eredeti elsődleges adatbázis és hello régi elsődleges adatbázist állítanak be egy új elsődleges adatbázis hello; másodlagos adatbázis Ezt követően már csupán szinkronizálási hello új elsődleges replika.</span><span class="sxs-lookup"><span data-stu-id="977a6-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="977a6-138">Azonban mivel a pont a kötött visszaállítás nem támogatott a hello másodlagos adatbázisok, ha hello felhasználó által elkövetett toorecover adatok toohello régi elsődleges adatbázis, amely nem volt replikált toohello új elsődleges adatbázis előtt hello kényszerített feladatátvétel történt, hello a felhasználónak kell tooengage támogatási toorecover Ez az adatvesztés.</span><span class="sxs-lookup"><span data-stu-id="977a6-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="977a6-139">Ha a hello elsődleges adatbázis több másodlagos adatbázist, hello parancs lesz automatikusan reconfigure hello más másodlagos tooconnect toohello új elsődleges.</span><span class="sxs-lookup"><span data-stu-id="977a6-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="977a6-140">A következő lépéseket tooinitiate feladatátvételhez hello használata.</span><span class="sxs-lookup"><span data-stu-id="977a6-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="977a6-141">A Management Studio eszközben csatlakozzon a toohello Azure SQL Database logikai kiszolgáló, amely egy georeplikált másodlagos adatbázis található.</span><span class="sxs-lookup"><span data-stu-id="977a6-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="977a6-142">Nyissa meg a hello adatbázismappát, és bontsa ki a hello **Rendszeradatbázisokban** mappát, kattintson a jobb gombbal a **fő**, és kattintson a **új lekérdezés**.</span><span class="sxs-lookup"><span data-stu-id="977a6-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="977a6-143">Hello következő **ALTER DATABASE** utasítás tooswitch hello másodlagos adatbázis toohello elsődleges szerepkör.</span><span class="sxs-lookup"><span data-stu-id="977a6-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="977a6-144">Kattintson a **Execute** toorun hello lekérdezés.</span><span class="sxs-lookup"><span data-stu-id="977a6-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="977a6-145">Ha az elsődleges és másodlagos is online állapotba kerülnek hello parancs kiadása hello régi elsődleges válik az adatszinkronizálás azonnali nélkül új másodlagos hello.</span><span class="sxs-lookup"><span data-stu-id="977a6-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="977a6-146">Ha elsődleges hello tranzakciók végrehajtása, ha hello parancs kiadása adatvesztést fordulhat elő.</span><span class="sxs-lookup"><span data-stu-id="977a6-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="977a6-147">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="977a6-147">Next steps</span></span>
* <span data-ttu-id="977a6-148">A feladatátvétel után ellenőrizze a kiszolgáló és az adatbázis hello hitelesítési követelmények hello új elsődleges.</span><span class="sxs-lookup"><span data-stu-id="977a6-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="977a6-149">További információkért lásd: [SQL-adatbázis biztonsági katasztrófa utáni helyreállítás után](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="977a6-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="977a6-150">aktív georeplikáció, beleértve a helyreállítási előtti és utáni helyreállítás lépéseit, és végrehajtása egy vész-helyreállítási részletezési használata katasztrófa utáni helyreállítás toolearn lásd [katasztrófa utáni helyreállítás](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="977a6-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="977a6-151">Egy Sasha Nosov aktív georeplikáció kapcsolatos blogbejegyzést, lásd: [új georeplikáció képességek a Spotlight](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="977a6-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="977a6-152">Felhőalapú alkalmazások toouse aktív georeplikáció megtervezésével kapcsolatos további információkért lásd: [felhőalapú alkalmazások megtervezése az üzletmenet folytonossága érdekében georeplikáció használatával](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="977a6-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="977a6-153">Aktív georeplikáció a rugalmas készletek használatával kapcsolatos információkért lásd: [rugalmas készlet vész-helyreállítási stratégiák](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="977a6-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="977a6-154">Az üzletmenet folytonossága áttekintését lásd: [üzleti folytonosság – áttekintés](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="977a6-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

