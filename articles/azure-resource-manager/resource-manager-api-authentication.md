---
title: "az Active Directory aaaAzure hitelesítési és erőforrás-kezelő |} Microsoft Docs"
description: "Fejlesztői útmutató tooauthentication hello Azure Resource Manager API-t és az Azure Active Directory, az alkalmazások integrálása más Azure-előfizetések."
services: azure-resource-manager,active-directory
documentationcenter: na
author: dushyantgill
manager: timlt
editor: tysonn
ms.assetid: 17b2b40d-bf42-4c7d-9a88-9938409c5088
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 12/27/2016
ms.author: dugill;tomfitz
ms.openlocfilehash: 757e45fdb28488b45de70647746461888bf35a56
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="use-resource-manager-authentication-api-tooaccess-subscriptions"></a><span data-ttu-id="bab1e-103">Erőforrás-kezelő hitelesítési API tooaccess előfizetések használata</span><span class="sxs-lookup"><span data-stu-id="bab1e-103">Use Resource Manager authentication API tooaccess subscriptions</span></span>
## <a name="introduction"></a><span data-ttu-id="bab1e-104">Bevezetés</span><span class="sxs-lookup"><span data-stu-id="bab1e-104">Introduction</span></span>
<span data-ttu-id="bab1e-105">Ha egy szoftver fejlesztő, akinek szüksége van egy alkalmazás, amely felügyeli az ügyfél Azure-erőforrások toocreate, ez a témakör bemutatja, hogyan tooauthenticate a hello Azure Resource Manager API-k és szerezhet hozzáférést tooresources más előfizetésekhez.</span><span class="sxs-lookup"><span data-stu-id="bab1e-105">If you are a software developer who needs toocreate an app that manages customer's Azure resources, this topic shows you how tooauthenticate with hello Azure Resource Manager APIs and gain access tooresources in other subscriptions.</span></span>

<span data-ttu-id="bab1e-106">Az alkalmazás érhető el több módon Resource Manager API-k hello:</span><span class="sxs-lookup"><span data-stu-id="bab1e-106">Your app can access hello Resource Manager APIs in couple of ways:</span></span>

1. <span data-ttu-id="bab1e-107">**Felhasználói + alkalmazás-hozzáférés**: az alkalmazáshoz, amelyet a bejelentkezett felhasználó nevében erőforrásokhoz férnek hozzá.</span><span class="sxs-lookup"><span data-stu-id="bab1e-107">**User + app access**: for apps that access resources on behalf of a signed-in user.</span></span> <span data-ttu-id="bab1e-108">Ez a módszer az alkalmazások, például webes alkalmazásokat vagy csak "interaktív kezelése" Azure-erőforrások kezelésére szolgáló parancssori eszköz működik.</span><span class="sxs-lookup"><span data-stu-id="bab1e-108">This approach works for apps, such as web apps and command-line tools, that deal with only "interactive management" of Azure resources.</span></span>
2. <span data-ttu-id="bab1e-109">**Csak alkalmazás hozzáférés**: démon szolgáltatások és az ütemezett feladatok futó alkalmazások számára.</span><span class="sxs-lookup"><span data-stu-id="bab1e-109">**App-only access**: for apps that run daemon services and scheduled jobs.</span></span> <span data-ttu-id="bab1e-110">hello app identitás toohello erőforrások közvetlen hozzáférést kap.</span><span class="sxs-lookup"><span data-stu-id="bab1e-110">hello app's identity is granted direct access toohello resources.</span></span> <span data-ttu-id="bab1e-111">Ez a megközelítés hosszú távú távfelügyeleti (felügyelet) hozzáférési tooAzure igénylő alkalmazások esetében működik.</span><span class="sxs-lookup"><span data-stu-id="bab1e-111">This approach works for apps that need long-term headless (unattended) access tooAzure.</span></span>

<span data-ttu-id="bab1e-112">Ez a témakör részletes útmutatást toocreate egy olyan alkalmazáshoz, ezek hitelesítési módszerek alkalmazza.</span><span class="sxs-lookup"><span data-stu-id="bab1e-112">This topic provides step-by-step instructions toocreate an app that employs both these authorization methods.</span></span> <span data-ttu-id="bab1e-113">Azt illusztrálja, hogyan tooperform minden lépés REST API-t vagy a C#.</span><span class="sxs-lookup"><span data-stu-id="bab1e-113">It shows how tooperform each step with REST API or C#.</span></span> <span data-ttu-id="bab1e-114">hello teljes ASP.NET MVC alkalmazás érhető el: [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span><span class="sxs-lookup"><span data-stu-id="bab1e-114">hello complete ASP.NET MVC application is available at [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span></span>

## <a name="what-hello-web-app-does"></a><span data-ttu-id="bab1e-115">Milyen hello webes alkalmazás nem</span><span class="sxs-lookup"><span data-stu-id="bab1e-115">What hello web app does</span></span>
<span data-ttu-id="bab1e-116">a webalkalmazás hello:</span><span class="sxs-lookup"><span data-stu-id="bab1e-116">hello web app:</span></span>

1. <span data-ttu-id="bab1e-117">Bejelentkezik egy Azure felhasználói.</span><span class="sxs-lookup"><span data-stu-id="bab1e-117">Signs-in an Azure user.</span></span>
2. <span data-ttu-id="bab1e-118">Felhasználói toogrant hello web app hozzáférés tooResource Manager kéri.</span><span class="sxs-lookup"><span data-stu-id="bab1e-118">Asks user toogrant hello web app access tooResource Manager.</span></span>
3. <span data-ttu-id="bab1e-119">Lekérdezi a felhasználó + alkalmazás hozzáférési jogkivonat erőforrás-kezelő eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="bab1e-119">Gets user + app access token for accessing Resource Manager.</span></span>
4. <span data-ttu-id="bab1e-120">Használja a jogkivonatot (a 3. lépés) toocall erőforrás-kezelő és a szerepkör-hozzárendelés hello app szolgáltatás egyszerű tooa hello az előfizetést, amely hello app hosszú távú hozzáférés toohello előfizetés.</span><span class="sxs-lookup"><span data-stu-id="bab1e-120">Uses token (from step 3) toocall Resource Manager and assign hello app's service principal tooa role in hello subscription, which gives hello app long-term access toohello subscription.</span></span>
5. <span data-ttu-id="bab1e-121">Csak alkalmazás-hozzáférési jogkivonat lekérése.</span><span class="sxs-lookup"><span data-stu-id="bab1e-121">Gets app-only access token.</span></span>
6. <span data-ttu-id="bab1e-122">(Az 5. lépés) token toomanage erőforrásokat használ hello előfizetésben Resource Manageren keresztül.</span><span class="sxs-lookup"><span data-stu-id="bab1e-122">Uses token (from step 5) toomanage resources in hello subscription through Resource Manager.</span></span>

<span data-ttu-id="bab1e-123">Itt található hello webalkalmazás hello végpontok közötti áramlását.</span><span class="sxs-lookup"><span data-stu-id="bab1e-123">Here's hello end-to-end flow of hello web application.</span></span>

![Erőforrás-kezelő hitelesítési folyamat](./media/resource-manager-api-authentication/Auth-Swim-Lane.png)

<span data-ttu-id="bab1e-125">Felhasználóként, hello előfizetési azonosítót megadta hello előfizetés toouse szeretne:</span><span class="sxs-lookup"><span data-stu-id="bab1e-125">As a user, you provide hello subscription id for hello subscription you want toouse:</span></span>

![Adja meg az előfizetés-azonosító](./media/resource-manager-api-authentication/sample-ux-1.png)

<span data-ttu-id="bab1e-127">Válassza ki a hello fiók toouse való bejelentkezéskor.</span><span class="sxs-lookup"><span data-stu-id="bab1e-127">Select hello account toouse for logging in.</span></span>

![Válasszon fiókot](./media/resource-manager-api-authentication/sample-ux-2.png)

<span data-ttu-id="bab1e-129">Adja meg a hitelesítő adatokat.</span><span class="sxs-lookup"><span data-stu-id="bab1e-129">Provide your credentials.</span></span>

![Adjon meg hitelesítő adatokat](./media/resource-manager-api-authentication/sample-ux-3.png)

<span data-ttu-id="bab1e-131">Alkalmazás-hozzáférés tooyour hello Azure-előfizetések engedélyezése:</span><span class="sxs-lookup"><span data-stu-id="bab1e-131">Grant hello app access tooyour Azure subscriptions:</span></span>

![Hozzáférés biztosítása](./media/resource-manager-api-authentication/sample-ux-4.png)

<span data-ttu-id="bab1e-133">A csatlakoztatott előfizetések kezelése:</span><span class="sxs-lookup"><span data-stu-id="bab1e-133">Manage your connected subscriptions:</span></span>

![Csatlakozás az előfizetés](./media/resource-manager-api-authentication/sample-ux-7.png)

## <a name="register-application"></a><span data-ttu-id="bab1e-135">Alkalmazás regisztrálása</span><span class="sxs-lookup"><span data-stu-id="bab1e-135">Register application</span></span>
<span data-ttu-id="bab1e-136">A kezdéshez kódolási regisztrálja a webalkalmazás az Azure Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="bab1e-136">Before you start coding, register your web app with Azure Active Directory (AD).</span></span> <span data-ttu-id="bab1e-137">hello alkalmazás regisztrálása egy központi identitás, az alkalmazás az Azure AD-hoz létre.</span><span class="sxs-lookup"><span data-stu-id="bab1e-137">hello app registration creates a central identity for your app in Azure AD.</span></span> <span data-ttu-id="bab1e-138">Alapvető információkat az alkalmazás OAuth-Ügyfélazonosító, a válasz URL-címek és a hitelesítő adatok például az alkalmazás által tooauthenticate és access Azure Resource Manager API-k magánál tartja.</span><span class="sxs-lookup"><span data-stu-id="bab1e-138">It holds basic information about your application like OAuth Client ID, Reply URLs, and credentials that your application uses tooauthenticate and access Azure Resource Manager APIs.</span></span> <span data-ttu-id="bab1e-139">hello app regisztrációs különböző delegált engedélyek, amelyet az alkalmazás Microsoft APIs hello felhasználó nevében elérésekor hello is rögzíti.</span><span class="sxs-lookup"><span data-stu-id="bab1e-139">hello app registration also records hello various delegated permissions that your application needs when accessing Microsoft APIs on behalf of hello user.</span></span>

<span data-ttu-id="bab1e-140">Az alkalmazás más előfizetés fér hozzá, mert a több-bérlős alkalmazásként kell konfigurálnia.</span><span class="sxs-lookup"><span data-stu-id="bab1e-140">Because your app accesses other subscription, you must configure it as a multi-tenant application.</span></span> <span data-ttu-id="bab1e-141">toopass érvényesítési, adjon meg egy társított az Azure Active Directory tartományhoz.</span><span class="sxs-lookup"><span data-stu-id="bab1e-141">toopass validation, provide a domain associated with your Azure Active Directory.</span></span> <span data-ttu-id="bab1e-142">az Azure Active Directory, a bejelentkezés toohello társított toosee hello tartományok [klasszikus portál](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="bab1e-142">toosee hello domains associated with your Azure Active Directory, log in toohello [classic portal](https://manage.windowsazure.com).</span></span> <span data-ttu-id="bab1e-143">Válassza ki az Azure Active Directory majd **tartományok**.</span><span class="sxs-lookup"><span data-stu-id="bab1e-143">Select your Azure Active Directory and then select **Domains**.</span></span>

<span data-ttu-id="bab1e-144">hello a következő példa bemutatja, hogyan tooregister hello Azure PowerShell használatával alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="bab1e-144">hello following example shows how tooregister hello app by using Azure PowerShell.</span></span> <span data-ttu-id="bab1e-145">Hello legújabb verzióját (2016 augusztusától) Azure PowerShell adja meg a parancs toowork kell rendelkeznie.</span><span class="sxs-lookup"><span data-stu-id="bab1e-145">You must have hello latest version (August 2016) of Azure PowerShell for this command toowork.</span></span>

    $app = New-AzureRmADApplication -DisplayName "{app name}" -HomePage "https://{your domain}/{app name}" -IdentifierUris "https://{your domain}/{app name}" -Password "{your password}" -AvailableToOtherTenants $true

<span data-ttu-id="bab1e-146">hello AD-alkalmazást, a toolog, kell hello alkalmazás azonosítóját és jelszavát.</span><span class="sxs-lookup"><span data-stu-id="bab1e-146">toolog in as hello AD application, you need hello application id and password.</span></span> <span data-ttu-id="bab1e-147">toosee hello alkalmazásazonosító visszaadott hello előző parancsot használja:</span><span class="sxs-lookup"><span data-stu-id="bab1e-147">toosee hello application id that is returned from hello previous command, use:</span></span>

    $app.ApplicationId

<span data-ttu-id="bab1e-148">hello a következő példa bemutatja, hogyan tooregister hello Azure parancssori felület használatával alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="bab1e-148">hello following example shows how tooregister hello app by using Azure CLI.</span></span>

    azure ad app create --name {app name} --home-page https://{your domain}/{app name} --identifier-uris https://{your domain}/{app name} --password {your password} --available true

<span data-ttu-id="bab1e-149">hello eredmények tartalmazzák a hello AppId, amely hello alkalmazásként hitelesítéséhez szükséges.</span><span class="sxs-lookup"><span data-stu-id="bab1e-149">hello results include hello AppId, which you need when authenticating as hello application.</span></span>

### <a name="optional-configuration---certificate-credential"></a><span data-ttu-id="bab1e-150">Opcionális konfigurációs - tanúsítvány hitelesítő adatok</span><span class="sxs-lookup"><span data-stu-id="bab1e-150">Optional configuration - certificate credential</span></span>
<span data-ttu-id="bab1e-151">Az alkalmazások is támogatja tanúsítvány hitelesítő adatokat az Azure AD: hozzon létre egy önaláírt tanúsítványt, tartsa hello titkos kulcs és adja hozzá a nyilvános kulcs tooyour az Azure AD-alkalmazás regisztrációja hello.</span><span class="sxs-lookup"><span data-stu-id="bab1e-151">Azure AD also supports certificate credentials for applications: you create a self-signed cert, keep hello private key, and add hello public key tooyour Azure AD application registration.</span></span> <span data-ttu-id="bab1e-152">A hitelesítéshez az alkalmazás küld egy kis hasznos tooAzure AD a titkos kulccsal aláírva, és az Azure AD hello aláírás regisztrált hello nyilvános kulccsal ellenőrzi.</span><span class="sxs-lookup"><span data-stu-id="bab1e-152">For authentication, your application sends a small payload tooAzure AD signed using your private key, and Azure AD validates hello signature using hello public key that you registered.</span></span>

<span data-ttu-id="bab1e-153">Egy AD-alkalmazás létrehozása a tanúsítvánnyal kapcsolatos információkért lásd: [egyszerű szolgáltatás használata az Azure PowerShell toocreate tooaccess erőforrások](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) vagy [egyszerű szolgáltatás használata az Azure parancssori felület toocreate tooaccess erőforrások](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span><span class="sxs-lookup"><span data-stu-id="bab1e-153">For information about creating an AD app with a certificate, see [Use Azure PowerShell toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) or [Use Azure CLI toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span></span>

## <a name="get-tenant-id-from-subscription-id"></a><span data-ttu-id="bab1e-154">Előfizetés-azonosító bérlőazonosító beszerzése</span><span class="sxs-lookup"><span data-stu-id="bab1e-154">Get tenant id from subscription id</span></span>
<span data-ttu-id="bab1e-155">egy jogkivonatot, amely lehet használt toocall erőforrás-kezelő toorequest, az alkalmazásban tooknow hello Bérlőazonosító hello Azure-előfizetés üzemeltető hello Azure AD-bérlő szükséges.</span><span class="sxs-lookup"><span data-stu-id="bab1e-155">toorequest a token that can be used toocall Resource Manager, your application needs tooknow hello tenant ID of hello Azure AD tenant that hosts hello Azure subscription.</span></span> <span data-ttu-id="bab1e-156">Nagy valószínűséggel a felhasználókkal, hogy az előfizetés-azonosítók, de előfordulhat, hogy nem tudják a bérlői azonosító az Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="bab1e-156">Most likely, your users know their subscription ids, but they might not know their tenant ids for Azure Active Directory.</span></span> <span data-ttu-id="bab1e-157">tooget hello felhasználói hello felhasználó bérlőazonosító, kérjen hello előfizetés-azonosító. Adja meg, hogy az előfizetés-azonosító, hello előfizetés vonatkozó kérelem küldésekor:</span><span class="sxs-lookup"><span data-stu-id="bab1e-157">tooget hello user's tenant id, ask hello user for hello subscription id. Provide that subscription id when sending a request about hello subscription:</span></span>

    https://management.azure.com/subscriptions/{subscription-id}?api-version=2015-01-01

<span data-ttu-id="bab1e-158">hello kérelem sikertelen lesz, mivel hello felhasználó nem bejelentkezése még, de hello bérlőazonosító beolvasható hello válasz.</span><span class="sxs-lookup"><span data-stu-id="bab1e-158">hello request fails because hello user has not logged in yet, but you can retrieve hello tenant id from hello response.</span></span> <span data-ttu-id="bab1e-159">Ezt a kivételt a hello válasz fejléc értéke hello bérlőazonosító lekérdezni **WWW-Authenticate**.</span><span class="sxs-lookup"><span data-stu-id="bab1e-159">In that exception, retrieve hello tenant id from hello response header value for **WWW-Authenticate**.</span></span> <span data-ttu-id="bab1e-160">Ez a megvalósítás a hello látja [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) metódust.</span><span class="sxs-lookup"><span data-stu-id="bab1e-160">You see this implementation in hello [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) method.</span></span>

## <a name="get-user--app-access-token"></a><span data-ttu-id="bab1e-161">Felhasználói + alkalmazás hozzáférési jogkivonat beszerzése</span><span class="sxs-lookup"><span data-stu-id="bab1e-161">Get user + app access token</span></span>
<span data-ttu-id="bab1e-162">Az alkalmazás átirányítja a felhasználókat hello felhasználói tooAzure az OAuth 2.0 engedélyezik kérelem - tooauthenticate hello felhasználó hitelesítő adatainak a AD, és vissza egy engedélyezési kódot.</span><span class="sxs-lookup"><span data-stu-id="bab1e-162">Your application redirects hello user tooAzure AD with an OAuth 2.0 Authorize Request - tooauthenticate hello user's credentials and get back an authorization code.</span></span> <span data-ttu-id="bab1e-163">Az alkalmazás a Resource Manager hello engedélyezési kód tooget olyan hozzáférési jogkivonatot használja.</span><span class="sxs-lookup"><span data-stu-id="bab1e-163">Your application uses hello authorization code tooget an access token for Resource Manager.</span></span> <span data-ttu-id="bab1e-164">Hello [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) hello engedélyezési kérést hoz létre.</span><span class="sxs-lookup"><span data-stu-id="bab1e-164">hello [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) method creates hello authorization request.</span></span>

<span data-ttu-id="bab1e-165">Ez a témakör bemutatja a hello REST API kérelmek tooauthenticate hello felhasználó.</span><span class="sxs-lookup"><span data-stu-id="bab1e-165">This topic shows hello REST API requests tooauthenticate hello user.</span></span> <span data-ttu-id="bab1e-166">Is használhatja segítő szalagtárak tooperform hitelesítést a kódban.</span><span class="sxs-lookup"><span data-stu-id="bab1e-166">You can also use helper libraries tooperform authentication in your code.</span></span> <span data-ttu-id="bab1e-167">Ezek a kódtárak kapcsolatos további információkért lásd: [Azure Active Directory hitelesítési Kódtárai](../active-directory/active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="bab1e-167">For more information about these libraries, see [Azure Active Directory Authentication Libraries](../active-directory/active-directory-authentication-libraries.md).</span></span> <span data-ttu-id="bab1e-168">Egy alkalmazás Identitáskezelés integrálásával útmutatóért lásd: [Azure Active Directory fejlesztői útmutatója](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="bab1e-168">For guidance on integrating identity management in an application, see [Azure Active Directory developer's guide](../active-directory/active-directory-developers-guide.md).</span></span>

### <a name="auth-request-oauth-20"></a><span data-ttu-id="bab1e-169">Hitelesítési kérelmek (OAuth 2.0-s)</span><span class="sxs-lookup"><span data-stu-id="bab1e-169">Auth request (OAuth 2.0)</span></span>
<span data-ttu-id="bab1e-170">Nyissa meg azonosító Connect/OAuth2.0 engedélyezik lekérdezési toohello az Azure AD hitelesítési végpontra ki:</span><span class="sxs-lookup"><span data-stu-id="bab1e-170">Issue an Open ID Connect/OAuth2.0 Authorize Request toohello Azure AD Authorize endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize

<span data-ttu-id="bab1e-171">hello lekérdezési karakterlánc paraméterek érhetők el ehhez a kérelemhez ismerteti a hello [egy engedélyezési kód kérése](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) témakör.</span><span class="sxs-lookup"><span data-stu-id="bab1e-171">hello query string parameters that are available for this request are described in hello [request an authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) topic.</span></span>

<span data-ttu-id="bab1e-172">a következő példa azt mutatja meg hogyan hello toorequest OAuth2.0 engedélyezési:</span><span class="sxs-lookup"><span data-stu-id="bab1e-172">hello following example shows how toorequest OAuth2.0 authorization:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=query&response_type=code&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&domain_hint=live.com

<span data-ttu-id="bab1e-173">Az Azure AD hitelesíti a hello felhasználót, és, ha szükséges, megkérdezi hello felhasználói toogrant engedély toohello alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="bab1e-173">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="bab1e-174">Hello engedélyezési kód toohello válasz URL-CÍMEN, az alkalmazás adja vissza.</span><span class="sxs-lookup"><span data-stu-id="bab1e-174">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="bab1e-175">Attól függően, hogy hello kért response_mode, az Azure AD vagy küld vissza hello adatok a lekérdezési karakterláncban vagy post-adatokat.</span><span class="sxs-lookup"><span data-stu-id="bab1e-175">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

    code=AAABAAAAiL****FDMZBUwZ8eCAA&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="auth-request-open-id-connect"></a><span data-ttu-id="bab1e-176">Hitelesítési kérelmek (Open ID Connect)</span><span class="sxs-lookup"><span data-stu-id="bab1e-176">Auth request (Open ID Connect)</span></span>
<span data-ttu-id="bab1e-177">Ha nem csak kívánja tooaccess Azure Resource Manager hello felhasználó nevében, de is lehetővé teszi a felhasználó toosign hello tooyour alkalmazásokban az Azure AD-fiókjában, ki egy nyitott azonosító csatlakozás engedélyezése lekérdezési.</span><span class="sxs-lookup"><span data-stu-id="bab1e-177">If you not only wish tooaccess Azure Resource Manager on behalf of hello user, but also allow hello user toosign in tooyour application using their Azure AD account, issue an Open ID Connect Authorize Request.</span></span> <span data-ttu-id="bab1e-178">A Open ID Connect az alkalmazás is kap egy id_token, hogy a az alkalmazás toosign hello felhasználó használhatja az Azure AD-ből.</span><span class="sxs-lookup"><span data-stu-id="bab1e-178">With Open ID Connect, your application also receives an id_token from Azure AD that your app can use toosign in hello user.</span></span>

<span data-ttu-id="bab1e-179">hello lekérdezési karakterlánc paraméterek érhetők el ehhez a kérelemhez ismerteti a hello [küldési hello bejelentkezési kérelmek](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) témakör.</span><span class="sxs-lookup"><span data-stu-id="bab1e-179">hello query string parameters that are available for this request are described in hello [Send hello sign-in request](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) topic.</span></span>

<span data-ttu-id="bab1e-180">A következő egy példa egy Open ID Connect kérelem:</span><span class="sxs-lookup"><span data-stu-id="bab1e-180">An example Open ID Connect request is:</span></span>

     https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=form_post&response_type=code+id_token&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&scope=openid+profile&nonce=63567Dc4MDAw&domain_hint=live.com&state=M_12tMyKaM8

<span data-ttu-id="bab1e-181">Az Azure AD hitelesíti a hello felhasználót, és, ha szükséges, megkérdezi hello felhasználói toogrant engedély toohello alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="bab1e-181">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="bab1e-182">Hello engedélyezési kód toohello válasz URL-CÍMEN, az alkalmazás adja vissza.</span><span class="sxs-lookup"><span data-stu-id="bab1e-182">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="bab1e-183">Attól függően, hogy hello kért response_mode, az Azure AD vagy küld vissza hello adatok a lekérdezési karakterláncban vagy post-adatokat.</span><span class="sxs-lookup"><span data-stu-id="bab1e-183">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

<span data-ttu-id="bab1e-184">Az Open ID Connect válasz példája:</span><span class="sxs-lookup"><span data-stu-id="bab1e-184">An example Open ID Connect response is:</span></span>

    code=AAABAAAAiL*****I4rDWd7zXsH6WUjlkIEQxIAA&id_token=eyJ0eXAiOiJKV1Q*****T3GrzzSFxg&state=M_12tMyKaM8&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="token-request-oauth20-code-grant-flow"></a><span data-ttu-id="bab1e-185">Jogkivonatkérelem (OAuth2.0 Code Grant Flow)</span><span class="sxs-lookup"><span data-stu-id="bab1e-185">Token request (OAuth2.0 Code Grant Flow)</span></span>
<span data-ttu-id="bab1e-186">Most, hogy az alkalmazás az Azure AD-ből kapott hello engedélyezési kódot, akkor idő tooget hello hozzáférési jogkivonatot az Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="bab1e-186">Now that your application has received hello authorization code from Azure AD, it is time tooget hello access token for Azure Resource Manager.</span></span>  <span data-ttu-id="bab1e-187">Utáni OAuth2.0 Code Grant Token kérelem toohello Azure AD Token végpont:</span><span class="sxs-lookup"><span data-stu-id="bab1e-187">Post an OAuth2.0 Code Grant Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="bab1e-188">hello lekérdezési karakterlánc paraméterek érhetők el ehhez a kérelemhez ismerteti a hello [hello engedélyezési kód használata](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) témakör.</span><span class="sxs-lookup"><span data-stu-id="bab1e-188">hello query string parameters that are available for this request are described in hello [use hello authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) topic.</span></span>

<span data-ttu-id="bab1e-189">a következő példa hello code grant token jelszó hitelesítő adat vonatkozó kérést láthatók:</span><span class="sxs-lookup"><span data-stu-id="bab1e-189">hello following example shows a request for code grant token with password credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="bab1e-190">Amikor olyan tanúsítvány hitelesítő adatait, hozzon létre JSON webes jogkivonat (JWT) és (RSA SHA256) bejelentkezési hello titkos kulcs a az alkalmazás tanúsítvány hitelesítő adatok használatával.</span><span class="sxs-lookup"><span data-stu-id="bab1e-190">When working with certificate credentials, create a JSON Web Token (JWT) and sign (RSA SHA256) using hello private key of your application's certificate credential.</span></span> <span data-ttu-id="bab1e-191">hello jogcímtípusok hello jogkivonat megjelennek-e [JWT jogkivonat jogcímek](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span><span class="sxs-lookup"><span data-stu-id="bab1e-191">hello claim types for hello token are shown in [JWT token claims](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span></span> <span data-ttu-id="bab1e-192">Referenciáért lásd: hello [Active Directory hitelesítési könyvtár (.NET) kód](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign ügyfél helyességi feltétel JWT-jogkivonatokat.</span><span class="sxs-lookup"><span data-stu-id="bab1e-192">For reference, see hello [Active Directory Auth Library (.NET) code](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign Client Assertion JWT tokens.</span></span>

<span data-ttu-id="bab1e-193">Lásd: hello [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) talál részletes információt ügyfél-hitelesítéshez.</span><span class="sxs-lookup"><span data-stu-id="bab1e-193">See hello [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) for details on client authentication.</span></span>

<span data-ttu-id="bab1e-194">a következő példa hello code grant token tanúsítvány hitelesítő adat vonatkozó kérést láthatók:</span><span class="sxs-lookup"><span data-stu-id="bab1e-194">hello following example shows a request for code grant token with certificate credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&client_assertion=eyJhbG*****Y9cYo8nEjMyA

<span data-ttu-id="bab1e-195">Egy példa egy válasz code grant jogkivonat:</span><span class="sxs-lookup"><span data-stu-id="bab1e-195">An example response for code grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039858","not_before":"1432035958","resource":"https://management.core.windows.net/","access_token":"eyJ0eXAiOiJKV1Q****M7Cw6JWtfY2lGc5A","refresh_token":"AAABAAAAiL9Kn2Z****55j-sjnyYgAA","scope":"user_impersonation","id_token":"eyJ0eXAiOiJKV*****-drP1J3P-HnHi9Rr46kGZnukEBH4dsg"}

#### <a name="handle-code-grant-token-response"></a><span data-ttu-id="bab1e-196">Kezeli a code grant token válasz</span><span class="sxs-lookup"><span data-stu-id="bab1e-196">Handle code grant token response</span></span>
<span data-ttu-id="bab1e-197">A sikeres token válasz az Azure Resource Manager hello (felhasználó + alkalmazás) hozzáférési jogkivonatot tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="bab1e-197">A successful token response contains hello (user + app) access token for Azure Resource Manager.</span></span> <span data-ttu-id="bab1e-198">Az alkalmazás által a hozzáférési token tooaccess erőforrás-kezelő, hello felhasználó nevében.</span><span class="sxs-lookup"><span data-stu-id="bab1e-198">Your application uses this access token tooaccess Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="bab1e-199">az Azure AD által kibocsátott hozzáférési jogkivonatok élettartama hello egy óra.</span><span class="sxs-lookup"><span data-stu-id="bab1e-199">hello lifetime of access tokens issued by Azure AD is one hour.</span></span> <span data-ttu-id="bab1e-200">Nem valószínű, hogy a webes alkalmazás toorenew hello (felhasználó + alkalmazás) hozzáférési jogkivonatot kell-e.</span><span class="sxs-lookup"><span data-stu-id="bab1e-200">It is unlikely that your web application needs toorenew hello (user + app) access token.</span></span> <span data-ttu-id="bab1e-201">Ha toorenew hello hozzáférési jogkivonat szükséges, használja a hello frissítési jogkivonat, amely az alkalmazás fogad hello token válaszként.</span><span class="sxs-lookup"><span data-stu-id="bab1e-201">If it needs toorenew hello access token, use hello refresh token that your application receives in hello token response.</span></span> <span data-ttu-id="bab1e-202">Utáni OAuth2.0 Token kérelem toohello Azure AD Token végpont:</span><span class="sxs-lookup"><span data-stu-id="bab1e-202">Post an OAuth2.0 Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="bab1e-203">hello hello frissítési kérelem rendelkező paraméterek toouse részelemcímkék ismertetését [frissítés hello hozzáférési jogkivonat](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span><span class="sxs-lookup"><span data-stu-id="bab1e-203">hello parameters toouse with hello refresh request are described in [refreshing hello access token](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span></span>

<span data-ttu-id="bab1e-204">hello következő példa bemutatja, hogyan toouse hello frissítési token:</span><span class="sxs-lookup"><span data-stu-id="bab1e-204">hello following example shows how toouse hello refresh token:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=refresh_token&refresh_token=AAABAAAAiL9Kn2Z****55j-sjnyYgAA&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="bab1e-205">Bár a frissítési jogkivonatokat használt tooget új hozzáférési jogkivonatok az Azure Resource Manager lehet, nem alkalmasak legyenek offline hozzáférés az alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="bab1e-205">Although refresh tokens can be used tooget new access tokens for Azure Resource Manager, they are not suitable for offline access by your application.</span></span> <span data-ttu-id="bab1e-206">hello frissítési jogkivonatok élettartama korlátozva, és frissítési jogkivonatok kötött toohello felhasználó.</span><span class="sxs-lookup"><span data-stu-id="bab1e-206">hello refresh tokens lifetime is limited, and refresh tokens are bound toohello user.</span></span> <span data-ttu-id="bab1e-207">Ha hello felhasználó elhagyja a szervezet hello, hello alkalmazás hello frissítési jogkivonat használatával elveszítette a hozzáférését.</span><span class="sxs-lookup"><span data-stu-id="bab1e-207">If hello user leaves hello organization, hello application using hello refresh token loses access.</span></span> <span data-ttu-id="bab1e-208">Ez a megközelítés alkalmazásoknál, amelyek nem használják a csapatok toomanage az Azure-erőforrások.</span><span class="sxs-lookup"><span data-stu-id="bab1e-208">This approach isn't suitable for applications that are used by teams toomanage their Azure resources.</span></span>

## <a name="check-if-user-can-assign-access-toosubscription"></a><span data-ttu-id="bab1e-209">Ha a felhasználói hozzáférés toosubscription rendelhet ellenőrzése</span><span class="sxs-lookup"><span data-stu-id="bab1e-209">Check if user can assign access toosubscription</span></span>
<span data-ttu-id="bab1e-210">Az alkalmazás most már rendelkezik egy token tooaccess Azure Resource Manager hello felhasználó nevében.</span><span class="sxs-lookup"><span data-stu-id="bab1e-210">Your application now has a token tooaccess Azure Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="bab1e-211">következő lépés hello tooconnect app toohello előfizetése van.</span><span class="sxs-lookup"><span data-stu-id="bab1e-211">hello next step is tooconnect your app toohello subscription.</span></span> <span data-ttu-id="bab1e-212">A csatlakozás után az alkalmazás kezelhető előfizetésekben akkor is, ha hello felhasználó nem található (hosszú távú offline hozzáférést).</span><span class="sxs-lookup"><span data-stu-id="bab1e-212">After connecting, your app can manage those subscriptions even when hello user isn't present (long-term offline access).</span></span>

<span data-ttu-id="bab1e-213">Minden előfizetés tooconnect hívja a hello [erőforrás-kezelő listázási engedély](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine hello felhasználó rendelkezik-e felügyeleti jogokkal hello az előfizetéshez.</span><span class="sxs-lookup"><span data-stu-id="bab1e-213">For each subscription tooconnect, call hello [Resource Manager list permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine whether hello user has access management rights for hello subscription.</span></span>

<span data-ttu-id="bab1e-214">Hello [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) hello ASP.NET MVC mintaalkalmazás metódusában valósítja meg a hívás.</span><span class="sxs-lookup"><span data-stu-id="bab1e-214">hello [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) method of hello ASP.NET MVC sample app implements this call.</span></span>

<span data-ttu-id="bab1e-215">a következő példa azt mutatja meg hogyan hello toorequest előfizetésekből a felhasználó engedélyeit.</span><span class="sxs-lookup"><span data-stu-id="bab1e-215">hello following example shows how toorequest a user's permissions on a subscription.</span></span> <span data-ttu-id="bab1e-216">a rendszer hello azonosítóját hello előfizetés 83cfe939-2402-4581-b761-4f59b0a041e4.</span><span class="sxs-lookup"><span data-stu-id="bab1e-216">83cfe939-2402-4581-b761-4f59b0a041e4 is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/83cfe939-2402-4581-b761-4f59b0a041e4/providers/microsoft.authorization/permissions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiLC***lwO1mM7Cw6JWtfY2lGc5A

<span data-ttu-id="bab1e-217">Az előfizetés hello válasz tooget felhasználói engedélyeinek példája:</span><span class="sxs-lookup"><span data-stu-id="bab1e-217">An example of hello response tooget user's permissions on subscription is:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"actions":["*"],"notActions":["Microsoft.Authorization/*/Write","Microsoft.Authorization/*/Delete"]},{"actions":["*/read"],"notActions":[]}]}

<span data-ttu-id="bab1e-218">hello engedélyek API több engedélyeket ad vissza.</span><span class="sxs-lookup"><span data-stu-id="bab1e-218">hello permissions API returns multiple permissions.</span></span> <span data-ttu-id="bab1e-219">Minden engedélyt engedélyezett műveletek (műveletek) áll, és nem engedélyezett műveletek (notactions).</span><span class="sxs-lookup"><span data-stu-id="bab1e-219">Each permission consists of allowed actions (actions) and disallowed actions (notactions).</span></span> <span data-ttu-id="bab1e-220">Ha egy művelet megtalálható-e hello engedélyezett műveletek listája bármilyen engedéllyel, és nem található meg a hello notactions listája az engedélyt, hello felhasználói tooperform művelet engedélyezett.</span><span class="sxs-lookup"><span data-stu-id="bab1e-220">If an action is present in hello allowed actions list of any permission and not present in hello notactions list of that permission, hello user is allowed tooperform that action.</span></span> <span data-ttu-id="bab1e-221">**Microsoft.Authorization/RoleAssignments/Write** , hogy, amely hozzáférést biztosít a rights management hello művelet.</span><span class="sxs-lookup"><span data-stu-id="bab1e-221">**microsoft.authorization/roleassignments/write** is hello action that that grants access management rights.</span></span> <span data-ttu-id="bab1e-222">Az alkalmazás számára ez a művelet karakterlánc hello műveletek és minden engedély notactions reguláris kifejezéssel egyező kell elemezni hello engedélyek eredmény toolook.</span><span class="sxs-lookup"><span data-stu-id="bab1e-222">Your application must parse hello permissions result toolook for a regex match on this action string in hello actions and notactions of each permission.</span></span>

## <a name="get-app-only-access-token"></a><span data-ttu-id="bab1e-223">Csak alkalmazás-token beszerzése</span><span class="sxs-lookup"><span data-stu-id="bab1e-223">Get app-only access token</span></span>
<span data-ttu-id="bab1e-224">Tudja, ha hello felhasználói hozzáférés toohello Azure-előfizetés is hozzárendelhető.</span><span class="sxs-lookup"><span data-stu-id="bab1e-224">Now, you know if hello user can assign access toohello Azure subscription.</span></span> <span data-ttu-id="bab1e-225">hello lépések a következők:</span><span class="sxs-lookup"><span data-stu-id="bab1e-225">hello next steps are:</span></span>

1. <span data-ttu-id="bab1e-226">Rendelje hozzá a hello megfelelő RBAC szerepkör tooyour alkalmazás azonosítóját hello az előfizetésben.</span><span class="sxs-lookup"><span data-stu-id="bab1e-226">Assign hello appropriate RBAC role tooyour application's identity on hello subscription.</span></span>
2. <span data-ttu-id="bab1e-227">Annak ellenőrzése hello hozzáférés hozzárendelése, hello alkalmazás engedélyt hello előfizetésben lekérdezésével vagy erőforrás-kezelő csak alkalmazás tokent elérésével.</span><span class="sxs-lookup"><span data-stu-id="bab1e-227">Validate hello access assignment by querying for hello Application's permission on hello subscription or by accessing Resource Manager using app-only token.</span></span>
3. <span data-ttu-id="bab1e-228">Az alkalmazások "csatlakoztatott előfizetések" adatszerkezet - hello azonosító hello előfizetés megőrzése rekord hello kapcsolatot.</span><span class="sxs-lookup"><span data-stu-id="bab1e-228">Record hello connection in your applications "connected subscriptions" data structure - persisting hello id of hello subscription.</span></span>

<span data-ttu-id="bab1e-229">Nézzük szorosabb hello első lépésben.</span><span class="sxs-lookup"><span data-stu-id="bab1e-229">Let's look closer at hello first step.</span></span> <span data-ttu-id="bab1e-230">tooassign hello megfelelő RBAC szerepkör toohello alkalmazás azonosítóját, meg kell határoznia:</span><span class="sxs-lookup"><span data-stu-id="bab1e-230">tooassign hello appropriate RBAC role toohello application's identity, you must determine:</span></span>

* <span data-ttu-id="bab1e-231">Az Alkalmazásidentitás hello felhasználó Azure Active Directoryban hello objektum azonosítója</span><span class="sxs-lookup"><span data-stu-id="bab1e-231">hello object id of your application's identity in hello user's Azure Active Directory</span></span>
* <span data-ttu-id="bab1e-232">hello RBAC szerepkörhöz tartozik, amely az alkalmazás által igényelt hello előfizetésben hello azonosítója</span><span class="sxs-lookup"><span data-stu-id="bab1e-232">hello identifier of hello RBAC role that your application requires on hello subscription</span></span>

<span data-ttu-id="bab1e-233">Az alkalmazás hitelesíti a felhasználót az Azure AD-ből, ha azt hoz létre egyszerű az alkalmazáshoz, hogy az Azure AD-ben.</span><span class="sxs-lookup"><span data-stu-id="bab1e-233">When your application authenticates a user from an Azure AD, it creates a service principal object for your application in that Azure AD.</span></span> <span data-ttu-id="bab1e-234">Azure lehetővé teszi, hogy az RBAC-szerepkörök toobe hozzárendelt tooservice rendszerbiztonsági tagok toogrant közvetlen hozzáférést toocorresponding alkalmazások az Azure-erőforrások.</span><span class="sxs-lookup"><span data-stu-id="bab1e-234">Azure allows RBAC roles toobe assigned tooservice principals toogrant direct access toocorresponding applications on Azure resources.</span></span> <span data-ttu-id="bab1e-235">Erre akkor pontosan mit toodo jelenítsük.</span><span class="sxs-lookup"><span data-stu-id="bab1e-235">This action is exactly what we wish toodo.</span></span> <span data-ttu-id="bab1e-236">Lekérdezés hello Azure AD Graph API toodetermine hello azonosítója hello szolgáltatás egyszerű hello bejelentkezett felhasználó az alkalmazás csomagazonosítóját az Azure AD.</span><span class="sxs-lookup"><span data-stu-id="bab1e-236">Query hello Azure AD Graph API toodetermine hello identifier of hello service principal of your application in hello signed-in user's Azure AD.</span></span>

<span data-ttu-id="bab1e-237">Csak akkor kell egy hozzáférési jogkivonatot az Azure Resource Manager - egy új hozzáférési jogkivonat toocall hello Azure AD Graph API van szüksége.</span><span class="sxs-lookup"><span data-stu-id="bab1e-237">You only have an access token for Azure Resource Manager - you need a new access token toocall hello Azure AD Graph API.</span></span> <span data-ttu-id="bab1e-238">Azure AD-ben minden egyes alkalmazás rendelkezik engedéllyel tooquery saját szolgáltatás elsődleges objektumot, így csak alkalmazás-hozzáférési tokent is elegendő.</span><span class="sxs-lookup"><span data-stu-id="bab1e-238">Every application in Azure AD has permission tooquery its own service principal object, so an app-only access token is sufficient.</span></span>

<a id="app-azure-ad-graph" />

### <a name="get-app-only-access-token-for-azure-ad-graph-api"></a><span data-ttu-id="bab1e-239">Szerezze be a csak alkalmazás-hozzáférési tokent az Azure AD Graph API</span><span class="sxs-lookup"><span data-stu-id="bab1e-239">Get app-only access token for Azure AD Graph API</span></span>
<span data-ttu-id="bab1e-240">tooauthenticate alkalmazása és egy jogkivonat tooAzure AD Graph API, get ki egy ügyfél-hitelesítő adat Grant OAuth2.0 folyamat jogkivonatkérelem tooAzure AD jogkivonat végpontjához (**https://login.microsoftonline.com/ {directory_domain_name} / OAuth2/Token**).</span><span class="sxs-lookup"><span data-stu-id="bab1e-240">tooauthenticate your app and get a token tooAzure AD Graph API, issue a Client Credential Grant OAuth2.0 flow token request tooAzure AD token endpoint (**https://login.microsoftonline.com/{directory_domain_name}/OAuth2/Token**).</span></span>

<span data-ttu-id="bab1e-241">Hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) metódus hello ASP.net MVC mintaalkalmazás csak alkalmazás hozzáférjen a Graph API a jogkivonat lekérdezi az Active Directory Authentication Library .NET hello.</span><span class="sxs-lookup"><span data-stu-id="bab1e-241">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) method of hello ASP.net MVC sample application gets an app-only access token for Graph API using hello Active Directory Authentication Library for .NET.</span></span>

<span data-ttu-id="bab1e-242">hello lekérdezési karakterlánc paraméterek érhetők el ehhez a kérelemhez ismerteti a hello [kérelem egy hozzáférési jogkivonat](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) témakör.</span><span class="sxs-lookup"><span data-stu-id="bab1e-242">hello query string parameters that are available for this request are described in hello [Request an Access Token](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) topic.</span></span>

<span data-ttu-id="bab1e-243">Egy példa egy kérelem ügyfél-hitelesítési jogkivonat engedélyezése:</span><span class="sxs-lookup"><span data-stu-id="bab1e-243">An example request for client credential grant token:</span></span>

    POST https://login.microsoftonline.com/62e173e9-301e-423e-bcd4-29121ec1aa24/oauth2/token HTTP/1.1
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 187</pre>
    <pre>grant_type=client_credentials&client_id=a0448380-c346-4f9f-b897-c18733de9394&resource=https%3A%2F%2Fgraph.windows.net%2F &client_secret=olna8C*****Og%3D

<span data-ttu-id="bab1e-244">Egy példa egy válasz ügyfél-hitelesítési jogkivonat engedélyezése:</span><span class="sxs-lookup"><span data-stu-id="bab1e-244">An example response for client credential grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039862","not_before":"1432035962","resource":"https://graph.windows.net/","access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRv****G5gUTV-kKorR-pg"}

### <a name="get-objectid-of-application-service-principal-in-user-azure-ad"></a><span data-ttu-id="bab1e-245">A felhasználó az Azure AD az alkalmazás egyszerű ObjectId beolvasása</span><span class="sxs-lookup"><span data-stu-id="bab1e-245">Get ObjectId of application service principal in user Azure AD</span></span>
<span data-ttu-id="bab1e-246">Most, használja a hello csak alkalmazás-hozzáférési jogkivonat tooquery hello [Azure AD Graph Szolgáltatásnevekről](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API toodetermine hello hello alkalmazás egyszerű hello könyvtárban objektumazonosítója.</span><span class="sxs-lookup"><span data-stu-id="bab1e-246">Now, use hello app-only access token tooquery hello [Azure AD Graph Service Principals](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API toodetermine hello Object Id of hello application's service principal in hello directory.</span></span>

<span data-ttu-id="bab1e-247">Hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) hello ASP.net MVC mintaalkalmazás metódusában valósítja meg a hívás.</span><span class="sxs-lookup"><span data-stu-id="bab1e-247">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) method of hello ASP.net MVC sample application implements this call.</span></span>

<span data-ttu-id="bab1e-248">a következő példa azt mutatja meg hogyan hello toorequest egy alkalmazás egyszerű.</span><span class="sxs-lookup"><span data-stu-id="bab1e-248">hello following example shows how toorequest an application's service principal.</span></span> <span data-ttu-id="bab1e-249">a0448380-c346-4f9f-b897-c18733de9394 hello alkalmazás ügyfélazonosítója hello.</span><span class="sxs-lookup"><span data-stu-id="bab1e-249">a0448380-c346-4f9f-b897-c18733de9394 is hello client id of hello application.</span></span>

    GET https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/servicePrincipals?api-version=1.5&$filter=appId%20eq%20'a0448380-c346-4f9f-b897-c18733de9394' HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJK*****-kKorR-pg

<span data-ttu-id="bab1e-250">hello alábbi példa azt mutatja az alkalmazás szolgáltatási választ toohello kérelmet egyszerű</span><span class="sxs-lookup"><span data-stu-id="bab1e-250">hello following example shows a response toohello request for an application's service principal</span></span>

    HTTP/1.1 200 OK

    {"odata.metadata":"https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/$metadata#directoryObjects/Microsoft.DirectoryServices.ServicePrincipal","value":[{"odata.type":"Microsoft.DirectoryServices.ServicePrincipal","objectType":"ServicePrincipal","objectId":"9b5018d4-6951-42ed-8a92-f11ec283ccec","deletionTimestamp":null,"accountEnabled":true,"appDisplayName":"CloudSense","appId":"a0448380-c346-4f9f-b897-c18733de9394","appOwnerTenantId":"62e173e9-301e-423e-bcd4-29121ec1aa24","appRoleAssignmentRequired":false,"appRoles":[],"displayName":"CloudSense","errorUrl":null,"homepage":"http://www.vipswapper.com/cloudsense","keyCredentials":[],"logoutUrl":null,"oauth2Permissions":[{"adminConsentDescription":"Allow hello application tooaccess CloudSense on behalf of hello signed-in user.","adminConsentDisplayName":"Access CloudSense","id":"b7b7338e-683a-4796-b95e-60c10380de1c","isEnabled":true,"type":"User","userConsentDescription":"Allow hello application tooaccess CloudSense on your behalf.","userConsentDisplayName":"Access CloudSense","value":"user_impersonation"}],"passwordCredentials":[],"preferredTokenSigningKeyThumbprint":null,"publisherName":"vipswapper"quot;,"replyUrls":["http://www.vipswapper.com/cloudsense","http://www.vipswapper.com","http://vipswapper.com","http://vipswapper.azurewebsites.net","http://localhost:62080"],"samlMetadataUrl":null,"servicePrincipalNames":["http://www.vipswapper.com/cloudsense","a0448380-c346-4f9f-b897-c18733de9394"],"tags":["WindowsAzureActiveDirectoryIntegratedApp"]}]}

### <a name="get-azure-rbac-role-identifier"></a><span data-ttu-id="bab1e-251">Azure RBAC szerepkör-azonosító lekérése</span><span class="sxs-lookup"><span data-stu-id="bab1e-251">Get Azure RBAC role identifier</span></span>
<span data-ttu-id="bab1e-252">tooassign hello megfelelő RBAC szerepkör tooyour egyszerű szolgáltatásnév, meg kell határoznia hello Azure RBAC szerepkör hello azonosítója.</span><span class="sxs-lookup"><span data-stu-id="bab1e-252">tooassign hello appropriate RBAC role tooyour service principal, you must determine hello identifier of hello Azure RBAC role.</span></span>

<span data-ttu-id="bab1e-253">hello megfelelő RBAC szerepkört az alkalmazáshoz:</span><span class="sxs-lookup"><span data-stu-id="bab1e-253">hello right RBAC role for your application:</span></span>

* <span data-ttu-id="bab1e-254">Ha az alkalmazás csak figyeli hello előfizetés, változtatások nélkül, hello előfizetés csak olvasási engedélyre van szükség.</span><span class="sxs-lookup"><span data-stu-id="bab1e-254">If your application only monitors hello subscription, without making any changes, it requires only reader permissions on hello subscription.</span></span> <span data-ttu-id="bab1e-255">Rendelje hozzá a hello **olvasó** szerepkör.</span><span class="sxs-lookup"><span data-stu-id="bab1e-255">Assign hello **Reader** role.</span></span>
* <span data-ttu-id="bab1e-256">Ha az alkalmazás kezeli az Azure hello előfizetés, entitások létrehozása/módosítása vagy törlése egyikét igényli hello közreműködői engedélyekkel.</span><span class="sxs-lookup"><span data-stu-id="bab1e-256">If your application manages Azure hello subscription, creating/modifying/deleting entities, it requires one of hello contributor permissions.</span></span>
  * <span data-ttu-id="bab1e-257">toomanage egy adott típusú erőforrás, rendeljen hello erőforrás-specifikus közreműködői szerepkört (virtuális gép közreműködő, virtuális hálózat közreműködő, tárolási fiók közreműködői, stb.)</span><span class="sxs-lookup"><span data-stu-id="bab1e-257">toomanage a particular type of resource, assign hello resource-specific contributor roles (Virtual Machine Contributor, Virtual Network Contributor, Storage Account Contributor, etc.)</span></span>
  * <span data-ttu-id="bab1e-258">toomanage minden erőforrástípus, hozzárendelése hello **közreműködő** szerepkör.</span><span class="sxs-lookup"><span data-stu-id="bab1e-258">toomanage any resource type, assign hello **Contributor** role.</span></span>

<span data-ttu-id="bab1e-259">az alkalmazás szerepkör-hozzárendelés hello látható toousers, így a Válasszon hello legkevesebb szükséges jogosultsággal.</span><span class="sxs-lookup"><span data-stu-id="bab1e-259">hello role assignment for your application is visible toousers, so select hello least-required privilege.</span></span>

<span data-ttu-id="bab1e-260">Hello hívás [erőforrás-kezelő szerepkör-definíció API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) Azure RBAC-szerepkörök és a keresési majd ismétlés hello eredmény toofind hello toolist szükséges szerepkör-definíció neve.</span><span class="sxs-lookup"><span data-stu-id="bab1e-260">Call hello [Resource Manager role definition API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist all Azure RBAC roles and search then iterate over hello result toofind hello desired role definition by name.</span></span>

<span data-ttu-id="bab1e-261">Hello [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) hello ASP.net MVC mintaalkalmazás metódusában valósítja meg a hívás.</span><span class="sxs-lookup"><span data-stu-id="bab1e-261">hello [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="bab1e-262">hello következő kérelem példa azt mutatja meg, hogyan tooget Azure RBAC szerepkör-azonosító.</span><span class="sxs-lookup"><span data-stu-id="bab1e-262">hello following request example shows how tooget Azure RBAC role identifier.</span></span> <span data-ttu-id="bab1e-263">a rendszer hello azonosítóját hello előfizetés 09cbd307-aa71-4aca-b346-5f253e6e3ebb.</span><span class="sxs-lookup"><span data-stu-id="bab1e-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV*****fY2lGc5

<span data-ttu-id="bab1e-264">hello válasz hello a következő formátumban kell megadni:</span><span class="sxs-lookup"><span data-stu-id="bab1e-264">hello response is in hello following format:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"properties":{"roleName":"API Management Service Contributor","type":"BuiltInRole","description":"Lets you manage API Management services, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.ApiManagement/Services/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/312a565d-c81f-4fd8-895a-4e21e48d571c","type":"Microsoft.Authorization/roleDefinitions","name":"312a565d-c81f-4fd8-895a-4e21e48d571c"},{"properties":{"roleName":"Application Insights Component Contributor","type":"BuiltInRole","description":"Lets you manage Application Insights components, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.Insights/components/*","Microsoft.Insights/webtests/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/ae349356-3a1b-4a5e-921d-050484c6347e","type":"Microsoft.Authorization/roleDefinitions","name":"ae349356-3a1b-4a5e-921d-050484c6347e"}]}

<span data-ttu-id="bab1e-265">Toocall helyezni az API nem kell.</span><span class="sxs-lookup"><span data-stu-id="bab1e-265">You do not need toocall this API on an ongoing basis.</span></span> <span data-ttu-id="bab1e-266">Miután meghatározta hello jól ismert GUID-hello szerepkör-definíció, hogyan hozhat létre, hello szerepkör-definíció azonosítója:</span><span class="sxs-lookup"><span data-stu-id="bab1e-266">Once you've determined hello well-known GUID of hello role definition, you can construct hello role definition id as:</span></span>

    /subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{well-known-role-guid}

<span data-ttu-id="bab1e-267">Az alábbiakban a gyakran használt beépített szerepkörök hello jól ismert azonosítóját:</span><span class="sxs-lookup"><span data-stu-id="bab1e-267">Here are hello well-known guids of commonly used built-in roles:</span></span>

| <span data-ttu-id="bab1e-268">Szerepkör</span><span class="sxs-lookup"><span data-stu-id="bab1e-268">Role</span></span> | <span data-ttu-id="bab1e-269">GUID</span><span class="sxs-lookup"><span data-stu-id="bab1e-269">Guid</span></span> |
| --- | --- |
| <span data-ttu-id="bab1e-270">Olvasó</span><span class="sxs-lookup"><span data-stu-id="bab1e-270">Reader</span></span> |<span data-ttu-id="bab1e-271">acdd72a7-3385-48EF-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="bab1e-271">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |
| <span data-ttu-id="bab1e-272">Közreműködő</span><span class="sxs-lookup"><span data-stu-id="bab1e-272">Contributor</span></span> |<span data-ttu-id="bab1e-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span><span class="sxs-lookup"><span data-stu-id="bab1e-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span></span> |
| <span data-ttu-id="bab1e-274">Virtuális gép közreműködő</span><span class="sxs-lookup"><span data-stu-id="bab1e-274">Virtual Machine Contributor</span></span> |<span data-ttu-id="bab1e-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span><span class="sxs-lookup"><span data-stu-id="bab1e-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span></span> |
| <span data-ttu-id="bab1e-276">Virtuális hálózat közreműködő</span><span class="sxs-lookup"><span data-stu-id="bab1e-276">Virtual Network Contributor</span></span> |<span data-ttu-id="bab1e-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span><span class="sxs-lookup"><span data-stu-id="bab1e-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span></span> |
| <span data-ttu-id="bab1e-278">Tárolási fiók közreműködői</span><span class="sxs-lookup"><span data-stu-id="bab1e-278">Storage Account Contributor</span></span> |<span data-ttu-id="bab1e-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span><span class="sxs-lookup"><span data-stu-id="bab1e-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span></span> |
| <span data-ttu-id="bab1e-280">Webhely közreműködő</span><span class="sxs-lookup"><span data-stu-id="bab1e-280">Website Contributor</span></span> |<span data-ttu-id="bab1e-281">de139f84-1756-47ae-9be6-808fbbe84772</span><span class="sxs-lookup"><span data-stu-id="bab1e-281">de139f84-1756-47ae-9be6-808fbbe84772</span></span> |
| <span data-ttu-id="bab1e-282">Webes terv közreműködő</span><span class="sxs-lookup"><span data-stu-id="bab1e-282">Web Plan Contributor</span></span> |<span data-ttu-id="bab1e-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span><span class="sxs-lookup"><span data-stu-id="bab1e-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span></span> |
| <span data-ttu-id="bab1e-284">SQL Server közreműködő</span><span class="sxs-lookup"><span data-stu-id="bab1e-284">SQL Server Contributor</span></span> |<span data-ttu-id="bab1e-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span><span class="sxs-lookup"><span data-stu-id="bab1e-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span></span> |
| <span data-ttu-id="bab1e-286">SQL DB Contributor</span><span class="sxs-lookup"><span data-stu-id="bab1e-286">SQL DB Contributor</span></span> |<span data-ttu-id="bab1e-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span><span class="sxs-lookup"><span data-stu-id="bab1e-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span></span> |

### <a name="assign-rbac-role-tooapplication"></a><span data-ttu-id="bab1e-288">Az RBAC szerepkör tooapplication hozzárendelése</span><span class="sxs-lookup"><span data-stu-id="bab1e-288">Assign RBAC role tooapplication</span></span>
<span data-ttu-id="bab1e-289">Minden tooassign hello megfelelő RBAC szerepkör tooyour szolgáltatásnevet kell hello segítségével [erőforrás-kezelő szerepkör-hozzárendelés létrehozására](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span><span class="sxs-lookup"><span data-stu-id="bab1e-289">You have everything you need tooassign hello appropriate RBAC role tooyour service principal by using hello [Resource Manager create role assignment](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span></span>

<span data-ttu-id="bab1e-290">Hello [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) hello ASP.net MVC mintaalkalmazás metódusában valósítja meg a hívás.</span><span class="sxs-lookup"><span data-stu-id="bab1e-290">hello [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="bab1e-291">Egy példa kérelem tooassign RBAC szerepkör tooapplication:</span><span class="sxs-lookup"><span data-stu-id="bab1e-291">An example request tooassign RBAC role tooapplication:</span></span>

    PUT https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/microsoft.authorization/roleassignments/4f87261d-2816-465d-8311-70a27558df4c?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiL*****FlwO1mM7Cw6JWtfY2lGc5
    Content-Type: application/json
    Content-Length: 230

    {"properties": {"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2"}}

<span data-ttu-id="bab1e-292">Hello kérelem hello a következő értékek használhatók:</span><span class="sxs-lookup"><span data-stu-id="bab1e-292">In hello request, hello following values are used:</span></span>

| <span data-ttu-id="bab1e-293">GUID</span><span class="sxs-lookup"><span data-stu-id="bab1e-293">Guid</span></span> | <span data-ttu-id="bab1e-294">Leírás</span><span class="sxs-lookup"><span data-stu-id="bab1e-294">Description</span></span> |
| --- | --- |
| <span data-ttu-id="bab1e-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span><span class="sxs-lookup"><span data-stu-id="bab1e-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span></span> |<span data-ttu-id="bab1e-296">hello előfizetés hello azonosítója</span><span class="sxs-lookup"><span data-stu-id="bab1e-296">hello id of hello subscription</span></span> |
| <span data-ttu-id="bab1e-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span><span class="sxs-lookup"><span data-stu-id="bab1e-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span></span> |<span data-ttu-id="bab1e-298">hello szolgáltatás egyszerű hello alkalmazás hello objektum azonosítója</span><span class="sxs-lookup"><span data-stu-id="bab1e-298">hello object id of hello service principal of hello application</span></span> |
| <span data-ttu-id="bab1e-299">acdd72a7-3385-48EF-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="bab1e-299">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |<span data-ttu-id="bab1e-300">hello olvasó szerepkört hello azonosítója</span><span class="sxs-lookup"><span data-stu-id="bab1e-300">hello id of hello reader role</span></span> |
| <span data-ttu-id="bab1e-301">4f87261d-2816-465d-8311-70a27558df4c</span><span class="sxs-lookup"><span data-stu-id="bab1e-301">4f87261d-2816-465d-8311-70a27558df4c</span></span> |<span data-ttu-id="bab1e-302">egy új guid hello új szerepkör-hozzárendelés létrehozása</span><span class="sxs-lookup"><span data-stu-id="bab1e-302">a new guid created for hello new role assignment</span></span> |

<span data-ttu-id="bab1e-303">hello válasz hello a következő formátumban kell megadni:</span><span class="sxs-lookup"><span data-stu-id="bab1e-303">hello response is in hello following format:</span></span>

    HTTP/1.1 201 Created

    {"properties":{"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2","scope":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb"},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleAssignments/4f87261d-2816-465d-8311-70a27558df4c","type":"Microsoft.Authorization/roleAssignments","name":"4f87261d-2816-465d-8311-70a27558df4c"}

### <a name="get-app-only-access-token-for-azure-resource-manager"></a><span data-ttu-id="bab1e-304">Szerezze be a csak alkalmazás-hozzáférési tokent az Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="bab1e-304">Get app-only access token for Azure Resource Manager</span></span>
<span data-ttu-id="bab1e-305">toovalidate az alkalmazás hello szükséges hozzáféréssel rendelkezzen a hello előfizetés, a vizsgálati művelet végrehajtásához a hello előfizetés csak alkalmazás token használatával.</span><span class="sxs-lookup"><span data-stu-id="bab1e-305">toovalidate that app has hello desired access on hello subscription, perform a test task on hello subscription using an app-only token.</span></span>

<span data-ttu-id="bab1e-306">tooget csak alkalmazás-hozzáférési tokent, kövesse az utasításokat szakaszából [csak alkalmazás-token beszerzése az Azure AD Graph API](#app-azure-ad-graph), egy másik érték megadásával hello erőforrás paraméter:</span><span class="sxs-lookup"><span data-stu-id="bab1e-306">tooget an app-only access token, follow instructions from section [Get app-only access token for Azure AD Graph API](#app-azure-ad-graph), with a different value for hello resource parameter:</span></span>

    https://management.core.windows.net/

<span data-ttu-id="bab1e-307">Hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) metódus hello ASP.NET MVC mintaalkalmazás csak alkalmazás hozzáférés az Azure Resource Manager használatával token lekérdezi az Active Directory Authentication Library .net hello.</span><span class="sxs-lookup"><span data-stu-id="bab1e-307">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample application gets an app-only access token for Azure Resource Manager using hello Active Directory Authentication Library for .net.</span></span>

#### <a name="get-applications-permissions-on-subscription"></a><span data-ttu-id="bab1e-308">Az alkalmazás engedélyeket szerezni az előfizetésben</span><span class="sxs-lookup"><span data-stu-id="bab1e-308">Get Application's Permissions on Subscription</span></span>
<span data-ttu-id="bab1e-309">amely az alkalmazás rendelkezik hello toocheck szükséges hozzáférés az Azure-előfizetéssel, akkor is hívhat hello [erőforrás-kezelő engedélyei](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span><span class="sxs-lookup"><span data-stu-id="bab1e-309">toocheck that your application has hello desired access on an Azure subscription, you may also call hello [Resource Manager Permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span></span> <span data-ttu-id="bab1e-310">Ezt a módszert akkor határozza meg, hogy hello felhasználó rendelkezik-e a hozzáférés-kezelés jogosultságokkal hello előfizetés hasonló toohow.</span><span class="sxs-lookup"><span data-stu-id="bab1e-310">This approach is similar toohow you determined whether hello user has Access Management rights for hello subscription.</span></span> <span data-ttu-id="bab1e-311">Azonban a megadott idő hello engedélyek API hello csak alkalmazás jogkivonattal, hogy az előző lépésben hello hívható.</span><span class="sxs-lookup"><span data-stu-id="bab1e-311">However, this time, call hello permissions API with hello app-only access token that you received in hello previous step.</span></span>

<span data-ttu-id="bab1e-312">Hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) hello ASP.NET MVC mintaalkalmazás metódusában valósítja meg a hívás.</span><span class="sxs-lookup"><span data-stu-id="bab1e-312">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample app implements this call.</span></span>

## <a name="manage-connected-subscriptions"></a><span data-ttu-id="bab1e-313">Csatlakoztatott előfizetések kezelése</span><span class="sxs-lookup"><span data-stu-id="bab1e-313">Manage connected subscriptions</span></span>
<span data-ttu-id="bab1e-314">Hello megfelelő RBAC szerepkör hozzárendelése tooyour alkalmazás egyszerű hello előfizetés esetén az alkalmazás is tartsa figyelés vagy kezelése csak alkalmazás-hozzáférési jogkivonatok segítségével csatlakozzon az Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="bab1e-314">When hello appropriate RBAC role is assigned tooyour application's service principal on hello subscription, your application can keep monitoring/managing it using app-only access tokens for Azure Resource Manager.</span></span>

<span data-ttu-id="bab1e-315">Ha egy előfizetés tulajdonosa eltávolítja az alkalmazás szerepkör-hozzárendelés hello klasszikus portál vagy a parancssori eszközök, az alkalmazás használatával az adott előfizetéshez nem képesek tooaccess.</span><span class="sxs-lookup"><span data-stu-id="bab1e-315">If a subscription owner removes your application's role assignment using hello classic portal or command-line tools, your application is no longer able tooaccess that subscription.</span></span> <span data-ttu-id="bab1e-316">Ebben az esetben kell, hogy a külső hello alkalmazásból megszakadt hello kapcsolat hello előfizetéssel hello felhasználó értesítése, és számukra beállítás túl "javítás" hello kapcsolat.</span><span class="sxs-lookup"><span data-stu-id="bab1e-316">In that case, you should notify hello user that hello connection with hello subscription was severed from outside hello application and give them an option too"repair" hello connection.</span></span> <span data-ttu-id="bab1e-317">"Javítás" egyszerűen csak akkor hozza létre hello szerepkör-hozzárendelés offline törölve lett.</span><span class="sxs-lookup"><span data-stu-id="bab1e-317">"Repair" would simply re-create hello role assignment that was deleted offline.</span></span>

<span data-ttu-id="bab1e-318">Hello felhasználói tooconnect előfizetések tooyour alkalmazás engedélyezve van, mint engedélyeznie kell a hello felhasználói toodisconnect előfizetések túl.</span><span class="sxs-lookup"><span data-stu-id="bab1e-318">Just as you enabled hello user tooconnect subscriptions tooyour application, you must allow hello user toodisconnect subscriptions too.</span></span> <span data-ttu-id="bab1e-319">Az access felügyeleti szempontból válassza le azt jelenti, amely rendelkezik egy hello alkalmazás egyszerű szolgáltatásnév hello előfizetés hello szerepkör-hozzárendelés eltávolítása.</span><span class="sxs-lookup"><span data-stu-id="bab1e-319">From an access management point of view, disconnect means removing hello role assignment that hello application's service principal has on hello subscription.</span></span> <span data-ttu-id="bab1e-320">Másik lehetőségként olyan állapotokat hello előfizetés hello alkalmazásban előfordulhat, hogy el kell távolítani túl.</span><span class="sxs-lookup"><span data-stu-id="bab1e-320">Optionally, any state in hello application for hello subscription might be removed too.</span></span>
<span data-ttu-id="bab1e-321">Csak a hello előfizetésben felügyeleti engedéllyel rendelkező felhasználók is képes toodisconnect hello előfizetés.</span><span class="sxs-lookup"><span data-stu-id="bab1e-321">Only users with access management permission on hello subscription are able toodisconnect hello subscription.</span></span>

<span data-ttu-id="bab1e-322">Hello [RevokeRoleFromServicePrincipalOnSubscription metódus](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) az ASP.net MVC hello mintaalkalmazás valósítja meg a hívás.</span><span class="sxs-lookup"><span data-stu-id="bab1e-322">hello [RevokeRoleFromServicePrincipalOnSubscription method](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="bab1e-323">Ennyi az egész – a felhasználók most már egyszerűen csatlakozhat, és kezelheti az Azure-előfizetések az alkalmazással.</span><span class="sxs-lookup"><span data-stu-id="bab1e-323">That's it - users can now easily connect and manage their Azure subscriptions with your application.</span></span>
