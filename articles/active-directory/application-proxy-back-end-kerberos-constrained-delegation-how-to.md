---
title: "Az alkalmazásproxy alkalmazás toouse Kerberos által korlátozott delegálás aaaHow tooconfigure |} Microsoft Docs"
description: "Hogyan tooconfigure Kerberos által korlátozott delegálás az Azure AD alkalmazásproxy alkalmazáshoz."
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 93dac264ff1d3b99dead1d9c759c37c59373cbd4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-an-application-proxy-application-toouse-kerberos-constrained-delegation"></a><span data-ttu-id="dd242-103">Hogyan tooconfigure az alkalmazásproxy alkalmazás toouse Kerberos által korlátozott delegálás</span><span class="sxs-lookup"><span data-stu-id="dd242-103">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>

<span data-ttu-id="dd242-104">hello módszer áll rendelkezésre elérése érdekében az alkalmazások némileg eltérőek lehetnek az alkalmazás tooapplication és, hogy Azure Application Proxy kínál hello kezdő verzióról jobb hello lehetőségek közül SSO toopublished a Kerberos által korlátozott delegálás (KCD).</span><span class="sxs-lookup"><span data-stu-id="dd242-104">hello methods available for achieving SSO toopublished applications can somewhat vary from application tooapplication and one of hello options that Azure Application Proxy offers right out of hello box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="dd242-105">Ez az összekötő állomás esetén korlátozott konfigurált tooperform kerberos hitelesítési toobackend alkalmazások, felhasználók nevében.</span><span class="sxs-lookup"><span data-stu-id="dd242-105">This is where a connector host is configured tooperform constrained kerberos authentication toobackend applications, on behalf of users.</span></span>

<span data-ttu-id="dd242-106">hello tényleges eljárás a Kerberos által korlátozott Delegálás engedélyezéséhez viszonylag egyszerű, és általában a különböző összetevőkkel és hitelesítési folyamat, amely elősegíti a SSO igényelnek nem több, mint egy általános hello megértése.</span><span class="sxs-lookup"><span data-stu-id="dd242-106">hello actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of hello various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="dd242-107">Keresés, ahol Kerberos által korlátozott Delegálás SSO nem működik megfelelően, információkat toohelp jó forrásai elhárításában, ritka lehet.</span><span class="sxs-lookup"><span data-stu-id="dd242-107">Finding good sources of information toohelp troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="dd242-108">Ez a cikk, próbálja meg tooprovide egyetlen pont, hibaelhárításához és önálló javítása néhány hello leggyakoribb problémák látható segítségül hivatkozással.</span><span class="sxs-lookup"><span data-stu-id="dd242-108">As such, this article attempts tooprovide a single point of reference that should help troubleshoot and self-remediate some of hello most common issues that we see.</span></span> <span data-ttu-id="dd242-109">Hello azonos idő ajánlat további útmutatás t talál diagnosztizálása összetettebb hello és törlesztett végrehajtás.</span><span class="sxs-lookup"><span data-stu-id="dd242-109">At hello same time offer additional guidance for diagnosing hello more complex and troubled of implementation.</span></span>

<span data-ttu-id="dd242-110">Vegye figyelembe, hogy ez a cikk lehetővé teszi a következő feltételek hello:</span><span class="sxs-lookup"><span data-stu-id="dd242-110">note that this article makes hello following assumptions:</span></span>

-   <span data-ttu-id="dd242-111">Azure-alkalmazásproxy megfelelően van telepítve a [dokumentáció](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) és általános toonon Kerberos által korlátozott Delegálás alkalmazásokat a várt módon működik.</span><span class="sxs-lookup"><span data-stu-id="dd242-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access toonon KCD applications is working as expected.</span></span>

-   <span data-ttu-id="dd242-112">hello közzétett célalkalmazás alapul kerberos IIS és a Microsoft végrehajtását.</span><span class="sxs-lookup"><span data-stu-id="dd242-112">hello published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="dd242-113">hello kiszolgáló és az alkalmazás állomások egyetlen Active Directory-tartományban találhatók.</span><span class="sxs-lookup"><span data-stu-id="dd242-113">hello server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="dd242-114">Részletes tájékoztatást közötti tartományok és erdők forgatókönyvek megtalálhatók a [Kerberos által korlátozott Delegálás tanulmány](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="dd242-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="dd242-115">hello tulajdonos alkalmazás közzé van téve egy Azure-ban bérlői előtti hitelesítés engedélyezve van, és a felhasználók-azonosítóknak tooauthenticate tooAzure keresztül űrlap alapú hitelesítés.</span><span class="sxs-lookup"><span data-stu-id="dd242-115">hello subject application is published in an Azure tenant with pre-authentication enabled, and users are expected tooauthenticate tooAzure via forms based authentication.</span></span> <span data-ttu-id="dd242-116">Gazdag ügyfél-hitelesítési forgatókönyvei nem vonatkozik ez a cikk, de a jövőbeli hello bármikor hozzáadni.</span><span class="sxs-lookup"><span data-stu-id="dd242-116">Rich client authentication scenarios are not covered by this article, but be added at some point in hello future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="dd242-117">Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="dd242-117">Prerequisites</span></span>

<span data-ttu-id="dd242-118">Azure-alkalmazásproxy is telepíthető az infrastruktúra lényegében bármilyen típusú, vagy a környezet és hello architektúrák minden bizonnyal szervezet tooorganization eltérőek lehetnek.</span><span class="sxs-lookup"><span data-stu-id="dd242-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and hello architectures no doubt vary from organization tooorganization.</span></span> <span data-ttu-id="dd242-119">Egyik leggyakoribb oka hello Kerberos által korlátozott Delegálás kapcsolatos problémák nem hello környezetekben, de meglehetősen egyszerű hibás konfigurációt vagy általános felügyeletet.</span><span class="sxs-lookup"><span data-stu-id="dd242-119">One of hello most common causes of KCD related issues are not hello environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="dd242-120">Ezért azt tanácsoljuk, mindig toostart annak biztosítása, hogy teljesül-összes hello Előfeltételek jelenjen meg a fő szerint [Kerberos által korlátozott Delegálás egyszeri bejelentkezés használatával hello alkalmazásproxy cikk](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) elindítása előtt a hibaelhárítás.</span><span class="sxs-lookup"><span data-stu-id="dd242-120">For this reason, our advice is always toostart by making sure you have met all hello pre-requisites laid out in our main [Using KCD SSO with hello Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="dd242-121">Különösen hello fejezet foglalkozik a Kerberos által korlátozott Delegálás konfigurálása 2012R2, mivel ez alkalmazza az előző verziók Windows de ugyanakkor számos egyéb szempontot szem előtt tartva nem alapvetően más megközelítést tooconfiguring Kerberos által korlátozott Delegálás:</span><span class="sxs-lookup"><span data-stu-id="dd242-121">Particularly hello section on configuring KCD on 2012R2, as this employs a fundamentally different approach tooconfiguring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="dd242-122">A rendszer nem ritka, hogy az egy tartomány tagja server tooopen egy adott tartományvezérlőt egy biztonságos csatorna párbeszédpanelen.</span><span class="sxs-lookup"><span data-stu-id="dd242-122">It is not uncommon for a domain member server tooopen a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="dd242-123">Ezután lépjen tooanother párbeszédpanel egy adott időpontban, így összekötő állomások általában nem szabad korlátozott toobeing képes toocommunicate csak adott helyi hely tartományvezérlők a.</span><span class="sxs-lookup"><span data-stu-id="dd242-123">Then move tooanother dialog at any given time, so connector hosts should generally not be restricted toobeing able toocommunicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="dd242-124">Pont fölött hasonló toohello tartományok közötti forgatókönyvek, amelyek egy összekötő állomás tooDCs hello helyi hálózati szegélyhálózati kívül található közvetlen átirányítások támaszkodnak.</span><span class="sxs-lookup"><span data-stu-id="dd242-124">Similar toohello above point, cross domain scenarios rely on referrals that direct a connector host tooDCs that may reside outside of hello local network perimeter.</span></span> <span data-ttu-id="dd242-125">Ebben a forgatókönyvben egyaránt van arra is engedélyezi a forgalom és újabb verziók esetében, amelyek megfelelnek a más megfelelő tartományokban, ellenkező esetben delegálás tooDCs fontos toomake sikertelen.</span><span class="sxs-lookup"><span data-stu-id="dd242-125">In this scenario it is equally important toomake sure you are also allowing traffic onwards tooDCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="dd242-126">Ahol lehetséges, lehetőleg ne tároljon minden aktív IP-CÍMEK/Azonosítók eszközök közötti összekötő gazdagépek és -tartományvezérlő, mivel azok néha keresztül zavaró és zavarják a core keresztüli RPC-adatforgalmat</span><span class="sxs-lookup"><span data-stu-id="dd242-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="dd242-127">Mint amennyit szeretnénk tooresolve problémák gyors és hatékony, időbe telhet, ezért lehetőség szerint érdemes próbálja és a delegálás a legegyszerűbb forgatókönyvek hello.</span><span class="sxs-lookup"><span data-stu-id="dd242-127">As much as we’d like tooresolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in hello simplest of scenarios.</span></span> <span data-ttu-id="dd242-128">hello alkalmazná több változót, hello több előfordulhat, hogy a toocontend.</span><span class="sxs-lookup"><span data-stu-id="dd242-128">hello more variables you introduce, hello more you may have toocontend with.</span></span> <span data-ttu-id="dd242-129">Például korlátozza a tesztelési tooa egyetlen összekötőt időt takaríthat meg értékes, és további összekötők hello problémák megoldása után lehet hozzáadni.</span><span class="sxs-lookup"><span data-stu-id="dd242-129">For example, limiting your testing tooa single connector can save valuable time, and additional connectors can be added after hello issues has been resolved.</span></span>

<span data-ttu-id="dd242-130">Néhány környezeti tényezők is eredményezhetnek tooan probléma újra, ha lehetséges próbálja és hello architektúra tooa operációs rendszer minimális tesztelési minimalizálása érdekében.</span><span class="sxs-lookup"><span data-stu-id="dd242-130">Some environmental factors may also be contributing tooan issue, so again if possible try and minimize hello architecture tooa bare minimum for testing.</span></span> <span data-ttu-id="dd242-131">Például helytelenül konfigurált belső tűzfal hozzáférés-vezérlési listák nem ritka, ezért lehetőség van egy összekötő rögtön keresztül toohello tartományvezérlők és a háttéralkalmazás engedélyezett származó összes forgalmat.</span><span class="sxs-lookup"><span data-stu-id="dd242-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through toohello DCs and backend application.</span></span> 

<span data-ttu-id="dd242-132">Hello abszolút legjobb hely tooposition összekötők ténylegesen lehet legközelebb tootheir célok.</span><span class="sxs-lookup"><span data-stu-id="dd242-132">Actually hello absolute best place tooposition connectors is as close tootheir targets as can be.</span></span> <span data-ttu-id="dd242-133">Egy kép tűzfal beágyazott Bár a tesztelés egyszerűen hozzáadja a szükségtelen összetettségét, és csak sikerült meghosszabbítani a vizsgálatok.</span><span class="sxs-lookup"><span data-stu-id="dd242-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="dd242-134">Igen milyen számít Kerberos által korlátozott Delegálás probléma ennek ellenére?</span><span class="sxs-lookup"><span data-stu-id="dd242-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="dd242-135">Jól nincs több klasszikus jelzésének hibás és hello első jelentkezik a probléma általában manifest magukat a Kerberos által korlátozott Delegálás SSO hello böngésző.</span><span class="sxs-lookup"><span data-stu-id="dd242-135">Well, there several classic indications of KCD SSO failing and hello first signs of an issue usually manifest themselves in hello browser.</span></span>

   ![Helytelen a Kerberos által korlátozott konfigurációs hiba](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Engedélyezési toomissing engedélyek miatt sikertelen volt](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="dd242-138">felhasználói hozzáférés toohello alkalmazás összes viselniük hello tooperform SSO sikertelenek lesznek, és ezért elutasítja az azonos tünete hello.</span><span class="sxs-lookup"><span data-stu-id="dd242-138">all which bear hello same symptom of failing tooperform SSO, and consequently denying hello user access toohello application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="dd242-139">Hibaelhárítás</span><span class="sxs-lookup"><span data-stu-id="dd242-139">Troubleshooting</span></span>

<span data-ttu-id="dd242-140">Hogyan majd hibaelhárítása hello probléma és a megfigyelt jelenségek függenek.</span><span class="sxs-lookup"><span data-stu-id="dd242-140">How you then troubleshoot depend on hello issue and observed symptoms.</span></span> <span data-ttu-id="dd242-141">Előtt fog minden további volna javasoljuk, hogy a következő hivatkozások, hello nem még rendelkezik olyan hasznos információkat tartalmaznak, mint:</span><span class="sxs-lookup"><span data-stu-id="dd242-141">Before going any further we would suggest hello following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="dd242-142">Alkalmazásproxy problémák és hibaüzenetek hibaelhárítása</span><span class="sxs-lookup"><span data-stu-id="dd242-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="dd242-143">Kerberos-hibákhoz, és a jelenség</span><span class="sxs-lookup"><span data-stu-id="dd242-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="dd242-144">Egyszeri bejelentkezési modellel működik ha helyszíni és felhőalapú Identitások nem azonosak.</span><span class="sxs-lookup"><span data-stu-id="dd242-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="dd242-145">Ha ez sokkal, majd hello fő probléma mindenképpen létezik.</span><span class="sxs-lookup"><span data-stu-id="dd242-145">If you’ve got this far, then hello main issue definitely exists.</span></span> <span data-ttu-id="dd242-146">Szüksége toodig mélyebb, ezért először hello folyamat három különböző szakaszokat elháríthatja az elválasztó.</span><span class="sxs-lookup"><span data-stu-id="dd242-146">You need toodig deeper, so start by separating hello flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="dd242-147">**Ügyfelek előhitelesítése** -hello külső felhasználó hitelesítéséhez tooAzure böngésző használatával.</span><span class="sxs-lookup"><span data-stu-id="dd242-147">**Client pre-authentication** - hello external user authenticating tooAzure via a browser.</span></span>

<span data-ttu-id="dd242-148">Képes toopre alatt-hitelesítéshez tooAzure elengedhetetlen a Kerberos által korlátozott Delegálás SSO toofunction.</span><span class="sxs-lookup"><span data-stu-id="dd242-148">Being able toopre-authenticate tooAzure is imperative for KCD SSO toofunction.</span></span> <span data-ttu-id="dd242-149">Ez kell lehet tesztelni és címzett először, ha probléma merül fel.</span><span class="sxs-lookup"><span data-stu-id="dd242-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="dd242-150">Vegye figyelembe, hogy hello előhitelesítési szakaszhoz hozzá van nincs kapcsolat tooKCD vagy hello közzétett alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="dd242-150">Note that hello pre-authentication stage has no relation tooKCD or hello published application.</span></span> <span data-ttu-id="dd242-151">Viszonylag könnyen toocorrect ellentmondások által megerősítést ellenőrzése hello tulajdonos fiók létezik-e az Azure-ban meg kell, és nem le van tiltva/letiltva.</span><span class="sxs-lookup"><span data-stu-id="dd242-151">It should be fairly easy toocorrect any discrepancies by sanity checking hello subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="dd242-152">a rendszer általában elegendő leíró toounderstand hello OK hello hiba választ hello böngészőben.</span><span class="sxs-lookup"><span data-stu-id="dd242-152">hello error response in hello browser is usually descriptive enough toounderstand hello cause.</span></span> <span data-ttu-id="dd242-153">Ha nem biztos a más kapcsolatos problémák elhárítása docs tooverify is ellenőrizheti.</span><span class="sxs-lookup"><span data-stu-id="dd242-153">You can also check our other Troubleshoot docs tooverify if you aren’t sure.</span></span>

<span data-ttu-id="dd242-154">**Delegálás szolgáltatás** -hello Azure Proxy connector beszerzése a kerberos szolgáltatásjegy a KDC (Kerberos kulcskiosztó központ), a felhasználók nevében.</span><span class="sxs-lookup"><span data-stu-id="dd242-154">**Delegation service** - hello Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="dd242-155">a külső kommunikáció hello hello ügyfél és a hello Azure előtér között kell nincs hatással a Kerberos által korlátozott Delegálás megszüntethesse Önnek, másik győződjön meg arról, hogy működik.</span><span class="sxs-lookup"><span data-stu-id="dd242-155">hello external communications between hello client and hello Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="dd242-156">Ez a helyzet hello Azure Proxy szolgáltatás lehet a megadott felhasználói azonosító érvénytelen, amely lehet használt tooobtain a kerberos jegyet.</span><span class="sxs-lookup"><span data-stu-id="dd242-156">This is so hello Azure Proxy service can be provided with a valid user ID that be used tooobtain a kerberos ticket.</span></span> <span data-ttu-id="dd242-157">Nélkül a Kerberos által korlátozott Delegálás nincs lehetőség, és sikertelen lesz.</span><span class="sxs-lookup"><span data-stu-id="dd242-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="dd242-158">Ahogy korábban említettük, hello böngésző hibaüzenetek általában megadja a néhány jó a dolgok miért nem működnek.</span><span class="sxs-lookup"><span data-stu-id="dd242-158">As mentioned previously, hello browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="dd242-159">Győződjön meg arról, hogy toonote hello Tevékenységazonosító és időbélyeg hello válaszként, ez lehetővé teszi toocorrelate hello viselkedés tooactual események hello Azure Proxy-eseménynaplóban találhatók.</span><span class="sxs-lookup"><span data-stu-id="dd242-159">Make sure toonote down hello activity ID and timestamp in hello response as this allow you toocorrelate hello behavior tooactual events in hello Azure Proxy event log.</span></span>

   ![Helytelen a Kerberos által korlátozott konfigurációs hiba](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="dd242-161">És hello megfelelő bejegyzések látott hello Eseménynapló lesz látható a 13019 vagy 12027 eseményként is rögzíti.</span><span class="sxs-lookup"><span data-stu-id="dd242-161">And hello corresponding entries seen hello event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="dd242-162">Található hello eseménynaplók összekötő **alkalmazási és Szolgáltatásnaplójában** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Összekötő**&gt;**Admin**.</span><span class="sxs-lookup"><span data-stu-id="dd242-162">You can find hello connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Alkalmazásproxy eseménynaplójából 13019 esemény](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![Alkalmazásproxy eseménynaplójából 12027 esemény](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="dd242-165">Használjon egy A rekordot hello alkalmazás címe, és nem egy olyan CNAME rekordot a belső DNS-kiszolgáló</span><span class="sxs-lookup"><span data-stu-id="dd242-165">Use an A record in your internal DNS for hello application’s address, and not a CName</span></span>

-   <span data-ttu-id="dd242-166">Újból ellenőrizze a hello összekötőt üzemeltető rendelkezik hello jogok toodelegate toohello cél fiókhoz tartozó egyszerű Szolgáltatásnevet, és hogy a kijelölt **bármely hitelesítési protokoll** van kiválasztva.</span><span class="sxs-lookup"><span data-stu-id="dd242-166">Re-confirm that hello connector host has been granted hello rights toodelegate toohello designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="dd242-167">Ez a fő tárgyalja [SSO konfigurációs cikk](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span><span class="sxs-lookup"><span data-stu-id="dd242-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="dd242-168">Győződjön meg arról, hogy csak egyetlen példány futhat hello egyszerű Szolgáltatásnevet az Active Directory fennálló kiállításával egy **setspn - x** bármely tartományi tag gazdagépen cmd parancssorból</span><span class="sxs-lookup"><span data-stu-id="dd242-168">Verify that there is only a single instance of hello SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="dd242-169">Ellenőrizze, hogy ha folyamatban van a tartományi házirend toosee kényszerített toolimit hello [kerberos kiállított jogkivonatokat mérete legfeljebb](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), mert a jogkivonat beszerezni, ha az megakadályozása hello összekötő toobe túlzott található</span><span class="sxs-lookup"><span data-stu-id="dd242-169">Check toosee if a domain policy is being enforced toolimit hello [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent hello connector from obtaining a token if found toobe excessive</span></span>

<span data-ttu-id="dd242-170">A hálózati nyomkövetés rögzítése hello cseréjét hello összekötő állomás- és a KDC között hello ajánlott következő lépés az beszerzése több alacsony szintű részletes hello problémák lesz.</span><span class="sxs-lookup"><span data-stu-id="dd242-170">A network trace capturing hello exchanges between hello connector host and a domain KDC would then be hello next best step in obtaining more low level detail on hello issues.</span></span> <span data-ttu-id="dd242-171">Ezt a található [mélyreható kapcsolatos problémák elhárítása papír](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="dd242-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="dd242-172">Ha jegykezelési megfelelőnek tűnik, meg kell jelennie egy eseményre hello naplók figyelmezteti a felhasználókat arra, hogy a hitelesítés a 401-es visszaadó toohello alkalmazás miatt sikertelen volt.</span><span class="sxs-lookup"><span data-stu-id="dd242-172">If ticketing looks good, you should see an event in hello logs stating that authentication failed due toohello application returning a 401.</span></span> <span data-ttu-id="dd242-173">Ez általában azt jelenti, hogy hello célalkalmazás elutasítása a jegyet, ezért folytassa a következő szakasz a következő hello.</span><span class="sxs-lookup"><span data-stu-id="dd242-173">This typically indicates that hello target application rejecting your ticket, so proceed with hello following next stage.</span></span>

<span data-ttu-id="dd242-174">**A célalkalmazás** -hello fogyasztói hello összekötő által biztosított hello kerberos jegy</span><span class="sxs-lookup"><span data-stu-id="dd242-174">**Target application** - hello consumer of hello kerberos ticket provided by hello connector</span></span>

<span data-ttu-id="dd242-175">Ezen szakasza hello csatlakozó van várt toohave küldi a kerberos szolgáltatás jegy toohello háttér, fejlécként hello első alkalmazásigénylés belül.</span><span class="sxs-lookup"><span data-stu-id="dd242-175">At this stage hello connector is expected toohave sent a kerberos service ticket toohello backend, as a header within hello first application request.</span></span>

-   <span data-ttu-id="dd242-176">Hello alkalmazással hello portálon megadott belső URL-ellenőrizze, hogy hello alkalmazás közvetlenül hello böngészőből hello összekötő állomáson elérhető.</span><span class="sxs-lookup"><span data-stu-id="dd242-176">Using hello application’s internal URL defined in hello portal, validate that hello application is accessible directly from hello browser on hello connector host.</span></span> <span data-ttu-id="dd242-177">Ezután bejelentkezhet sikeresen megtörtént.</span><span class="sxs-lookup"><span data-stu-id="dd242-177">Then you can login successfully.</span></span> <span data-ttu-id="dd242-178">Ezzel a részletek hello összekötő hibaelhárítás lapon található.</span><span class="sxs-lookup"><span data-stu-id="dd242-178">Details on doing this can be found on hello connector Troubleshoot page.</span></span>

-   <span data-ttu-id="dd242-179">Továbbra is a hello összekötő gazdagépen, győződjön meg arról, hogy hello a hitelesítési hello böngésző között, és hello alkalmazás használja a kerberos hello következő tevékenységek végrehajtásával:</span><span class="sxs-lookup"><span data-stu-id="dd242-179">Still on hello connector host, confirm that hello authentication between hello browser and hello application is using kerberos, by doing one of hello following:</span></span>

1.  <span data-ttu-id="dd242-180">A fejlesztői eszközök futtatása (**F12**) a Internet Explorer vagy [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) hello összekötő gazdagépről.</span><span class="sxs-lookup"><span data-stu-id="dd242-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from hello connector host.</span></span> <span data-ttu-id="dd242-181">Nyissa meg toohello alkalmazást hello belső URL-cím, és WWW engedélyezési fejléceket hello alkalmazásból hello válaszként visszaadott kínált hello ellenőrzéséhez vagy egyeztető tooensure vagy kerberos jelen.</span><span class="sxs-lookup"><span data-stu-id="dd242-181">Go toohello application using hello internal URL, and inspect hello offered WWW authorization headers returned in hello response from hello application, tooensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="dd242-182">Egy későbbi kerberos blob hello válaszként visszaadott hello böngésző toohello az alkalmazás általában megkezdi a **YII**, ezért ez a kerberos Play alatt jól jelzi.</span><span class="sxs-lookup"><span data-stu-id="dd242-182">A subsequent kerberos blob returned in hello response from hello browser toohello application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="dd242-183">NTLM hello ugyanakkor mindig indítsa el a **TlRMTVNTUAAB**, amely szól, amikor a Base64 kódolású anyag dekódolni NTLMSSP.</span><span class="sxs-lookup"><span data-stu-id="dd242-183">NTLM on hello other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="dd242-184">Ha látja **TlRMTVNTUAAB** elején hello hello blob, ez azt jelenti, hogy van-e a Kerberos **nem** érhető el.</span><span class="sxs-lookup"><span data-stu-id="dd242-184">If you see **TlRMTVNTUAAB** at hello start of hello blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="dd242-185">Ha ez nem látható, a Kerberos valószínű érhető el.</span><span class="sxs-lookup"><span data-stu-id="dd242-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="dd242-186">Vegye figyelembe, ha Fiddler használatával ezt a módszert igényelnének ideiglenesen letilthatja az hello alkalmazás konfiguráció az IIS-ben a bővített védelmet.</span><span class="sxs-lookup"><span data-stu-id="dd242-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on hello application’s config in IIS.</span></span>

     ![Hálózati hálózatfelügyeleti böngészőablakban](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="dd242-188">*Ábra:* ez nem TIRMTVNTUAAB kezdődik, mert ez az, hogy rendelkezésre áll-e a Kerberos példa.</span><span class="sxs-lookup"><span data-stu-id="dd242-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="dd242-189">Ez az YII nem kezdődő Kerberos Blob egy példát.</span><span class="sxs-lookup"><span data-stu-id="dd242-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="dd242-190">NTLM ideiglenesen eltávolítása hello szolgáltatók listája IIS helyen, és hozzáférés alkalmazásában közvetlenül az Internet Explorer összekötő gazdagépen.</span><span class="sxs-lookup"><span data-stu-id="dd242-190">Temporarily remove NTLM from hello providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="dd242-191">Az NTLM már nem a hello szolgáltatók listája csak Kerberos használatával képes tooaccess hello alkalmazás kell lennie.</span><span class="sxs-lookup"><span data-stu-id="dd242-191">With NTLM no longer in hello providers list, you should be able tooaccess hello application using Kerberos only.</span></span> <span data-ttu-id="dd242-192">Ha ez nem sikerül, majd, amelyek arra utalnak, hogy van-e probléma hello alkalmazást, és a Kerberos-hitelesítés nem működik.</span><span class="sxs-lookup"><span data-stu-id="dd242-192">If this fails, then that suggests that there is a problem with hello application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="dd242-193">Kerberos nem érhető el, ha ellenőrzés hello alkalmazás hitelesítési beállításait, hogy az IIS toomake egyezteti az alatta csak NTLM legfelső szerepel.</span><span class="sxs-lookup"><span data-stu-id="dd242-193">If Kerberos is not available, then check hello application’s authentication settings in IIS toomake sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="dd242-194">(Nem Negotiate: kerberos vagy Negotiate: PKU2U).</span><span class="sxs-lookup"><span data-stu-id="dd242-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="dd242-195">Csak továbbra is, ha Kerberos működőképességét.</span><span class="sxs-lookup"><span data-stu-id="dd242-195">Only continue if Kerberos is functional.</span></span>

   ![Windows-hitelesítésszolgáltatók](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="dd242-197">A Kerberos és NTLM helyen lehetővé teszi, hogy most ideiglenesen letilthatja az előhitelesítési hello alkalmazás hello portálon.</span><span class="sxs-lookup"><span data-stu-id="dd242-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for hello application in hello portal.</span></span> <span data-ttu-id="dd242-198">Tekintse meg, ha hozzá tud férni a hello internet hello külső URL-cím használatával.</span><span class="sxs-lookup"><span data-stu-id="dd242-198">See if you can access it from hello internet using hello external URL.</span></span> <span data-ttu-id="dd242-199">Rákérdezéses tooauthenticate kell lennie, és képes toodo kell lennie, ezért hello a fiókot használja a használt hello előző lépésben.</span><span class="sxs-lookup"><span data-stu-id="dd242-199">You should be prompted tooauthenticate and should be able toodo so with hello same account used in hello previous step.</span></span> <span data-ttu-id="dd242-200">Ha nem, ez az a probléma hello a háttéralkalmazás és nem a Kerberos által korlátozott Delegálás minden jelzi.</span><span class="sxs-lookup"><span data-stu-id="dd242-200">If not, this indicates a problem with hello backend application and not KCD at all.</span></span>

-   <span data-ttu-id="dd242-201">Most újra engedélyezi az előhitelesítési hello portálon, és a hitelesítéshez Azure szolgáltatáson keresztül próbált meg külső URL-CÍMEN keresztül tooconnect toohello alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="dd242-201">Now re-enable pre-authentication in hello portal and authenticate through Azure by attempting tooconnect toohello application via it’s external URL.</span></span> <span data-ttu-id="dd242-202">Ha az egyszeri bejelentkezés sikertelen volt, majd kell megjelennie hello böngészőt, valamint az esemény 13022 hello tiltott hibaüzenet:</span><span class="sxs-lookup"><span data-stu-id="dd242-202">If SSO has failed, then you should see a forbidden error message in hello browser, plus event 13022 in hello log:</span></span>

    <span data-ttu-id="dd242-203">*Microsoft AAD alkalmazásproxy-összekötő nem tudja hitelesíteni hello felhasználót, mert hello háttérkiszolgáló válaszol tooKerberos hitelesítési kísérlet egy HTTP 401-es hiba miatt.*</span><span class="sxs-lookup"><span data-stu-id="dd242-203">*Microsoft AAD Application Proxy Connector cannot authenticate hello user because hello backend server responds tooKerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![Tiltott hibaüzenetet HTTTP 401](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="dd242-205">Ellenőrizze, hello IIS alkalmazás tooensure hello konfigurált alkalmazáskészlet ugyanazt a fiókot, amely egyszerű Szolgáltatásnevet hello konfigurációja szemben az ad-ben, lépjen az IIS-ben, az alábbi ábra szemlélteti konfigurált toouse hello</span><span class="sxs-lookup"><span data-stu-id="dd242-205">Check hello IIS application tooensure hello configured application pool is configured toouse hello same account that hello SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![IIS alkalmazás konfigurációs ablak](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="dd242-207">Miután eldöntötte, hello identitás, ki hello következőt egy cmd Rákérdezés toomake, ezt a fiókot a szóban forgó SPN hello mindenképpen van beállítva a.</span><span class="sxs-lookup"><span data-stu-id="dd242-207">Once you know hello identity, issue hello following from a cmd prompt toomake sure this account is definitely configured with hello SPN in question.</span></span> <span data-ttu-id="dd242-208">Például **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="dd242-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![SetSPN parancssori ablakban](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="dd242-210">Ellenőrizze, hogy hello portal hello alkalmazások beállításainak képest van meghatározva. SPN van hello azonos SPN hello cél AD fiók hello alkalmazás alkalmazáskészlet által használt konfigurált hello</span><span class="sxs-lookup"><span data-stu-id="dd242-210">Check that hello SPN defined against hello application’s settings in hello portal is hello same SPN that is configured against hello target AD account in use by hello application’s app pool</span></span>

   ![SPN-konfiguráció Azure-portálon](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="dd242-212">Nyissa meg az IIS és a select hello **Konfigurációszerkesztő** hello alkalmazás lehetőséget, és keresse meg a túl**system.webServer/security/authentication/windowsAuthentication** toomake meg arról, hogy **UseAppPoolCredentials** tootrue van beállítva.</span><span class="sxs-lookup"><span data-stu-id="dd242-212">Go into IIS and select hello **Configuration Editor** option for hello application, and navigate too**system.webServer/security/authentication/windowsAuthentication** toomake sure that **UseAppPoolCredentials** is set tootrue</span></span>

   ![Az IIS konfigurációs app készletek hitelesítőadat-beállítás](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="dd242-214">Ugyanakkor nem a Kerberos-műveletek hello a teljesítmény fokozása hasznos, is hagyja engedélyezve van a Kernel mód hatására hello hello jegyre kért szolgáltatás toobe visszafejteni a számítógépfiókot.</span><span class="sxs-lookup"><span data-stu-id="dd242-214">While being useful in improving hello performance of Kerberos operations, leaving Kernel mode enabled also causes hello ticket for hello requested service toobe decrypted using machine account.</span></span> <span data-ttu-id="dd242-215">Más néven: hello helyi rendszer, így a készlet tootrue break Kerberos által korlátozott Delegálás Ha hello alkalmazás kiszolgálófarm több kiszolgáló között.</span><span class="sxs-lookup"><span data-stu-id="dd242-215">This is also called hello Local system, so having this set tootrue break KCD when hello application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="dd242-216">Egy további ellenőrzést, akkor is érdemes lehet toodisable hello **kiterjesztett** védelmi túl.</span><span class="sxs-lookup"><span data-stu-id="dd242-216">As an additional check, you may also want toodisable hello **Extended** protection too.</span></span> <span data-ttu-id="dd242-217">Eddig észlelt forgatókönyvek, ahol ez bizonyult toobreak engedélyezésekor a olyan speciális konfigurációk esetén a Kerberos által korlátozott Delegálás ahol hello alapértelmezett webhely almappa alkalmazás van közzétéve.</span><span class="sxs-lookup"><span data-stu-id="dd242-217">There have been encountered scenarios where this has proved toobreak KCD when enabled in very specific configurations, where an application is published as a sub folder of hello Default Web site.</span></span> <span data-ttu-id="dd242-218">Ez maga a névtelen hitelesítés csak, hello teljes párbeszédpanelek szürkén jelenik meg arra vonatkozóan, gyermekobjektum akkor nem kell öröklődés esetleges aktív beállításokat hagyja van konfigurálva.</span><span class="sxs-lookup"><span data-stu-id="dd242-218">This itself is configured for Anonymous authentication only, leaving hello entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="dd242-219">De ha lehetséges volna mindig javasoljuk, ezzel engedélyezve van, ezért feltétlenül tesztelése, de ne feledkezzen toorestore a tooenabled.</span><span class="sxs-lookup"><span data-stu-id="dd242-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget toorestore this tooenabled.</span></span>

<span data-ttu-id="dd242-220">További ellenőrzést kell rendelkeznie elhelyezése, nyomon követése toostart használ a közzétett alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="dd242-220">These additional checks should have put you on track toostart using your published application.</span></span> <span data-ttu-id="dd242-221">Megkezdheti és további összekötők is fel léptetéses konfigurálva toodelegate, de ha olyan további majd akkor javasoljuk, hogy a a részletesebb műszaki útmutató olvasási [hello teljes körű útmutatót hibaelhárítása az Azure AD alkalmazás Proxy](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="dd242-221">You can go ahead and spin up additional connectors that are also configured toodelegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [hello complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="dd242-222">Ha még nem tooprogress a problémát, a támogatási ehhez boldogok tooassist-nál nagyobb legyen, és továbbra is itt.</span><span class="sxs-lookup"><span data-stu-id="dd242-222">If you’re still unable tooprogress your issue, support would be more than happy tooassist and continue from here.</span></span> <span data-ttu-id="dd242-223">Hozzon létre egy támogatási jegy közvetlenül hello portálon belül, és a mérnökök tooyou lesznek elérhetők.</span><span class="sxs-lookup"><span data-stu-id="dd242-223">Create a support ticket directly within hello portal and our engineers will reach out tooyou.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="dd242-224">Egyéb forgatókönyvek</span><span class="sxs-lookup"><span data-stu-id="dd242-224">Other scenarios</span></span>

-   <span data-ttu-id="dd242-225">Azure alkalmazásproxy kéri a Kerberos-jegy kérelem tooan alkalmazásának elküldése előtt.</span><span class="sxs-lookup"><span data-stu-id="dd242-225">Azure Application Proxy requests a Kerberos ticket before sending its request tooan application.</span></span> <span data-ttu-id="dd242-226">3. fél alkalmazásmódjai például a Tableau kiszolgáló nincs megelégedve a módszert, és nem vár több hagyományos az hello egyeztetések tootake ellenőrzéséhez.</span><span class="sxs-lookup"><span data-stu-id="dd242-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects hello more conventional negotiations tootake place,.</span></span> <span data-ttu-id="dd242-227">hello első kérelme, mert névtelen, így hello alkalmazás toorespond hello hitelesítési típussal, amely támogatja a 401-es keresztül.</span><span class="sxs-lookup"><span data-stu-id="dd242-227">hello first request is anonymous, allowing hello application toorespond with hello authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="dd242-228">Kettős Ugrás hitelesítés – általában esetekben használatos, ahol a kérelmet rétegzett, egy háttér és első vége, megkövetelését hitelesítést, például az SQL Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="dd242-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="dd242-229">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="dd242-229">Next steps</span></span>
[<span data-ttu-id="dd242-230">Kerberos által korlátozott delegálás (KCD) konfigurálása a felügyelt tartományhoz</span><span class="sxs-lookup"><span data-stu-id="dd242-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)
