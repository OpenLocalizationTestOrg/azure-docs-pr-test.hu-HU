---
title: "Az alkalmazásproxy alkalmazás Kerberos által korlátozott delegálás konfigurálása |} Microsoft Docs"
description: "Kerberos által korlátozott delegálás konfigurálása az Azure AD alkalmazásproxy alkalmazás módjáról."
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 3a768c30cb874d42d7b4fbd2eeaa6c0e23904e10
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 08/03/2017
---
# <a name="how-to-configure-an-application-proxy-application-to-use-kerberos-constrained-delegation"></a><span data-ttu-id="e3870-103">Az alkalmazásproxy alkalmazás Kerberos által korlátozott delegálás konfigurálása</span><span class="sxs-lookup"><span data-stu-id="e3870-103">How to configure an Application Proxy application to use Kerberos Constrained Delegation</span></span>

<span data-ttu-id="e3870-104">A módszer áll rendelkezésre a közzétett alkalmazásokhoz SSO némileg eltérőek lehetnek alkalmazások elérésére, és az, hogy a Azure Application Proxy első használatkor jobb kínál lehetőségek közül a Kerberos által korlátozott delegálás (KCD).</span><span class="sxs-lookup"><span data-stu-id="e3870-104">The methods available for achieving SSO to published applications can somewhat vary from application to application and one of the options that Azure Application Proxy offers right out of the box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="e3870-105">Ez azért, ahol egy összekötő állomás háttér alkalmazásokhoz, a felhasználók nevében korlátozott kerberos-hitelesítés elvégzéséhez van konfigurálva.</span><span class="sxs-lookup"><span data-stu-id="e3870-105">This is where a connector host is configured to perform constrained kerberos authentication to backend applications, on behalf of users.</span></span>

<span data-ttu-id="e3870-106">A Kerberos által korlátozott Delegálás engedélyezéséhez a tényleges eljárás viszonylag egyszerű, és általában a nem több, mint a különböző összetevőkkel és hitelesítési folyamat, amely elősegíti a SSO általános ismeretének igényelnek.</span><span class="sxs-lookup"><span data-stu-id="e3870-106">The actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of the various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="e3870-107">Jó információforrásokat forgatókönyvek hibaelhárítás elősegítése érdekében ahol Kerberos által korlátozott Delegálás SSO nem működik megfelelően, keresése ritka lehet.</span><span class="sxs-lookup"><span data-stu-id="e3870-107">Finding good sources of information to help troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="e3870-108">Ez a cikk, megpróbálja, hibaelhárításához és önálló szervizelése látható kapcsolatos leggyakoribb hibák némelyike segítségül a hivatkozás egyetlen pontot biztosítani.</span><span class="sxs-lookup"><span data-stu-id="e3870-108">As such, this article attempts to provide a single point of reference that should help troubleshoot and self-remediate some of the most common issues that we see.</span></span> <span data-ttu-id="e3870-109">Egy időben az összetettebb és végrehajtási törlesztett diagnosztizálására további útmutatást kínál.</span><span class="sxs-lookup"><span data-stu-id="e3870-109">At the same time offer additional guidance for diagnosing the more complex and troubled of implementation.</span></span>

<span data-ttu-id="e3870-110">Vegye figyelembe, hogy ez a cikk esetén a következő előfeltételek:</span><span class="sxs-lookup"><span data-stu-id="e3870-110">note that this article makes the following assumptions:</span></span>

-   <span data-ttu-id="e3870-111">Azure-alkalmazásproxy megfelelően van telepítve a [dokumentáció](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) és nem a Kerberos által korlátozott Delegálás alkalmazások általános hozzáférést a várt módon működik.</span><span class="sxs-lookup"><span data-stu-id="e3870-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access to non KCD applications is working as expected.</span></span>

-   <span data-ttu-id="e3870-112">A közzétett célalkalmazás kerberos IIS és a Microsoft végrehajtásának alapul.</span><span class="sxs-lookup"><span data-stu-id="e3870-112">The published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="e3870-113">A kiszolgáló és az alkalmazás gazdagépek egyetlen Active Directory-tartományban találhatók.</span><span class="sxs-lookup"><span data-stu-id="e3870-113">The server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="e3870-114">Részletes tájékoztatást közötti tartományok és erdők forgatókönyvek megtalálhatók a [Kerberos által korlátozott Delegálás tanulmány](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="e3870-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="e3870-115">A tulajdonos alkalmazás közzé van téve egy Azure-ban bérlői előtti hitelesítés engedélyezve van, és a felhasználók-azonosítóknak hitelesítésre űrlap alapú hitelesítéssel.</span><span class="sxs-lookup"><span data-stu-id="e3870-115">The subject application is published in an Azure tenant with pre-authentication enabled, and users are expected to authenticate to Azure via forms based authentication.</span></span> <span data-ttu-id="e3870-116">Gazdag ügyfél-hitelesítési forgatókönyvei nem vonatkozik ez a cikk, de egy bizonyos ponton a jövőben hozzáadni.</span><span class="sxs-lookup"><span data-stu-id="e3870-116">Rich client authentication scenarios are not covered by this article, but be added at some point in the future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="e3870-117">Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="e3870-117">Prerequisites</span></span>

<span data-ttu-id="e3870-118">Azure-alkalmazásproxy lényegében bármilyen típusú infrastruktúra vagy a környezet is telepíthető, és a architektúrák minden bizonnyal eltérők lehetnek a szervezetben.</span><span class="sxs-lookup"><span data-stu-id="e3870-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and the architectures no doubt vary from organization to organization.</span></span> <span data-ttu-id="e3870-119">A Kerberos által korlátozott Delegálás a leggyakoribb okok egyike kapcsolatos problémák nincsenek-e a környezetekben, de meglehetősen egyszerű hibás konfigurációt vagy általános felügyeletet.</span><span class="sxs-lookup"><span data-stu-id="e3870-119">One of the most common causes of KCD related issues are not the environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="e3870-120">Ezért azt tanácsoljuk, mindig indítása a annak biztosítása, hogy a fő jelenjen meg minden előfeltétel teljesül [Kerberos által korlátozott Delegálás egyszeri bejelentkezés használatával az alkalmazásproxy-cikk](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) elindítása előtt a hibaelhárítás.</span><span class="sxs-lookup"><span data-stu-id="e3870-120">For this reason, our advice is always to start by making sure you have met all the pre-requisites laid out in our main [Using KCD SSO with the Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="e3870-121">Különösen a szakasz a Kerberos által korlátozott Delegálás konfigurálása 2012R2, mivel ez előző verziók Windows de ugyanakkor nem számos szempontot szem előtt tartva a Kerberos által korlátozott Delegálás konfigurálása alapvetően eltérő megközelítést alkalmazza:</span><span class="sxs-lookup"><span data-stu-id="e3870-121">Particularly the section on configuring KCD on 2012R2, as this employs a fundamentally different approach to configuring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="e3870-122">A rendszer nem ritka, hogy az egy tartományi tagkiszolgáló, egy adott tartományvezérlő biztonságos csatorna párbeszédpanel megnyitásához.</span><span class="sxs-lookup"><span data-stu-id="e3870-122">It is not uncommon for a domain member server to open a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="e3870-123">Helyezze át egy másik párbeszédpanelt egy adott időpontban, összekötő állomások általában nem kell korlátozni csak adott helyi hely tartományvezérlők, amelyek kommunikálni tudnak.</span><span class="sxs-lookup"><span data-stu-id="e3870-123">Then move to another dialog at any given time, so connector hosts should generally not be restricted to being able to communicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="e3870-124">Hasonló a fenti pontra, a tartományok közötti forgatókönyvek alapulnak, hogy azok a tartományvezérlők, a helyi hálózati határain kívül található egy összekötő gazdagép közvetlen hivatkozásokat.</span><span class="sxs-lookup"><span data-stu-id="e3870-124">Similar to the above point, cross domain scenarios rely on referrals that direct a connector host to DCs that may reside outside of the local network perimeter.</span></span> <span data-ttu-id="e3870-125">Ebben a forgatókönyvben egyaránt van győződjön meg arról is engedélyezi a forgalom kezdődően a tartományvezérlők, amelyek megfelelnek a megfelelő tartományához, vagy más delegálás sikertelen.</span><span class="sxs-lookup"><span data-stu-id="e3870-125">In this scenario it is equally important to make sure you are also allowing traffic onwards to DCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="e3870-126">Ahol lehetséges, lehetőleg ne tároljon minden aktív IP-CÍMEK/Azonosítók eszközök közötti összekötő gazdagépek és -tartományvezérlő, mivel azok néha keresztül zavaró és zavarják a core keresztüli RPC-adatforgalmat</span><span class="sxs-lookup"><span data-stu-id="e3870-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="e3870-127">Mint amennyit szeretnénk problémák gyors megoldása és hatékonyan, időbe telhet, ezért lehetőség szerint érdemes próbálja és a delegálás a legegyszerűbb forgatókönyvek.</span><span class="sxs-lookup"><span data-stu-id="e3870-127">As much as we’d like to resolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in the simplest of scenarios.</span></span> <span data-ttu-id="e3870-128">A több változót bevezetése, annál nagyobb lehet, hogy a tartalom.</span><span class="sxs-lookup"><span data-stu-id="e3870-128">The more variables you introduce, the more you may have to contend with.</span></span> <span data-ttu-id="e3870-129">Például korlátozza a tesztelést egyetlen összekötőt értékes időt takaríthat, és további összekötők a problémák megoldása után lehet hozzáadni.</span><span class="sxs-lookup"><span data-stu-id="e3870-129">For example, limiting your testing to a single connector can save valuable time, and additional connectors can be added after the issues has been resolved.</span></span>

<span data-ttu-id="e3870-130">Néhány környezeti tényezők is eredményezhetnek problémát, újra, ha lehetséges próbálja, és az operációs rendszer minimális tesztelési architektúra minimalizálása érdekében.</span><span class="sxs-lookup"><span data-stu-id="e3870-130">Some environmental factors may also be contributing to an issue, so again if possible try and minimize the architecture to a bare minimum for testing.</span></span> <span data-ttu-id="e3870-131">Például helytelenül konfigurált belső tűzfal hozzáférés-vezérlési listák nem ritka, ezért lehetőség van a tartományvezérlők és a háttéralkalmazás rögtön keresztül engedélyezett összekötő származó összes forgalmat.</span><span class="sxs-lookup"><span data-stu-id="e3870-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through to the DCs and backend application.</span></span> 

<span data-ttu-id="e3870-132">Ténylegesen abszolút legjobb összekötők helyezze helye a célhely lehet közelében.</span><span class="sxs-lookup"><span data-stu-id="e3870-132">Actually the absolute best place to position connectors is as close to their targets as can be.</span></span> <span data-ttu-id="e3870-133">Egy kép tűzfal beágyazott Bár a tesztelés egyszerűen hozzáadja a szükségtelen összetettségét, és csak sikerült meghosszabbítani a vizsgálatok.</span><span class="sxs-lookup"><span data-stu-id="e3870-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="e3870-134">Igen milyen számít Kerberos által korlátozott Delegálás probléma ennek ellenére?</span><span class="sxs-lookup"><span data-stu-id="e3870-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="e3870-135">Nincs több klasszikus jelzésének hiányában a Kerberos által korlátozott SSO és az első a problémát általában manifest magukat a böngészőben.</span><span class="sxs-lookup"><span data-stu-id="e3870-135">Well, there several classic indications of KCD SSO failing and the first signs of an issue usually manifest themselves in the browser.</span></span>

   ![Helytelen a Kerberos által korlátozott konfigurációs hiba](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Hiányzó jogosultságok miatt nem sikerült engedélyezése](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="e3870-138">minden amelyek viselik azonos tünete, hajtsa végre az egyszeri bejelentkezés sikertelen, és ezért elutasítja az a felhasználó hozzáférni az alkalmazáshoz.</span><span class="sxs-lookup"><span data-stu-id="e3870-138">all which bear the same symptom of failing to perform SSO, and consequently denying the user access to the application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="e3870-139">Hibaelhárítás</span><span class="sxs-lookup"><span data-stu-id="e3870-139">Troubleshooting</span></span>

<span data-ttu-id="e3870-140">Hogyan majd hibaelhárítása a problémát és a megfigyelt jelenségek függenek.</span><span class="sxs-lookup"><span data-stu-id="e3870-140">How you then troubleshoot depend on the issue and observed symptoms.</span></span> <span data-ttu-id="e3870-141">Előtt fog minden további akkor javasoljuk, hogy az alábbi hivatkozások nem még rendelkezik olyan hasznos információkat tartalmaznak, mint:</span><span class="sxs-lookup"><span data-stu-id="e3870-141">Before going any further we would suggest the following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="e3870-142">Alkalmazásproxy problémák és hibaüzenetek hibaelhárítása</span><span class="sxs-lookup"><span data-stu-id="e3870-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="e3870-143">Kerberos-hibákhoz, és a jelenség</span><span class="sxs-lookup"><span data-stu-id="e3870-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="e3870-144">Egyszeri bejelentkezési modellel működik ha helyszíni és felhőalapú Identitások nem azonosak.</span><span class="sxs-lookup"><span data-stu-id="e3870-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="e3870-145">Ha van a távoli, majd a fő probléma mindenképpen létezik-e.</span><span class="sxs-lookup"><span data-stu-id="e3870-145">If you’ve got this far, then the main issue definitely exists.</span></span> <span data-ttu-id="e3870-146">Meg kell mélyebben elmerülne a rendszer, így indítsa el a folyamat három különböző szakaszokat elháríthatja az elválasztó.</span><span class="sxs-lookup"><span data-stu-id="e3870-146">You need to dig deeper, so start by separating the flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="e3870-147">**Ügyfelek előhitelesítése** – a külső felhasználó hitelesítéséhez az Azure-bA böngésző használatával.</span><span class="sxs-lookup"><span data-stu-id="e3870-147">**Client pre-authentication** - The external user authenticating to Azure via a browser.</span></span>

<span data-ttu-id="e3870-148">Előtti hitelesítéshez az Azure-bA alatt elengedhetetlen a Kerberos által korlátozott Delegálás SSO függvénynek.</span><span class="sxs-lookup"><span data-stu-id="e3870-148">Being able to pre-authenticate to Azure is imperative for KCD SSO to function.</span></span> <span data-ttu-id="e3870-149">Ez kell lehet tesztelni és címzett először, ha probléma merül fel.</span><span class="sxs-lookup"><span data-stu-id="e3870-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="e3870-150">Vegye figyelembe, hogy az előhitelesítési szakasza nincs kapcsolat a Kerberos által korlátozott vagy a közzétett alkalmazáshoz.</span><span class="sxs-lookup"><span data-stu-id="e3870-150">Note that the pre-authentication stage has no relation to KCD or the published application.</span></span> <span data-ttu-id="e3870-151">Meg kell viszonylag egyszerűen kijavíthatja az esetleges eltéréseket által megerősítést ellenőrzése a tulajdonos fiók létezik-e az Azure-ban, és, hogy nincs letiltva vagy letiltva.</span><span class="sxs-lookup"><span data-stu-id="e3870-151">It should be fairly easy to correct any discrepancies by sanity checking the subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="e3870-152">A böngészőben a hibaválaszba általában leíró elég okának megértéséhez.</span><span class="sxs-lookup"><span data-stu-id="e3870-152">The error response in the browser is usually descriptive enough to understand the cause.</span></span> <span data-ttu-id="e3870-153">Győződjön meg arról, ha nem biztos, hogy más kapcsolatos problémák elhárítása leírásokat is ellenőrizheti.</span><span class="sxs-lookup"><span data-stu-id="e3870-153">You can also check our other Troubleshoot docs to verify if you aren’t sure.</span></span>

<span data-ttu-id="e3870-154">**Delegálás szolgáltatás** – az Azure Proxy connector megszerezni a kerberos szolgáltatásjegy a KDC (Kerberos kulcskiosztó központ), a felhasználók nevében.</span><span class="sxs-lookup"><span data-stu-id="e3870-154">**Delegation service** - The Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="e3870-155">A külső kommunikáció az ügyfél és az Azure előtér között kell nincs hatással a Kerberos által korlátozott Delegálás megszüntethesse Önnek, másik győződjön meg arról, hogy működik.</span><span class="sxs-lookup"><span data-stu-id="e3870-155">The external communications between the client and the Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="e3870-156">Ez a helyzet az Azure Proxy szolgáltatás megadható érvényes felhasználói azonosítóval, amely használható a kerberos jegy beszerzéséhez.</span><span class="sxs-lookup"><span data-stu-id="e3870-156">This is so the Azure Proxy service can be provided with a valid user ID that be used to obtain a kerberos ticket.</span></span> <span data-ttu-id="e3870-157">Nélkül a Kerberos által korlátozott Delegálás nincs lehetőség, és sikertelen lesz.</span><span class="sxs-lookup"><span data-stu-id="e3870-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="e3870-158">Ahogy korábban említettük, a böngésző hibaüzenetek általában megadja a néhány jó a dolgok miért nem működnek.</span><span class="sxs-lookup"><span data-stu-id="e3870-158">As mentioned previously, the browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="e3870-159">Győződjön meg arról, jegyezze fel a tevékenység azonosítója és a válaszban szereplő Timestamp típusú, ez lehetővé teszi, hogy az Azure Proxy naplóbeli eseményei a tényleges el összefüggéseket.</span><span class="sxs-lookup"><span data-stu-id="e3870-159">Make sure to note down the activity ID and timestamp in the response as this allow you to correlate the behavior to actual events in the Azure Proxy event log.</span></span>

   ![Helytelen a Kerberos által korlátozott konfigurációs hiba](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="e3870-161">És a megfelelő bejegyzések láthatók az eseménynaplóban lesz látható a 13019 vagy 12027 eseményként is rögzíti.</span><span class="sxs-lookup"><span data-stu-id="e3870-161">And the corresponding entries seen the event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="e3870-162">Az összekötő eseménynaplók található **alkalmazási és Szolgáltatásnaplójában** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **összekötő**&gt;**Admin**.</span><span class="sxs-lookup"><span data-stu-id="e3870-162">You can find the connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Alkalmazásproxy eseménynaplójából 13019 esemény](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![Alkalmazásproxy eseménynaplójából 12027 esemény](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="e3870-165">Az A rekord a belső DNS-ben az alkalmazás címének és nem egy olyan CNAME rekordot használhat</span><span class="sxs-lookup"><span data-stu-id="e3870-165">Use an A record in your internal DNS for the application’s address, and not a CName</span></span>

-   <span data-ttu-id="e3870-166">Újra győződjön meg arról, hogy az összekötő állomás rendelkezik a megfelelő engedélyekkel a feladat a kijelölt tároló fiókhoz tartozó egyszerű Szolgáltatásnevet, és hogy **bármely hitelesítési protokoll** van kiválasztva.</span><span class="sxs-lookup"><span data-stu-id="e3870-166">Re-confirm that the connector host has been granted the rights to delegate to the designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="e3870-167">Ez a fő tárgyalja [SSO konfigurációs cikk](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span><span class="sxs-lookup"><span data-stu-id="e3870-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="e3870-168">Győződjön meg arról, hogy nincs-e az egyszerű Szolgáltatásnevet az Active Directory fennálló csak egyetlen példányát kiállításával egy **setspn - x** bármely tartományi tag gazdagépen cmd parancssorból</span><span class="sxs-lookup"><span data-stu-id="e3870-168">Verify that there is only a single instance of the SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="e3870-169">Ellenőrizze, hogy ha tartományi házirend van érvényben korlátozni a [kerberos kiállított jogkivonatokat mérete legfeljebb](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), mert ez akadályozni, hogy az összekötő egy token if található túl nagy</span><span class="sxs-lookup"><span data-stu-id="e3870-169">Check to see if a domain policy is being enforced to limit the [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent the connector from obtaining a token if found to be excessive</span></span>

<span data-ttu-id="e3870-170">A hálózati nyomkövetés rögzítése a connector állomás- és a KDC között cseréjét lesz a következő ajánlott lépés több alacsony szintű részletes a problémák az beszerzése.</span><span class="sxs-lookup"><span data-stu-id="e3870-170">A network trace capturing the exchanges between the connector host and a domain KDC would then be the next best step in obtaining more low level detail on the issues.</span></span> <span data-ttu-id="e3870-171">Ezt a található [mélyreható kapcsolatos problémák elhárítása papír](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="e3870-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="e3870-172">Ha jegykezelési megfelelőnek tűnik, meg kell jelennie a naplófájlokban, amely meghatározza, hogy, hogy a hitelesítés a 401-es visszaadó miatt nem sikerült egy eseményt.</span><span class="sxs-lookup"><span data-stu-id="e3870-172">If ticketing looks good, you should see an event in the logs stating that authentication failed due to the application returning a 401.</span></span> <span data-ttu-id="e3870-173">Ez általában azt jelzi, hogy a célalkalmazás elutasítása a jegyet, ezért folytatásához a következő következő szakaszára.</span><span class="sxs-lookup"><span data-stu-id="e3870-173">This typically indicates that the target application rejecting your ticket, so proceed with the following next stage.</span></span>

<span data-ttu-id="e3870-174">**A célalkalmazás** -a fogyasztó az összekötő által biztosított kerberos jegy</span><span class="sxs-lookup"><span data-stu-id="e3870-174">**Target application** - The consumer of the kerberos ticket provided by the connector</span></span>

<span data-ttu-id="e3870-175">Ebben a szakaszban az összekötő várhatóan küldött egy kerberos szolgáltatásjegyet a háttér fejlécként belül az első alkalmazás-kérelmekre.</span><span class="sxs-lookup"><span data-stu-id="e3870-175">At this stage the connector is expected to have sent a kerberos service ticket to the backend, as a header within the first application request.</span></span>

-   <span data-ttu-id="e3870-176">Az alkalmazás belső URL-cím segítségével meghatározott a portálon, ellenőrizze, hogy az alkalmazás közvetlenül a böngészőből az összekötő állomáson elérhető.</span><span class="sxs-lookup"><span data-stu-id="e3870-176">Using the application’s internal URL defined in the portal, validate that the application is accessible directly from the browser on the connector host.</span></span> <span data-ttu-id="e3870-177">Ezután bejelentkezhet sikeresen megtörtént.</span><span class="sxs-lookup"><span data-stu-id="e3870-177">Then you can login successfully.</span></span> <span data-ttu-id="e3870-178">Részleteket ezzel az összekötő hibaelhárítása oldalon található.</span><span class="sxs-lookup"><span data-stu-id="e3870-178">Details on doing this can be found on the connector Troubleshoot page.</span></span>

-   <span data-ttu-id="e3870-179">Az összekötő állomáson továbbra is győződjön meg arról, hogy a böngésző és az alkalmazás közötti hitelesítés kerberos, használja a következő módszerek valamelyikével:</span><span class="sxs-lookup"><span data-stu-id="e3870-179">Still on the connector host, confirm that the authentication between the browser and the application is using kerberos, by doing one of the following:</span></span>

1.  <span data-ttu-id="e3870-180">A fejlesztői eszközök futtatása (**F12**) a Internet Explorer vagy [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) a connector gazdagépről.</span><span class="sxs-lookup"><span data-stu-id="e3870-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from the connector host.</span></span> <span data-ttu-id="e3870-181">Nyissa meg a belső URL-cím használata alkalmazás, és vizsgálja meg a felajánlott WWW engedélyezési fejléceket a visszatérő válaszban az alkalmazásból, annak érdekében, hogy vagy negotiate vagy kerberos jelen.</span><span class="sxs-lookup"><span data-stu-id="e3870-181">Go to the application using the internal URL, and inspect the offered WWW authorization headers returned in the response from the application, to ensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="e3870-182">Az eredmény abban az ezt követő kerberos blob az alkalmazás a böngészőből érkező válasz általában megkezdi a **YII**, ezért ez a kerberos Play alatt jól jelzi.</span><span class="sxs-lookup"><span data-stu-id="e3870-182">A subsequent kerberos blob returned in the response from the browser to the application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="e3870-183">NTLM viszont mindig kezdődnie **TlRMTVNTUAAB**, amely szól, amikor a Base64 kódolású anyag dekódolni NTLMSSP.</span><span class="sxs-lookup"><span data-stu-id="e3870-183">NTLM on the other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="e3870-184">Ha látja **TlRMTVNTUAAB** a blob elején, ez azt jelenti, hogy van-e a Kerberos **nem** érhető el.</span><span class="sxs-lookup"><span data-stu-id="e3870-184">If you see **TlRMTVNTUAAB** at the start of the blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="e3870-185">Ha ez nem látható, a Kerberos valószínű érhető el.</span><span class="sxs-lookup"><span data-stu-id="e3870-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="e3870-186">Vegye figyelembe, ha a Fiddler használatával az ezt a módszert igényelnének, ideiglenesen letilthatja az alkalmazás konfigurációs az IIS-ben a bővített védelmet.</span><span class="sxs-lookup"><span data-stu-id="e3870-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on the application’s config in IIS.</span></span>

     ![Hálózati hálózatfelügyeleti böngészőablakban](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="e3870-188">*Ábra:* ez nem TIRMTVNTUAAB kezdődik, mert ez az, hogy rendelkezésre áll-e a Kerberos példa.</span><span class="sxs-lookup"><span data-stu-id="e3870-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="e3870-189">Ez az YII nem kezdődő Kerberos Blob egy példát.</span><span class="sxs-lookup"><span data-stu-id="e3870-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="e3870-190">Ideiglenesen távolítsa el az NTLM IIS helyen, és hozzáférés app IE összekötő gazdagép közvetlenül a szolgáltatók listájából.</span><span class="sxs-lookup"><span data-stu-id="e3870-190">Temporarily remove NTLM from the providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="e3870-191">Már nem a szolgáltatók listája az NTLM, a tudni hozzáférni az alkalmazáshoz, csak Kerberos használatával kell lennie.</span><span class="sxs-lookup"><span data-stu-id="e3870-191">With NTLM no longer in the providers list, you should be able to access the application using Kerberos only.</span></span> <span data-ttu-id="e3870-192">Ha ez nem sikerül, majd, amelyek arra utalnak, hogy van-e az alkalmazás konfigurációs probléma, és a Kerberos-hitelesítés nem működik.</span><span class="sxs-lookup"><span data-stu-id="e3870-192">If this fails, then that suggests that there is a problem with the application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="e3870-193">Ha Kerberos nem érhető el, ellenőrizze az alkalmazás hitelesítési beállításait is győződjön meg arról, hogy az IIS egyezteti NTLM alatta csak a legfelső szerepel.</span><span class="sxs-lookup"><span data-stu-id="e3870-193">If Kerberos is not available, then check the application’s authentication settings in IIS to make sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="e3870-194">(Nem Negotiate: kerberos vagy Negotiate: PKU2U).</span><span class="sxs-lookup"><span data-stu-id="e3870-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="e3870-195">Csak továbbra is, ha Kerberos működőképességét.</span><span class="sxs-lookup"><span data-stu-id="e3870-195">Only continue if Kerberos is functional.</span></span>

   ![Windows-hitelesítésszolgáltatók](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="e3870-197">A Kerberos és NTLM helyen lehetővé teszi, hogy most ideiglenesen letilthatja az előhitelesítési az alkalmazás a portálon.</span><span class="sxs-lookup"><span data-stu-id="e3870-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for the application in the portal.</span></span> <span data-ttu-id="e3870-198">Tekintse meg, ha hozzá tud férni az internetről, a külső URL-cím használatával.</span><span class="sxs-lookup"><span data-stu-id="e3870-198">See if you can access it from the internet using the external URL.</span></span> <span data-ttu-id="e3870-199">Hitelesítésére a rendszer kéri, és ugyanazt a fiókot az előző lépésben használt ehhez képesnek kell lennie.</span><span class="sxs-lookup"><span data-stu-id="e3870-199">You should be prompted to authenticate and should be able to do so with the same account used in the previous step.</span></span> <span data-ttu-id="e3870-200">Ha nem, ez az a probléma a háttéralkalmazás és nem a Kerberos által korlátozott Delegálás minden jelzi.</span><span class="sxs-lookup"><span data-stu-id="e3870-200">If not, this indicates a problem with the backend application and not KCD at all.</span></span>

-   <span data-ttu-id="e3870-201">Most engedélyezze újra a portálon előhitelesítést, és a hitelesítéshez Azure szolgáltatáson keresztül próbálnak meg külső URL-CÍMEN keresztül az alkalmazás csatlakozni.</span><span class="sxs-lookup"><span data-stu-id="e3870-201">Now re-enable pre-authentication in the portal and authenticate through Azure by attempting to connect to the application via it’s external URL.</span></span> <span data-ttu-id="e3870-202">Ha az egyszeri bejelentkezés sikertelen volt, majd kell megjelennie a böngészőt, valamint az esemény 13022 a tiltott hibaüzenet:</span><span class="sxs-lookup"><span data-stu-id="e3870-202">If SSO has failed, then you should see a forbidden error message in the browser, plus event 13022 in the log:</span></span>

    <span data-ttu-id="e3870-203">*Microsoft AAD alkalmazásproxy-összekötő nem tudja hitelesíteni a felhasználót, mert a háttérkiszolgáló válaszol-e egy HTTP 401 hiba: a Kerberos hitelesítési kísérleteket.*</span><span class="sxs-lookup"><span data-stu-id="e3870-203">*Microsoft AAD Application Proxy Connector cannot authenticate the user because the backend server responds to Kerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![Tiltott hibaüzenetet HTTTP 401](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="e3870-205">Ellenőrizze, hogy az IIS-alkalmazás konfigurált alkalmazáskészlet biztosításához ugyanazt a fiókot az egyszerű szolgáltatásnév konfigurált szemben az ad-ben, lépjen az alább bemutatott IIS használatára van konfigurálva</span><span class="sxs-lookup"><span data-stu-id="e3870-205">Check the IIS application to ensure the configured application pool is configured to use the same account that the SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![IIS alkalmazás konfigurációs ablak](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="e3870-207">Miután eldöntötte, hogy az identitás, probléma az alábbi cmd jelenít meg, győződjön meg arról, hogy ennek a fióknak a mindenképpen van konfigurálva az egyszerű Szolgáltatásnevet.</span><span class="sxs-lookup"><span data-stu-id="e3870-207">Once you know the identity, issue the following from a cmd prompt to make sure this account is definitely configured with the SPN in question.</span></span> <span data-ttu-id="e3870-208">Például **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="e3870-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![SetSPN parancssori ablakban](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="e3870-210">Ellenőrizze, hogy az alkalmazás beállításait a portálon képest van meghatározva. az egyszerű Szolgáltatásnevet az azonos egyszerű Szolgáltatásnevet, az alkalmazáskészlet alkalmazást használja a cél AD fiók van konfigurálva</span><span class="sxs-lookup"><span data-stu-id="e3870-210">Check that the SPN defined against the application’s settings in the portal is the same SPN that is configured against the target AD account in use by the application’s app pool</span></span>

   ![SPN-konfiguráció Azure-portálon](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="e3870-212">Nyissa meg az IIS, és válassza a **Konfigurációszerkesztő** az alkalmazás lehetőséget, és navigáljon a **system.webServer/security/authentication/windowsAuthentication** és győződjön meg arról, hogy **UseAppPoolCredentials** értéke igaz értékre</span><span class="sxs-lookup"><span data-stu-id="e3870-212">Go into IIS and select the **Configuration Editor** option for the application, and navigate to **system.webServer/security/authentication/windowsAuthentication** to make sure that **UseAppPoolCredentials** is set to true</span></span>

   ![Az IIS konfigurációs app készletek hitelesítőadat-beállítás](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="e3870-214">Miközben folyamatban elősegíti a Kerberos-művelet is engedélyezve van, a Kernel mód hagyja a teljesítmény fokozása hatására a jegyet a kért szolgáltatás visszafejteni a számítógépfiók számára.</span><span class="sxs-lookup"><span data-stu-id="e3870-214">While being useful in improving the performance of Kerberos operations, leaving Kernel mode enabled also causes the ticket for the requested service to be decrypted using machine account.</span></span> <span data-ttu-id="e3870-215">Ezt a helyi rendszer, így ez igaz break Kerberos által korlátozott Delegálás értékre, ha az alkalmazás a farmban lévő több kiszolgálón is nevezik.</span><span class="sxs-lookup"><span data-stu-id="e3870-215">This is also called the Local system, so having this set to true break KCD when the application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="e3870-216">Egy további ellenőrzést, mint is érdemes lehet letiltani a **kiterjesztett** védelmi túl.</span><span class="sxs-lookup"><span data-stu-id="e3870-216">As an additional check, you may also want to disable the **Extended** protection too.</span></span> <span data-ttu-id="e3870-217">Észlelt forgatókönyvek, ahol ez bizonyult hibájához Kerberos által korlátozott Delegálás engedélyezésekor a meghatározott konfigurációk, ahol közzé van téve egy alkalmazást, az alapértelmezett webhely almappa törölték.</span><span class="sxs-lookup"><span data-stu-id="e3870-217">There have been encountered scenarios where this has proved to break KCD when enabled in very specific configurations, where an application is published as a sub folder of the Default Web site.</span></span> <span data-ttu-id="e3870-218">Ez maga a névtelen hitelesítés csak, így a teljes szürkén jelenik meg, amelyek arra utalnak, gyermekobjektum akkor nem kell öröklődés minden aktív beállítások párbeszédpanelek van konfigurálva.</span><span class="sxs-lookup"><span data-stu-id="e3870-218">This itself is configured for Anonymous authentication only, leaving the entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="e3870-219">De ahol lehetséges volna mindig javasoljuk, ezzel engedélyezve van, ezért feltétlenül tesztelése, de ne feledkezzen visszaállítása a engedélyezve van.</span><span class="sxs-lookup"><span data-stu-id="e3870-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget to restore this to enabled.</span></span>

<span data-ttu-id="e3870-220">További ellenőrzést kell kell helyezni, nyomon követése a közzétett alkalmazás használatának megkezdéséhez.</span><span class="sxs-lookup"><span data-stu-id="e3870-220">These additional checks should have put you on track to start using your published application.</span></span> <span data-ttu-id="e3870-221">Lépjen tovább, és további összekötők delegálása is állítottak be léptetési, de ha olyan további majd akkor javasoljuk, hogy a a részletesebb műszaki útmutató olvasási [hibaelhárítása az Azure AD-alkalmazásproxy a teljes útmutató](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="e3870-221">You can go ahead and spin up additional connectors that are also configured to delegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [The complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="e3870-222">Ha továbbra sem tudja előrehaladás a problémát, támogatási több mint örömmel segíti, és itt továbbra is lehet.</span><span class="sxs-lookup"><span data-stu-id="e3870-222">If you’re still unable to progress your issue, support would be more than happy to assist and continue from here.</span></span> <span data-ttu-id="e3870-223">Hozzon létre egy támogatási jegy közvetlenül a portálon belül, és a mérnökök lesznek elérhetők a Önnek.</span><span class="sxs-lookup"><span data-stu-id="e3870-223">Create a support ticket directly within the portal and our engineers will reach out to you.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="e3870-224">Egyéb forgatókönyvek</span><span class="sxs-lookup"><span data-stu-id="e3870-224">Other scenarios</span></span>

-   <span data-ttu-id="e3870-225">Azure-alkalmazásproxy Kerberos-jegy kérelmek egy alkalmazás a kérelem elküldése előtt.</span><span class="sxs-lookup"><span data-stu-id="e3870-225">Azure Application Proxy requests a Kerberos ticket before sending its request to an application.</span></span> <span data-ttu-id="e3870-226">3. fél alkalmazásmódjai például Tableau Server nincs megelégedve a módszert, és inkább a kerül sor, több hagyományos egyeztetések vár.</span><span class="sxs-lookup"><span data-stu-id="e3870-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects the more conventional negotiations to take place,.</span></span> <span data-ttu-id="e3870-227">Az első kérésre, lehetővé téve az alkalmazást szeretne válaszolni, hogy a 401-es keresztül támogatja a hitelesítési típus névtelen.</span><span class="sxs-lookup"><span data-stu-id="e3870-227">The first request is anonymous, allowing the application to respond with the authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="e3870-228">Kettős Ugrás hitelesítés – általában esetekben használatos, ahol a kérelmet rétegzett, egy háttér és első vége, megkövetelését hitelesítést, például az SQL Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="e3870-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e3870-229">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="e3870-229">Next steps</span></span>
[<span data-ttu-id="e3870-230">Kerberos által korlátozott delegálás (KCD) konfigurálása a felügyelt tartományhoz</span><span class="sxs-lookup"><span data-stu-id="e3870-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)
