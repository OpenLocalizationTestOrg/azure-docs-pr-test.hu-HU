---
title: "Az Azure AD Connect: Hogyan tudja elhárítani az LocalDB 10 GB-os korlát probléma |} Microsoft Docs"
description: "Ez a témakör ismerteti az Azure AD Connect szinkronizálási szolgáltatás helyreállítása, ha 10 GB-os LocalDB probléma korlátozza."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 08e682c51b12d4506019d2f6b68e1eae0798b990
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-how-to-recover-from-localdb-10-gb-limit"></a><span data-ttu-id="d7c39-103">Az Azure AD Connect: Hogyan tudja elhárítani az LocalDB 10 GB-os korlát</span><span class="sxs-lookup"><span data-stu-id="d7c39-103">Azure AD Connect: How to recover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="d7c39-104">Az identitásadatok tárolásához az Azure AD Connectnek szüksége van egy SQL Server-adatbázisra.</span><span class="sxs-lookup"><span data-stu-id="d7c39-104">Azure AD Connect requires a SQL Server database to store identity data.</span></span> <span data-ttu-id="d7c39-105">Használhatja az Azure AD Connecttel együtt telepített alapértelmezett SQL Server 2012 Express LocalDB-t, vagy használhatja saját teljes SQL-kiszolgálóját.</span><span class="sxs-lookup"><span data-stu-id="d7c39-105">You can either use the default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="d7c39-106">Az SQL Server Express 10 GB-os méretkorláttal rendelkezik.</span><span class="sxs-lookup"><span data-stu-id="d7c39-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="d7c39-107">Ha a LocalDB-t használja és eléri a korlátot, az Azure AD Connect szinkronizálási szolgáltatása többé nem indul majd el, vagy nem végzi el megfelelően a szinkronizálást.</span><span class="sxs-lookup"><span data-stu-id="d7c39-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="d7c39-108">Ez a cikk ismerteti a helyreállítási lépéseket.</span><span class="sxs-lookup"><span data-stu-id="d7c39-108">This article provides the recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="d7c39-109">Probléma</span><span class="sxs-lookup"><span data-stu-id="d7c39-109">Symptoms</span></span>
<span data-ttu-id="d7c39-110">Két közös jelenségek van:</span><span class="sxs-lookup"><span data-stu-id="d7c39-110">There are two common symptoms:</span></span>

* <span data-ttu-id="d7c39-111">Az Azure AD Connect szinkronizálási szolgáltatás **fut** , de nem tudja szinkronizálni *"leállt-adatbázis-lemez-teljes"* hiba.</span><span class="sxs-lookup"><span data-stu-id="d7c39-111">Azure AD Connect Synchronization Service **is running** but fails to synchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="d7c39-112">Az Azure AD Connect szinkronizálási szolgáltatás **nem indíthatók el**.</span><span class="sxs-lookup"><span data-stu-id="d7c39-112">Azure AD Connect Synchronization Service **is unable to start**.</span></span> <span data-ttu-id="d7c39-113">Amikor megkísérli elindítani a szolgáltatást, az nem esemény 6323 és hibaüzenet *"a kiszolgáló hibába ütközött, mert nincs elég szabad lemezterület az SQL Server."*</span><span class="sxs-lookup"><span data-stu-id="d7c39-113">When you attempt to start the service, it fails with event 6323 and error message *"The server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="d7c39-114">Rövid távú helyreállítási lépések</span><span class="sxs-lookup"><span data-stu-id="d7c39-114">Short-term recovery steps</span></span>
<span data-ttu-id="d7c39-115">Ez a szakasz a lépéseit az Azure AD Connect szinkronizálási szolgáltatás folytatja a működését a szükséges adatbázis-terület felszabadítását.</span><span class="sxs-lookup"><span data-stu-id="d7c39-115">This section provides the steps to reclaim DB space required for Azure AD Connect Synchronization Service to resume operation.</span></span> <span data-ttu-id="d7c39-116">A lépések az alábbiak:</span><span class="sxs-lookup"><span data-stu-id="d7c39-116">The steps include:</span></span>
1. [<span data-ttu-id="d7c39-117">A szinkronizálási szolgáltatás állapotának meghatározása</span><span class="sxs-lookup"><span data-stu-id="d7c39-117">Determine the Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="d7c39-118">Az adatbázis zsugorítása</span><span class="sxs-lookup"><span data-stu-id="d7c39-118">Shrink the database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="d7c39-119">Futtassa az előzményadatok törlése</span><span class="sxs-lookup"><span data-stu-id="d7c39-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="d7c39-120">Rövidítse le a futtatási előzményei adatok megőrzési időtartama</span><span class="sxs-lookup"><span data-stu-id="d7c39-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-the-synchronization-service-status"></a><span data-ttu-id="d7c39-121">A szinkronizálási szolgáltatás állapotának meghatározása</span><span class="sxs-lookup"><span data-stu-id="d7c39-121">Determine the Synchronization Service status</span></span>
<span data-ttu-id="d7c39-122">Először határozza meg, hogy a szinkronizálási szolgáltatás még fut vagy nem:</span><span class="sxs-lookup"><span data-stu-id="d7c39-122">First, determine whether the Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="d7c39-123">Jelentkezzen be rendszergazdaként az Azure AD Connect-kiszolgáló.</span><span class="sxs-lookup"><span data-stu-id="d7c39-123">Log in to your Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="d7c39-124">Ugrás a **szolgáltatásvezérlő**.</span><span class="sxs-lookup"><span data-stu-id="d7c39-124">Go to **Service Control Manager**.</span></span>

3. <span data-ttu-id="d7c39-125">Tekintse meg a **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="d7c39-125">Check the status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="d7c39-126">Ha fut, ne állítsa le és indítsa újra a szolgáltatást.</span><span class="sxs-lookup"><span data-stu-id="d7c39-126">If it is running, do not stop or restart the service.</span></span> <span data-ttu-id="d7c39-127">Kihagyás [az adatbázis zsugorítása](#shrink-the-database) . lépés:, és navigáljon [Delete futtatása előzményadatok](#delete-run-history-data) lépés.</span><span class="sxs-lookup"><span data-stu-id="d7c39-127">Skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="d7c39-128">Ha nem fut, próbálja meg elindítani a szolgáltatást.</span><span class="sxs-lookup"><span data-stu-id="d7c39-128">If it is not running, try to start the service.</span></span> <span data-ttu-id="d7c39-129">Kihagyása, ha a szolgáltatás sikeresen elindul, [az adatbázis zsugorítása](#shrink-the-database) . lépés:, és navigáljon [Delete futtatása előzményadatok](#delete-run-history-data) lépés.</span><span class="sxs-lookup"><span data-stu-id="d7c39-129">If the service starts successfully, skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="d7c39-130">Ellenkező esetben folytassa [az adatbázis zsugorítása](#shrink-the-database) lépés.</span><span class="sxs-lookup"><span data-stu-id="d7c39-130">Otherwise, continue with [Shrink the database](#shrink-the-database) step.</span></span>

### <a name="shrink-the-database"></a><span data-ttu-id="d7c39-131">Az adatbázis zsugorítása</span><span class="sxs-lookup"><span data-stu-id="d7c39-131">Shrink the database</span></span>
<span data-ttu-id="d7c39-132">A zsugorítási művelet használatával szabadítson fel elegendő DB helyet a szinkronizálási szolgáltatás elindításához.</span><span class="sxs-lookup"><span data-stu-id="d7c39-132">Use the Shrink operation to free up enough DB space to start the Synchronization Service.</span></span> <span data-ttu-id="d7c39-133">Az felszabadítja DB szóközök eltávolításával az adatbázisban.</span><span class="sxs-lookup"><span data-stu-id="d7c39-133">It frees up DB space by removing whitespaces in the database.</span></span> <span data-ttu-id="d7c39-134">Ez a lépés esetén a legjobb, mert nem garantált, hogy mindig helyreállíthatja terület.</span><span class="sxs-lookup"><span data-stu-id="d7c39-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="d7c39-135">További információ a zsugorítási műveletet, olvassa el ebben a cikkben [adatbázis zsugorítása](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="d7c39-135">To learn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d7c39-136">Kihagyhatja ezt a lépést, ha a szinkronizálási szolgáltatás futtatásához.</span><span class="sxs-lookup"><span data-stu-id="d7c39-136">Skip this step if you can get the Synchronization Service to run.</span></span> <span data-ttu-id="d7c39-137">Nem ajánlott elvégezni az SQL Database, ahogyan a megnövekedett töredezettsége miatt teljesítménycsökkenést eredményezhet.</span><span class="sxs-lookup"><span data-stu-id="d7c39-137">It is not recommended to shrink the SQL DB as it can lead to poor performance due to increased fragmentation.</span></span>

<span data-ttu-id="d7c39-138">Az Azure AD Connect létrehozott adatbázis neve nem **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="d7c39-138">The name of the database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="d7c39-139">A zsugorítási művelet elvégzéséhez be kell jelentkeznie vagy a sysadmin (rendszergazda) vagy az adatbázis DBO.</span><span class="sxs-lookup"><span data-stu-id="d7c39-139">To perform a Shrink operation, you must log in either as the sysadmin or DBO of the database.</span></span> <span data-ttu-id="d7c39-140">Az Azure AD Connect telepítése során a következő fiókok jogokat kapnak a sysadmin (rendszergazda):</span><span class="sxs-lookup"><span data-stu-id="d7c39-140">During Azure AD Connect installation, the following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="d7c39-141">A helyi rendszergazdák</span><span class="sxs-lookup"><span data-stu-id="d7c39-141">Local Administrators</span></span>
* <span data-ttu-id="d7c39-142">Az Azure AD Connect telepítésének futtatásához használt felhasználói fiók.</span><span class="sxs-lookup"><span data-stu-id="d7c39-142">The user account that was used to run Azure AD Connect installation.</span></span>
* <span data-ttu-id="d7c39-143">A szinkronizálási szolgáltatásfiók az Azure AD Connect szinkronizálási szolgáltatás üzemi környezetben használt.</span><span class="sxs-lookup"><span data-stu-id="d7c39-143">The Sync Service account that is used as the operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="d7c39-144">A helyi csoport telepítése során létrehozott ADSyncAdmins.</span><span class="sxs-lookup"><span data-stu-id="d7c39-144">The local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="d7c39-145">Készítsen biztonsági mentést az adatbázis másolása **ADSync.mdf** és **ADSync_log.ldf** alatt található fájlok `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` egy biztonságos helyre.</span><span class="sxs-lookup"><span data-stu-id="d7c39-145">Back up the database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` to a safe location.</span></span>

2. <span data-ttu-id="d7c39-146">Indítson el egy új PowerShell-munkamenetet.</span><span class="sxs-lookup"><span data-stu-id="d7c39-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="d7c39-147">Navigáljon a mappa `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="d7c39-147">Navigate to folder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="d7c39-148">Start **sqlcmd** segédprogram a parancs futtatásával `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, az adatbázis DBO vagy egy rendszergazdai hitelesítő adatokkal.</span><span class="sxs-lookup"><span data-stu-id="d7c39-148">Start **sqlcmd** utility by running the command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using the credential of a sysadmin or the database DBO.</span></span>

5. <span data-ttu-id="d7c39-149">Az adatbázis, az sqlcmd parancssorból: zsugorítani (1 >), adja meg `DBCC Shrinkdatabase(ADSync,1);`, utána pedig `GO` a következő sorban található.</span><span class="sxs-lookup"><span data-stu-id="d7c39-149">To shrink the database, at the sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in the next line.</span></span>

6. <span data-ttu-id="d7c39-150">Ha a művelet sikeres, próbálja meg újból elindítani a szinkronizálási szolgáltatást.</span><span class="sxs-lookup"><span data-stu-id="d7c39-150">If the operation is successful, try to start the Synchronization Service again.</span></span> <span data-ttu-id="d7c39-151">Ha a szinkronizálási szolgáltatást el lehet indítani, folytassa a [Delete előzményadatok futtassa](#delete-run-history-data) lépés.</span><span class="sxs-lookup"><span data-stu-id="d7c39-151">If you can start the Synchronization Service, go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="d7c39-152">Ha nem, forduljon a támogatási szolgálathoz.</span><span class="sxs-lookup"><span data-stu-id="d7c39-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="d7c39-153">Futtassa az előzményadatok törlése</span><span class="sxs-lookup"><span data-stu-id="d7c39-153">Delete run history data</span></span>
<span data-ttu-id="d7c39-154">Alapértelmezés szerint az Azure AD Connect megőrzi be a hét nap értékelésével futtatási előzményei.</span><span class="sxs-lookup"><span data-stu-id="d7c39-154">By default, Azure AD Connect retains up to seven days’ worth of run history data.</span></span> <span data-ttu-id="d7c39-155">Ebben a lépésben azt DB jusson, hogy az Azure AD Connect szinkronizálási szolgáltatás is indítsa el újra a szinkronizálással futtatási előzményei adatokat törli.</span><span class="sxs-lookup"><span data-stu-id="d7c39-155">In this step, we delete the run history data to reclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="d7c39-156">Start **Synchronization Service Managert** START → szinkronizálási szolgáltatás címen.</span><span class="sxs-lookup"><span data-stu-id="d7c39-156">Start **Synchronization Service Manager** by going to START → Synchronization Service.</span></span>

2.  <span data-ttu-id="d7c39-157">Lépjen a **műveletek** fülre.</span><span class="sxs-lookup"><span data-stu-id="d7c39-157">Go to the **Operations** tab.</span></span>

3.  <span data-ttu-id="d7c39-158">A **műveletek**, jelölje be **egyértelmű futtatása**...</span><span class="sxs-lookup"><span data-stu-id="d7c39-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="d7c39-159">Választhat **törölje az összes futtatása** vagy **előtt fut törlése... <date>**  lehetőséget.</span><span class="sxs-lookup"><span data-stu-id="d7c39-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="d7c39-160">Ajánlott elindításához futtassa a két napnál régebbi előzmények adatok törlésével.</span><span class="sxs-lookup"><span data-stu-id="d7c39-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="d7c39-161">Ha továbbra is az adatbázis méretének problémát tapasztal, majd válassza ki a **törölje az összes futtatása** lehetőséget.</span><span class="sxs-lookup"><span data-stu-id="d7c39-161">If you continue to run into DB size issue, then choose the **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="d7c39-162">Rövidítse le a futtatási előzményei adatok megőrzési időtartama</span><span class="sxs-lookup"><span data-stu-id="d7c39-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="d7c39-163">Ez a lépés akkor több szinkronizálási ciklust követően a 10 GB-os korlát probléma rendszert futtató valószínűségét csökkentése érdekében.</span><span class="sxs-lookup"><span data-stu-id="d7c39-163">This step is to reduce the likelihood of running into the 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="d7c39-164">Nyisson meg egy új PowerShell-munkamenetet.</span><span class="sxs-lookup"><span data-stu-id="d7c39-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="d7c39-165">Futtatás `Get-ADSyncScheduler` és jegyezze fel a PurgeRunHistoryInterval tulajdonság, amely azt adja meg az aktuális megőrzési időszak.</span><span class="sxs-lookup"><span data-stu-id="d7c39-165">Run `Get-ADSyncScheduler` and take note of the PurgeRunHistoryInterval property, which specifies the current retention period.</span></span>

3. <span data-ttu-id="d7c39-166">Futtatás `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` beállítani a megőrzési idő két nap.</span><span class="sxs-lookup"><span data-stu-id="d7c39-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` to set the retention period to two days.</span></span> <span data-ttu-id="d7c39-167">A megőrzési idő, szükség szerint módosítsa.</span><span class="sxs-lookup"><span data-stu-id="d7c39-167">Adjust the retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-to-full-sql"></a><span data-ttu-id="d7c39-168">Hosszú távú megoldásokról – a teljes SQL áttelepítése</span><span class="sxs-lookup"><span data-stu-id="d7c39-168">Long-term solution – Migrate to full SQL</span></span>
<span data-ttu-id="d7c39-169">A probléma általában előzetes, hogy 10 GB-os adatbázisméret már nem elegendő az Azure AD Connect szinkronizálása a helyszíni Active Directory, az Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d7c39-169">In general, the issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect to synchronize your on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="d7c39-170">Ajánlott váltani az SQL server teljes verzióját használja.</span><span class="sxs-lookup"><span data-stu-id="d7c39-170">It is recommended that you switch to using the full version of SQL server.</span></span> <span data-ttu-id="d7c39-171">Az Azure AD Connect üzemelő példányának LocalDB adatbázisát nem cserélheti le közvetlenül az SQL teljes verziójának adatbázisára.</span><span class="sxs-lookup"><span data-stu-id="d7c39-171">You cannot directly replace the LocalDB of an existing Azure AD Connect deployment with the database of the full version of SQL.</span></span> <span data-ttu-id="d7c39-172">Ehelyett egy új Azure AD Connect-kiszolgálót kell üzembe helyeznie az SQL teljes verziójával.</span><span class="sxs-lookup"><span data-stu-id="d7c39-172">Instead, you must deploy a new Azure AD Connect server with the full version of SQL.</span></span> <span data-ttu-id="d7c39-173">Ajánlott a párhuzamos migrálás, amely során az (SQL-adatbázist tartalmazó) új Azure AD Connect-kiszolgálót átmeneti kiszolgálóként helyezi üzembe a (LocalDB-adatbázist tartalmazó) meglévő Azure AD Connect-kiszolgáló mellett.</span><span class="sxs-lookup"><span data-stu-id="d7c39-173">It is recommended that you do a swing migration where the new Azure AD Connect server (with SQL DB) is deployed as a staging server, next to the existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="d7c39-174">A távoli SQL az Azure AD Connecttel történő konfigurálásáról tekintse meg a [Az Azure AD Connect egyéni telepítése](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom) című cikket.</span><span class="sxs-lookup"><span data-stu-id="d7c39-174">For instruction on how to configure remote SQL with Azure AD Connect, refer to article [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="d7c39-175">Az Azure AD Connect frissítésének párhuzamos migrálásáról tekintse meg az [Azure AD Connect: Frissítés egy előző verzióról a legújabbra](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration) című cikket.</span><span class="sxs-lookup"><span data-stu-id="d7c39-175">For instructions on swing migration for Azure AD Connect upgrade, refer to article [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="d7c39-176">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="d7c39-176">Next steps</span></span>
<span data-ttu-id="d7c39-177">További információ: [Helyszíni identitások integrálása az Azure Active Directoryval](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="d7c39-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
