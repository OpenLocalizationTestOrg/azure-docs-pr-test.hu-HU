---
title: "Növekményes pillanatképek használja biztonsági mentése és helyreállítása nem felügyelt Azure virtuális gépek lemezei |} Microsoft Docs"
description: "Hozzon létre egy egyéni biztonsági mentés és helyreállítás a növekményes pillanatképek használata Azure virtuális gépek lemezeit a megoldás."
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: 3524b987-bd65-4e35-83e7-fbc2136643e5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: aungoo
ms.openlocfilehash: 7b08ce207b2a3cc2dd3d3559765def6af42a844a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 07/11/2017
---
# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="aeb06-103">Készítsen biztonsági másolatot az Azure nem felügyelt méretű lemezek növekményes pillanatképek</span><span class="sxs-lookup"><span data-stu-id="aeb06-103">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="aeb06-104">Áttekintés</span><span class="sxs-lookup"><span data-stu-id="aeb06-104">Overview</span></span>
<span data-ttu-id="aeb06-105">Az Azure Storage lehetővé teszi a pillanatképek készítése a blobokat.</span><span class="sxs-lookup"><span data-stu-id="aeb06-105">Azure Storage provides the capability to take snapshots of blobs.</span></span> <span data-ttu-id="aeb06-106">Pillanatképek a blob állapot abban az idő rögzítése.</span><span class="sxs-lookup"><span data-stu-id="aeb06-106">Snapshots capture the blob state at that point in time.</span></span> <span data-ttu-id="aeb06-107">Ez a cikk azt ismerteti, hogyan kezelheti a pillanatképek használata virtuális gépek lemezeinek biztonsági másolatait a forgatókönyvet.</span><span class="sxs-lookup"><span data-stu-id="aeb06-107">In this article, we will describe a scenario of how you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="aeb06-108">Ez a módszer segítségével használhatja, ha nem az Azure biztonsági mentési és helyreállítási szolgáltatás, és létrehozza a virtuális gépek lemezeit egyéni biztonsági mentési stratégiáját.</span><span class="sxs-lookup"><span data-stu-id="aeb06-108">You can use this methodology when you choose not to use Azure Backup and Recovery Service, and wish to create a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="aeb06-109">Azure virtuális gépek lemezeit, az Azure Storage lapblobokat tárolódnak.</span><span class="sxs-lookup"><span data-stu-id="aeb06-109">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="aeb06-110">Azt is van szó ebben a cikkben a virtuális gépek lemezeinek biztonsági mentési stratégiája, mivel azt fogja kell hivatkozó pillanatképek lapblobokat környezetében.</span><span class="sxs-lookup"><span data-stu-id="aeb06-110">Since we are talking about backup strategy for virtual machine disks in this article, we will be referring to snapshots in the context of page blobs.</span></span> <span data-ttu-id="aeb06-111">A pillanatképek kapcsolatos további tudnivalókért tekintse meg [egy pillanatképet készíteni egy Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="aeb06-111">To learn more about snapshots, refer to [Creating a Snapshot of a Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="aeb06-112">Mi az a pillanatképet?</span><span class="sxs-lookup"><span data-stu-id="aeb06-112">What is a snapshot?</span></span>
<span data-ttu-id="aeb06-113">Egy blob pillanatképet egy időben rögzített blob csak olvasható verziója telepítve.</span><span class="sxs-lookup"><span data-stu-id="aeb06-113">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="aeb06-114">Pillanatkép létrehozása, azt is kell olvasni, másolja, vagy törölni, de nem módosított.</span><span class="sxs-lookup"><span data-stu-id="aeb06-114">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="aeb06-115">A pillanatképek lehetőséget nyújtanak olyan biztonsági mentése blob, ahogyan megjelenik egy időben el.</span><span class="sxs-lookup"><span data-stu-id="aeb06-115">Snapshots provide a way to back up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="aeb06-116">Amíg a többi 2015-04-05-ös verziója kellett teljes pillanatképek másolása lehetőséget.</span><span class="sxs-lookup"><span data-stu-id="aeb06-116">Until REST version 2015-04-05 you had the ability to copy full snapshots.</span></span> <span data-ttu-id="aeb06-117">A többi verzió 2015-07-08 és újabb verzióiban meg is másolhatja növekményes pillanatképek.</span><span class="sxs-lookup"><span data-stu-id="aeb06-117">With the REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="aeb06-118">Teljes pillanatkép másolása</span><span class="sxs-lookup"><span data-stu-id="aeb06-118">Full snapshot copy</span></span>
<span data-ttu-id="aeb06-119">A pillanatképek másik tárolási fiókot, egy blobot alap BLOB biztonsági mentések megtartása másolhat.</span><span class="sxs-lookup"><span data-stu-id="aeb06-119">Snapshots can be copied to another storage account as a blob to keep backups of the base blob.</span></span> <span data-ttu-id="aeb06-120">Pillanatkép a alap, mint a blob visszaállítása egy korábbi blob keresztül is másolhatja.</span><span class="sxs-lookup"><span data-stu-id="aeb06-120">You can also copy a snapshot over its base blob, which is like restoring the blob to an earlier version.</span></span> <span data-ttu-id="aeb06-121">Amikor a pillanatképet egy másik másolja át egy tárfiókot, azt a azonos lemezterületet a kiinduló lap blob elfoglalja.</span><span class="sxs-lookup"><span data-stu-id="aeb06-121">When a snapshot is copied from one storage account to another, it will occupy the same space as the base page blob.</span></span> <span data-ttu-id="aeb06-122">Ezért másolása teljes pillanatképek származó egy másik lassú lesz, és is fog használni, nagy mennyiségű lemezterületet a cél tárfiók.</span><span class="sxs-lookup"><span data-stu-id="aeb06-122">Therefore, copying whole snapshots from one storage account to another will be slow and will also consume lot of space in the target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="aeb06-123">Ha az alap blob másolása másik célhelyet, a pillanatképek a BLOB nem kerülnek.</span><span class="sxs-lookup"><span data-stu-id="aeb06-123">If you copy the base blob to another destination, the snapshots of the blob are not copied along with it.</span></span> <span data-ttu-id="aeb06-124">Ehhez hasonlóan alap blob felülírása egy másolatot, ha az alap blob tartozó pillanatképet nem érinti és ép alap blob neve alatt maradnak.</span><span class="sxs-lookup"><span data-stu-id="aeb06-124">Similarly, if you overwrite a base blob with a copy, snapshots associated with the base blob are not affected and stay intact under base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="aeb06-125">Készítsen biztonsági másolatot készített pillanatfelvételek segítségével történő lemezek</span><span class="sxs-lookup"><span data-stu-id="aeb06-125">Back up disks using snapshots</span></span>
<span data-ttu-id="aeb06-126">A virtuális gépek lemezeit a biztonsági mentési stratégia, mint a lemez vagy a lap BLOB rendszeres időközönként pillanatképek tarthat, és azokat egy másik tárolási fiókot használva másolási eszközökkel, mint például [másolási Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) művelet vagy [AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="aeb06-126">As a backup strategy for your virtual machine disks, you can take periodic snapshots of the disk or page blob, and copy them to another storage account using tools like [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) operation or [AzCopy](storage-use-azcopy.md).</span></span> <span data-ttu-id="aeb06-127">A cél az oldalakra vonatkozó blob egy eltérő nevű pillanatkép másolhatja.</span><span class="sxs-lookup"><span data-stu-id="aeb06-127">You can copy a snapshot to a destination page blob with a different name.</span></span> <span data-ttu-id="aeb06-128">Az eredményül kapott cél oldalakra vonatkozó blob írható oldalakra vonatkozó blob és a pillanatkép nem.</span><span class="sxs-lookup"><span data-stu-id="aeb06-128">The resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="aeb06-129">A cikk azt ismerteti, lépéseket kell tennie a pillanatképek használata virtuális gépek lemezeinek biztonsági másolatait.</span><span class="sxs-lookup"><span data-stu-id="aeb06-129">Later in this article we will describe steps to take backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="aeb06-130">A lemezek pillanatképek visszaállítása</span><span class="sxs-lookup"><span data-stu-id="aeb06-130">Restore disks using snapshots</span></span>
<span data-ttu-id="aeb06-131">Ha a lemez helyreállításához a biztonsági mentési pillanatképek egyikében rögzített stabil korábbi, pillanatkép másolhatja a kiinduló lap blob keresztül.</span><span class="sxs-lookup"><span data-stu-id="aeb06-131">When it is time to restore your disk to a previous stable version captured in one of the backup snapshots, you can copy a snapshot over the base page blob.</span></span> <span data-ttu-id="aeb06-132">Követően a pillanatkép van előléptetve a kiinduló lap blob, a pillanatkép marad, de a forrás, amely képes is olvashatók és írhatók másolatot felülírja.</span><span class="sxs-lookup"><span data-stu-id="aeb06-132">After the snapshot is promoted to the base page blob, the snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="aeb06-133">A cikk azt ismerteti, a pillanatkép visszaállítása egy korábbi verzióját a lemez lépéseket.</span><span class="sxs-lookup"><span data-stu-id="aeb06-133">Later in this article we will describe steps to restore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="aeb06-134">Végrehajtási teljes pillanatkép másolása</span><span class="sxs-lookup"><span data-stu-id="aeb06-134">Implementing full snapshot copy</span></span>
<span data-ttu-id="aeb06-135">Megvalósíthat egy teljes pillanatképet másolása a következő tevékenységek végrehajtásával</span><span class="sxs-lookup"><span data-stu-id="aeb06-135">You can implement a full snapshot copy by doing the following,</span></span>

* <span data-ttu-id="aeb06-136">Először készítsen pillanatképet az alap blob használatával a [pillanatkép Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) műveletet.</span><span class="sxs-lookup"><span data-stu-id="aeb06-136">First, take a snapshot of the base blob using the [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) operation.</span></span>
* <span data-ttu-id="aeb06-137">A célként megadott tárolási fiók használatával, majd másolja a pillanatkép [másolási Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="aeb06-137">Then, copy the snapshot to a target storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span>
* <span data-ttu-id="aeb06-138">Ismételje meg a folyamatot, az alap blobba biztonsági másolatait.</span><span class="sxs-lookup"><span data-stu-id="aeb06-138">Repeat this process to maintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="aeb06-139">Növekményes pillanatképet másolása</span><span class="sxs-lookup"><span data-stu-id="aeb06-139">Incremental snapshot copy</span></span>
<span data-ttu-id="aeb06-140">Az új funkciója [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API készítsen biztonsági másolatot a pillanatképek a lapblobokat és lemezek javulás lehetőséget kínál.</span><span class="sxs-lookup"><span data-stu-id="aeb06-140">The new feature in [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API provides a much better way to back up the snapshots of your page blobs or disks.</span></span> <span data-ttu-id="aeb06-141">Az API-t azokat a változásokat az alap blob és a pillanatképek között adja vissza.</span><span class="sxs-lookup"><span data-stu-id="aeb06-141">The API returns the list of changes between the base blob and the snapshots.</span></span> <span data-ttu-id="aeb06-142">Ez csökkenti a biztonsági mentési fiók felhasznált tárterület.</span><span class="sxs-lookup"><span data-stu-id="aeb06-142">This reduces the amount of storage space used on the backup account.</span></span> <span data-ttu-id="aeb06-143">Az API támogatja a lapblobokat prémium szintű Storage, valamint a standard szintű tárolót.</span><span class="sxs-lookup"><span data-stu-id="aeb06-143">The API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="aeb06-144">Ez az API használatával, most már lefordíthatja gyorsabb és hatékonyabb biztonsági mentési megoldás az Azure virtuális gépeken.</span><span class="sxs-lookup"><span data-stu-id="aeb06-144">Using this API, you can now build faster and efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="aeb06-145">Ez lesz elérhető, a többi verziójával 2015-07-08 és magasabb.</span><span class="sxs-lookup"><span data-stu-id="aeb06-145">This will be available with the REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="aeb06-146">Növekményes pillanatképet másolási lehetővé teszi másolhat egy tárfiók egy másikra a különbség a között,</span><span class="sxs-lookup"><span data-stu-id="aeb06-146">Incremental Snapshot Copy allows you to copy from one storage account to another the difference between,</span></span>

* <span data-ttu-id="aeb06-147">Alap blob és a pillanatkép vagy</span><span class="sxs-lookup"><span data-stu-id="aeb06-147">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="aeb06-148">A kiinduló BLOB bármely két pillanatképek</span><span class="sxs-lookup"><span data-stu-id="aeb06-148">Any two snapshots of the base blob</span></span>

<span data-ttu-id="aeb06-149">A következő feltételek teljesülnek, a megadott</span><span class="sxs-lookup"><span data-stu-id="aeb06-149">Provided the following conditions are met,</span></span>

* <span data-ttu-id="aeb06-150">A blob Jan-1-2016 vagy újabb hozták létre.</span><span class="sxs-lookup"><span data-stu-id="aeb06-150">The blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="aeb06-151">A blob nem írja felül a [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) vagy [másolási Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) két pillanatképek között.</span><span class="sxs-lookup"><span data-stu-id="aeb06-151">The blob was not overwritten with [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) or [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) between two snapshots.</span></span>

<span data-ttu-id="aeb06-152">**Megjegyzés:**: Ez a funkció érhető el prémium és Standard Azure Lapblobokat.</span><span class="sxs-lookup"><span data-stu-id="aeb06-152">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="aeb06-153">Ha van egy egyéni biztonsági mentési stratégia pillanatképeket használó a pillanatképek másolása egy tárfiókot másik nagyon lassú lehet, és nagy mennyiségű tárhely fel.</span><span class="sxs-lookup"><span data-stu-id="aeb06-153">When you have a custom backup strategy that uses snapshots, copying the snapshots from one storage account to another can be very slow and consumes a lot of storage space.</span></span> <span data-ttu-id="aeb06-154">Helyett másolja át a teljes pillanatkép biztonsági mentési tárfiókba, a biztonsági mentési oldalakra vonatkozó blob egymást követő pillanatképek közötti különbség is írhat.</span><span class="sxs-lookup"><span data-stu-id="aeb06-154">Instead of copying the entire snapshot to a backup storage account, you can write the difference between consecutive snapshots to a backup page blob.</span></span> <span data-ttu-id="aeb06-155">Ezzel a módszerrel a másolás és a biztonsági mentések tárolására szolgáló terület ideje jelentősen csökken.</span><span class="sxs-lookup"><span data-stu-id="aeb06-155">This way, the time to copy and space to store backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="aeb06-156">Végrehajtási növekményes pillanatképet másolása</span><span class="sxs-lookup"><span data-stu-id="aeb06-156">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="aeb06-157">A következőképpen valósíthatja növekményes pillanatképet másolása</span><span class="sxs-lookup"><span data-stu-id="aeb06-157">You can implement incremental snapshot copy by doing the following,</span></span>

* <span data-ttu-id="aeb06-158">Pillanatkép készítése a alap blob használatával [pillanatkép Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span><span class="sxs-lookup"><span data-stu-id="aeb06-158">Take a snapshot of the base blob using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span></span>
* <span data-ttu-id="aeb06-159">A cél biztonsági másolatok tárolási fiók használatával másolja a pillanatkép [másolási Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="aeb06-159">Copy the snapshot to the target backup storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span> <span data-ttu-id="aeb06-160">Ez a biztonsági mentési oldalakra vonatkozó blob lesz.</span><span class="sxs-lookup"><span data-stu-id="aeb06-160">This will be the backup page blob.</span></span> <span data-ttu-id="aeb06-161">Pillanatkép készítése a biztonsági mentési oldalakra vonatkozó blob, és tárolja a biztonsági mentési fiók.</span><span class="sxs-lookup"><span data-stu-id="aeb06-161">Take a snapshot of this backup page blob and store in backup account.</span></span>
* <span data-ttu-id="aeb06-162">Egy másik pillanatképet, az alap blob pillanatkép Blob használatával.</span><span class="sxs-lookup"><span data-stu-id="aeb06-162">Take another snapshot of the base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="aeb06-163">Alap blob használatának első és második pillanatképek közötti különbség beolvasása [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span><span class="sxs-lookup"><span data-stu-id="aeb06-163">Get the difference between first and second snapshots of base blob using  [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span></span> <span data-ttu-id="aeb06-164">Használja az új paramétert **prevsnapshot** le szeretné kérdezni a különbség a pillanatkép DateTime értéket.</span><span class="sxs-lookup"><span data-stu-id="aeb06-164">Use the new parameter **prevsnapshot** to specify the DateTime value of the snapshot you want to get the difference with.</span></span> <span data-ttu-id="aeb06-165">Ha ez a paraméter meg adva, a többi válasz csak a cél pillanatkép és a korábbi pillanatképből, többek között a tiszta lapok között módosított lapokat tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="aeb06-165">When this parameter is present, the REST response will include only the pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="aeb06-166">Használjon [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) változtatásait szeretné alkalmazni ezeket a biztonsági mentési oldalakra vonatkozó blob.</span><span class="sxs-lookup"><span data-stu-id="aeb06-166">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) to apply these changes to the backup page blob.</span></span>
* <span data-ttu-id="aeb06-167">Végezetül pillanatkép készítése a biztonsági mentési oldalakra vonatkozó blob, és tárolja a biztonsági mentési tárfiókot.</span><span class="sxs-lookup"><span data-stu-id="aeb06-167">Finally, take a snapshot of the backup page blob and store it in the backup storage account.</span></span>

<span data-ttu-id="aeb06-168">A következő szakaszban azt ismerteti, részletesebben hogyan kezelheti a biztonsági mentések lemezek növekményes pillanatképet-másolással</span><span class="sxs-lookup"><span data-stu-id="aeb06-168">In the next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="aeb06-169">Forgatókönyv</span><span class="sxs-lookup"><span data-stu-id="aeb06-169">Scenario</span></span>
<span data-ttu-id="aeb06-170">Ebben a szakaszban ismerteti azt a forgatókönyvet, amely magában foglalja a virtuális gép lemezeinek készített pillanatfelvételek segítségével történő egyéni biztonsági mentési stratégiáját.</span><span class="sxs-lookup"><span data-stu-id="aeb06-170">In this section we will describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="aeb06-171">Vegye figyelembe a DS sorozatnak Azure virtuális gépek csatolt prémium szintű storage P30 lemezzel.</span><span class="sxs-lookup"><span data-stu-id="aeb06-171">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="aeb06-172">A P30 lemez nevű *mypremiumdisk* tárolódik a prémium szintű storage-fiók neve *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-172">The P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="aeb06-173">Standard szintű tárfiók nevű *mybackupstdaccount* a biztonsági másolatának tárolására használandó *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-173">A standard storage account called *mybackupstdaccount* will be used for storing the backup of *mypremiumdisk*.</span></span> <span data-ttu-id="aeb06-174">Azt szeretné tartani a pillanatképet *mypremiumdisk* 12 óránként.</span><span class="sxs-lookup"><span data-stu-id="aeb06-174">We would like to keep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="aeb06-175">A tárfiók és a lemezek létrehozásával kapcsolatos további tudnivalókért tekintse meg [tudnivalók az Azure storage-fiókok](storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="aeb06-175">To learn about creating storage account and disks, refer to [About Azure storage accounts](storage-create-storage-account.md).</span></span>

<span data-ttu-id="aeb06-176">Az Azure virtuális gépek biztonsági mentéséről további tudnivalókért tekintse meg [tervezze meg az Azure virtuális gép biztonsági mentések](../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="aeb06-176">To learn about backing up Azure VMs, refer to [Plan Azure VM backups](../backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="aeb06-177">Ismerteti a végrehajtás lépéseit egy lemez növekményes készített pillanatfelvételek segítségével történő biztonsági mentés karbantartása</span><span class="sxs-lookup"><span data-stu-id="aeb06-177">Steps to maintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="aeb06-178">Az alábbiakban ismertetett lépések érvénybe a pillanatkép-készítési *mypremiumdisk* és karbantartása a biztonsági másolatok *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-178">The steps described below will take snapshots of *mypremiumdisk* and maintain the backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="aeb06-179">A biztonsági másolat nevű szabványos oldalakra vonatkozó blob lesz *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-179">The backup will be a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="aeb06-180">A biztonsági mentési oldalakra vonatkozó blob mindig fogja tartalmazni az utolsó pillanatképét a egyező állapotban *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-180">The backup page blob will always reflect the same state as the last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="aeb06-181">Először hozza létre a biztonsági mentési oldalakra vonatkozó blob a prémium szintű tároló lemez.</span><span class="sxs-lookup"><span data-stu-id="aeb06-181">First, create the backup page blob for your premium storage disk.</span></span> <span data-ttu-id="aeb06-182">Ehhez készítsen pillanatképet *mypremiumdisk* nevű *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-182">To do this, take a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="aeb06-183">Másolja a pillanatkép mybackupstdaccount nevű oldalblobként *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-183">Copy this snapshot to mybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="aeb06-184">Pillanatkép készítése *mybackupstdpageblob* nevű *mybackupstdpageblob_ss1*használatával [pillanatkép Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) és tárolja a *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-184">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="aeb06-185">A biztonsági mentési időszakban egy másik pillanatkép létrehozása a *mypremiumdisk*, azaz *mypremiumdisk_ss2*, és tárolja a *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-185">During the backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="aeb06-186">A növekményes módosult a két pillanatképek közötti *mypremiumdisk_ss2* és *mypremiumdisk_ss1*használatával [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) a *mypremiumdisk_ss2* rendelkező **prevsnapshot** paraméter értéke a időbélyegzője *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-186">Get the incremental changes between the two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) on *mypremiumdisk_ss2* with **prevsnapshot** parameter set to the timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="aeb06-187">Ezek a növekményes változásokat írni a biztonsági mentési oldalakra vonatkozó blob *mybackupstdpageblob* a *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-187">Write these incremental changes to the backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="aeb06-188">Ha a növekményes változásokat törölt tartománya, akkor törölni kell a biztonsági mentési oldalakra vonatkozó blob a.</span><span class="sxs-lookup"><span data-stu-id="aeb06-188">If there are deleted ranges in the incremental changes, they must be cleared from the backup page blob.</span></span> <span data-ttu-id="aeb06-189">Használjon [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) a növekményes változásokat írni a biztonsági mentési oldalakra vonatkozó blob.</span><span class="sxs-lookup"><span data-stu-id="aeb06-189">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) to write incremental changes to the backup page blob.</span></span>
6. <span data-ttu-id="aeb06-190">Pillanatkép készítése a biztonsági mentési oldalakra vonatkozó blob *mybackupstdpageblob*néven *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-190">Take a snapshot of the backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="aeb06-191">Törölje az előző pillanatképet *mypremiumdisk_ss1* a prémium szintű storage-fiók.</span><span class="sxs-lookup"><span data-stu-id="aeb06-191">Delete the previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="aeb06-192">Minden biztonsági mentés időszakának ismételje meg a 4 – 6.</span><span class="sxs-lookup"><span data-stu-id="aeb06-192">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="aeb06-193">Így akkor is fenntartható a biztonsági másolatainak *mypremiumdisk* szabványos tárfiókokban.</span><span class="sxs-lookup"><span data-stu-id="aeb06-193">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Készítsen biztonsági másolatot növekményes pillanatképek használatával](./media/storage-incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a><span data-ttu-id="aeb06-195">A lemez a visszaállítandó pillanatképek lépései</span><span class="sxs-lookup"><span data-stu-id="aeb06-195">Steps to restore a disk from snapshots</span></span>
<span data-ttu-id="aeb06-196">Az alábbiakban ismertetett lépések visszaállítja a prémium szintű lemez *mypremiumdisk* egy korábbi pillanatkép biztonsági másolatokat tároló-fiókból való *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-196">The steps described below will restore premium disk, *mypremiumdisk* to an earlier snapshot from the backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="aeb06-197">A pont azonosítható a prémium szintű lemez visszaállítása előtt.</span><span class="sxs-lookup"><span data-stu-id="aeb06-197">Identify the point in time you wish to restore the premium disk to.</span></span> <span data-ttu-id="aeb06-198">Tegyük fel, amelyek van pillanatkép *mybackupstdpageblob_ss2*, amely tárolja a biztonsági mentési tárfiók *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-198">Let's say that is snapshot *mybackupstdpageblob_ss2*, which is stored in the backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="aeb06-199">A mybackupstdaccount, előléptetni a pillanatkép *mybackupstdpageblob_ss2* , az új biztonsági mentési alap oldalakra vonatkozó blob *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-199">In mybackupstdaccount, promote the snapshot *mybackupstdpageblob_ss2* as the new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="aeb06-200">Pillanatkép készítése a visszaállított biztonsági mentési oldalakra vonatkozó blob, úgynevezett *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-200">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="aeb06-201">Másolja a visszaállított oldalakra vonatkozó blob *mybackupstdpageblobrestored* a *mybackupstdaccount* való *mypremiumaccount* az új premium tárolására *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="aeb06-201">Copy the restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* to *mypremiumaccount* as the new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="aeb06-202">Pillanatkép készítése *mypremiumdiskrestored*néven *mypremiumdiskrestored_ss1* jövőbeli növekményes biztonsági mentést készíteni.</span><span class="sxs-lookup"><span data-stu-id="aeb06-202">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="aeb06-203">A DS adatsorozat VM mutasson a visszaállított lemez *mypremiumdiskrestored* és a régi leválasztási *mypremiumdisk* a virtuális gépről.</span><span class="sxs-lookup"><span data-stu-id="aeb06-203">Point the DS series VM to the restored disk *mypremiumdiskrestored* and detach the old *mypremiumdisk* from the VM.</span></span>
7. <span data-ttu-id="aeb06-204">A visszaállított lemez előző szakaszban ismertetett biztonsági mentés megkezdéséhez *mypremiumdiskrestored*használatával a *mybackupstdpageblobrestored* , a biztonsági mentési oldalakra vonatkozó blob.</span><span class="sxs-lookup"><span data-stu-id="aeb06-204">Begin the Backup process described in previous section for the restored disk *mypremiumdiskrestored*, using the *mybackupstdpageblobrestored* as the backup page blob.</span></span>

![A pillanatképek lemez visszaállítása](./media/storage-incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="aeb06-206">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="aeb06-206">Next Steps</span></span>
<span data-ttu-id="aeb06-207">Egy blob pillanatképeinek és az alábbi hivatkozások segítségével virtuális gép biztonsági mentési infrastruktúrájának megtervezésével kapcsolatos további tudnivalókért.</span><span class="sxs-lookup"><span data-stu-id="aeb06-207">Learn more about creating snapshots of a blob and planning your VM backup infrastructure using the links below.</span></span>

* [<span data-ttu-id="aeb06-208">Egy BLOB pillanatkép létrehozása</span><span class="sxs-lookup"><span data-stu-id="aeb06-208">Creating a Snapshot of a Blob</span></span>](https://msdn.microsoft.com/library/azure/hh488361.aspx)
* [<span data-ttu-id="aeb06-209">A virtuális gép biztonsági mentési infrastruktúra megtervezése</span><span class="sxs-lookup"><span data-stu-id="aeb06-209">Plan your VM Backup Infrastructure</span></span>](../backup/backup-azure-vms-introduction.md)

