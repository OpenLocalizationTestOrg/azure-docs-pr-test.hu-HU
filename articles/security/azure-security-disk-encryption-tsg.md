---
title: "Azure lemez titkosítási hibaelhárítása |} Microsoft Docs"
description: "Ez a cikk hibaelhárítási tippek a Microsoft Azure lemez Encryption for Windows és Linux IaaS virtuális gépeket."
services: security
documentationcenter: na
author: deventiwari
manager: avibm
editor: yuridio
ms.assetid: ce0e23bd-07eb-43af-a56c-aa1a73bdb747
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/27/2017
ms.author: devtiw
ms.openlocfilehash: 5f482a92b8fcd71a1b767fcc5741bc57605997ea
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 08/29/2017
---
# <a name="azure-disk-encryption-troubleshooting-guide"></a><span data-ttu-id="30d50-103">Azure Disk Encryption hibaelhárítási útmutatója</span><span class="sxs-lookup"><span data-stu-id="30d50-103">Azure Disk Encryption Troubleshooting Guide</span></span>

<span data-ttu-id="30d50-104">Ez az útmutató informatikai (IT) szakemberek készült, információkat adatbiztonsági elemzők, és amelynek szervezetek Azure disk encryption használ, és útmutatást lemeztitkosítás hibaelhárítás kell felhő rendszergazdák kapcsolatos hiba lépett fel.</span><span class="sxs-lookup"><span data-stu-id="30d50-104">This guide is for information technology (IT) professionals, information security analysts, and cloud administrators whose organizations are using Azure disk encryption and need guidance to troubleshoot disk-encryption related issues.</span></span>

## <a name="troubleshooting-linux-os-disk-encryption"></a><span data-ttu-id="30d50-105">Hibaelhárítási Linux operációsrendszer-lemez titkosítása</span><span class="sxs-lookup"><span data-stu-id="30d50-105">Troubleshooting Linux OS disk encryption</span></span>

<span data-ttu-id="30d50-106">Linux operációsrendszer-lemez titkosítása az operációs rendszer meghajtó azt a teljes lemez titkosítása folyamatot futtatása előtt kell választania.</span><span class="sxs-lookup"><span data-stu-id="30d50-106">Linux OS disk encryption must unmount the OS drive prior to running it through the full disk encryption process.</span></span>   <span data-ttu-id="30d50-107">Ha nem tudja, egy hibaüzenet, a "nem tudta leválasztani után..."</span><span class="sxs-lookup"><span data-stu-id="30d50-107">If it cannot, an error message of "failed to unmount after…"</span></span> <span data-ttu-id="30d50-108">hibaüzenet valószínű.</span><span class="sxs-lookup"><span data-stu-id="30d50-108">error message is likely to occur.</span></span>

<span data-ttu-id="30d50-109">Ennek az oka valószínűleg, amikor az operációs rendszer lemeztitkosítás kísérletet egy virtuális gép célkörnyezet módosított vagy a támogatott készlet gyűjtemény lemezképből megváltozott.</span><span class="sxs-lookup"><span data-stu-id="30d50-109">This is most likely when OS disk encryption is attempted on a target VM environment that has been modified or changed from its supported stock gallery image.</span></span>  <span data-ttu-id="30d50-110">A támogatott kép is zavarják a bővítmény leválasztása az operációs rendszer meghajtó eltéréseket közé:</span><span class="sxs-lookup"><span data-stu-id="30d50-110">Examples of deviations from the supported image, which can interfere with the extension’s ability to unmount the OS drive include:</span></span>
- <span data-ttu-id="30d50-111">Testreszabott lemezképeket, amelyek már nem felel meg egy támogatott fájlrendszeren és/vagy a particionálási sémát.</span><span class="sxs-lookup"><span data-stu-id="30d50-111">Customized images that no longer match a supported file system and/or partitioning scheme.</span></span>
- <span data-ttu-id="30d50-112">Alkalmazások, például víruskereső, Docker, SAP, MongoDB vagy az operációs rendszer titkosítási előtt futó Apache Cassandra testreszabott képeket.</span><span class="sxs-lookup"><span data-stu-id="30d50-112">Customized images with applications such as antivirus, Docker, SAP, MongoDB, or Apache Cassandra running in the OS prior to encryption.</span></span>  <span data-ttu-id="30d50-113">Ezeket az alkalmazásokat nehezen leáll, és az operációs rendszer nyitott fájlok leíró megőrzését, ha a meghajtó nem, hibát okozó nem lehet.</span><span class="sxs-lookup"><span data-stu-id="30d50-113">These applications are difficult to terminate, and when they retain open file handles to the OS drive, the drive cannot be unmounted, causing failure.</span></span>
- <span data-ttu-id="30d50-114">Egyéni futtatott parancsfájlok, a zárja be a titkosítás lépéssel közelségi kapcsolat zavaró, és ez a hiba miatt idő.</span><span class="sxs-lookup"><span data-stu-id="30d50-114">Custom scripts that run in close time proximity to the encryption step can interfere and cause this failure.</span></span> <span data-ttu-id="30d50-115">Ez akkor fordulhat elő, ha a Resource Manager-sablon meghatározása végrehajtása egyidejűleg több kiterjesztést, vagy ha egy egyéni parancsprogramok futtatására szolgáló bővítmény vagy egyéb művelet fut egyidejűleg a lemez titkosítása.</span><span class="sxs-lookup"><span data-stu-id="30d50-115">This can happen when a Resource Manager template defines multiple extensions to execute simultaneously, or when a custom script extension or other action is run simultaneously to disk encryption.</span></span>   <span data-ttu-id="30d50-116">Szerializálása és elkülönítése lépéseket azzal megoldhatja a problémát.</span><span class="sxs-lookup"><span data-stu-id="30d50-116">Serializing and isolating such steps may resolve the issue.</span></span>
- <span data-ttu-id="30d50-117">SELinux titkosítás engedélyezése előtt nem lett letiltva, a leválasztási lépés sikertelen lesz.</span><span class="sxs-lookup"><span data-stu-id="30d50-117">When SELinux has not been disabled prior to enabling encryption, the unmount step fails.</span></span>  <span data-ttu-id="30d50-118">SELinux titkosítási befejeződését követően lehet újra engedélyezni.</span><span class="sxs-lookup"><span data-stu-id="30d50-118">SELinux can be re-enabled after encryption has completed.</span></span>
- <span data-ttu-id="30d50-119">Ha az operációsrendszer-lemezképet használ egy LVM séma (bár korlátozott LVM adatok támogatása nem érhető el, az operációs rendszer LVM lemez nem)</span><span class="sxs-lookup"><span data-stu-id="30d50-119">When the OS disk is using an LVM scheme (although limited LVM data disk support is available, LVM OS disk is not)</span></span>
- <span data-ttu-id="30d50-120">Ha minimális memória feltételeknek nem felel meg (az operációs rendszer lemeztitkosítás 7GB ajánlott)</span><span class="sxs-lookup"><span data-stu-id="30d50-120">When minimum memory requirements are not met (7GB is suggested for OS disk encryption)</span></span>
- <span data-ttu-id="30d50-121">Amikor adatokat /mnt/ könyvtár, vagy egymással (például /mnt/data1 /mnt/data2, /data3 + /data3/data4, stb.) úton csatlakoztatta a rekurzív módon lett volna</span><span class="sxs-lookup"><span data-stu-id="30d50-121">When data drives have been recursively mounted under /mnt/ directory, or each other (for example, /mnt/data1, /mnt/data2, /data3 + /data3/data4, etc.)</span></span>
- <span data-ttu-id="30d50-122">Ha más Azure Disk Encryption [Előfeltételek](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) Linux nem felel meg</span><span class="sxs-lookup"><span data-stu-id="30d50-122">When other Azure Disk Encryption [prerequisites](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for Linux are not met</span></span>

## <a name="unable-to-encrypt"></a><span data-ttu-id="30d50-123">Nem sikerült titkosítani a</span><span class="sxs-lookup"><span data-stu-id="30d50-123">Unable to encrypt</span></span>

<span data-ttu-id="30d50-124">Néhány esetben az adatok titkosítása úgy tűnik, hogy "Az operációs rendszer lemezén lépések titkosítási" Beragadt Linux és SSH le van tiltva.</span><span class="sxs-lookup"><span data-stu-id="30d50-124">In some cases, the Linux disk encryption appears to be stuck at "OS disk encryption started" and SSH is disabled.</span></span> <span data-ttu-id="30d50-125">Között a készlet gyűjtemény lemezkép 3-16 órát is igénybe vehet.</span><span class="sxs-lookup"><span data-stu-id="30d50-125">This process can take between 3-16 hours to complete on a stock gallery image.</span></span>  <span data-ttu-id="30d50-126">Ha multi-TB-os méret adatlemezt ad hozzá, a nap vehet igénybe.</span><span class="sxs-lookup"><span data-stu-id="30d50-126">If multi-TB size data disks are added, the process may take days.</span></span> <span data-ttu-id="30d50-127">A Linux operációs rendszert futtató lemez titkosítási feladatütemezési ideiglenesen leválasztja az operációs rendszer meghajtó, és végrehajtja a titkosított állapotában tudják, mielőtt a teljes operációsrendszer-lemez blokkonként titkosítását.</span><span class="sxs-lookup"><span data-stu-id="30d50-127">The Linux OS disk encryption sequence unmounts the OS drive temporarily, and performs block by block encryption of the entire OS disk, before remounting it in its encrypted state.</span></span>   <span data-ttu-id="30d50-128">Eltérően Azure Disk Encryption használatát a Windows Linux lemez titkosítása nem engedélyezi a virtuális gép egyidejű használatát amíg folyamatban van a titkosítás.</span><span class="sxs-lookup"><span data-stu-id="30d50-128">Unlike Azure Disk Encryption on Windows, Linux Disk Encryption does not allow concurrent use of the VM while the encryption is in progress.</span></span>  <span data-ttu-id="30d50-129">A teljesítményt nyújt a virtuális gép, például a lemez, hogy standard vagy prémium (SSD) tárhelyre, a tárfiók alapját mérete jelentős mértékben befolyásolhatja a teljes titkosítás szükséges időt.</span><span class="sxs-lookup"><span data-stu-id="30d50-129">The performance characteristics of the VM, including the size of the disk and whether the storage account is backed by standard or premium (SSD) storage, can greatly influence the time required to complete encryption.</span></span>

<span data-ttu-id="30d50-130">Állapotának ellenőrzéséhez a Feladatnézetben mező által visszaadott a [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) parancs lekérhető.</span><span class="sxs-lookup"><span data-stu-id="30d50-130">To check status, the ProgressMessage field returned from the [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) command can be polled.</span></span>   <span data-ttu-id="30d50-131">Az operációs rendszer meghajtó titkosított, miközben a virtuális gép egy karbantartási állapotba kerül, és SSH is le van tiltva fennakadást a folyamatban lévő folyamatban érdekében.</span><span class="sxs-lookup"><span data-stu-id="30d50-131">While the OS drive is being encrypted, the VM enters a servicing state, and SSH is also disabled to prevent any disruption to the ongoing process.</span></span>  <span data-ttu-id="30d50-132">EncryptionInProgress titkosítás folyamatban, majd később egy VMRestartPending üzenet arra kéri a virtuális gép újraindítása az órákat közben az az idő, a legtöbb megjelenik.</span><span class="sxs-lookup"><span data-stu-id="30d50-132">EncryptionInProgress will be reported for the majority of the time while encryption is in progress, followed several hours later with a VMRestartPending message prompting to restart the VM.</span></span>  <span data-ttu-id="30d50-133">Példa:</span><span class="sxs-lookup"><span data-stu-id="30d50-133">For example:</span></span>


```
PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : EncryptionInProgress
DataVolumesEncrypted       : EncryptionInProgress
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk encryption started

PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : VMRestartPending
DataVolumesEncrypted       : Encrypted
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk successfully encrypted, please reboot the VM
```

<span data-ttu-id="30d50-134">Miután kell indítania a virtuális gép után a virtuális gép újraindítása, és egyúttal jogosultságot ad az újraindítás és a befejező lépései végezhető el a célszámítógépen 2-3 percet, állapotüzenetet jelzi, hogy a titkosítás végül befejeződött.</span><span class="sxs-lookup"><span data-stu-id="30d50-134">Once prompted to reboot the VM, and after restarting the VM, and giving 2-3 minutes for the reboot and for final steps to be performed on the target, the status message will indicate that encryption has finally completed.</span></span>   <span data-ttu-id="30d50-135">Ez az üzenet nem érhető el, ha a titkosított meghajtón az operációs rendszer várhatóan készen áll a használatra, és a virtuális gép is használható újra.</span><span class="sxs-lookup"><span data-stu-id="30d50-135">Once this message is available, the encrypted OS drive is expected to be ready for use and for the VM to be usable again.</span></span>

<span data-ttu-id="30d50-136">Azokban az esetekben, ahol az ebben a sorozatban nem fordult elő vagy ha rendszerindítási információk, állapotüzenetet vagy egyéb hiba mutatók jelentést, hogy az operációs rendszer titkosítási közepén Ez a folyamat (például ha a "nem sikerült leválasztani" hiba történt a jelen útmutatóban ismertetett) sikertelen volt, a ajánlott visszaállítani a virtuális Gépet a pillanatkép vagy azonnal titkosítási előtt készült biztonsági másolatok.</span><span class="sxs-lookup"><span data-stu-id="30d50-136">In cases where this sequence was not seen, or if boot information, progress message, or other error indicators report that OS encryption has failed in the middle of this process (for example if you are seeing the "failed to unmount" error described in this guide), it is recommended to restore the VM back to the snapshot or backup taken immediately prior to encryption.</span></span>  <span data-ttu-id="30d50-137">A következő kísérlet előtt javasolt ismételt kiértékelése a virtuális gép jellemzőit, és győződjön meg arról, hogy a szükséges előfeltételek maradéktalanul teljesülnek-e.</span><span class="sxs-lookup"><span data-stu-id="30d50-137">Prior to the next attempt, it is suggested to re-evaluate the characteristics of the VM and ensure that all prerequisites are satisfied.</span></span>

## <a name="troubleshooting-azure-disk-encryption-behind-a-firewall"></a><span data-ttu-id="30d50-138">Hibaelhárítás az Azure Disk Encryption tűzfal mögött</span><span class="sxs-lookup"><span data-stu-id="30d50-138">Troubleshooting Azure Disk Encryption behind a Firewall</span></span>
<span data-ttu-id="30d50-139">Kapcsolat egy tűzfal, a proxy követelmény vagy a hálózati biztonsági csoport (NSG) beállításainak korlátozza, amikor a bővítmény hajthatnak végre a szükséges feladatok is működni.</span><span class="sxs-lookup"><span data-stu-id="30d50-139">When connectivity is restricted by a firewall, proxy requirement, or network security group (NSG) settings, the ability of the extension to perform needed tasks can be disrupted.</span></span>   <span data-ttu-id="30d50-140">Ez például a "Nem érhető el a virtuális Gépen a bővítmény állapotát" állapotüzenetek eredményezhet és várt esetekben nem sikerült befejezni.</span><span class="sxs-lookup"><span data-stu-id="30d50-140">This can result in status messages such as "Extension status not available on the VM" and in expected scenarios failing to finish.</span></span>  <span data-ttu-id="30d50-141">A következő szakaszok rendelkezik néhány tűzfal kapcsolatos gyakori hibák, lehetséges, hogy vizsgálni.</span><span class="sxs-lookup"><span data-stu-id="30d50-141">The sections that follow has some common firewall issues that you may investigate.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="30d50-142">Network security groups (Hálózati biztonsági csoportok)</span><span class="sxs-lookup"><span data-stu-id="30d50-142">Network security groups</span></span>
<span data-ttu-id="30d50-143">A hálózati biztonsági csoport beállításai továbbra is engedélyeznie kell a végpontot a dokumentált hálózati konfigurációnak megfelelő [Előfeltételek](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) a lemez titkosításához.</span><span class="sxs-lookup"><span data-stu-id="30d50-143">Any network security group settings applied must still allow the endpoint to meet the documented network configuration [prerequisites](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) for disk encryption.</span></span>

### <a name="azure-keyvault-behind-firewall"></a><span data-ttu-id="30d50-144">Tűzfal mögött található Azure Keyvault</span><span class="sxs-lookup"><span data-stu-id="30d50-144">Azure Keyvault behind firewall</span></span>
<span data-ttu-id="30d50-145">A virtuális gép kulcstároló eléréséhez képesnek kell lennie.</span><span class="sxs-lookup"><span data-stu-id="30d50-145">The VM must be able to access key vault.</span></span> <span data-ttu-id="30d50-146">Tekintse meg a kulcs tartalék által kezelt tűzfalon keresztül hozzáférést nyújtani a [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) csapatával.</span><span class="sxs-lookup"><span data-stu-id="30d50-146">Refer to guidance on access to key fault from behind a firewall that is maintained by the [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) team.</span></span>

### <a name="linux-package-management-behind-firewall"></a><span data-ttu-id="30d50-147">Linux-csomag felügyeleti tűzfal mögött</span><span class="sxs-lookup"><span data-stu-id="30d50-147">Linux package management behind firewall</span></span>
<span data-ttu-id="30d50-148">Futási időben Azure Disk Encryption Linux támaszkodik a cél terjesztési Csomagkezelő rendszeren titkosítás engedélyezése előtt szükséges előfeltételként szükséges összetevők telepítéséhez.</span><span class="sxs-lookup"><span data-stu-id="30d50-148">At run time, Azure Disk Encryption for Linux relies on the target distribution’s package management system to install needed prerequisite components prior to enabling encryption.</span></span>  <span data-ttu-id="30d50-149">Ha a tűzfal beállításainak megakadályozza, hogy a virtuális gép igényt töltse le és telepítse ezeket az összetevőket, majd további hibák várható.</span><span class="sxs-lookup"><span data-stu-id="30d50-149">If firewall settings prevent the VM from being able to download and install these components, then subsequent failures are expected.</span></span>    <span data-ttu-id="30d50-150">A lépések szerint konfigurálhatja ezt a terjesztési által változhat.</span><span class="sxs-lookup"><span data-stu-id="30d50-150">The steps to configure this may vary by distribution.</span></span>  <span data-ttu-id="30d50-151">A Red Hat Ha a proxy szükség, győződjön meg arról, hogy előfizetés-kezelő és yum megfelelően vannak beállítva nélkülözhetetlen.</span><span class="sxs-lookup"><span data-stu-id="30d50-151">On Red Hat, when a proxy is required, ensuring that subscription-manager and yum are set up properly is vital.</span></span>  <span data-ttu-id="30d50-152">Lásd: [ez](https://access.redhat.com/solutions/189533) Red Hat támogatási cikk erről a témakörről.</span><span class="sxs-lookup"><span data-stu-id="30d50-152">See [this](https://access.redhat.com/solutions/189533) Red Hat support article on this topic.</span></span>  

## <a name="troubleshooting-windows-server-2016-server-core"></a><span data-ttu-id="30d50-153">Windows Server 2016 Server Core hibaelhárítása</span><span class="sxs-lookup"><span data-stu-id="30d50-153">Troubleshooting Windows Server 2016 Server Core</span></span>

<span data-ttu-id="30d50-154">A Windows Server 2016 Server Core az a bdehdcfg összetevő nem áll rendelkezésre, alapértelmezés szerint.</span><span class="sxs-lookup"><span data-stu-id="30d50-154">On Windows Server 2016 Server Core, the bdehdcfg component is not available by default.</span></span> <span data-ttu-id="30d50-155">Ez az összetevő Azure Disk Encryption használata szükséges.</span><span class="sxs-lookup"><span data-stu-id="30d50-155">This component is required by Azure Disk Encryption.</span></span>

<span data-ttu-id="30d50-156">A megoldás a probléma a c:\windows\system32 mappában, a Server Core-lemezkép a Windows Server 2016 Data Center VM fájlok másolása a következő 4:</span><span class="sxs-lookup"><span data-stu-id="30d50-156">To workaround this issue, copy the following 4 files from a Windows Server 2016 Data Center VM to the c:\windows\system32 folder of the Server Core image:</span></span>

```
bdehdcfg.exe
bdehdcfglib.dll
bdehdcfglib.dll.mui
bdehdcfg.exe.mui
```

<span data-ttu-id="30d50-157">Ezután futtassa a következő parancsot:</span><span class="sxs-lookup"><span data-stu-id="30d50-157">Then, run the following command:</span></span>

```
bdehdcfg.exe -target default
```

<span data-ttu-id="30d50-158">Ezzel létrehoz egy 550MB rendszerpartíció, és ezután a rendszer újraindítása után segítségével Diskpart ellenőrizze a kötetek, majd a folytatáshoz.</span><span class="sxs-lookup"><span data-stu-id="30d50-158">This will create a 550MB system partition and then after a reboot, you can use Diskpart to check the volumes, and proceed.</span></span>  

<span data-ttu-id="30d50-159">Példa:</span><span class="sxs-lookup"><span data-stu-id="30d50-159">For example:</span></span>

```
DISKPART> list vol

  Volume ###  Ltr  Label        Fs     Type        Size     Status     Info
  ----------  ---  -----------  -----  ----------  -------  ---------  --------
  Volume 0     C                NTFS   Partition    126 GB  Healthy    Boot
  Volume 1                      NTFS   Partition    550 MB  Healthy    System
  Volume 2     D   Temporary S  NTFS   Partition     13 GB  Healthy    Pagefile
```
## <a name="see-also"></a><span data-ttu-id="30d50-160">Lásd még:</span><span class="sxs-lookup"><span data-stu-id="30d50-160">See also</span></span>
<span data-ttu-id="30d50-161">Ebből a dokumentumból megismerte további információk az Azure disk encryption és elhárítása gyakori problémákat.</span><span class="sxs-lookup"><span data-stu-id="30d50-161">In this document, you learned more about some common issues in Azure disk encryption, and how to troubleshoot.</span></span> <span data-ttu-id="30d50-162">Ez a szolgáltatás és a funkció kapcsolatos további információk:</span><span class="sxs-lookup"><span data-stu-id="30d50-162">For more information about this service and its capability read:</span></span>

- [<span data-ttu-id="30d50-163">Az Azure Security Centerben lemeztitkosítás alkalmazása</span><span class="sxs-lookup"><span data-stu-id="30d50-163">Apply disk encryption in Azure Security Center</span></span>](https://docs.microsoft.com/azure/security-center/security-center-apply-disk-encryption)
- [<span data-ttu-id="30d50-164">Azure virtuális gép titkosítása</span><span class="sxs-lookup"><span data-stu-id="30d50-164">Encrypt an Azure Virtual Machine</span></span>](https://docs.microsoft.com/azure/security-center/security-center-disk-encryption)
- [<span data-ttu-id="30d50-165">Az Azure Data Encryption nyugalmi</span><span class="sxs-lookup"><span data-stu-id="30d50-165">Azure Data Encryption-at-Rest</span></span>](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest)
