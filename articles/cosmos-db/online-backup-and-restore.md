---
title: "Online biztonsági mentés és helyreállítás Azure Cosmos DB |} Microsoft Docs"
description: "Ismerje meg az automatikus biztonsági mentés végrehajtásához, és egy Azure Cosmos DB adatbázis visszaállítása."
keywords: "biztonsági mentés és visszaállítás, az online biztonsági mentés"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: 130f0eb259621737d6dbdb151e363915fb334ce1
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 08/18/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="079c4-104">Automatikus online biztonsági mentés és helyreállítás Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="079c4-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="079c4-105">Azure Cosmos-adatbázis rendszeres időközönként automatikusan az adatok biztonsági másolatainak vesz igénybe.</span><span class="sxs-lookup"><span data-stu-id="079c4-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="079c4-106">Automatikus biztonsági mentés készül anélkül, hogy befolyásolná a teljesítmény vagy a rendelkezésre álló a Helyadatbázis-műveletekhez.</span><span class="sxs-lookup"><span data-stu-id="079c4-106">The automatic backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="079c4-107">A biztonsági mentések külön-külön tárolják egy másik tárhelyre, és azokat a biztonsági mentések globálisan replikálva vannak a rugalmasságot regionális vészhelyzetek ellen.</span><span class="sxs-lookup"><span data-stu-id="079c4-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="079c4-108">Ha véletlenül törli a a Comos DB tárolót, és később a adat-helyreállítás vagy egy vész-helyreállítási megoldást igényelnek szánt forgatókönyvek az automatikus biztonsági mentésekhez.</span><span class="sxs-lookup"><span data-stu-id="079c4-108">The automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="079c4-109">Ez a cikk egy rövid összefoglalása a adatok redundancia és rendelkezésre állás érdekében Cosmos DB kezdődik, és majd ismerteti a biztonsági másolatok.</span><span class="sxs-lookup"><span data-stu-id="079c4-109">This article starts with a quick recap of the data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="079c4-110">Magas rendelkezésre állás az Cosmos DB - egy összefoglalása</span><span class="sxs-lookup"><span data-stu-id="079c4-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="079c4-111">Cosmos DB kialakításánál fogva [globálisan elosztott](distribute-data-globally.md) – lehetővé teszi a méretezhető átviteli együtt feladatátvevő és transzparens többhelyű API-alapú házirend több Azure-régiók között.</span><span class="sxs-lookup"><span data-stu-id="079c4-111">Cosmos DB is designed to be [globally distributed](distribute-data-globally.md) – it allows you to scale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="079c4-112">Egy adatbázis rendszer ajánlat mint [rendelkezésre állás 99,99 % SLA-k](https://azure.microsoft.com/support/legal/sla/cosmos-db), Cosmos DB az írási műveletek tartósan elkötelezettek vagyunk a helyi lemezek helyi adatközpontban lévő replikák másodlagosak által az ügyfélnek igazolása előtt.</span><span class="sxs-lookup"><span data-stu-id="079c4-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all the writes in Cosmos DB are durably committed to local disks by a quorum of replicas within a local data center before acknowledging to the client.</span></span> <span data-ttu-id="079c4-113">Vegye figyelembe, hogy a magas rendelkezésre állású Cosmos-adatbázis helyi tároló alapul, és nem függ semmilyen külső tárolási technológiákat.</span><span class="sxs-lookup"><span data-stu-id="079c4-113">Note that the high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="079c4-114">Továbbá ha az adatbázis-fiók egynél több Azure-régió tartozik, az írási műveletek replikálódnak más régiókból is.</span><span class="sxs-lookup"><span data-stu-id="079c4-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="079c4-115">Az átviteli sebesség és a hozzáférési adatok méretezhető, alacsony késleltetésű, akkor is a különböző régiókban-adatbázis fiókjához tartozó tetszés szerinti olvasás.</span><span class="sxs-lookup"><span data-stu-id="079c4-115">To scale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="079c4-116">Minden olvasási régióban a (replikált) adatok tartósan állandó között a replikakészlethez.</span><span class="sxs-lookup"><span data-stu-id="079c4-116">In each read region, the (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="079c4-117">Az alábbi ábrán szemléltetett, van-e egyetlen Cosmos DB tárolót [vízszintesen particionált](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="079c4-117">As illustrated in the following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="079c4-118">Az alábbi ábra egy kör megjelölt "Partíció", és mindegyik partíció keresztül egy magas rendelkezésre állású legyen.</span><span class="sxs-lookup"><span data-stu-id="079c4-118">A “partition” is denoted by a circle in the following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="079c4-119">Ez az a helyi terjesztési (az X tengely jelölik) egyetlen Azure régión belül.</span><span class="sxs-lookup"><span data-stu-id="079c4-119">This is the local distribution within a single Azure region (denoted by the X axis).</span></span> <span data-ttu-id="079c4-120">Továbbá minden egyes partícióra (a megfelelő replikakészlethez) van majd globálisan elosztott-(például régiókban az ábra a három – USA keleti régiója, USA nyugati régiója és közép-Indiában) adatbázis fiókjához tartozó különféle régiókban.</span><span class="sxs-lookup"><span data-stu-id="079c4-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration the three regions – East US, West US and Central India).</span></span> <span data-ttu-id="079c4-121">A "partíció set" van globálisan elosztott entitás, minden régióban (Y tengely jelölik) az adatok többszörös lemásolását, amely.</span><span class="sxs-lookup"><span data-stu-id="079c4-121">The “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by the Y axis).</span></span> <span data-ttu-id="079c4-122">A régiók-adatbázis fiókjához tartozó prioritás rendelhető és Cosmos DB transzparens módon fog megfelelni a feladatátvétel katasztrófa esetén a következő terület.</span><span class="sxs-lookup"><span data-stu-id="079c4-122">You can assign priority to the regions associated with your database account and Cosmos DB will transparently failover to the next region in case of disaster.</span></span> <span data-ttu-id="079c4-123">Manuálisan is szimulálhatja feladatátvételi tesztelése az alkalmazás-végpontok közötti rendelkezésre állását.</span><span class="sxs-lookup"><span data-stu-id="079c4-123">You can also manually simulate failover to test the end-to-end availability of your application.</span></span>  

<span data-ttu-id="079c4-124">Az alábbi ábrán a Cosmos DB redundanciát a magas fokú.</span><span class="sxs-lookup"><span data-stu-id="079c4-124">The following image illustrates the high degree of redundancy with Cosmos DB.</span></span>

![A Cosmos DB redundancia magas fokú](./media/online-backup-and-restore/redundancy.png)

![A Cosmos DB redundancia magas fokú](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="079c4-127">Teljes, automatikus, online biztonsági mentések</span><span class="sxs-lookup"><span data-stu-id="079c4-127">Full, automatic, online backups</span></span>
<span data-ttu-id="079c4-128">Sajnos a törölt a tároló, vagy az adatbázis!</span><span class="sxs-lookup"><span data-stu-id="079c4-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="079c4-129">A Cosmos DB nem csak az adatokat, de az adatok biztonsági mentését is magas redundáns és rugalmas regionális katasztrófák.</span><span class="sxs-lookup"><span data-stu-id="079c4-129">With Cosmos DB, not only your data, but the backups of your data are also made highly redundant and resilient to regional disasters.</span></span> <span data-ttu-id="079c4-130">Automatikus biztonsági mentéseket jelenleg körülbelül négy óránként készít, és a legújabb 2 biztonsági másolatai mindig.</span><span class="sxs-lookup"><span data-stu-id="079c4-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="079c4-131">Ha az adatok akár véletlenül eldobása, vagy sérült, adjon [kérje az Azure támogatási](https://azure.microsoft.com/support/options/) 8 órán belül.</span><span class="sxs-lookup"><span data-stu-id="079c4-131">If the data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="079c4-132">A biztonsági másolatokat készít a nem befolyásolja a teljesítmény vagy a rendelkezésre álló a Helyadatbázis-műveletekhez.</span><span class="sxs-lookup"><span data-stu-id="079c4-132">The backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="079c4-133">A kiépített RUs fel, vagy a teljesítményét és az adatbázis elérhetőségét érintő nélkül cosmos adatbázis a biztonsági mentés a háttérben vesz igénybe.</span><span class="sxs-lookup"><span data-stu-id="079c4-133">Cosmos DB takes the backup in the background without consuming your provisioned RUs or affecting the performance and without affecting the availability of your database.</span></span> 

<span data-ttu-id="079c4-134">Ellentétben a Cosmos DB belül tárolt adatokat az automatikus biztonsági másolatai Azure Blob Storage szolgáltatásban.</span><span class="sxs-lookup"><span data-stu-id="079c4-134">Unlike your data that is stored inside Cosmos DB, the automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="079c4-135">A kis késleltetésű/hatékony feltöltés biztosításához a biztonsági mentési pillanatképet tölt fel az Azure Blob Storage tárolóban ugyanabban a régióban, mint a jelenlegi írási terület a Cosmos DB adatbázis fiók egy példányát.</span><span class="sxs-lookup"><span data-stu-id="079c4-135">To guarantee the low latency/efficient upload, the snapshot of your backup is uploaded to an instance of Azure Blob storage in the same region as the current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="079c4-136">A regionális katasztrófa szembeni hibatűrést minden pillanatképet a biztonsági mentési adatok az Azure Blob Storage újra replikálódik keresztül georedundáns tárolás (GRS) egy másik régióban.</span><span class="sxs-lookup"><span data-stu-id="079c4-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) to another region.</span></span> <span data-ttu-id="079c4-137">Az alábbi ábrán látható, hogy a teljes Cosmos DB tárolóhoz (az összes három elsődleges partíció USA nyugati régiója, az ebben a példában) készül biztonsági másolat egy távoli Azure Blob Storage-fiókban az USA nyugati régiója, és ezután Georedundáns USA keleti régiója replikálva.</span><span class="sxs-lookup"><span data-stu-id="079c4-137">The following diagram shows that the entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated to East US.</span></span> 

<span data-ttu-id="079c4-138">Az alábbi ábrán a Georedundáns Azure Storage összes Cosmos DB entitásának rendszeres teljes biztonsági mentést.</span><span class="sxs-lookup"><span data-stu-id="079c4-138">The following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Az összes Cosmos DB entitások Georedundáns Azure Storage rendszeres teljes biztonsági mentés](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="079c4-140">Biztonsági mentés megőrzési időtartam</span><span class="sxs-lookup"><span data-stu-id="079c4-140">Backup retention period</span></span>
<span data-ttu-id="079c4-141">A fent leírtaknak megfelelően Azure Cosmos DB időt vesz igénybe az adatok pillanatfelvételének négy óránként, és 30 napig őrzi meg minden partíció utolsó két pillanatképeket.</span><span class="sxs-lookup"><span data-stu-id="079c4-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains the last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="079c4-142">A megfelelőségi szabályzat / pillanatképek kiürítésekor 90 nap után.</span><span class="sxs-lookup"><span data-stu-id="079c4-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="079c4-143">Ha meg szeretné tartani a saját pillanatképeket, használhatja az Exportálás JSON beállítást az Azure Cosmos DB [adatáttelepítési eszközét](import-data.md#export-to-json-file) további biztonsági mentés ütemezése.</span><span class="sxs-lookup"><span data-stu-id="079c4-143">If you want to maintain your own snapshots, you can use the export to JSON option in the Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) to schedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="079c4-144">Adatbázis visszaállítása az online biztonsági mentés</span><span class="sxs-lookup"><span data-stu-id="079c4-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="079c4-145">Ha véletlenül törli az adatbázis vagy a gyűjtemény, akkor [fájlt egy támogatási jegy](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) vagy [Azure az ügyfélszolgálat](https://azure.microsoft.com/support/options/) az adatok biztonsági másolatból történő visszaállítását a legutóbbi automatikus.</span><span class="sxs-lookup"><span data-stu-id="079c4-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) to restore the data from the last automatic backup.</span></span> <span data-ttu-id="079c4-146">Ha szeretné visszaállítani az adatbázist, mert adatsérülés következett be, lásd: [adatsérülés kezelése](#handling-data-corruption) megakadályozhatja, hogy a sérült adatok a biztonsági mentés túljutó további lépések végrehajtására van lehetősége.</span><span class="sxs-lookup"><span data-stu-id="079c4-146">If you need to restore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need to take additional steps to prevent the corrupted data from penetrating the backups.</span></span> <span data-ttu-id="079c4-147">A visszaállítandó biztonsági másolat egy adott pillanatképet Cosmos DB megköveteli, hogy az adatok volt elérhető a biztonsági mentési ciklus, hogy a pillanatkép idejére.</span><span class="sxs-lookup"><span data-stu-id="079c4-147">For a specific snapshot of your backup to be restored, Cosmos DB requires that the data was available for the duration of the backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="079c4-148">Adatsérülés kezelése</span><span class="sxs-lookup"><span data-stu-id="079c4-148">Handling data corruption</span></span>
<span data-ttu-id="079c4-149">Azure Cosmos-adatbázis minden partíció utolsó két biztonsági mentését a rendszer megőrzi.</span><span class="sxs-lookup"><span data-stu-id="079c4-149">Azure Cosmos DB retains the last two backups of every partition in the system.</span></span> <span data-ttu-id="079c4-150">Ez a modell jól működik, ha óta az utolsó verziókra visszaállítható véletlenül törli a tároló (gyűjtemény dokumentumok, a graph, a táblázat), vagy az adatbázis.</span><span class="sxs-lookup"><span data-stu-id="079c4-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of the last versions can be restored.</span></span> <span data-ttu-id="079c4-151">Azonban abban az esetben, amikor a felhasználók vezethetnek adatsérülés következett be, amikor Azure Cosmos DB előfordulhat, hogy ne tudjanak a program sérült adatokat a, és lehetséges, hogy a sérülés előfordulhat, hogy rendelkezik követhessék a biztonsági mentéseket.</span><span class="sxs-lookup"><span data-stu-id="079c4-151">However, in the case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of the data corruption, and it is possible that the corruption may have penetrated the backups.</span></span> <span data-ttu-id="079c4-152">Amint sérülést észlel, törölnie kell a sérült tároló (gyűjtemény vagy graph vagy tábla), hogy a biztonsági mentések védi a felülírás sérült adatokkal.</span><span class="sxs-lookup"><span data-stu-id="079c4-152">As soon as corruption is detected, you should delete the corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="079c4-153">Az utolsó biztonsági mentés régi négy óra lehet, mert a felhasználó is alkalmaz [adatcsatorna módosítása](change-feed.md) rögzítése és tárolása az utolsó négy óra érdemes az adatok a tároló törlése előtt.</span><span class="sxs-lookup"><span data-stu-id="079c4-153">Since the last backup could be four hours old, the user can employ [change feed](change-feed.md) to capture and store the last four hours worth of data before deleting the container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="079c4-154">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="079c4-154">Next steps</span></span>

<span data-ttu-id="079c4-155">Az adatbázis több adatközpontokban replikációt, tekintse meg [terjesztése az adatok globálisan Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="079c4-155">To replicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="079c4-156">A fájl forduljon Azure támogatási szolgálatához [Azure-portálról igénylést](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="079c4-156">To file contact Azure Support, [file a ticket from the Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

