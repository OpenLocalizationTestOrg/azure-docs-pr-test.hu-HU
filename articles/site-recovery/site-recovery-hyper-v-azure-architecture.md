---
title: "Hogyan működik a Hyper-V-replikáció az Azure-ba a Site Recoveryben? | Microsoft Docs"
description: "Ez a cikk ismerteti, hogyan működik a Hyper-V-replikáció az Azure Site Recoveryben"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/14/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: site-recovery-architecture-hyper-v-to-azure
ms.openlocfilehash: 6fa952af93033f82effdef418903fc93d94dd05c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 07/11/2017
---
# <a name="how-does-hyper-v-replication-to-azure-work"></a><span data-ttu-id="fb601-104">Hogyan működik a Hyper-V-replikáció az Azure-ba?</span><span class="sxs-lookup"><span data-stu-id="fb601-104">How does Hyper-V replication to Azure work?</span></span>

<span data-ttu-id="fb601-105">Ebből a cikkből megismerheti az architektúrát és az Azure-ba történő Hyper-V-replikáció munkafolyamatát az [Azure Site Recovery](site-recovery-overview.md) szolgáltatás használatával.</span><span class="sxs-lookup"><span data-stu-id="fb601-105">Read this article to understand the architecture and workflows for Hyper-V replication to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="fb601-106">Megjegyzéseit a cikk alján, vagy az [Azure Recovery Services fórumban](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr) teheti közzé.</span><span class="sxs-lookup"><span data-stu-id="fb601-106">Post any comments at the bottom of this article, or in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="fb601-107">A következőket replikálhatja az Azure-ba:</span><span class="sxs-lookup"><span data-stu-id="fb601-107">You can replicate the following to Azure:</span></span>
- <span data-ttu-id="fb601-108">**Hyper-V VMM-mel**: System Center Virtual Machine Manager-felhőkben (VMM-felhőkben) felügyelt helyszíni Hyper-V-gazdagépeken található virtuális gépek.</span><span class="sxs-lookup"><span data-stu-id="fb601-108">**Hyper-V with VMM**: VMs located on on-premises Hyper-V hosts managed in  System Center Virtual MAchine Manager (VMM) clouds.</span></span> <span data-ttu-id="fb601-109">A gazdagépek bármilyen [támogatott operációs rendszert](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers) futtathatnak.</span><span class="sxs-lookup"><span data-stu-id="fb601-109">Hosts can be running any [supported operating system](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span> <span data-ttu-id="fb601-110">A [Hyper-V és az Azure által támogatott](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows) bármilyen vendég operációs rendszert futtató Hyper-V-alapú virtuális gépet replikálhat.</span><span class="sxs-lookup"><span data-stu-id="fb601-110">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>
- <span data-ttu-id="fb601-111">**Hyper-V VMM nélkül**: VMM-felhőkben nem felügyelt Hyper-V-gazdagépeken található helyszíni virtuális gépek.</span><span class="sxs-lookup"><span data-stu-id="fb601-111">**Hyper-V without VMM**: On-premises VMs located on Hyper-V hosts that aren't managed in VMM clouds.</span></span> <span data-ttu-id="fb601-112">A gazdagépek a [támogatott operációs rendszerek](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions) bármelyikét futtathatják.</span><span class="sxs-lookup"><span data-stu-id="fb601-112">Hosts can run any of the [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span></span> <span data-ttu-id="fb601-113">A [Hyper-V és az Azure által támogatott](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows) bármilyen vendég operációs rendszert futtató Hyper-V-alapú virtuális gépet replikálhat.</span><span class="sxs-lookup"><span data-stu-id="fb601-113">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="fb601-114">Az architektúra összetevői</span><span class="sxs-lookup"><span data-stu-id="fb601-114">Architectural components</span></span>

<span data-ttu-id="fb601-115">**Terület**</span><span class="sxs-lookup"><span data-stu-id="fb601-115">**Area**</span></span> | <span data-ttu-id="fb601-116">**Összetevő**</span><span class="sxs-lookup"><span data-stu-id="fb601-116">**Component**</span></span> | <span data-ttu-id="fb601-117">**Részletek**</span><span class="sxs-lookup"><span data-stu-id="fb601-117">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="fb601-118">**Azure**</span><span class="sxs-lookup"><span data-stu-id="fb601-118">**Azure**</span></span> | <span data-ttu-id="fb601-119">Az Azure-ban szüksége van egy Microsoft Azure-fiókra, és Azure Storage-fiókra és egy Azure-hálózatra.</span><span class="sxs-lookup"><span data-stu-id="fb601-119">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span></span> | <span data-ttu-id="fb601-120">A Storage és a hálózat lehet Resource Manager-alapú vagy klasszikus fiók.</span><span class="sxs-lookup"><span data-stu-id="fb601-120">Storage and network can be Resource Manager-based, or classic accounts.</span></span><br/><br/> <span data-ttu-id="fb601-121">A replikált adatokat a tárfiók tárolja, ha pedig feladatátvétel következik be a helyszíni helyről, a rendszer Azure virtuális gépeket hoz létre a replikált adatokkal.</span><span class="sxs-lookup"><span data-stu-id="fb601-121">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span><br/><br/> <span data-ttu-id="fb601-122">Az Azure virtuális gépek a létrejöttükkor csatlakoznak az Azure virtuális hálózathoz.</span><span class="sxs-lookup"><span data-stu-id="fb601-122">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="fb601-123">**VMM-kiszolgáló**</span><span class="sxs-lookup"><span data-stu-id="fb601-123">**VMM server**</span></span> | <span data-ttu-id="fb601-124">VMM-felhőkben lévő Hyper-V-gazdagépek</span><span class="sxs-lookup"><span data-stu-id="fb601-124">Hyper-V hosts located in VMM clouds</span></span> | <span data-ttu-id="fb601-125">Ha a Hyper-V-gazdagépeket VMM felhőben felügyeli, a Recovery Services-tárolóban regisztrálja a VMM-kiszolgálót.</span><span class="sxs-lookup"><span data-stu-id="fb601-125">If Hyper-V hosts are managed in VMM clouds, you register the VMM server in the Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="fb601-126">A VMM-kiszolgálón telepítse a Site Recovery Providert az Azure-ral való replikáció vezényléséhez.</span><span class="sxs-lookup"><span data-stu-id="fb601-126">On the VMM server you install the Site Recovery Provider to orchestrate replication with Azure.</span></span><br/><br/> <span data-ttu-id="fb601-127">A hálózatleképezés konfigurálásához logikai és virtuálisgép-hálózatokat is be kell állítania.</span><span class="sxs-lookup"><span data-stu-id="fb601-127">You need logical and VM networks set up to configure network mapping.</span></span> <span data-ttu-id="fb601-128">Egy virtuálisgép-hálózatot össze kell kötnie egy felhőhöz társított logikai hálózattal.</span><span class="sxs-lookup"><span data-stu-id="fb601-128">A VM network should be linked to a logical network that's associated with the cloud.</span></span>
<span data-ttu-id="fb601-129">**Hyper-V gazdagép**</span><span class="sxs-lookup"><span data-stu-id="fb601-129">**Hyper-V host**</span></span> | <span data-ttu-id="fb601-130">A Hyper-V-kiszolgálók VMM-kiszolgálóval vagy anélkül is üzembe helyezhetők.</span><span class="sxs-lookup"><span data-stu-id="fb601-130">Hyper-V servers can be deployed with or without VMM server.</span></span> | <span data-ttu-id="fb601-131">Ha nincs VMM-kiszolgáló, a Site Recovery Providert a gazdagépen kell telepíteni, hogy vezényelni tudja az internetes replikációt a Site Recoveryval.</span><span class="sxs-lookup"><span data-stu-id="fb601-131">If there's no VMM server, the Site Recovery Provider is installed on the host to orchestrate replication with Site Recovery over the internet.</span></span> <span data-ttu-id="fb601-132">Ha van VMM-kiszolgáló, a Provider azon van telepítve, és nem a gazdagépen.</span><span class="sxs-lookup"><span data-stu-id="fb601-132">If there's a VMM server, the Provider is installed on it, and not on the host.</span></span><br/><br/> <span data-ttu-id="fb601-133">A Recovery Services-ügynököt a gazdagépen kell telepíteni az adatreplikáció kezelése érdekében.</span><span class="sxs-lookup"><span data-stu-id="fb601-133">The Recovery Services agent is installed on the host to handle data replication.</span></span><br/><br/> <span data-ttu-id="fb601-134">A Provider és az Agent kommunikációja biztonságos, titkosított csatornákon történik.</span><span class="sxs-lookup"><span data-stu-id="fb601-134">Communications from both the Provider and the agent are secure and encrypted.</span></span> <span data-ttu-id="fb601-135">Ezenfelül az Azure-tárfiókba replikált adatok is titkosítást kapnak.</span><span class="sxs-lookup"><span data-stu-id="fb601-135">Replicated data in Azure storage is also encrypted.</span></span>
<span data-ttu-id="fb601-136">**Hyper-V virtuális gépek**</span><span class="sxs-lookup"><span data-stu-id="fb601-136">**Hyper-V VMs**</span></span> | <span data-ttu-id="fb601-137">A Hyper-V gazdakiszolgálón legalább egy virtuális gépnek kell lennie.</span><span class="sxs-lookup"><span data-stu-id="fb601-137">You need one or more VMs on the Hyper-V host server.</span></span> | <span data-ttu-id="fb601-138">A virtuális gépekre semmit nem kell explicit módon telepíteni</span><span class="sxs-lookup"><span data-stu-id="fb601-138">Nothing needs to explicitly installed on VMs</span></span>

## <a name="deployment-steps"></a><span data-ttu-id="fb601-139">A központi telepítés lépései</span><span class="sxs-lookup"><span data-stu-id="fb601-139">Deployment steps</span></span>

1. <span data-ttu-id="fb601-140">**Azure**: Állítsa be az Azure-összetevőket.</span><span class="sxs-lookup"><span data-stu-id="fb601-140">**Azure**: You set up the Azure components.</span></span> <span data-ttu-id="fb601-141">Javasoljuk, hogy a Site Recovery üzembe helyezésének megkezdése előtt hozza létre a Storage- és hálózati fiókokat.</span><span class="sxs-lookup"><span data-stu-id="fb601-141">We recommend you set up storage and network accounts before you begin Site Recovery deployment.</span></span>
2. <span data-ttu-id="fb601-142">**Tároló**: Hozzon létre egy Recovery Services-tárolót a Site Recoveryhez, és konfigurálja a tároló beállításait, például konfigurálja a forrás- és célbeállításokat, állítson be egy replikációs szabályzatot és engedélyezze a replikációt.</span><span class="sxs-lookup"><span data-stu-id="fb601-142">**Vault**: You create a Recovery Services vault for Site Recovery, and configure vault settings, including configuring source and target settings, setting up a replication policy, and enabling replication.</span></span>
3. <span data-ttu-id="fb601-143">**Forrás és cél**:</span><span class="sxs-lookup"><span data-stu-id="fb601-143">**Source and target**:</span></span>
    - <span data-ttu-id="fb601-144">**Hyper-V gazdagépek-VMM-felhőkben**: A forrásbeállítások részeként töltse le és telepítse az Azure Site Recovery Providert a VMM-kiszolgálóra, az Azure Recovery Services-ügynököt minden Hyper-V-gazdagépre.</span><span class="sxs-lookup"><span data-stu-id="fb601-144">**Hyper-V hosts in VMM clouds**: As part of specifying source settings, you download and install the Azure Site Recovery Provider on the VMM server, and the Azure Recovery Services agent on each Hyper-V host.</span></span> <span data-ttu-id="fb601-145">A forrás a VMM-kiszolgáló lesz.</span><span class="sxs-lookup"><span data-stu-id="fb601-145">The source will be the VMM server.</span></span> <span data-ttu-id="fb601-146">A cél az Azure.</span><span class="sxs-lookup"><span data-stu-id="fb601-146">The target is Azure.</span></span>
    - <span data-ttu-id="fb601-147">Hyper-V-gazdagépek VMM nélkül: Amikor megadja a forrásbeállításokat, letölti és telepíti a Providert és az ügynököt minden egyes Hyper-V-gazdagépre.</span><span class="sxs-lookup"><span data-stu-id="fb601-147">Hyper-V hosts without VMM: When you specify source settings, you download and install the Provider and agent on each Hyper-V host.</span></span> <span data-ttu-id="fb601-148">Az üzembe helyezés során egy Hyper-V-helyre gyűjti az összes gazdagépet, és ezt a helyet adja meg forrásként.</span><span class="sxs-lookup"><span data-stu-id="fb601-148">During deployment you gather the hosts into a Hyper-V site, and specify this site as the source.</span></span> <span data-ttu-id="fb601-149">A cél az Azure.</span><span class="sxs-lookup"><span data-stu-id="fb601-149">The target is Azure.</span></span>

    <span data-ttu-id="fb601-150">![A VMM/Hyper-V replikálást az Azure-](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![Hyper-V helyek replikációs az Azure-bA](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span><span class="sxs-lookup"><span data-stu-id="fb601-150">![Hyper-V/VMM replication to Azure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![Hyper-V site replication to Azure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span></span>


4. <span data-ttu-id="fb601-151">**Replikációs házirend**: Létrehoz egy replikációs házirendet a Hyper-V-helyhez vagy a VMM-felhőhöz.</span><span class="sxs-lookup"><span data-stu-id="fb601-151">**Replication policy**: You create a replication policy for the Hyper-V site or VMM cloud.</span></span> <span data-ttu-id="fb601-152">A házirendet ezután a rendszer minden, a helyen vagy a felhőben lévő gazdagépen található virtuális gépre alkalmazza.</span><span class="sxs-lookup"><span data-stu-id="fb601-152">The policy is applied to all VMs located on hosts in the site or cloud.</span></span>
5. <span data-ttu-id="fb601-153">**Replikáció engedélyezése**: Engedélyezi a replikációt a Hyper-V-alapú virtuális gépek számára.</span><span class="sxs-lookup"><span data-stu-id="fb601-153">**Enable replication**: You enable replication for Hyper-V VMs.</span></span> <span data-ttu-id="fb601-154">A kezdeti replikálás a replikációs házirend beállításainak megfelelően történik.</span><span class="sxs-lookup"><span data-stu-id="fb601-154">Initial replication occurs in accordance with the replication policy settings.</span></span> <span data-ttu-id="fb601-155">Az adatváltozásokat a rendszer nyomon követi, és az Azure változáskülönbözeteinek replikálása a kezdeti replikálás befejezése után kezdődik meg.</span><span class="sxs-lookup"><span data-stu-id="fb601-155">Data changes are tracked, and replication of delta changes to Azure begins after the initial replication finishes.</span></span> <span data-ttu-id="fb601-156">Az elemek nyomon követett módosításait a rendszer .hrl fájlokban tárolja.</span><span class="sxs-lookup"><span data-stu-id="fb601-156">Tracked changes for an item are held in a .hrl file.</span></span>
6. <span data-ttu-id="fb601-157">**Feladatátvétel tesztelése**: Egy tesztcélú feladatátvétel futtatásával ellenőrzi, hogy minden a vártnak megfelelően működik-e.</span><span class="sxs-lookup"><span data-stu-id="fb601-157">**Test failover**:  You run a test failover to make sure everything's working as expected.</span></span>

<span data-ttu-id="fb601-158">További információk az üzembe helyezésről:</span><span class="sxs-lookup"><span data-stu-id="fb601-158">Learn more about deployment:</span></span>
- [<span data-ttu-id="fb601-159">Bevezetés a Hyper-V-alapú virtuális gépek az Azure-ba történő replikálásába – VMM-mel</span><span class="sxs-lookup"><span data-stu-id="fb601-159">Get started with Hyper-V VM replication to Azure - with VMM</span></span>](site-recovery-vmm-to-azure.md)
- [<span data-ttu-id="fb601-160">Bevezetés a Hyper-V-alapú virtuális gépek az Azure-ba történő replikálásába – VMM nélkül</span><span class="sxs-lookup"><span data-stu-id="fb601-160">Get started with Hyper-V VM replication to Azure - without VMM</span></span>](site-recovery-hyper-v-site-to-azure.md)

## <a name="hyper-v-replication-workflow"></a><span data-ttu-id="fb601-161">A Hyper-V replikálás munkafolyamata</span><span class="sxs-lookup"><span data-stu-id="fb601-161">Hyper-V replication workflow</span></span>

### <a name="enable-protection"></a><span data-ttu-id="fb601-162">Védelem engedélyezése</span><span class="sxs-lookup"><span data-stu-id="fb601-162">Enable protection</span></span>

1. <span data-ttu-id="fb601-163">Miután engedélyezte a védelmet egy Hyper-V-alapú virtuális gép esetében az Azure Portalon vagy a helyszíni környezetben, elindul a **Védelem engedélyezése** feladat.</span><span class="sxs-lookup"><span data-stu-id="fb601-163">After you enable protection for a Hyper-V VM, in the Azure portal or on-premises, the **Enable protection** starts.</span></span>
2. <span data-ttu-id="fb601-164">A feladat ellenőrzi, hogy a gép megfelel-e az előfeltételeknek, mielőtt meghívja a [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx) metódust, amely az Ön által megadott beállításoknak megfelelően beállítja a replikációt.</span><span class="sxs-lookup"><span data-stu-id="fb601-164">The job checks that the machine complies with prerequisites, before invoking the [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), to set up replication with the settings you've configured.</span></span>
3. <span data-ttu-id="fb601-165">A feladat elindítja a kezdeti replikációt a [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) metódus meghívásával egy teljes körű virtuálisgép-replikáció elindítása céljából, majd a virtuális gépek virtuális lemezeit továbbítja az Azure-ba.</span><span class="sxs-lookup"><span data-stu-id="fb601-165">The job starts initial replication by invoking the [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) method, to initialize a full VM replication, and send the VM's virtual disks to Azure.</span></span>
4. <span data-ttu-id="fb601-166">A feladatot a **Feladatok** lapon követheti nyomon.</span><span class="sxs-lookup"><span data-stu-id="fb601-166">You can monitor the job in the **Jobs** tab.</span></span>
        <span data-ttu-id="fb601-167">![Feladatok listája](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Védelem engedélyezésének részletei](media/site-recovery-hyper-v-azure-architecture/image2.png)</span><span class="sxs-lookup"><span data-stu-id="fb601-167">![Jobs list](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Enable protection drill down](media/site-recovery-hyper-v-azure-architecture/image2.png)</span></span>

### <a name="initial-replication"></a><span data-ttu-id="fb601-168">Kezdeti replikálás</span><span class="sxs-lookup"><span data-stu-id="fb601-168">Initial replication</span></span>

1. <span data-ttu-id="fb601-169">A kezdeti replikálás indításakor egy [pillanatfelvétel készül a Hyper-V-alapú virtuális gépről](https://technet.microsoft.com/library/dd560637.aspx).</span><span class="sxs-lookup"><span data-stu-id="fb601-169">A [Hyper-V VM snapshot](https://technet.microsoft.com/library/dd560637.aspx) snapshot is taken when initial replication is triggered.</span></span>
2. <span data-ttu-id="fb601-170">A rendszer egyenként replikálja a virtuális merevlemezeket, amíg az összes át nem lesz másolva az Azure-ba.</span><span class="sxs-lookup"><span data-stu-id="fb601-170">Virtual hard disks are replicated one by one until they're all copied to Azure.</span></span> <span data-ttu-id="fb601-171">Ez a virtuális gép méretétől és a hálózat sávszélességétől függően eltarthat egy ideig.</span><span class="sxs-lookup"><span data-stu-id="fb601-171">It could take a while, depending on the VM size, and network bandwidth.</span></span> <span data-ttu-id="fb601-172">A hálózathasználat optimalizálásával kapcsolatban lásd [a helyszíni környezetből Azure-ba irányuló védelem hálózati sávszélesség-használatának kezelését](https://support.microsoft.com/kb/3056159) ismertető cikket.</span><span class="sxs-lookup"><span data-stu-id="fb601-172">To optimize your network usage, see [How to manage on-premises to Azure protection network bandwidth usage](https://support.microsoft.com/kb/3056159).</span></span>
3. <span data-ttu-id="fb601-173">Ha módosítják a lemezt, miközben a kezdeti replikáció folyamatban van, a Hyper-V-replikációkövető nyomon követi a módosításokat replikálási naplók (.hrl) formájában.</span><span class="sxs-lookup"><span data-stu-id="fb601-173">If disk changes occur while initial replication is in progress, the Hyper-V Replica Replication Tracker tracks those changes as Hyper-V Replication Logs (.hrl).</span></span> <span data-ttu-id="fb601-174">Ezek a fájlok ugyanabban a mappában találhatók, mint a lemezek.</span><span class="sxs-lookup"><span data-stu-id="fb601-174">These files are located in the same folder as the disks.</span></span> <span data-ttu-id="fb601-175">Minden lemezhez tartozik egy .hrl-fájl, amelyet a rendszer továbbít a másodlagos tárterületre.</span><span class="sxs-lookup"><span data-stu-id="fb601-175">Each disk has an associated .hrl file that will be sent to secondary storage.</span></span>
4. <span data-ttu-id="fb601-176">A pillanatkép- és a naplófájlok a kezdeti replikáció végrehajtása közben is lemezerőforrásokat használnak.</span><span class="sxs-lookup"><span data-stu-id="fb601-176">The snapshot and log files consume disk resources while initial replication is in progress.</span></span>
5. <span data-ttu-id="fb601-177">A kezdeti replikáció befejeztével a rendszer törli a virtuális gép pillanatképét.</span><span class="sxs-lookup"><span data-stu-id="fb601-177">When the initial replication finishes, the VM snapshot is deleted.</span></span> <span data-ttu-id="fb601-178">A rendszer a naplózott lemezmódosításokat szinkronizálja, és egyesíti a szülőlemezzel.</span><span class="sxs-lookup"><span data-stu-id="fb601-178">Delta disk changes in the log are synchronized and merged to the parent disk.</span></span>


### <a name="finalize-protection"></a><span data-ttu-id="fb601-179">Védelem véglegesítése</span><span class="sxs-lookup"><span data-stu-id="fb601-179">Finalize protection</span></span>

1. <span data-ttu-id="fb601-180">A kezdeti replikálás befejezése után a **Védelem véglegesítése a virtuális gépen** feladat konfigurálja a hálózatot és más replikáció utáni beállításokat a virtuális gép védelméhez.</span><span class="sxs-lookup"><span data-stu-id="fb601-180">After the initial replication finishes, the **Finalize protection on the virtual machine** job configures network and other post-replication settings, so that the virtual machine is protected.</span></span>
    <span data-ttu-id="fb601-181">![Védelem véglegesítése feladat](media/site-recovery-hyper-v-azure-architecture/image3.png)</span><span class="sxs-lookup"><span data-stu-id="fb601-181">![Finalize protection job](media/site-recovery-hyper-v-azure-architecture/image3.png)</span></span>
2. <span data-ttu-id="fb601-182">Azure-ba történő replikálás esetén előfordulhat, hogy módosítania kell a virtuális gép beállításait, hogy az készen álljon a feladatátvételre.</span><span class="sxs-lookup"><span data-stu-id="fb601-182">If you're replicating to Azure, you might need to tweak the settings for the virtual machine so that it's ready for failover.</span></span> <span data-ttu-id="fb601-183">Ezen a ponton érdemes lehet feladatátvételi tesztet futtatni, amellyel ellenőrizheti, hogy minden megfelelően működik-e.</span><span class="sxs-lookup"><span data-stu-id="fb601-183">At this point you can run a test failover to check everything is working as expected.</span></span>

### <a name="delta-replication"></a><span data-ttu-id="fb601-184">Változásreplikáció</span><span class="sxs-lookup"><span data-stu-id="fb601-184">Delta replication</span></span>

1. <span data-ttu-id="fb601-185">A kezdeti replikálást követően a replikációs beállításoknak megfelelően elindul a változások szinkronizálása.</span><span class="sxs-lookup"><span data-stu-id="fb601-185">After the initial replication, delta synchronization begins, in accordance with replication settings.</span></span>
2. <span data-ttu-id="fb601-186">A Hyper-V-replikációkövető a virtuális merevlemezek változásait .hrl fájlokban követi nyomon.</span><span class="sxs-lookup"><span data-stu-id="fb601-186">The Hyper-V Replica Replication Tracker tracks the changes to a virtual hard disk as .hrl files.</span></span> <span data-ttu-id="fb601-187">Minden replikációra konfigurált lemezhez tartozik egy .hrl fájl.</span><span class="sxs-lookup"><span data-stu-id="fb601-187">Each disk that's configured for replication has an associated .hrl file.</span></span> <span data-ttu-id="fb601-188">A rendszer a naplót a kezdeti replikáció befejezését követően küldi át az ügyfél tárfiókjába.</span><span class="sxs-lookup"><span data-stu-id="fb601-188">This log is sent to the customer's storage account after initial replication is complete.</span></span> <span data-ttu-id="fb601-189">A napló az Azure-ba való továbbítása alatt a rendszer az elsődleges lemez változásait egy másik naplófájlban követi nyomon ugyanabban a könyvtárban.</span><span class="sxs-lookup"><span data-stu-id="fb601-189">When a log is in transit to Azure, the changes in the primary disk are tracked in another log file, in the same directory.</span></span>
3. <span data-ttu-id="fb601-190">A kezdeti és a változásreplikáció során a virtuális gép figyelése a virtuálisgép-nézetben lehetséges.</span><span class="sxs-lookup"><span data-stu-id="fb601-190">During initial and delta replication, you can monitor the VM in the VM view.</span></span> <span data-ttu-id="fb601-191">[További információk](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="fb601-191">[Learn more](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span></span>  

### <a name="replication-synchronization"></a><span data-ttu-id="fb601-192">Replikációszinkronizálás</span><span class="sxs-lookup"><span data-stu-id="fb601-192">Replication synchronization</span></span>

1. <span data-ttu-id="fb601-193">Ha nem sikerül a változások replikálása, és a teljes replikáció túl sok sávszélességet vagy időt venne igénybe, a rendszer a virtuális gépet megjelöli újraszinkronizálásra.</span><span class="sxs-lookup"><span data-stu-id="fb601-193">If delta replication fails, and a full replication would be costly in terms of bandwidth or time, then a VM is marked for resynchronization.</span></span> <span data-ttu-id="fb601-194">Ha például a .hrl-fájlok mérete eléri a lemezkapacitás 50%-át, a rendszer kijelöli a virtuális gépet újraszinkronizálásra.</span><span class="sxs-lookup"><span data-stu-id="fb601-194">For example, if the .hrl files reach 50% of the disk size, then the VM will be marked for resynchronization.</span></span>
2.  <span data-ttu-id="fb601-195">Az újraszinkronizálás kiszámítja a forrás és a cél virtuális gépek ellenőrzőösszegeit, és ezek alapján csak a változtatott adatokat továbbítja, így segít csökkenti az adatmennyiséget.</span><span class="sxs-lookup"><span data-stu-id="fb601-195">Resynchronization minimizes the amount of data sent by computing checksums of the source and target virtual machines, and sending only the delta data.</span></span> <span data-ttu-id="fb601-196">Az újraszinkronizálás egy rögzített blokkméretű csonkoló algoritmust alkalmaz, amelyben a forrás- és a célfájlok rögzített méretű adattömbökre vannak osztva.</span><span class="sxs-lookup"><span data-stu-id="fb601-196">Resynchronization uses a fixed-block chunking algorithm where source and target files are divided into fixed chunks.</span></span> <span data-ttu-id="fb601-197">A rendszer kiszámítja az egyes adattömbök ellenőrző összegét, majd ezeket összevetve megállapítja, hogy mely blokkokat kell a forrásból átmásolni a célba.</span><span class="sxs-lookup"><span data-stu-id="fb601-197">Checksums for each chunk are generated and then compared to determine which blocks from the source need to be applied to the target.</span></span>
3. <span data-ttu-id="fb601-198">Az újraszinkronizálás befejezését követően folytatódik a normál változásreplikálás.</span><span class="sxs-lookup"><span data-stu-id="fb601-198">After resynchronization finishes, normal delta replication should resume.</span></span> <span data-ttu-id="fb601-199">Alapértelmezés szerint a rendszer automatikusan munkaidőn kívüli időpontra ütemezi az újraszinkronizálást, de manuálisan is elvégezhető a virtuális gép újraszinkronizálása.</span><span class="sxs-lookup"><span data-stu-id="fb601-199">By default resynchronization is scheduled to run automatically outside office hours, but you can resynchronize a virtual machine manually.</span></span> <span data-ttu-id="fb601-200">Például manuálisan folytathatja az újraszinkronizálást, ha hálózatkimaradás vagy egyéb kimaradás következik be.</span><span class="sxs-lookup"><span data-stu-id="fb601-200">For example, you can resume resynchronization if a network outage or another outage occurs.</span></span> <span data-ttu-id="fb601-201">Ehhez jelölje ki a virtuális gépet a portálon, majd válassza az **Újraszinkronizálás** elemet.</span><span class="sxs-lookup"><span data-stu-id="fb601-201">To do this, select the VM in the portal > **Resynchronize**.</span></span>

    ![Manuális újraszinkronizálás](media/site-recovery-hyper-v-azure-architecture/image4.png)


### <a name="retries"></a><span data-ttu-id="fb601-203">Újrapróbálkozások</span><span class="sxs-lookup"><span data-stu-id="fb601-203">Retries</span></span>

<span data-ttu-id="fb601-204">Ha hiba lép fel a replikáció során, a rendszer automatikusan újrapróbálkozik.</span><span class="sxs-lookup"><span data-stu-id="fb601-204">If a replication error occurs, there's a built-in retry.</span></span> <span data-ttu-id="fb601-205">A vonatkozó logika két kategóriába sorolható:</span><span class="sxs-lookup"><span data-stu-id="fb601-205">This logic can be classified into two categories:</span></span>

<span data-ttu-id="fb601-206">**Kategória**</span><span class="sxs-lookup"><span data-stu-id="fb601-206">**Category**</span></span> | <span data-ttu-id="fb601-207">**Részletek**</span><span class="sxs-lookup"><span data-stu-id="fb601-207">**Details**</span></span>
--- | ---
<span data-ttu-id="fb601-208">**Helyreállíthatatlan hibák**</span><span class="sxs-lookup"><span data-stu-id="fb601-208">**Non-recoverable errors**</span></span> | <span data-ttu-id="fb601-209">A rendszer nem kísérli meg a helyreállításukat.</span><span class="sxs-lookup"><span data-stu-id="fb601-209">No retry is attempted.</span></span> <span data-ttu-id="fb601-210">A virtuális gép állapota **Kritikusra** vált, és rendszergazdai beavatkozás szükséges.</span><span class="sxs-lookup"><span data-stu-id="fb601-210">VM status will be **Critical**, and administrator intervention is required.</span></span> <span data-ttu-id="fb601-211">Ilyen hibák például a következők: sérült VHD-lánc; a virtuálisgép-replika érvénytelen állapota; hálózati hitelesítési hibák: engedélyezési hibák; „a virtuális gép nem található” hibák (önálló Hyper-V-kiszolgálók esetén).</span><span class="sxs-lookup"><span data-stu-id="fb601-211">Examples of these errors include: broken VHD chain; Invalid state for the replica VM; Network authentication errors: authorization errors; VM not found errors (for standalone Hyper-V servers)</span></span>
<span data-ttu-id="fb601-212">**Helyreállítható hibák**</span><span class="sxs-lookup"><span data-stu-id="fb601-212">**Recoverable errors**</span></span> | <span data-ttu-id="fb601-213">A rendszer minden replikálási időközben újrapróbálkozik exponenciális visszalépéssel, amely az újrapróbálkozás időközét az első kísérlet kezdetétől számított 1, 2, 4, 8 és 10 percre növeli.</span><span class="sxs-lookup"><span data-stu-id="fb601-213">Retries occur every replication interval, using an exponential back-off that increases the retry interval from the start of the first attempt by 1, 2, 4, 8, and 10 minutes.</span></span> <span data-ttu-id="fb601-214">Ha a hiba nem szűnik meg, a rendszer 30 percenként újrapróbálkozik.</span><span class="sxs-lookup"><span data-stu-id="fb601-214">If an error persists, retry every 30 minutes.</span></span> <span data-ttu-id="fb601-215">Példák: hálózati hibák; nem elegendő lemezterületből fakadó hibák; alacsony memóriaállapot.</span><span class="sxs-lookup"><span data-stu-id="fb601-215">Examples include: network errors; low disk  errors; low memory conditions</span></span> |

## <a name="protection-and-recovery-lifecycle"></a><span data-ttu-id="fb601-216">A védelem és helyreállítás életciklusa</span><span class="sxs-lookup"><span data-stu-id="fb601-216">Protection and recovery lifecycle</span></span>

![munkafolyamat](./media/site-recovery-components/arch-hyperv-azure-workflow.png)

## <a name="next-steps"></a><span data-ttu-id="fb601-218">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="fb601-218">Next steps</span></span>

- [<span data-ttu-id="fb601-219">Üzembe helyezési előfeltételek ellenőrzése</span><span class="sxs-lookup"><span data-stu-id="fb601-219">Check deployment prerequisites</span></span>](site-recovery-prereq.md)
- <span data-ttu-id="fb601-220">Hibaelhárítás a következőkkel:</span><span class="sxs-lookup"><span data-stu-id="fb601-220">Troubleshoot with:</span></span>
    - [<span data-ttu-id="fb601-221">Védelem figyelése és hibaelhárítása</span><span class="sxs-lookup"><span data-stu-id="fb601-221">Monitor and troubleshoot protection</span></span>](site-recovery-monitoring-and-troubleshooting.md)
    - [<span data-ttu-id="fb601-222">A Microsoft ügyfélszolgálatának segítsége</span><span class="sxs-lookup"><span data-stu-id="fb601-222">Help from Microsoft support</span></span>](site-recovery-monitoring-and-troubleshooting.md#reach-out-for-microsoft-support)
    - [<span data-ttu-id="fb601-223">Gyakori hibák és megoldások</span><span class="sxs-lookup"><span data-stu-id="fb601-223">Common errors and resolutions</span></span>](site-recovery-monitoring-and-troubleshooting.md#common-azure-site-recovery-errors-and-their-resolutions)
