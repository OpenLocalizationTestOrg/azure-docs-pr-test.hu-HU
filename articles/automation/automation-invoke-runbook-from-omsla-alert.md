---
title: "egy Azure Automation-Runbook a napló Analytics riasztási aaaCalling |} Microsoft Docs"
description: "Ez a cikk áttekintést hogyan tooinvoke egy Automation-runbook Microsoft OMS Log Analytics-riasztás alapján."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="cc273-103">Azure Automation-runbook hívása OMS Log Analytics-riasztásból</span><span class="sxs-lookup"><span data-stu-id="cc273-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="cc273-104">Ha riasztás konfigurálva van a Naplóelemzési toocreate sikertelen lesz, egy riasztás rekordot, ha az eredmények feltételeknek egy adott, például a hosszan tartó csúcs az igények processzorhasználat vagy egy adott alkalmazás folyamat kritikus toohello funkciói az üzleti alkalmazások és egy kapcsolódó esemény Windows eseménynaplóban hello, riasztás automatikusan futtathat egy Automation-runbook egy kísérlet tooauto-hello probléma megoldásáról.</span><span class="sxs-lookup"><span data-stu-id="cc273-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="cc273-105">Nincsenek két beállítások toocall runbook hello riasztás konfigurálásakor.</span><span class="sxs-lookup"><span data-stu-id="cc273-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="cc273-106">Ezek:</span><span class="sxs-lookup"><span data-stu-id="cc273-106">Specifically,</span></span>

1. <span data-ttu-id="cc273-107">Egy webhook használata.</span><span class="sxs-lookup"><span data-stu-id="cc273-107">Using a Webhook.</span></span>
   * <span data-ttu-id="cc273-108">Ez hello egyetlen elérhető esetén pedig az OMS-munkaterület nem csatolt tooan Automation-fiók.</span><span class="sxs-lookup"><span data-stu-id="cc273-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="cc273-109">Ha már rendelkezik egy Automation-fiók kapcsolódó tooan OMS-munkaterület, a beállítás akkor továbbra is elérhető.</span><span class="sxs-lookup"><span data-stu-id="cc273-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="cc273-110">A runbook közvetlen kiválasztása.</span><span class="sxs-lookup"><span data-stu-id="cc273-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="cc273-111">Ez a beállítás csak a csatolt tooan Automation-fiók hello OMS-munkaterület esetén érhető el.</span><span class="sxs-lookup"><span data-stu-id="cc273-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="cc273-112">Runbook meghívása webhook használatával</span><span class="sxs-lookup"><span data-stu-id="cc273-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="cc273-113">A webhook lehetővé teszi egy adott runbookhoz toostart az Azure Automationben keresztül egyetlen HTTP-kérelem.</span><span class="sxs-lookup"><span data-stu-id="cc273-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="cc273-114">Hello konfigurálása előtt [Naplóelemzési riasztás](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook egy webhook használatával riasztási művelet, szüksége lesz toofirst hello runbook, amelyeket a rendszer ezzel a módszerrel a webhook létrehozása.</span><span class="sxs-lookup"><span data-stu-id="cc273-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="cc273-115">Tekintse át és kövesse hello hello [a webhook létrehozása](automation-webhooks.md#creating-a-webhook) a következő cikket, és ne feledje toorecord hello webhook URL-CÍMÉT, hogy hivatkozhasson rá hello riasztási szabály konfigurálása közben.</span><span class="sxs-lookup"><span data-stu-id="cc273-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="cc273-116">Runbookok közvetlen meghívása</span><span class="sxs-lookup"><span data-stu-id="cc273-116">Calling a runbook directly</span></span>

<span data-ttu-id="cc273-117">Ha rendelkezik hello Automation & vezérlő ajánlat telepített, és az OMS-munkaterület konfigurált hello Runbook műveletek beállítás hello riasztás konfigurálásakor, megtekintheti az összes runbookokat hello **válasszon ki egy runbookot** legördülő lista és válassza ki azt szeretné, hogy a válasz toohello riasztás toorun hello adott runbook.</span><span class="sxs-lookup"><span data-stu-id="cc273-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="cc273-118">kijelölt hello runbook futhat a hello Azure-felhőbe vagy egy hibrid forgatókönyv-feldolgozót a munkaterületen.</span><span class="sxs-lookup"><span data-stu-id="cc273-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="cc273-119">Amikor hello riasztást hoz létre hello runbook beállítás használatával, a webhook hello runbook hoz létre.</span><span class="sxs-lookup"><span data-stu-id="cc273-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="cc273-120">Ha nyissa meg toohello Automation-fiók, és keresse meg a toohello webhook panelen kiválasztott hello runbook hello webhook tekintheti meg.</span><span class="sxs-lookup"><span data-stu-id="cc273-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="cc273-121">Ha törli a hello riasztást, hello webhook nem törlődik, de hello felhasználó manuálisan törölheti hello webhook.</span><span class="sxs-lookup"><span data-stu-id="cc273-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="cc273-122">Nincs probléma Ha hello webhook nem törlődik, hogy csak egy árva elemet, végül kell toobe rendelés toomaintain szervezett Automation-fiók törlése.</span><span class="sxs-lookup"><span data-stu-id="cc273-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="cc273-123">A runbookok jellemzői (mindkét lehetőség esetében)</span><span class="sxs-lookup"><span data-stu-id="cc273-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="cc273-124">Mindkét módszer esetén hello runbook meghívása hello Log Analytics-riasztás alapján másképp viselkednek tulajdonságokkal rendelkeznek, a riasztási szabályok konfigurálása előtt tisztában toobe kell rendelkeznie.</span><span class="sxs-lookup"><span data-stu-id="cc273-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="cc273-125">Rendelkeznie kell egy **WebhookData** elnevezésű és **Objektum** típusú bemeneti runbookparaméterrel.</span><span class="sxs-lookup"><span data-stu-id="cc273-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="cc273-126">Ez lehet kötelező vagy nem kötelező.</span><span class="sxs-lookup"><span data-stu-id="cc273-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="cc273-127">hello riasztás hello keresési eredmények toohello runbook a bemeneti paraméter használatával továbbítja.</span><span class="sxs-lookup"><span data-stu-id="cc273-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="cc273-128">Kód tooconvert hello WebhookData tooa PowerShell objektummal kell rendelkeznie.</span><span class="sxs-lookup"><span data-stu-id="cc273-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="cc273-129">*$SearchResults* objektumokból álló tömb lesz; az egyes objektumok hello értéket tartalmazó mező az egy keresési eredményből.</span><span class="sxs-lookup"><span data-stu-id="cc273-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="cc273-130">Hello webhook és runbook lehetőség WebhookData ellentmondásainak</span><span class="sxs-lookup"><span data-stu-id="cc273-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="cc273-131">Egy riasztás toocall olyan Webhook konfigurálásakor adja meg a runbookhoz létrehozott webhook URL-címet, majd kattintson a hello **teszt Webhook** gombra.</span><span class="sxs-lookup"><span data-stu-id="cc273-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="cc273-132">hello eredményül kapott WebhookData küldött toohello runbook nem tartalmaz vagy *. SearchResult* vagy *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="cc273-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="cc273-133">Riasztás, ha hello riasztás váltja ki, és meghívja a hello webhook menti, ha WebhookData küldött toohello runbook hello tartalmaz *. SearchResult*.</span><span class="sxs-lookup"><span data-stu-id="cc273-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="cc273-134">Ha riasztás létrehozása, és konfigurálja úgy a runbook (amely is létrehoz egy webhook) toocall, amikor hello WebhookData toohello runbook tartalmazó küld riasztási eseményindítók *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="cc273-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="cc273-135">Így a hello kód a fenti példában kell tooget *. SearchResult* Ha hello riasztás meghívja a webhook, és tooget kell *. SearchResults* Ha hello riasztás egy runbook közvetlenül.</span><span class="sxs-lookup"><span data-stu-id="cc273-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="cc273-136">Forgatókönyv – példa</span><span class="sxs-lookup"><span data-stu-id="cc273-136">Example walkthrough</span></span>

<span data-ttu-id="cc273-137">Bemutatjuk, hogyan működik a következő példa grafikus forgatókönyv, amely egy Windows-szolgáltatás elindul hello segítségével.</span><span class="sxs-lookup"><span data-stu-id="cc273-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Windows-szolgáltatás grafikus runbookjának indítása](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="cc273-139">hello runbook rendelkezik egy bemeneti paraméter típusú **objektum** neve, amely **WebhookData** , és tartalmazza a hello riasztási tartalmazó átadott hello webhook adatok *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="cc273-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="cc273-140">![Runbook bemeneti paraméterei](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="cc273-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="cc273-141">Az ebben a példában a Naplóelemzési létrehozott két egyéni mezők *SvcDisplayName_CF* és *SvcState_CF*, tooextract hello szolgáltatás megjelenített neve és hello hello szolgáltatás állapota (azaz fut vagy leállt) hello eseményből származó írt toohello rendszer-eseménynaplójában.</span><span class="sxs-lookup"><span data-stu-id="cc273-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="cc273-142">A Microsoft majd riasztási szabályt létrehozni a következő keresési lekérdezés hello: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` , hogy azt észleli, ha hello nyomtatásisor-kezelő szolgáltatás le van állítva, a rendszer a Windows hello.</span><span class="sxs-lookup"><span data-stu-id="cc273-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="cc273-143">Minden szolgáltatás egyik fontos lehet, de ehhez a példához jelenleg hivatkozik egy már meglévő szolgáltatások hello hello Windows operációs rendszer részét képező.</span><span class="sxs-lookup"><span data-stu-id="cc273-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="cc273-144">hello riasztási művelet konfigurált tooexecute a runbook ebben a példában használt, és futtassa a hello hibrid forgatókönyv-feldolgozó, amelyek engedélyezve vannak a hello célrendszereket.</span><span class="sxs-lookup"><span data-stu-id="cc273-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="cc273-145">a runbook-kód tevékenység hello **LA az beszerzése szolgáltatás neve** fog átalakítása hello JSON-formátumú karakterláncot egy objektumtípus és hello elemet a szűrő *SvcDisplayName_CF* tooextract hello megjelenített neve a hello A Windows szolgáltatás, és adja át ennek alakzatot hello következő tevékenység, amely ellenőrzi, hogy hello szolgáltatás le van állítva, mielőtt megpróbálná toorestart azt.</span><span class="sxs-lookup"><span data-stu-id="cc273-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="cc273-146">*SvcDisplayName_CF* van egy [egyéni mező](../log-analytics/log-analytics-custom-fields.md) Naplóelemzési toodemonstrate ebben a példában létrehozott.</span><span class="sxs-lookup"><span data-stu-id="cc273-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="cc273-147">Hello szolgáltatás leállásakor hello riasztási szabály a Naplóelemzési felismeri egyezés és kezdeményezi hello runbook és hello riasztás környezete toohello runbook küldése.</span><span class="sxs-lookup"><span data-stu-id="cc273-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="cc273-148">hello runbook műveletet nem hajt végre tooverify hello szolgáltatás leáll, és ha így kísérlet toorestart hello szolgáltatást, és győződjön meg arról, hogy megfelelően elindult-e, és kimeneti hello annak az eredménye.</span><span class="sxs-lookup"><span data-stu-id="cc273-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="cc273-149">Másik lehetőségként az Automation-fiókhoz kapcsolódó tooyour OMS-munkaterület nincs, ha szeretné hello riasztási szabály konfigurálása egy webhook művelet tootrigger hello runbookhoz és hello runbook tooconvert hello JSON-formátumú karakterláncot és a szűrőkonfigurálása*. SearchResult* a korábban említett hello útmutatást követve.</span><span class="sxs-lookup"><span data-stu-id="cc273-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="cc273-150">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="cc273-150">Next steps</span></span>

* <span data-ttu-id="cc273-151">Naplóelemzési a riasztásokkal kapcsolatos további toolearn és hogyan toocreate, lásd: [riasztásokat a Naplóelemzési](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="cc273-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="cc273-152">Hogyan tootrigger runbookok egy webhook: toounderstand [Azure Automation-webhook](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="cc273-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>
