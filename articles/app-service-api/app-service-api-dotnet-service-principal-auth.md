---
title: "Az Azure App Service API Apps szolgáltatás egyszerű hitelesítéssel |} Microsoft Docs"
description: "Ismerje meg, hogyan védi meg a szolgáltatások közötti forgatókönyvek az Azure App Service API-alkalmazás."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 95653287546bbe358111ed16af0c30a53caff2b5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 07/11/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="50ee4-103">Az Azure App Service API Apps szolgáltatás egyszerű hitelesítés</span><span class="sxs-lookup"><span data-stu-id="50ee4-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="50ee4-104">Áttekintés</span><span class="sxs-lookup"><span data-stu-id="50ee4-104">Overview</span></span>
<span data-ttu-id="50ee4-105">Ez a cikk ismerteti, hogyan App Service hitelesítés *belső* API-alkalmazások elérésére.</span><span class="sxs-lookup"><span data-stu-id="50ee4-105">This article explains how to use App Service authentication for *internal* access to API apps.</span></span> <span data-ttu-id="50ee4-106">Egy belső forgatókönyv, csak a saját alkalmazáskód felhasználhatóvá kell használni kívánt API-alkalmazások esetében.</span><span class="sxs-lookup"><span data-stu-id="50ee4-106">An internal scenario is where you have an API app that you want to be consumable only by your own application code.</span></span> <span data-ttu-id="50ee4-107">Az ajánlott módszer az App Service-ben Ez a forgatókönyv végrehajtásához az Azure AD használatára a hívott API-alkalmazás védelme érdekében.</span><span class="sxs-lookup"><span data-stu-id="50ee4-107">The recommended way to implement this scenario in App Service is to use Azure AD to protect the called API app.</span></span> <span data-ttu-id="50ee4-108">Meghívja az alkalmazásidentitás (egyszerű szolgáltatásnév) hitelesítő adatok megadásával az Azure AD-ből kapott tulajdonosi jogkivonatok védett API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="50ee4-108">You call the protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="50ee4-109">Más Azure AD, tekintse meg a **szolgáltatások közötti hitelesítési** szakasza a [Azure App Service hitelesítés áttekintése](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="50ee4-109">For alternatives to using Azure AD, see the **Service-to-service authentication** section of the [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="50ee4-110">Ebből a cikkből megtudhatja:</span><span class="sxs-lookup"><span data-stu-id="50ee4-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="50ee4-111">Hogyan illetéktelen hozzáférés elleni védelmének API-alkalmazás az Azure Active Directory (Azure AD) segítségével.</span><span class="sxs-lookup"><span data-stu-id="50ee4-111">How to use Azure Active Directory (Azure AD) to protect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="50ee4-112">Hogyan védett API-alkalmazás egy API-alkalmazást, a webes alkalmazás vagy a mobilalkalmazás használják az Azure AD szolgáltatás rendszerbiztonsági tag (app-identitás) hitelesítő adatait.</span><span class="sxs-lookup"><span data-stu-id="50ee4-112">How to consume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="50ee4-113">A logikai alkalmazás felhasználása kapcsolatos információkért lásd: [az App Service a Logic apps üzemeltetett egyéni API használata](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="50ee4-113">For information about how to consume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="50ee4-114">Győződjön meg arról, hogy a védett API-alkalmazás nem lehet meghívni egy böngészőből bejelentkezett felhasználók módjáról.</span><span class="sxs-lookup"><span data-stu-id="50ee4-114">How to make sure that the protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="50ee4-115">Győződjön meg arról, hogy a védett API-alkalmazás csak akkor hívható meg az adott Azure AD szolgáltatás egyszerű módja.</span><span class="sxs-lookup"><span data-stu-id="50ee4-115">How to make sure that the protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="50ee4-116">A cikk két részből áll:</span><span class="sxs-lookup"><span data-stu-id="50ee4-116">The article contains two sections:</span></span>

* <span data-ttu-id="50ee4-117">A [szolgáltatás egyszerű hitelesítés konfigurálása az Azure App Service](#authconfig) a szakasz a hitelesítés az API-alkalmazások konfigurálása, és a védett API-alkalmazások felhasználása általában ismerteti.</span><span class="sxs-lookup"><span data-stu-id="50ee4-117">The [How to configure service principal authentication in Azure App Service](#authconfig) section explains in general how to configure authentication for any API app, and how to consume the protected API app.</span></span> <span data-ttu-id="50ee4-118">Ez a szakasz App Service, beleértve a .NET, Node.js és Java által támogatott összes keretrendszerek egyaránt vonatkozik.</span><span class="sxs-lookup"><span data-stu-id="50ee4-118">This section applies equally to all frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="50ee4-119">Kezdve a [a .NET-bevezető oktatóanyagok folytatása](#tutorialstart) szakaszban az oktatóanyag végigvezeti Önt egy "belső hozzáférés" forgatókönyvet, az App Service-ben futó .NET mintaalkalmazás konfigurálása.</span><span class="sxs-lookup"><span data-stu-id="50ee4-119">Starting with the [Continuing the .NET getting-started tutorials](#tutorialstart) section, the tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="50ee4-120"><a id="authconfig"></a>Az Azure App Service szolgáltatás egyszerű hitelesítés konfigurálása</span><span class="sxs-lookup"><span data-stu-id="50ee4-120"><a id="authconfig"></a> How to configure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="50ee4-121">Ez a témakör általános API-alkalmazásra vonatkozó utasításokat.</span><span class="sxs-lookup"><span data-stu-id="50ee4-121">This section provides general instructions that apply to any API app.</span></span> <span data-ttu-id="50ee4-122">A lépések az adott való tegye lista .NET mintaalkalmazás, lásd [a .NET API-alkalmazások útmutató-sorozat folytatása](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="50ee4-122">For steps specific to the To Do List .NET sample application, go to [Continuing the .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="50ee4-123">Az a [Azure-portálon](https://portal.azure.com/), keresse meg a **beállítások** panelen az API-alkalmazás, amelyet szeretne védeni, és keresse meg a **szolgáltatások** szakaszt, és kattintson **hitelesítési / engedélyezési**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-123">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you want to protect, and then find the **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Hitelesítési/engedélyezési Azure-portálon](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="50ee4-125">Az a **hitelesítési / engedélyezési** panelen kattintson a **a**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-125">In the **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="50ee4-126">Az a **hitelesítetlen kérés esetén elvégzendő művelet** legördülő listában válassza **bejelentkezés Azure Active Directoryval** .</span><span class="sxs-lookup"><span data-stu-id="50ee4-126">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="50ee4-127">A **hitelesítésszolgáltatókat**, jelölje be **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Hitelesítési/engedélyezési panel az Azure-portálon](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="50ee4-129">Konfigurálja a **Azure Active Directory beállításai** hozzon létre egy új panel az Azure AD-alkalmazást, vagy ha már rendelkezik egy használni kívánt, meglévő Azure AD alkalmazás használja.</span><span class="sxs-lookup"><span data-stu-id="50ee4-129">Configure the **Azure Active Directory Settings** blade to create a new Azure AD application, or use an existing Azure AD application if you already have one that you want to use.</span></span>
   
    <span data-ttu-id="50ee4-130">Belső forgatókönyvek általában tartalmaz, amely az API-alkalmazást hívja az API-alkalmazások.</span><span class="sxs-lookup"><span data-stu-id="50ee4-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="50ee4-131">Használhatja a külön Azure AD-alkalmazásokat minden API-alkalmazás vagy egy Azure AD-alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="50ee4-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="50ee4-132">A panel részletes utasításokért lásd: [konfigurálása az App Service alkalmazás használhatja az Azure Active Directory bejelentkezési](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="50ee4-132">For detailed instructions on this blade, see [How to configure your App Service application to use Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="50ee4-133">Ha a hitelesítési szolgáltató konfigurációs panelen végzett, kattintson **OK**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-133">When you're done with the authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="50ee4-134">Az a **hitelesítési / engedélyezési** panelen kattintson a **mentése**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-134">In the **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Kattintson a Save (Mentés) gombra.](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="50ee4-136">Ebben az esetben, ha az App Service csak lehetővé teszi a kérelmek a beállított a hívók az Azure AD-bérlő.</span><span class="sxs-lookup"><span data-stu-id="50ee4-136">When this is done, App Service only allows requests from callers in the configured Azure AD tenant.</span></span> <span data-ttu-id="50ee4-137">Nincs hitelesítési vagy engedélyezési kód szükséges a védett API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="50ee4-137">No authentication or authorization code is required in the protected API app.</span></span> <span data-ttu-id="50ee4-138">Az API-alkalmazásba, általában együtt a tulajdonosi jogkivonattal a HTTP-fejlécekben használt jogcímek átadását és érheti el ezt az információt a kódot, hogy ellenőrizze, hogy vannak-e kérelmek egy adott hívó, például egy egyszerű szolgáltatást.</span><span class="sxs-lookup"><span data-stu-id="50ee4-138">The bearer token is passed to the API app along with commonly used claims in HTTP headers, and you can read that information in code to validate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="50ee4-139">Ez a hitelesítési szolgáltatás működik, mint az összes, az App service támogat, beleértve a .NET, Node.js és Java nyelven.</span><span class="sxs-lookup"><span data-stu-id="50ee4-139">This authentication functionality works the same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-to-consume-the-protected-api-app"></a><span data-ttu-id="50ee4-140">Hogyan kell a védett API-alkalmazások felhasználása</span><span class="sxs-lookup"><span data-stu-id="50ee4-140">How to consume the protected API app</span></span>
<span data-ttu-id="50ee4-141">A hívónak biztosítania kell egy Azure AD-tulajdonosi jogkivonattal API-hívások.</span><span class="sxs-lookup"><span data-stu-id="50ee4-141">The caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="50ee4-142">Ahhoz, hogy a szolgáltatás egyszerű hitelesítő adataival tulajdonosi jogkivonattal, a hívó által használt Active Directory Authentication Library (adal-t a [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), vagy [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="50ee4-142">To get a bearer token using service principal credentials, the caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="50ee4-143">Egy token beszerzéséhez az adal-t meghívó kód az adal-ra a következő adatokat tartalmazza:</span><span class="sxs-lookup"><span data-stu-id="50ee4-143">To get a token, the code that calls ADAL provides to ADAL the following information:</span></span>

* <span data-ttu-id="50ee4-144">Az Azure AD-bérlő neve.</span><span class="sxs-lookup"><span data-stu-id="50ee4-144">The name of your Azure AD tenant.</span></span>
* <span data-ttu-id="50ee4-145">Az ügyfél-azonosító és a titkos ügyfélkódot (Alkalmazáskulcs) az Azure AD-alkalmazás a hívó társított.</span><span class="sxs-lookup"><span data-stu-id="50ee4-145">The client ID and client secret (app key) of the Azure AD app associated with the caller.</span></span>
* <span data-ttu-id="50ee4-146">Az Azure AD-alkalmazás a védett API-alkalmazáshoz tartozó ügyfél-azonosító.</span><span class="sxs-lookup"><span data-stu-id="50ee4-146">The client ID of the Azure AD application associated with the protected API app.</span></span> <span data-ttu-id="50ee4-147">(Ha csak egy Azure AD-alkalmazást használ, ez az ügyfél azonosítója megegyezik azzal a hívónak.)</span><span class="sxs-lookup"><span data-stu-id="50ee4-147">(If just one Azure AD application is used, this is the same client ID as the one for the caller.)</span></span>

<span data-ttu-id="50ee4-148">Ezeket az értékeket az Azure AD lapján érhetők el a [a klasszikus Azure portálon](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="50ee4-148">These values are available in the Azure AD pages of the [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="50ee4-149">A token beszerzett, ha a hívó tartalmazza a HTTP-kérések a hitelesítési fejléc.</span><span class="sxs-lookup"><span data-stu-id="50ee4-149">Once the token has been acquired, the caller includes it with HTTP requests in the Authorization header.</span></span>  <span data-ttu-id="50ee4-150">App Service érvényesíti a jogkivonatot, és lehetővé teszi a kérelmek a védett API-alkalmazás eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="50ee4-150">App Service validates the token and allows the requests to reach the protected API app.</span></span>

#### <a name="how-to-protect-the-api-app-from-access-by-users-in-the-same-tenant"></a><span data-ttu-id="50ee4-151">Az API-alkalmazás a felhasználók ugyanazzal a bérlővel védelme</span><span class="sxs-lookup"><span data-stu-id="50ee4-151">How to protect the API app from access by users in the same tenant</span></span>
<span data-ttu-id="50ee4-152">A felhasználók ugyanazzal a bérlővel tulajdonosi jogkivonatok érvényesek védett API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="50ee4-152">Bearer tokens for users in the same tenant are considered valid for the protected API app.</span></span>  <span data-ttu-id="50ee4-153">Ha azt szeretné, annak érdekében, hogy csak egy egyszerű meghívhatja a védett API-alkalmazás, adja hozzá a kódot a védett API-alkalmazás a következő jogcímeket a jogkivonatból ellenőrzése:</span><span class="sxs-lookup"><span data-stu-id="50ee4-153">If you want to ensure that only a service principal can call the protected API app, add code in the protected API app to validate the following claims from the token:</span></span>

* <span data-ttu-id="50ee4-154">`appid`az ügyfél-Azonosítóját az Azure AD-alkalmazás, amely a hívó társított kell lennie.</span><span class="sxs-lookup"><span data-stu-id="50ee4-154">`appid` should be the client ID of the Azure AD application that is associated with the caller.</span></span> 
* <span data-ttu-id="50ee4-155">`oid`(`objectidentifier`) kell lennie a hívó szolgáltatás résztvevő-azonosító.</span><span class="sxs-lookup"><span data-stu-id="50ee4-155">`oid` (`objectidentifier`) should be the service principal ID of the caller.</span></span> 

<span data-ttu-id="50ee4-156">App Service emellett a `objectidentifier` jogcím X-MS-CLIENT-tag-ID fejlécében.</span><span class="sxs-lookup"><span data-stu-id="50ee4-156">App Service also provides the `objectidentifier` claim in the X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-to-protect-the-api-app-from-browser-access"></a><span data-ttu-id="50ee4-157">Hogyan védi meg a böngésző-hozzáférés az API-alkalmazás</span><span class="sxs-lookup"><span data-stu-id="50ee4-157">How to protect the API app from browser access</span></span>
<span data-ttu-id="50ee4-158">Ha Ön nem ellenőrizhesse a kódban a védett API-alkalmazás, és külön használhatja az Azure AD alkalmazás védett API-alkalmazás, ügyeljen arra, hogy az Azure AD-alkalmazás válasz URL-CÍMEN nem ugyanaz, mint az API-alkalmazás alap URL-címet.</span><span class="sxs-lookup"><span data-stu-id="50ee4-158">If you don't validate claims in code in the protected API app, and if you use a separate Azure AD application for the protected API app, make sure that the Azure AD application's Reply URL is not the same as the API app's base URL.</span></span> <span data-ttu-id="50ee4-159">Ha a válasz URL-címet közvetlenül a védett API-alkalmazás mutat, az azonos Azure AD-bérlő a felhasználó képes keresse meg az API-alkalmazás, jelentkezzen be, és sikeresen hívja az API-t.</span><span class="sxs-lookup"><span data-stu-id="50ee4-159">If the Reply URL points directly to the protected API app, a user in the same Azure AD tenant could browse to the API app, log on, and successfully call the API.</span></span>

## <span data-ttu-id="50ee4-160"><a id="tutorialstart"></a>A .NET API-alkalmazások útmutató-sorozat folytatása</span><span class="sxs-lookup"><span data-stu-id="50ee4-160"><a id="tutorialstart"></a> Continuing the .NET API Apps tutorial series</span></span>
<span data-ttu-id="50ee4-161">Ha a Node.js vagy Java oktatóanyag sorozat API-alkalmazások, ugorjon a [további lépések](#next-steps) szakasz.</span><span class="sxs-lookup"><span data-stu-id="50ee4-161">If you are following the Node.js or Java tutorial series for API apps, skip to the [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="50ee4-162">Az a cikk hátralévő része a .NET API-alkalmazások útmutató-sorozat folytatja, és feltételezi, hogy végrehajtotta a [felhasználói hitelesítési oktatóanyag](app-service-api-dotnet-user-principal-auth.md) , és a felhasználói hitelesítés engedélyezve van az Azure-ban futó mintaalkalmazást.</span><span class="sxs-lookup"><span data-stu-id="50ee4-162">The remainder of this article continues the .NET API Apps tutorial series and assumes that you have completed the [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have the sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="50ee4-163">Az Azure-ban hitelesítés beállítása</span><span class="sxs-lookup"><span data-stu-id="50ee4-163">Set up authentication in Azure</span></span>
<span data-ttu-id="50ee4-164">Ebben a szakaszban megadhatja az App Service, hogy csak a HTTP-kérelmek az adatréteg API-alkalmazásának eléréséhez, akkor azok, amelyek érvényes Azure AD tulajdonosi jogkivonatoknak nevezzük.</span><span class="sxs-lookup"><span data-stu-id="50ee4-164">In this section you configure App Service so that the only HTTP requests it allows to reach the data tier API app are the ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="50ee4-165">A következő szakaszban a középső réteg API-alkalmazás alkalmazás hitelesítő adatok küldése az Azure AD vissza egy tulajdonosi jogkivonatot és a tulajdonosi jogkivonattal küldeni az adatréteg API-alkalmazásának konfigurálásához.</span><span class="sxs-lookup"><span data-stu-id="50ee4-165">In the following section, you configure the middle tier API app to send application credentials to Azure AD, get back a bearer token, and send the bearer token to the data tier API app.</span></span> <span data-ttu-id="50ee4-166">Ez a folyamat az az ábrán látható.</span><span class="sxs-lookup"><span data-stu-id="50ee4-166">This process is illustrated in the diagram.</span></span>

![Szolgáltatás-hitelesítés diagramja](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="50ee4-168">Ha problémát tapasztal az oktatóanyag utasításait követve közben, olvassa el a [hibaelhárítás](#troubleshooting) szakasz az oktatóanyag végén.</span><span class="sxs-lookup"><span data-stu-id="50ee4-168">If you run into problems while following the tutorial directions, see the [Troubleshooting](#troubleshooting) section at the end of the tutorial.</span></span> 

1. <span data-ttu-id="50ee4-169">A a [Azure-portálon](https://portal.azure.com/), keresse meg a **beállítások** ToDoListDataAPI (adatok réteg) API-alkalmazás létrehozása, és kattintson az API-alkalmazás paneljén **beállítások**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-169">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you created for the ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="50ee4-170">Az a **beállítások** panelen található az **szolgáltatások** szakaszt, és kattintson a **hitelesítési / engedélyezési**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-170">In the **Settings** blade, find the **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Hitelesítési/engedélyezési Azure-portálon](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="50ee4-172">Az a **hitelesítési / engedélyezési** panelen kattintson a **a**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-172">In the **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="50ee4-173">Az a **hitelesítetlen kérés esetén elvégzendő művelet** legördülő listában válassza **bejelentkezés Azure Active Directoryval**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-173">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="50ee4-174">Ez a beállítás hatására az App Service annak érdekében, hogy csak hitelesített kérelmek reach az API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="50ee4-174">This is the setting that causes App Service to ensure that only authenticated requests reach the API app.</span></span> <span data-ttu-id="50ee4-175">Érvényes tulajdonosi jogkivonatok rendelkező kéréseknél az App Service mentén jogkivonatok átadása az API-alkalmazás tölti fel ezt az információt könnyebben számára elérhetővé tenni a kódot a gyakran használt JOGCÍMEKKEL rendelkező és HTTP-fejlécek.</span><span class="sxs-lookup"><span data-stu-id="50ee4-175">For requests that have valid bearer tokens, App Service passes the tokens along to the API app and populates HTTP headers with commonly used claims to make that information more easily available to your code.</span></span>
5. <span data-ttu-id="50ee4-176">A **hitelesítésszolgáltatókat**, kattintson a **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Hitelesítési/engedélyezési panel az Azure-portálon](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="50ee4-178">Az a **Azure Active Directory beállításai** panelen kattintson a **Express**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-178">In the **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="50ee4-179">Az a **Express** beállítás Azure automatikusan létrehozhat egy AAD-alkalmazást az Azure ad [bérlői](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="50ee4-179">With the **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="50ee4-180">Nem rendelkezik a bérlő létrehozására, mert minden Azure-fiók automatikusan van egy.</span><span class="sxs-lookup"><span data-stu-id="50ee4-180">You don't have to create a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="50ee4-181">A **üzemmód**, kattintson a **új AD-alkalmazás létrehozása** Ha még nincs kiválasztva.</span><span class="sxs-lookup"><span data-stu-id="50ee4-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="50ee4-182">A portál csatlakozik a **létrehozása App** beviteli mezőt, alapértelmezett értékkel.</span><span class="sxs-lookup"><span data-stu-id="50ee4-182">The portal plugs the **Create App** input box with a default value.</span></span> <span data-ttu-id="50ee4-183">Alapértelmezés szerint az Azure AD-alkalmazás neve megegyezik az API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="50ee4-183">By default, the Azure AD application is named the same as the API app.</span></span> <span data-ttu-id="50ee4-184">Tetszés szerint megadhat egy másik nevet.</span><span class="sxs-lookup"><span data-stu-id="50ee4-184">If you prefer, you can enter a different name.</span></span>
   
    ![Az Azure AD-beállítások](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="50ee4-186">**Megjegyzés:**: alternatív megoldásként használhat egy egyetlen Azure AD alkalmazás a hívó API-alkalmazás és a védett API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="50ee4-186">**Note**: As an alternative, you could use a single Azure AD application for both the calling API app and the protected API app.</span></span> <span data-ttu-id="50ee4-187">Ha úgy dönt, hogy az alternatív, nem kell a **új AD-alkalmazás létrehozása** itt beállítást, mert már létrehozott egy Azure AD-alkalmazást a felhasználó hitelesítési az oktatóanyag korábbi részében.</span><span class="sxs-lookup"><span data-stu-id="50ee4-187">If you chose that alternative, you would not need the **Create New AD App** option here because you already created an Azure AD application earlier in the user authentication tutorial.</span></span> <span data-ttu-id="50ee4-188">Ebben az oktatóanyagban fogja használni a hívó API-alkalmazás és a védett API-alkalmazás az Azure AD-alkalmazások.</span><span class="sxs-lookup"><span data-stu-id="50ee4-188">For this tutorial, you'll use separate Azure AD applications for the calling API app and the protected API app.</span></span>
8. <span data-ttu-id="50ee4-189">Jegyezze fel az értéket a **alkalmazás létrehozása** beviteli mezőt; az AAD-alkalmazást a klasszikus Azure portálon később lesz meg.</span><span class="sxs-lookup"><span data-stu-id="50ee4-189">Make a note of the value that is in the **Create App** input box; you'll look up this AAD application in the Azure classic portal later.</span></span>
9. <span data-ttu-id="50ee4-190">Kattintson az **OK** gombra.</span><span class="sxs-lookup"><span data-stu-id="50ee4-190">Click **OK**.</span></span>
10. <span data-ttu-id="50ee4-191">Az a **hitelesítési / engedélyezési** panelen kattintson a **mentése**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-191">In the **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Kattintson a Save (Mentés) gombra.](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="50ee4-193">App Service hoz létre az Azure Active Directory alkalmazás **bejelentkezési URL-cím** és **válasz URL-CÍMEN** automatikusan beállítja az API-alkalmazás URL-címét.</span><span class="sxs-lookup"><span data-stu-id="50ee4-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set to the URL of your API app.</span></span> <span data-ttu-id="50ee4-194">Az utóbbi érték lehetővé teszi a felhasználók az AAD-bérlőben jelentkezzen be, és az API-alkalmazás eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="50ee4-194">The latter value enables users in your AAD tenant to log in and access the API app.</span></span>

### <a name="verify-that-the-api-app-is-protected"></a><span data-ttu-id="50ee4-195">Győződjön meg arról, hogy védett-e az API-alkalmazás</span><span class="sxs-lookup"><span data-stu-id="50ee4-195">Verify that the API app is protected</span></span>
1. <span data-ttu-id="50ee4-196">Egy böngészőben nyissa meg az URL-címet a API-alkalmazás: az a **API-alkalmazás** panel az Azure-portálon kattintson a hivatkozásra kattintva **URL-cím**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-196">In a browser go to the URL of the API app: in the **API app** blade in the Azure portal, click the link under **URL**.</span></span> 
   
    <span data-ttu-id="50ee4-197">Ekkor megnyílik egy bejelentkezési képernyő, mert nem hitelesített kérelmek nem engedélyezettek az API-alkalmazás eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="50ee4-197">You are redirected to a login screen because unauthenticated requests are not allowed to reach the API app.</span></span> 
   
    <span data-ttu-id="50ee4-198">Ha a böngészőben navigáljon a Swagger felhasználói felület, a böngésző már kerülhettek naplózásra a – ebben az esetben, nyisson meg egy InPrivate vagy Incognito ablakot, és navigáljon a Swagger felhasználói felület URL-CÍMÉT.</span><span class="sxs-lookup"><span data-stu-id="50ee4-198">If your browser does go to the Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go to the Swagger UI URL.</span></span>
2. <span data-ttu-id="50ee4-199">Jelentkezzen be az AAD-bérlőben egy olyan felhasználó hitelesítő adataival.</span><span class="sxs-lookup"><span data-stu-id="50ee4-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="50ee4-200">Ha van bejelentkezve, a "sikeres létrehozásról" tájékoztató oldal jelenik meg a böngészőben.</span><span class="sxs-lookup"><span data-stu-id="50ee4-200">When you're logged on, the "successfully created" page appears in the browser.</span></span>

## <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="50ee4-201">A beszerzést, mind az Azure AD-jogkivonat küldése a ToDoListAPI projekt konfigurálása</span><span class="sxs-lookup"><span data-stu-id="50ee4-201">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="50ee4-202">Ebben a szakaszban a következő feladatokat hajthatnak végre:</span><span class="sxs-lookup"><span data-stu-id="50ee4-202">In this section you do the following tasks:</span></span>

* <span data-ttu-id="50ee4-203">Adja hozzá a kódot a középső réteg API-alkalmazás, amely az Azure AD alkalmazás hitelesítő adatainak használatával egy jogkivonat és a HTTP-kérések küldése az adatréteg API-alkalmazását.</span><span class="sxs-lookup"><span data-stu-id="50ee4-203">Add code in the middle tier API app that uses Azure AD application credentials to acquire a token and send it with HTTP requests to the data tier API app.</span></span>
* <span data-ttu-id="50ee4-204">A hitelesítő adatokat kell beolvasni az Azure AD.</span><span class="sxs-lookup"><span data-stu-id="50ee4-204">Get the credentials you need from Azure AD.</span></span>
* <span data-ttu-id="50ee4-205">Adja meg a hitelesítő adatokat az Azure App Service futásidejű környezeti beállításokban a középső rétegbeli API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="50ee4-205">Enter the credentials into Azure App Service runtime environment settings in the middle tier API app.</span></span> 

### <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="50ee4-206">A beszerzést, mind az Azure AD-jogkivonat küldése a ToDoListAPI projekt konfigurálása</span><span class="sxs-lookup"><span data-stu-id="50ee4-206">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="50ee4-207">A következő módosításokat a ToDoListAPI projekt, a Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="50ee4-207">Make the following changes in the ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="50ee4-208">Állítsa vissza az összes lévő kódot az *ServicePrincipal.cs* fájlt.</span><span class="sxs-lookup"><span data-stu-id="50ee4-208">Uncomment all of the code in the *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="50ee4-209">Ez egy, a kódot, amelyeket a .NET-hez készült adal-t használ az Azure AD tulajdonosi jogkivonat.</span><span class="sxs-lookup"><span data-stu-id="50ee4-209">This is the code that uses ADAL for .NET to acquire the Azure AD bearer token.</span></span>  <span data-ttu-id="50ee4-210">Több konfigurációs értékeket, amelyek akkor lesznek állítva az Azure futtatókörnyezetben később használ.</span><span class="sxs-lookup"><span data-stu-id="50ee4-210">It uses several configuration values that you'll set in the Azure runtime environment later.</span></span> <span data-ttu-id="50ee4-211">A kód itt látható:</span><span class="sxs-lookup"><span data-stu-id="50ee4-211">Here's the code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="50ee4-212">**Megjegyzés:** ezt a kódot az adal-t kér .NET NuGet-csomagot (Microsoft.IdentityModel.Clients.ActiveDirectory), amely a projekt már telepítve van.</span><span class="sxs-lookup"><span data-stu-id="50ee4-212">**Note:** This code requires the ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in the project.</span></span> <span data-ttu-id="50ee4-213">Ez a projekt teljesen új hozott létre, ha kellene telepíteni ezt a csomagot.</span><span class="sxs-lookup"><span data-stu-id="50ee4-213">If you were creating this project from scratch, you would have to install this package.</span></span> <span data-ttu-id="50ee4-214">Ez a csomag automatikusan nincs telepítve az API app – új projekt sablonban.</span><span class="sxs-lookup"><span data-stu-id="50ee4-214">This package is not automatically installed by the API app new-project template.</span></span>
2. <span data-ttu-id="50ee4-215">A *tartományvezérlők/ToDoListController*, állítsa vissza a kód a `NewDataAPIClient` módszer, amelynek kiegészíti a jogkivonattal a HTTP-kérelmek engedélyezési fejlécében.</span><span class="sxs-lookup"><span data-stu-id="50ee4-215">In *Controllers/ToDoListController*, uncomment the code in the `NewDataAPIClient` method that adds the token to HTTP requests in the authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="50ee4-216">Telepítse a ToDoListAPI projektet.</span><span class="sxs-lookup"><span data-stu-id="50ee4-216">Deploy the ToDoListAPI project.</span></span> <span data-ttu-id="50ee4-217">(Kattintson a jobb gombbal a projektre, majd kattintson az **közzététel > Közzététel**.)</span><span class="sxs-lookup"><span data-stu-id="50ee4-217">(Right-click the project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="50ee4-218">A Visual Studio telepíti a projektet, és a webes alkalmazás alap URL-cím egy böngészőablakban megnyitja.</span><span class="sxs-lookup"><span data-stu-id="50ee4-218">Visual Studio deploys the project and opens a browser to the web app's base URL.</span></span> <span data-ttu-id="50ee4-219">Ez azt mutatja majd 403-as hibalap, ez nem jelent problémát, a Web API alap URL-címet egy böngészőben nyissa tett kísérlet.</span><span class="sxs-lookup"><span data-stu-id="50ee4-219">This will show a 403 error page, which is normal for an attempt to go to a Web API base URL from a browser.</span></span>
4. <span data-ttu-id="50ee4-220">Zárja be a böngészőt.</span><span class="sxs-lookup"><span data-stu-id="50ee4-220">Close the browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="50ee4-221">Az Azure AD konfigurációs értékek beolvasása</span><span class="sxs-lookup"><span data-stu-id="50ee4-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="50ee4-222">Az a [a klasszikus Azure portálon](https://manage.windowsazure.com/), és **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-222">In the [Azure classic portal](https://manage.windowsazure.com/), go to **Azure Active Directory**.</span></span>
2. <span data-ttu-id="50ee4-223">Az a **Directory** lapra, majd az AAD-bérlőt.</span><span class="sxs-lookup"><span data-stu-id="50ee4-223">On the **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="50ee4-224">Kattintson a **alkalmazások > a vállalat tulajdonában lévő alkalmazások**, majd kattintson a pipa jelre.</span><span class="sxs-lookup"><span data-stu-id="50ee4-224">Click **Applications > Applications my company owns**, and then click the check mark.</span></span>
4. <span data-ttu-id="50ee4-225">Az alkalmazások listájának megtekintéséhez kattintson a Azure létrehozó meg, ha engedélyezte a hitelesítési ToDoListDataAPI (adatok réteg) API-alkalmazás nevét.</span><span class="sxs-lookup"><span data-stu-id="50ee4-225">In the list of applications, click the name of the one that Azure created for you when you enabled authentication for the ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="50ee4-226">Kattintson a **Configure** (Konfigurálás) lapra.</span><span class="sxs-lookup"><span data-stu-id="50ee4-226">Click the **Configure** tab.</span></span>
6. <span data-ttu-id="50ee4-227">Másolás a **ügyfél-azonosító** értékét, és mentse valahol beszerezheti a később.</span><span class="sxs-lookup"><span data-stu-id="50ee4-227">Copy the **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="50ee4-228">A Azure klasszikus portál lépjen vissza a listája **a vállalat tulajdonában lévő alkalmazások**, és kattintson az AAD-alkalmazást, középső rétegbeli ToDoListAPI API-alkalmazás (hozta létre az előző oktatóanyag, nem az ebben az oktatóanyagban létrehozott egy).</span><span class="sxs-lookup"><span data-stu-id="50ee4-228">In the Azure classic portal go back to the list of **Applications my company owns**, and click the AAD application that you created for the middle tier ToDoListAPI API app (the one you created in the previous tutorial, not the one you created in this tutorial).</span></span>
8. <span data-ttu-id="50ee4-229">Kattintson a **Configure** (Konfigurálás) lapra.</span><span class="sxs-lookup"><span data-stu-id="50ee4-229">Click the **Configure** tab.</span></span>
9. <span data-ttu-id="50ee4-230">Másolás a **ügyfél-azonosító** értékét, és mentse valahol beszerezheti a később.</span><span class="sxs-lookup"><span data-stu-id="50ee4-230">Copy the **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="50ee4-231">A **kulcsok**, jelölje be **1 év** a a **időtartam kiválasztása** legördülő listából választhatja ki.</span><span class="sxs-lookup"><span data-stu-id="50ee4-231">Under **keys**, select **1 year** from the **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="50ee4-232">Kattintson a **Save** (Mentés) gombra.</span><span class="sxs-lookup"><span data-stu-id="50ee4-232">Click **Save**.</span></span>
    
     ![Alkalmazás-kulcs létrehozása](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="50ee4-234">Másolja ki a kulcs értékét, és mentse valahol beszerezheti a később.</span><span class="sxs-lookup"><span data-stu-id="50ee4-234">Copy the key value and save it someplace you can get it from later.</span></span>
    
     ![Új alkalmazás kulcs másolása](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-the-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="50ee4-236">A középső réteg API-alkalmazásának futtatókörnyezetben az Azure AD-beállítások konfigurálása</span><span class="sxs-lookup"><span data-stu-id="50ee4-236">Configure Azure AD settings in the middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="50ee4-237">Lépjen a [Azure-portálon](https://portal.azure.com/), majd keresse meg a **API-alkalmazás** panel, amelyen a TodoListAPI (középső réteg) projekt API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="50ee4-237">Go to the [Azure portal](https://portal.azure.com/), and then navigate to the **API App** blade for the API app that hosts the TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="50ee4-238">Kattintson a **Settings > Application Settings** (Beállítások > Alkalmazásbeállítások) lehetőségre.</span><span class="sxs-lookup"><span data-stu-id="50ee4-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="50ee4-239">Az a **Alkalmazásbeállítások** területen írja be a következő kulcsok és értékek:</span><span class="sxs-lookup"><span data-stu-id="50ee4-239">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="50ee4-240">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="50ee4-240">**Key**</span></span> | <span data-ttu-id="50ee4-241">IDA: hatóság</span><span class="sxs-lookup"><span data-stu-id="50ee4-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="50ee4-242">**Érték**</span><span class="sxs-lookup"><span data-stu-id="50ee4-242">**Value**</span></span> |<span data-ttu-id="50ee4-243">{az Azure AD bérlő neve} https://Login.microsoftonline.com/</span><span class="sxs-lookup"><span data-stu-id="50ee4-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="50ee4-244">**Példa**</span><span class="sxs-lookup"><span data-stu-id="50ee4-244">**Example**</span></span> |<span data-ttu-id="50ee4-245">https://Login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="50ee4-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="50ee4-246">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="50ee4-246">**Key**</span></span> | <span data-ttu-id="50ee4-247">IDA: ClientId</span><span class="sxs-lookup"><span data-stu-id="50ee4-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="50ee4-248">**Érték**</span><span class="sxs-lookup"><span data-stu-id="50ee4-248">**Value**</span></span> |<span data-ttu-id="50ee4-249">A hívó alkalmazás (középső réteg - ToDoListAPI) ügyfél-azonosítója</span><span class="sxs-lookup"><span data-stu-id="50ee4-249">Client ID of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="50ee4-250">**Példa**</span><span class="sxs-lookup"><span data-stu-id="50ee4-250">**Example**</span></span> |<span data-ttu-id="50ee4-251">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="50ee4-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="50ee4-252">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="50ee4-252">**Key**</span></span> | <span data-ttu-id="50ee4-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="50ee4-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="50ee4-254">**Érték**</span><span class="sxs-lookup"><span data-stu-id="50ee4-254">**Value**</span></span> |<span data-ttu-id="50ee4-255">A hívó alkalmazás (középső réteg - ToDoListAPI) Alkalmazáskulcs</span><span class="sxs-lookup"><span data-stu-id="50ee4-255">App key of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="50ee4-256">**Példa**</span><span class="sxs-lookup"><span data-stu-id="50ee4-256">**Example**</span></span> |<span data-ttu-id="50ee4-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="50ee4-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="50ee4-258">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="50ee4-258">**Key**</span></span> | <span data-ttu-id="50ee4-259">IDA: erőforrás</span><span class="sxs-lookup"><span data-stu-id="50ee4-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="50ee4-260">**Érték**</span><span class="sxs-lookup"><span data-stu-id="50ee4-260">**Value**</span></span> |<span data-ttu-id="50ee4-261">A hívott alkalmazás ügyfél-azonosító (adatrétegbeli - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="50ee4-261">Client ID of the called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="50ee4-262">**Példa**</span><span class="sxs-lookup"><span data-stu-id="50ee4-262">**Example**</span></span> |<span data-ttu-id="50ee4-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="50ee4-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="50ee4-264">**Megjegyzés:**: A `ida:Resource`, a hívott alkalmazást kell használnia **ügyfél-azonosító** és nem a **App ID URI**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-264">**Note**: For `ida:Resource`, make sure you use the called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="50ee4-265">`ida:ClientId`és `ida:Resource` eltérő értékek ehhez az oktatóanyaghoz, mert használata külön az Azure AD applicaations a középső réteg és az adatszint.</span><span class="sxs-lookup"><span data-stu-id="50ee4-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for the middle tier and data tier.</span></span> <span data-ttu-id="50ee4-266">Ha egyetlen használta az Azure AD-alkalmazást a hívó API-alkalmazás és a védett API-alkalmazás, használhatja ugyanazt az értéket mindkét `ida:ClientId` és `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="50ee4-266">If you were using a single Azure AD application for the calling API app and the protected API app, you would use the same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="50ee4-267">A kód ConfigurationManager beolvasni ezeket az értékeket, így azok tárolható, a projekt Web.config fájlban, vagy az Azure futtatókörnyezetben használja.</span><span class="sxs-lookup"><span data-stu-id="50ee4-267">The code uses ConfigurationManager to get these values, so they could be stored in the project's Web.config file or in the Azure runtime environment.</span></span> <span data-ttu-id="50ee4-268">Az ASP.NET-alkalmazások futása közben az Azure App Service-ben, a környezet beállítások automatikusan felülbírálhatják a beállításokat a Web.config fájlból.</span><span class="sxs-lookup"><span data-stu-id="50ee4-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config.</span></span> <span data-ttu-id="50ee4-269">A tesztkörnyezet beállításainak vannak általában egy [biztonságát módot a Web.config fájlban képest bizalmas adatokat tárol](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="50ee4-269">Environment settings are generally a [more secure way to store sensitive information compared to a Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="50ee4-270">Kattintson a **Save** (Mentés) gombra.</span><span class="sxs-lookup"><span data-stu-id="50ee4-270">Click **Save**.</span></span>
   
    ![Kattintson a Save (Mentés) gombra.](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-the-application"></a><span data-ttu-id="50ee4-272">Az alkalmazás tesztelése</span><span class="sxs-lookup"><span data-stu-id="50ee4-272">Test the application</span></span>
1. <span data-ttu-id="50ee4-273">Nyissa meg böngészőben az AngularJS előtér-webalkalmazás HTTPS URL-címét.</span><span class="sxs-lookup"><span data-stu-id="50ee4-273">In a browser go to the HTTPS URL of the AngularJS front end web app.</span></span>
2. <span data-ttu-id="50ee4-274">Kattintson a **To Do List** lapra, és jelentkezzen be az Azure AD-bérlő a felhasználó hitelesítő adataival.</span><span class="sxs-lookup"><span data-stu-id="50ee4-274">Click the **To Do List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="50ee4-275">Adja hozzá a Tennivalólista elemein, hogy az alkalmazás működésének ellenőrzéséhez.</span><span class="sxs-lookup"><span data-stu-id="50ee4-275">Add to-do items to verify that the application is working.</span></span>
   
    ![Tennivalók listája lap](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="50ee4-277">Ha az alkalmazás a várt módon nem működik, gondosan ellenőrizze a megadott Azure-portálon beállítások.</span><span class="sxs-lookup"><span data-stu-id="50ee4-277">If the application doesn't work as expected, double-check all of the settings you entered in the Azure portal.</span></span> <span data-ttu-id="50ee4-278">Ha a beállítások csak akkor lehet helyes jelenik meg, tekintse meg a [hibaelhárítás](#troubleshooting) szakasz az oktatóanyag későbbi részében.</span><span class="sxs-lookup"><span data-stu-id="50ee4-278">If all of the settings appear to be correct, see the [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-the-api-app-from-browser-access"></a><span data-ttu-id="50ee4-279">Böngésző-hozzáférés elleni védelmének az API-alkalmazás</span><span class="sxs-lookup"><span data-stu-id="50ee4-279">Protect the API app from browser access</span></span>
<span data-ttu-id="50ee4-280">A jelen oktatóanyag egy külön létrehozott ToDoListDataAPI (adatok réteg) API-alkalmazás az Azure AD-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="50ee4-280">For this tutorial you created a separate Azure AD application for the ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="50ee4-281">Most láthatta, ha az App Service egy AAD-alkalmazást hoz létre, mert oly módon, amely lehetővé teszi az API-alkalmazás URL-címet egy böngészőben nyissa, és jelentkezzen be egy felhasználó beállítja az AAD-alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="50ee4-281">As you've seen, when App Service creates an AAD application, it configures the AAD application in a way that enables a user to go to the API app's URL in a browser and log on.</span></span> <span data-ttu-id="50ee4-282">Ez azt jelenti, lehetséges, hogy a felhasználó az Azure AD-bérlőn, nem csak egy egyszerű szolgáltatásnév, az API eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="50ee4-282">That means it's possible for an end user in your Azure AD tenant, not just a service principal, to access the API.</span></span> 

<span data-ttu-id="50ee4-283">Ha meg szeretné akadályozni, hogy a böngésző-hozzáférés a védett API-alkalmazás programozás nélkül, módosíthatja a **válasz URL-CÍMEN** az AAD-alkalmazást, hogy eltér az API-alkalmazás alap URL.</span><span class="sxs-lookup"><span data-stu-id="50ee4-283">If you want to prevent browser access without writing any code in the protected API app, you can change the **Reply URL** in the AAD application so that it's different from the API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="50ee4-284">Böngésző-hozzáférés letiltása</span><span class="sxs-lookup"><span data-stu-id="50ee4-284">Disable browser access</span></span>
1. <span data-ttu-id="50ee4-285">A klasszikus portálon **konfigurálása** lapján az AAD-alkalmazást, amely a TodoListService lett létrehozva, módosítsa a **válasz URL-CÍMEN** úgy, hogy egy érvényes URL-címet, de nem az API-alkalmazás URL-cím mezőben.</span><span class="sxs-lookup"><span data-stu-id="50ee4-285">In the classic portal's **Configure** tab for the AAD application that was created for the TodoListService, change the value in the **Reply URL** field so that it is a valid URL but not the API app's URL.</span></span>
2. <span data-ttu-id="50ee4-286">Kattintson a **Save** (Mentés) gombra.</span><span class="sxs-lookup"><span data-stu-id="50ee4-286">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="50ee4-287">Ellenőrizze a böngésző-hozzáférés nem működik.</span><span class="sxs-lookup"><span data-stu-id="50ee4-287">Verify browser access no longer works</span></span>
<span data-ttu-id="50ee4-288">Korábban ellenőrizte, hogy lépjen az API-alkalmazás URL-CÍMÉT a böngésző egyéni felhasználói hitelesítő adatokkal való bejelentkezés.</span><span class="sxs-lookup"><span data-stu-id="50ee4-288">Earlier you verified that you can go to the API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="50ee4-289">Ebben a szakaszban, ellenőrizze, hogy ez nem lehetséges.</span><span class="sxs-lookup"><span data-stu-id="50ee4-289">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="50ee4-290">Egy új böngészőablakban újra az URL-címet a API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="50ee4-290">In a new browser window, go to the URL of the API app again.</span></span>
2. <span data-ttu-id="50ee4-291">Jelentkezzen be, amikor a rendszer erre kéri.</span><span class="sxs-lookup"><span data-stu-id="50ee4-291">Log in when prompted to do so.</span></span>
3. <span data-ttu-id="50ee4-292">Bejelentkezés sikeresen befejeződik, de egy hibalap vezet.</span><span class="sxs-lookup"><span data-stu-id="50ee4-292">Login succeeds but leads to an error page.</span></span>
   
    <span data-ttu-id="50ee4-293">Az AAD-alkalmazást, hogy a felhasználók az AAD-bérlőben nem jelentkezzen be és érhetik el az API-t egy beállított.</span><span class="sxs-lookup"><span data-stu-id="50ee4-293">You've configured the AAD app so that users in the AAD tenant cannot log in and access the API from a browser.</span></span> <span data-ttu-id="50ee4-294">Az API-alkalmazás továbbra is elérheti, ha a szolgáltatás egyszerű token, ellenőrizheti a webalkalmazás URL-címen, és vegye fel a további Tennivalólista elemein.</span><span class="sxs-lookup"><span data-stu-id="50ee4-294">You can still access the API app by using a service principal token, which you can verify by going to the web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-to-a-particular-service-principal"></a><span data-ttu-id="50ee4-295">Egy adott szolgáltatás egyszerű való hozzáférés korlátozása</span><span class="sxs-lookup"><span data-stu-id="50ee4-295">Restrict access to a particular service principal</span></span>
<span data-ttu-id="50ee4-296">Jelenleg, bármely hívó, amely egy jogkivonatot kérhet egy felhasználó vagy az Azure AD-bérlőben egyszerű meghívhatja a TodoListDataAPI (adatok réteg) API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="50ee4-296">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call the TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="50ee4-297">Győződjön meg arról, hogy csak az adatréteg API-alkalmazásának elfogadja a hívásokat a TodoListAPI (középső réteg) API-alkalmazást, és csak egy adott szolgáltatás egyszerű kívánt.</span><span class="sxs-lookup"><span data-stu-id="50ee4-297">You might want to make sure that the data tier API app only accepts calls from the TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="50ee4-298">Ezek a korlátozások érvényesítése kódrészletet adhat hozzá a `appid` és `objectidentifier` jogcímet a bejövő hívások.</span><span class="sxs-lookup"><span data-stu-id="50ee4-298">You can add these restrictions by adding code to validate the `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="50ee4-299">Ebben az oktatóanyagban a kódot, amely ellenőrzi az alkalmazás és szolgáltatás egyszerű azonosító közvetlenül a tartományvezérlő műveletek a put.</span><span class="sxs-lookup"><span data-stu-id="50ee4-299">For this tutorial you put the code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="50ee4-300">Alternatívák egy egyéni használandó `Authorize` attribútumot, vagy az ellenőrzés elvégzéséhez az indítási feladatütemezések (pl. OWIN köztes).</span><span class="sxs-lookup"><span data-stu-id="50ee4-300">Alternatives are to use a custom `Authorize` attribute or to do this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="50ee4-301">Az utóbbi példáért lásd: [a mintaalkalmazás](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="50ee4-301">For an example of the latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="50ee4-302">Az alábbi módosításokat végezni, a TodoListDataAPI projektet.</span><span class="sxs-lookup"><span data-stu-id="50ee4-302">Make the following changes to the TodoListDataAPI project.</span></span>

1. <span data-ttu-id="50ee4-303">Nyissa meg a *Controllers/TodoListController.cs* fájlt.</span><span class="sxs-lookup"><span data-stu-id="50ee4-303">Open the *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="50ee4-304">Állítsa vissza a sorok beállított `trustedCallerClientId` és `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="50ee4-304">Uncomment the lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="50ee4-305">Állítsa vissza a kódot a CheckCallerId metódusban.</span><span class="sxs-lookup"><span data-stu-id="50ee4-305">Uncomment the code in the CheckCallerId method.</span></span> <span data-ttu-id="50ee4-306">Ez a metódus neve elején. minden műveleti módszer a vezérlőben.</span><span class="sxs-lookup"><span data-stu-id="50ee4-306">This method is called at the start of every action method in the controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "The appID or service principal ID is not the expected value." });
            }
        }
4. <span data-ttu-id="50ee4-307">Telepítse újra a ToDoListDataAPI projektet az Azure App Service.</span><span class="sxs-lookup"><span data-stu-id="50ee4-307">Redeploy the ToDoListDataAPI project to Azure App Service.</span></span>
5. <span data-ttu-id="50ee4-308">A böngészőben nyissa meg az AngularJS előtérbeli webes alkalmazás HTTPS URL-CÍMÉT, és a kezdőlapján kattintson a **To Do List** fülre.</span><span class="sxs-lookup"><span data-stu-id="50ee4-308">In your browser, go to the AngularJS front end web app's HTTPS URL, and in the home page click the **To Do List** tab.</span></span>
   
    <span data-ttu-id="50ee4-309">Az alkalmazás nem működik, mert a háttérben hívások nem működnek.</span><span class="sxs-lookup"><span data-stu-id="50ee4-309">The application doesn't work because calls to the back end are failing.</span></span> <span data-ttu-id="50ee4-310">Az új kódot tényleges appid és típusinformáció ellenőrzi, de még nem rendelkezik a megfelelő értékek kereséséhez, ellen.</span><span class="sxs-lookup"><span data-stu-id="50ee4-310">The new code is checking actual appid and objectidentifier but it doesn't yet have the correct values to check them against.</span></span> <span data-ttu-id="50ee4-311">A böngésző fejlesztői eszközök konzol jelenti, hogy a kiszolgáló HTTP 401-es hibát ad vissza.</span><span class="sxs-lookup"><span data-stu-id="50ee4-311">The browser Developer Tools Console reports that the server is returning an HTTP 401 error.</span></span>
   
    ![Hiba történt a fejlesztői eszközök konzol](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="50ee4-313">A következő lépésekben konfigurál a várt értékeket.</span><span class="sxs-lookup"><span data-stu-id="50ee4-313">In the following steps you configure the expected values.</span></span>
6. <span data-ttu-id="50ee4-314">Az Azure AD-alkalmazást, a TodoListWebApp projekthez az Azure AD PowerShell, a szolgáltatás egyszerű értékének beolvasása.</span><span class="sxs-lookup"><span data-stu-id="50ee4-314">Using Azure AD PowerShell, get the value of the service principal for the Azure AD application that you created for the TodoListWebApp project.</span></span>
   
    <span data-ttu-id="50ee4-315">a.</span><span class="sxs-lookup"><span data-stu-id="50ee4-315">a.</span></span> <span data-ttu-id="50ee4-316">Azure PowerShell telepítése és csatlakozás az előfizetéshez kapcsolatos útmutatásért lásd: [az Azure PowerShell használata Azure Resource Managerrel](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="50ee4-316">For instructions on how to install Azure PowerShell and connect to your subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="50ee4-317">b.</span><span class="sxs-lookup"><span data-stu-id="50ee4-317">b.</span></span> <span data-ttu-id="50ee4-318">Szolgáltatás résztvevők listájának lekéréséhez hajtható végre a `Login-AzureRmAccount` parancsot, majd a `Get-AzureRmADServicePrincipal` parancsot.</span><span class="sxs-lookup"><span data-stu-id="50ee4-318">To get a list of service principals, execute the `Login-AzureRmAccount` command and then the `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="50ee4-319">c.</span><span class="sxs-lookup"><span data-stu-id="50ee4-319">c.</span></span> <span data-ttu-id="50ee4-320">Az ObjectId azonosító található a szolgáltatás egyszerű a TodoListAPI alkalmazás, és mentse egy helyre másolhatja később.</span><span class="sxs-lookup"><span data-stu-id="50ee4-320">Find the objectid for the service principal of the TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="50ee4-321">Az Azure portálon keresse meg az API-t telepítette, a ToDoListDataAPI projektet az API-alkalmazás panelen.</span><span class="sxs-lookup"><span data-stu-id="50ee4-321">In the Azure portal, navigate to the API app blade for the API app that you deployed the ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="50ee4-322">Kattintson a **beállítások > Alkalmazásbeállítások**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-322">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="50ee4-323">Az a **Alkalmazásbeállítások** területen írja be a következő kulcsok és értékek:</span><span class="sxs-lookup"><span data-stu-id="50ee4-323">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="50ee4-324">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="50ee4-324">**Key**</span></span> | <span data-ttu-id="50ee4-325">ToDo:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="50ee4-325">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="50ee4-326">**Érték**</span><span class="sxs-lookup"><span data-stu-id="50ee4-326">**Value**</span></span> |<span data-ttu-id="50ee4-327">Szolgáltatás résztvevő-azonosító az alkalmazás hívása</span><span class="sxs-lookup"><span data-stu-id="50ee4-327">Service principal id of calling application</span></span> |
   | <span data-ttu-id="50ee4-328">**Példa**</span><span class="sxs-lookup"><span data-stu-id="50ee4-328">**Example**</span></span> |<span data-ttu-id="50ee4-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="50ee4-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="50ee4-330">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="50ee4-330">**Key**</span></span> | <span data-ttu-id="50ee4-331">ToDo:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="50ee4-331">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="50ee4-332">**Érték**</span><span class="sxs-lookup"><span data-stu-id="50ee4-332">**Value**</span></span> |<span data-ttu-id="50ee4-333">Alkalmazás - átmásolva a TodoListAPI az Azure AD alkalmazás hívása ügyfél-azonosítója</span><span class="sxs-lookup"><span data-stu-id="50ee4-333">Client ID of calling application - copied from the TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="50ee4-334">**Példa**</span><span class="sxs-lookup"><span data-stu-id="50ee4-334">**Example**</span></span> |<span data-ttu-id="50ee4-335">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="50ee4-335">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="50ee4-336">Kattintson a **Save** (Mentés) gombra.</span><span class="sxs-lookup"><span data-stu-id="50ee4-336">Click **Save**.</span></span>
    
     ![Kattintson a Save (Mentés) gombra.](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="50ee4-338">A böngészőben lépjen vissza a webes alkalmazás URL-címet, és a kezdőlapján kattintson a **To Do List** fülre.</span><span class="sxs-lookup"><span data-stu-id="50ee4-338">In your browser, return to the web app's URL, and in the home page click the **To Do List** tab.</span></span>
    
     <span data-ttu-id="50ee4-339">Ezúttal az alkalmazás megfelelően működik-e mivel a megbízható hívó alkalmazás és szolgáltatás egyszerű azonosító a várt értékeket.</span><span class="sxs-lookup"><span data-stu-id="50ee4-339">This time the application works as expected because the trusted caller app ID and service principal ID are the expected values.</span></span>
    
     ![Tennivalók listája lap](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-the-projects-from-scratch"></a><span data-ttu-id="50ee4-341">Teljesen új projektek felépítése</span><span class="sxs-lookup"><span data-stu-id="50ee4-341">Building the projects from scratch</span></span>
<span data-ttu-id="50ee4-342">A két Web API-projektek használatával létrehozott a **Azure API App** projektek sablon és az alapértelmezett értékek vezérlő lecserélését egy ToDoList tartományvezérlőre.</span><span class="sxs-lookup"><span data-stu-id="50ee4-342">The two Web API projects were created by using the **Azure API App** project template and replacing the default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="50ee4-343">Az Azure AD szolgáltatás egyszerű jogkivonatokat a ToDoListAPI projektet az beszerzése a [Active Directory Authentication Library (ADAL) .NET-keretrendszerhez készült](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet-csomag lett telepítve.</span><span class="sxs-lookup"><span data-stu-id="50ee4-343">For acquiring Azure AD service principal tokens in the ToDoListAPI project, the [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="50ee4-344">Hozzon létre egy AngularJS egyoldalas alkalmazást a Web API háttérből például a ToDoListAngular kapcsolatos információkért lásd: [beavatkozás nélküli a labor: egy egyetlen oldal alkalmazás (SPA) az ASP.NET Web API és Angular.js Build](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="50ee4-344">For information about how to  create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="50ee4-345">Az Azure AD hitelesítési kód adásával kapcsolatos információkért lásd: [biztonságossá tétele AngularJS egyetlen oldal alkalmazások az Azure ad-val](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="50ee4-345">For information about how to add Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="50ee4-346">Hibaelhárítás</span><span class="sxs-lookup"><span data-stu-id="50ee4-346">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="50ee4-347">Győződjön meg arról, hogy azt ne tévessze össze ToDoListAPI (középső réteg) és a ToDoListDataAPI (adatrétegbeli).</span><span class="sxs-lookup"><span data-stu-id="50ee4-347">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="50ee4-348">Például ebben az oktatóanyagban, hitelesítés hozzáadása az adatréteg API-alkalmazását, **, de az alkalmazás kulcsot kell származnia ahhoz az Azure AD-alkalmazás, amelyet a középső réteg API-alkalmazásának létrehozott**.</span><span class="sxs-lookup"><span data-stu-id="50ee4-348">For example, in this tutorial you add authentication to the data tier API app, **but the app key must come from the Azure AD application that you created for the middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="50ee4-349">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="50ee4-349">Next steps</span></span>
<span data-ttu-id="50ee4-350">Ez az utolsó oktatóanyaga, amely az API Apps adatsorozat.</span><span class="sxs-lookup"><span data-stu-id="50ee4-350">This is the last tutorial in the API Apps series.</span></span> 

<span data-ttu-id="50ee4-351">Azure Active Directoryval kapcsolatos további információkért lásd a következőket.</span><span class="sxs-lookup"><span data-stu-id="50ee4-351">For more information about Azure Active Directory, see the following resources.</span></span>

* [<span data-ttu-id="50ee4-352">Az Azure AD fejlesztői útmutatója</span><span class="sxs-lookup"><span data-stu-id="50ee4-352">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="50ee4-353">Az Azure AD-forgatókönyvek</span><span class="sxs-lookup"><span data-stu-id="50ee4-353">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="50ee4-354">Azure AD-minták</span><span class="sxs-lookup"><span data-stu-id="50ee4-354">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="50ee4-355">A [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) minta hasonlít megjelenő elemek ebben az oktatóanyagban, de az App Service hitelesítés nélkül.</span><span class="sxs-lookup"><span data-stu-id="50ee4-355">The [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar to what is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="50ee4-356">Más módokon is telepíthet a Visual Studio-projektek API-alkalmazások esetén, vagy a Visual Studio használatával kapcsolatos információk [telepítés automatizálásáról](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) a egy [Forráskezelő rendszerből](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), lásd: [központi telepítése egy Azure App Service-alkalmazást](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="50ee4-356">For information about other ways to deploy Visual Studio projects to API apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How to deploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

