---
title: "az Azure App Service API Apps aaaService egyszerű hitelesítéssel |} Microsoft Docs"
description: "Ismerje meg, hogy az API-k tooprotect alkalmazást az Azure App Service szolgáltatások forgatókönyvek esetén."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="2761b-103">Az Azure App Service API Apps szolgáltatás egyszerű hitelesítés</span><span class="sxs-lookup"><span data-stu-id="2761b-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="2761b-104">Áttekintés</span><span class="sxs-lookup"><span data-stu-id="2761b-104">Overview</span></span>
<span data-ttu-id="2761b-105">Ez a cikk azt ismerteti, hogyan toouse App Service hitelesítés *belső* tooAPI alkalmazások eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="2761b-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="2761b-106">Egy belső forgatókönyv, melyekben egy API-alkalmazást, amelyet toobe fogyasztható csak a saját alkalmazás kóddal.</span><span class="sxs-lookup"><span data-stu-id="2761b-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="2761b-107">hello ajánlott módja tooimplement ebben a forgatókönyvben az App Service-ben az Azure AD toouse tooprotect hello nevezik API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="2761b-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="2761b-108">Védett hello API-alkalmazás azáltal, hogy az alkalmazásidentitás (egyszerű szolgáltatásnév) hitelesítő adatait az Azure AD-ből kapott tulajdonosi jogkivonatok hívható meg.</span><span class="sxs-lookup"><span data-stu-id="2761b-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="2761b-109">Alternatívák toousing az Azure AD, lásd: hello **szolgáltatások közötti hitelesítési** hello szakasza [Azure App Service hitelesítés áttekintése](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="2761b-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="2761b-110">Ebből a cikkből megtudhatja:</span><span class="sxs-lookup"><span data-stu-id="2761b-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="2761b-111">Hogyan toouse Azure Active Directory (Azure AD) tooprotect egy API-alkalmazást a hitelesítés nélküli hozzáférést.</span><span class="sxs-lookup"><span data-stu-id="2761b-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="2761b-112">Hogyan tooconsume védett API app egy API-alkalmazás, a webes alkalmazás vagy a mobilalkalmazás az Azure AD szolgáltatás rendszerbiztonsági tag (app-identitás) hitelesítő adatok használatával.</span><span class="sxs-lookup"><span data-stu-id="2761b-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="2761b-113">További információ a logic App tooconsume lásd [az App Service a Logic apps üzemeltetett egyéni API használata](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="2761b-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="2761b-114">Hogyan toomake meg arról, hogy hello védett API-alkalmazás által a böngészőből nem hívható bejelentkezett felhasználók számára.</span><span class="sxs-lookup"><span data-stu-id="2761b-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="2761b-115">Hogyan toomake meg arról, hogy hello védett API-alkalmazás csak meghívható egy adott Azure AD szolgáltatás egyszerű.</span><span class="sxs-lookup"><span data-stu-id="2761b-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="2761b-116">hello cikk két részből áll:</span><span class="sxs-lookup"><span data-stu-id="2761b-116">hello article contains two sections:</span></span>

* <span data-ttu-id="2761b-117">Hello [hogyan tooconfigure szolgáltatás egyszerű hitelesítés az Azure App Service](#authconfig) a szakasz ismerteti a általános hogyan tooconfigure hitelesítési API-alkalmazást, és hogyan tooconsume hello védett API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="2761b-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="2761b-118">Ez a szakasz egyformán tooall keretrendszerek App Service, beleértve a .NET, Node.js és Java által támogatott.</span><span class="sxs-lookup"><span data-stu-id="2761b-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="2761b-119">Hello kezdve [hello .NET-bevezető oktatóanyagok folytatása](#tutorialstart) szakaszban hello az oktatóanyag végigvezeti Önt egy "belső hozzáférés" forgatókönyvet, az App Service-ben futó .NET mintaalkalmazás konfigurálása.</span><span class="sxs-lookup"><span data-stu-id="2761b-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="2761b-120"><a id="authconfig"></a>Hogyan tooconfigure szolgáltatás egyszerű hitelesítés az Azure App Service-ben</span><span class="sxs-lookup"><span data-stu-id="2761b-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="2761b-121">Ez a témakör általános útmutatást, amelyek érvényesek a tooany API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="2761b-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="2761b-122">A lépések adott toohello tooDo lista .NET mintaalkalmazás, go túl[hello .NET API-alkalmazások útmutató-sorozat folytatása](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="2761b-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="2761b-123">A hello [Azure-portálon](https://portal.azure.com/), keresse meg a toohello **beállítások** hello API-alkalmazás, hogy szeretné, hogy tooprotect, és ezután megkeresi a hello panel **szolgáltatások** szakaszt, és kattintson a **Hitelesítési / engedélyezési**.</span><span class="sxs-lookup"><span data-stu-id="2761b-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Hitelesítési/engedélyezési Azure-portálon](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="2761b-125">A hello **hitelesítési / engedélyezési** panelen kattintson a **a**.</span><span class="sxs-lookup"><span data-stu-id="2761b-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="2761b-126">A hello **hitelesítetlen kérés esetén a művelet tootake** legördülő listában válassza **bejelentkezés Azure Active Directoryval** .</span><span class="sxs-lookup"><span data-stu-id="2761b-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="2761b-127">A **hitelesítésszolgáltatókat**, jelölje be **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="2761b-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Hitelesítési/engedélyezési panel az Azure-portálon](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="2761b-129">Hello konfigurálása **Azure Active Directory beállításai** panel toocreate egy új Azure AD-alkalmazást, vagy ha már rendelkezik egy meglévő Azure AD alkalmazás használja, amelyet az toouse.</span><span class="sxs-lookup"><span data-stu-id="2761b-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="2761b-130">Belső forgatókönyvek általában tartalmaz, amely az API-alkalmazást hívja az API-alkalmazások.</span><span class="sxs-lookup"><span data-stu-id="2761b-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="2761b-131">Használhatja a külön Azure AD-alkalmazásokat minden API-alkalmazás vagy egy Azure AD-alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="2761b-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="2761b-132">A panel részletes utasításokért lásd: [hogyan tooconfigure az App Service alkalmazás toouse Azure Active Directory bejelentkezési](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="2761b-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="2761b-133">Amikor elkészült, a hello hitelesítési szolgáltató konfigurációs panelen, kattintson a **OK**.</span><span class="sxs-lookup"><span data-stu-id="2761b-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="2761b-134">A hello **hitelesítési / engedélyezési** panelen kattintson a **mentése**.</span><span class="sxs-lookup"><span data-stu-id="2761b-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Kattintson a Save (Mentés) gombra.](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="2761b-136">Ebben az esetben az App Service csak engedélyez kéréseket a konfigurált hello Azure AD-bérlő hívókat.</span><span class="sxs-lookup"><span data-stu-id="2761b-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="2761b-137">Nincs hitelesítési vagy engedélyezési kód védett hello API-alkalmazás szükséges.</span><span class="sxs-lookup"><span data-stu-id="2761b-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="2761b-138">hello tulajdonosi jogkivonattal átadott toohello API app együtt gyakran használt jogcímek HTTP-fejlécek, és ezt az információt, amelyek egy adott hívó, például az egyszerű szolgáltatás kérelmek kód toovalidate érheti el.</span><span class="sxs-lookup"><span data-stu-id="2761b-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="2761b-139">Ez a hitelesítési funkció hello működik ugyanúgy minden nyelvhez, hogy az App service támogatja, beleértve a .NET, Node.js és Java.</span><span class="sxs-lookup"><span data-stu-id="2761b-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="2761b-140">Hogyan tooconsume hello védett API-alkalmazás</span><span class="sxs-lookup"><span data-stu-id="2761b-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="2761b-141">hello hívónak biztosítania kell egy Azure AD-tulajdonosi jogkivonattal API-hívások.</span><span class="sxs-lookup"><span data-stu-id="2761b-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="2761b-142">tooget szolgáltatás egyszerű hitelesítő adataival tulajdonosi jogkivonattal, hello hívó használja az Active Directory Authentication Library (adal-t a [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), vagy [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="2761b-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="2761b-143">tooget jogkivonatot, ADAL behívó kód hello tooADAL hello a következő információkat biztosítja:</span><span class="sxs-lookup"><span data-stu-id="2761b-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="2761b-144">az Azure AD-bérlő hello neve.</span><span class="sxs-lookup"><span data-stu-id="2761b-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="2761b-145">hello azonosító és az ügyfél ügyfélkulcs (Alkalmazáskulcs) hello hívó társított hello Azure AD-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="2761b-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="2761b-146">hello hello társított Azure AD-alkalmazás Ügyfélazonosítója hello védett API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="2761b-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="2761b-147">(Ha csak egy Azure AD-alkalmazást használ, ez van hello ugyanazon ügyfél-Azonosítót, egy a hello hívó hello.)</span><span class="sxs-lookup"><span data-stu-id="2761b-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="2761b-148">Ezek az értékek érhetők el az Azure AD hello lapjain hello [a klasszikus Azure portálon](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="2761b-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="2761b-149">Hello token beszerzett, miután hello hívó tartalmazza a HTTP-kérelmek hello engedélyezési fejlécben.</span><span class="sxs-lookup"><span data-stu-id="2761b-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="2761b-150">App Service érvényesíti hello jogkivonatot, és lehetővé teszi, hogy hello kérelmek tooreach hello védett API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="2761b-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="2761b-151">Hogyan tooprotect hello API-alkalmazást a hello a felhasználók ugyanazt a bérlői</span><span class="sxs-lookup"><span data-stu-id="2761b-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="2761b-152">Tulajdonosi jogkivonatok ugyanannak a bérlőnek érvényesek a hello hello lévő felhasználók számára védett API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="2761b-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="2761b-153">Ha azt szeretné, hogy csak egy egyszerű szolgáltatásnév meghívhatja tooensure hello védett API-alkalmazást, adja hozzá a kódot a hello védett API app toovalidate hello hello jogkivonatból jogcímek a következő:</span><span class="sxs-lookup"><span data-stu-id="2761b-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="2761b-154">`appid`hello hívó társított hello Azure AD-alkalmazás ügyfél-azonosító hello kell lennie.</span><span class="sxs-lookup"><span data-stu-id="2761b-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="2761b-155">`oid`(`objectidentifier`) hello szolgáltatás résztvevő-azonosító hello hívó kell lennie.</span><span class="sxs-lookup"><span data-stu-id="2761b-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="2761b-156">App Service emellett hello `objectidentifier` jogcím hello X-MS-CLIENT-tag-ID-fejlécben.</span><span class="sxs-lookup"><span data-stu-id="2761b-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="2761b-157">Hogyan tooprotect hello böngészőalapú hozzáférés API-alkalmazások</span><span class="sxs-lookup"><span data-stu-id="2761b-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="2761b-158">Ha Ön nem ellenőrizhesse a kódban védett hello API-alkalmazás, és külön használja az Azure AD-alkalmazást hello védett API-alkalmazás, győződjön meg arról, hogy az Azure AD alkalmazás-válasz URL-cím hello nem hello megegyeznek a hello API-alkalmazás alap URL-címet.</span><span class="sxs-lookup"><span data-stu-id="2761b-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="2761b-159">Ha hello válasz URL-címet közvetlenül védett toohello API-alkalmazás, egy felhasználó hello ugyanazt az Azure AD-bérlőben sikerült toohello API-alkalmazás keresse meg, jelentkezzen be, és sikeresen meg tudja hívni hello API.</span><span class="sxs-lookup"><span data-stu-id="2761b-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="2761b-160"><a id="tutorialstart"></a>Hello .NET API-alkalmazások útmutató-sorozat folytatása</span><span class="sxs-lookup"><span data-stu-id="2761b-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="2761b-161">Ha a következő hello Node.js vagy Java oktatóanyag adatsorozat API-alkalmazások, hagyja ki toohello [további lépések](#next-steps) szakasz.</span><span class="sxs-lookup"><span data-stu-id="2761b-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="2761b-162">hello a cikk hátralévő része továbbra is hello .NET API-alkalmazások útmutató-sorozat, és feltételezi, hogy végrehajtotta-e az hello [felhasználói hitelesítési oktatóanyag](app-service-api-dotnet-user-principal-auth.md) és hello minta alkalmazást az Azure-ban és a felhasználói hitelesítés engedélyezve van.</span><span class="sxs-lookup"><span data-stu-id="2761b-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="2761b-163">Az Azure-ban hitelesítés beállítása</span><span class="sxs-lookup"><span data-stu-id="2761b-163">Set up authentication in Azure</span></span>
<span data-ttu-id="2761b-164">Ebben a szakaszban App szolgáltatást konfigurálja úgy, hogy csak a HTTP-kérelmek tooreach hello API-alkalmazás adatrétegét lehetővé teszi, hogy hello hello érvényes Azure melyeket AD tulajdonosi jogkivonatoknak nevezzük.</span><span class="sxs-lookup"><span data-stu-id="2761b-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="2761b-165">A következő szakasz hello hello középső réteg API app toosend alkalmazás hitelesítő adatok tooAzure AD konfigurálhatja, vissza egy tulajdonosi jogkivonatot, és küldjön hello tulajdonosi jogkivonat toohello adatrétegbeli API-alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="2761b-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="2761b-166">Ez a folyamat hello ábrán látható.</span><span class="sxs-lookup"><span data-stu-id="2761b-166">This process is illustrated in hello diagram.</span></span>

![Szolgáltatás-hitelesítés diagramja](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="2761b-168">Ha a következő hello oktatóanyag utasításait során problémákat tapasztal, tekintse meg a hello [hibaelhárítás](#troubleshooting) szakasz hello oktatóanyag hello végén.</span><span class="sxs-lookup"><span data-stu-id="2761b-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="2761b-169">A hello [Azure-portálon](https://portal.azure.com/), keresse meg a toohello **beállítások** hello API-alkalmazást, amely hello ToDoListDataAPI (adatok réteg) API-alkalmazást létrehozni, és kattintson a panel **beállítások**.</span><span class="sxs-lookup"><span data-stu-id="2761b-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="2761b-170">A hello **beállítások** panelen, a keresés hello **szolgáltatások** szakaszt, és kattintson a **hitelesítési / engedélyezési**.</span><span class="sxs-lookup"><span data-stu-id="2761b-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Hitelesítési/engedélyezési Azure-portálon](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="2761b-172">A hello **hitelesítési / engedélyezési** panelen kattintson a **a**.</span><span class="sxs-lookup"><span data-stu-id="2761b-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="2761b-173">A hello **hitelesítetlen kérés esetén a művelet tootake** legördülő listában válassza **bejelentkezés Azure Active Directoryval**.</span><span class="sxs-lookup"><span data-stu-id="2761b-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="2761b-174">Ez az, hogy csak hitelesített kérelmek reach hello API-alkalmazás az App Service tooensure okozó hello beállítása.</span><span class="sxs-lookup"><span data-stu-id="2761b-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="2761b-175">Érvényes tulajdonosi jogkivonatok rendelkező kérelmek, az App Service hello jogkivonatok mentén toohello API app továbbítja, és tölti fel a HTTP-fejlécek a gyakran használt jogcímek toomake ezt az információt könnyebben elérhető tooyour kódot.</span><span class="sxs-lookup"><span data-stu-id="2761b-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="2761b-176">A **hitelesítésszolgáltatókat**, kattintson a **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="2761b-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Hitelesítési/engedélyezési panel az Azure-portálon](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="2761b-178">A hello **Azure Active Directory beállításai** panelen kattintson a **Express**.</span><span class="sxs-lookup"><span data-stu-id="2761b-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="2761b-179">A hello **Express** beállítás Azure automatikusan létrehozhat egy AAD-alkalmazást az Azure ad [bérlői](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="2761b-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="2761b-180">Nincs toocreate a bérlőt, mert minden Azure-fiók automatikusan van egy.</span><span class="sxs-lookup"><span data-stu-id="2761b-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="2761b-181">A **üzemmód**, kattintson a **új AD-alkalmazás létrehozása** Ha még nincs kiválasztva.</span><span class="sxs-lookup"><span data-stu-id="2761b-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="2761b-182">hello portál csatlakozik hello **létrehozása App** beviteli mezőt, alapértelmezett értékkel.</span><span class="sxs-lookup"><span data-stu-id="2761b-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="2761b-183">Alapértelmezés szerint az Azure AD-alkalmazást hello nevű hello ugyanaz, mint hello API alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="2761b-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="2761b-184">Tetszés szerint megadhat egy másik nevet.</span><span class="sxs-lookup"><span data-stu-id="2761b-184">If you prefer, you can enter a different name.</span></span>
   
    ![Az Azure AD-beállítások](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="2761b-186">**Megjegyzés:**: alternatív megoldásként használhat egy egyetlen Azure AD alkalmazás mindkét hello hívó API-alkalmazást, és hello védett API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="2761b-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="2761b-187">Ha úgy dönt, hogy az alternatív, nem kell hello **új AD-alkalmazás létrehozása** itt beállítást, mert a korábbi részében hello felhasználói hitelesítési oktatóanyag már létrehozott egy Azure AD-alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="2761b-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="2761b-188">Ebben az oktatóanyagban használt Azure AD-alkalmazások külön hívja az API-alkalmazás és hello hello védett API-alkalmazásba.</span><span class="sxs-lookup"><span data-stu-id="2761b-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="2761b-189">Jegyezze fel a hello értéket, amely a hello **létrehozása App** beviteli mezőt; meg fogja keresni az AAD-alkalmazást hello a klasszikus Azure portálon később.</span><span class="sxs-lookup"><span data-stu-id="2761b-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="2761b-190">Kattintson az **OK** gombra.</span><span class="sxs-lookup"><span data-stu-id="2761b-190">Click **OK**.</span></span>
10. <span data-ttu-id="2761b-191">A hello **hitelesítési / engedélyezési** panelen kattintson a **mentése**.</span><span class="sxs-lookup"><span data-stu-id="2761b-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Kattintson a Save (Mentés) gombra.](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="2761b-193">App Service hoz létre egy Azure Active Directory-alkalmazás az **bejelentkezési URL-cím** és **válasz URL-CÍMEN** toohello URL-címet a API-alkalmazás automatikusan beállítani.</span><span class="sxs-lookup"><span data-stu-id="2761b-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="2761b-194">hello ez utóbbi érték az AAD-bérlő toolog a felhasználók és a hozzáférés hello API-alkalmazás lehetővé teszi.</span><span class="sxs-lookup"><span data-stu-id="2761b-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="2761b-195">Győződjön meg arról, hogy hello API app védett</span><span class="sxs-lookup"><span data-stu-id="2761b-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="2761b-196">Egy böngészőben nyissa meg hello API-alkalmazás URL-CÍMÉT toohello: a hello **API-alkalmazás** panel az Azure-portálon hello alatt hello hivatkozásra **URL-cím**.</span><span class="sxs-lookup"><span data-stu-id="2761b-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="2761b-197">Átirányított tooa bejelentkezési képernyő áll, mert nem hitelesített kérelmek nem engedélyezettek tooreach hello API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="2761b-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="2761b-198">Ha a böngészőben nyissa meg toohello Swagger felhasználói Felületet, előfordulhat, hogy a böngésző már bejelentkezett a – ebben az esetben, nyisson meg egy InPrivate vagy Incognito ablakot, és folytassa toohello Swagger felhasználói felület URL-CÍMÉT.</span><span class="sxs-lookup"><span data-stu-id="2761b-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="2761b-199">Jelentkezzen be az AAD-bérlőben egy olyan felhasználó hitelesítő adataival.</span><span class="sxs-lookup"><span data-stu-id="2761b-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="2761b-200">Ha van bejelentkezve, hello "sikeresen létrejött" lap hello böngészőben.</span><span class="sxs-lookup"><span data-stu-id="2761b-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="2761b-201">Hello ToDoListAPI projekt tooacquire konfigurálása és hello Azure AD-jogkivonat küldése</span><span class="sxs-lookup"><span data-stu-id="2761b-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="2761b-202">Ez a szakasz a következő feladatok hello:</span><span class="sxs-lookup"><span data-stu-id="2761b-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="2761b-203">Adja hozzá a kódot hello középső rétegbeli API-alkalmazás, amely az Azure AD alkalmazás hitelesítő adatok tooacquire jogkivonatot használja, és a HTTP-kérelmek toohello API-alkalmazás adatrétegét küldése.</span><span class="sxs-lookup"><span data-stu-id="2761b-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="2761b-204">Hello hitelesítő adatokat kell beolvasni az Azure AD.</span><span class="sxs-lookup"><span data-stu-id="2761b-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="2761b-205">Adja meg a hello hitelesítő adatait az Azure App Service futásidejű környezeti beállításokban hello középső rétegbeli API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="2761b-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="2761b-206">Hello ToDoListAPI projekt tooacquire konfigurálása és hello Azure AD-jogkivonat küldése</span><span class="sxs-lookup"><span data-stu-id="2761b-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="2761b-207">Ellenőrizze a következő hello ToDoListAPI projektre a Visual Studio változásai hello.</span><span class="sxs-lookup"><span data-stu-id="2761b-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="2761b-208">Állítsa vissza az összes hello hello kód *ServicePrincipal.cs* fájlt.</span><span class="sxs-lookup"><span data-stu-id="2761b-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="2761b-209">Ez a .NET tooacquire hello Azure AD tulajdonosi jogkivonatot az adal-t használó hello kódot.</span><span class="sxs-lookup"><span data-stu-id="2761b-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="2761b-210">Több konfigurációs értékeket fogja beállított hello Azure futtatókörnyezetben később használ.</span><span class="sxs-lookup"><span data-stu-id="2761b-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="2761b-211">Az alábbiakban hello kódot:</span><span class="sxs-lookup"><span data-stu-id="2761b-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="2761b-212">**Megjegyzés:** ezt a kódot hello adal-t kér .NET NuGet-csomagot (Microsoft.IdentityModel.Clients.ActiveDirectory), amely hello projekt már telepítve van.</span><span class="sxs-lookup"><span data-stu-id="2761b-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="2761b-213">Ez a projekt teljesen új hozott létre, ha a csomag tooinstall kellene lennie.</span><span class="sxs-lookup"><span data-stu-id="2761b-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="2761b-214">Ez a csomag nem automatikusan hello API app – új projekt sablon telepíti.</span><span class="sxs-lookup"><span data-stu-id="2761b-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="2761b-215">A *tartományvezérlők/ToDoListController*, állítsa vissza a hello hello kód `NewDataAPIClient` hello authorization fejlécet hello token tooHTTP kérelmek hozzáadó metódust.</span><span class="sxs-lookup"><span data-stu-id="2761b-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="2761b-216">Hello ToDoListAPI projekt telepítése.</span><span class="sxs-lookup"><span data-stu-id="2761b-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="2761b-217">(Kattintson a jobb gombbal a hello projektet, majd kattintson az **közzététel > Közzététel**.)</span><span class="sxs-lookup"><span data-stu-id="2761b-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="2761b-218">Visual Studio telepíti hello projektet, és megnyitja a böngésző toohello webes alkalmazás alap URL-címet.</span><span class="sxs-lookup"><span data-stu-id="2761b-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="2761b-219">Ez azt mutatja majd 403-as hiba lap, egy kísérlet toogo tooa Web API alap URL-CÍMÉT a böngésző normális.</span><span class="sxs-lookup"><span data-stu-id="2761b-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="2761b-220">Bezárás hello böngésző.</span><span class="sxs-lookup"><span data-stu-id="2761b-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="2761b-221">Az Azure AD konfigurációs értékek beolvasása</span><span class="sxs-lookup"><span data-stu-id="2761b-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="2761b-222">A hello [a klasszikus Azure portálon](https://manage.windowsazure.com/), nyissa meg túl**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="2761b-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="2761b-223">A hello **Directory** lapra, majd az AAD-bérlőt.</span><span class="sxs-lookup"><span data-stu-id="2761b-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="2761b-224">Kattintson a **alkalmazások > a vállalat tulajdonában lévő alkalmazások**, majd kattintson a pipa hello.</span><span class="sxs-lookup"><span data-stu-id="2761b-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="2761b-225">Az alkalmazások hello listában kattintson egy Azure hozott létre az Ön hitelesítési hello ToDoListDataAPI (adatok réteg) API-alkalmazás engedélyezésekor hello hello nevét.</span><span class="sxs-lookup"><span data-stu-id="2761b-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="2761b-226">Kattintson a hello **konfigurálása** fülre.</span><span class="sxs-lookup"><span data-stu-id="2761b-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="2761b-227">Másolás hello **ügyfél-azonosító** értékét, és mentse valahol beszerezheti a később.</span><span class="sxs-lookup"><span data-stu-id="2761b-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="2761b-228">Hello a klasszikus Azure portálon lépjen vissza toohello listája **a vállalat tulajdonában lévő alkalmazások**, és kattintson a hello AAD-alkalmazást, amelyet létrehozott hello középső rétegbeli ToDoListAPI API-alkalmazás (hello nem létrehozott hello előző oktatóanyagban hello egyetlen, ebben az oktatóanyagban létre).</span><span class="sxs-lookup"><span data-stu-id="2761b-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="2761b-229">Kattintson a hello **konfigurálása** fülre.</span><span class="sxs-lookup"><span data-stu-id="2761b-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="2761b-230">Másolás hello **ügyfél-azonosító** értékét, és mentse valahol beszerezheti a később.</span><span class="sxs-lookup"><span data-stu-id="2761b-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="2761b-231">A **kulcsok**, jelölje be **1 év** hello a **időtartam kiválasztása** legördülő listából választhatja ki.</span><span class="sxs-lookup"><span data-stu-id="2761b-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="2761b-232">Kattintson a **Save** (Mentés) gombra.</span><span class="sxs-lookup"><span data-stu-id="2761b-232">Click **Save**.</span></span>
    
     ![Alkalmazás-kulcs létrehozása](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="2761b-234">Másolja ki hello kulcs értékét, és mentse valahol beszerezheti a később.</span><span class="sxs-lookup"><span data-stu-id="2761b-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Új alkalmazás kulcs másolása](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="2761b-236">Hello középső réteg API app futtatókörnyezetben az Azure AD-beállítások konfigurálása</span><span class="sxs-lookup"><span data-stu-id="2761b-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="2761b-237">Nyissa meg toohello [Azure-portálon](https://portal.azure.com/), és navigáljon a toohello **API-alkalmazás** panel, amelyen hello TodoListAPI (középső réteg) projekt hello API-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="2761b-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="2761b-238">Kattintson a **Settings > Application Settings** (Beállítások > Alkalmazásbeállítások) lehetőségre.</span><span class="sxs-lookup"><span data-stu-id="2761b-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="2761b-239">A hello **Alkalmazásbeállítások** területen írja be a következő hello kulcsok és értékek:</span><span class="sxs-lookup"><span data-stu-id="2761b-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="2761b-240">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="2761b-240">**Key**</span></span> | <span data-ttu-id="2761b-241">IDA: hatóság</span><span class="sxs-lookup"><span data-stu-id="2761b-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="2761b-242">**Érték**</span><span class="sxs-lookup"><span data-stu-id="2761b-242">**Value**</span></span> |<span data-ttu-id="2761b-243">{az Azure AD bérlő neve} https://Login.microsoftonline.com/</span><span class="sxs-lookup"><span data-stu-id="2761b-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="2761b-244">**Példa**</span><span class="sxs-lookup"><span data-stu-id="2761b-244">**Example**</span></span> |<span data-ttu-id="2761b-245">https://Login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="2761b-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="2761b-246">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="2761b-246">**Key**</span></span> | <span data-ttu-id="2761b-247">IDA: ClientId</span><span class="sxs-lookup"><span data-stu-id="2761b-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="2761b-248">**Érték**</span><span class="sxs-lookup"><span data-stu-id="2761b-248">**Value**</span></span> |<span data-ttu-id="2761b-249">Ügyfél-azonosítója (középső réteg - ToDoListAPI) alkalmazás hívása hello</span><span class="sxs-lookup"><span data-stu-id="2761b-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="2761b-250">**Példa**</span><span class="sxs-lookup"><span data-stu-id="2761b-250">**Example**</span></span> |<span data-ttu-id="2761b-251">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="2761b-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="2761b-252">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="2761b-252">**Key**</span></span> | <span data-ttu-id="2761b-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="2761b-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="2761b-254">**Érték**</span><span class="sxs-lookup"><span data-stu-id="2761b-254">**Value**</span></span> |<span data-ttu-id="2761b-255">Az alkalmazás (középső réteg - ToDoListAPI) hívása hello Alkalmazáskulcs</span><span class="sxs-lookup"><span data-stu-id="2761b-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="2761b-256">**Példa**</span><span class="sxs-lookup"><span data-stu-id="2761b-256">**Example**</span></span> |<span data-ttu-id="2761b-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="2761b-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="2761b-258">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="2761b-258">**Key**</span></span> | <span data-ttu-id="2761b-259">IDA: erőforrás</span><span class="sxs-lookup"><span data-stu-id="2761b-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="2761b-260">**Érték**</span><span class="sxs-lookup"><span data-stu-id="2761b-260">**Value**</span></span> |<span data-ttu-id="2761b-261">Hello néven alkalmazás ügyfél-azonosítója (adatrétegbeli - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="2761b-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="2761b-262">**Példa**</span><span class="sxs-lookup"><span data-stu-id="2761b-262">**Example**</span></span> |<span data-ttu-id="2761b-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="2761b-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="2761b-264">**Megjegyzés:**: A `ida:Resource`, ellenőrizze, hogy az alkalmazás neve hello használata **ügyfél-azonosító** és nem a **App ID URI**.</span><span class="sxs-lookup"><span data-stu-id="2761b-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="2761b-265">`ida:ClientId`és `ida:Resource` különböző értékeket ehhez az oktatóanyaghoz mert használata külön az Azure AD applicaations hello középső réteg és adatréteg.</span><span class="sxs-lookup"><span data-stu-id="2761b-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="2761b-266">Ha egyetlen használta az Azure AD alkalmazás hívja az API-alkalmazás és hello hello védett API-alkalmazást, használja ugyanezt az értéket a mindkét hello `ida:ClientId` és `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="2761b-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="2761b-267">hello kód használ ConfigurationManager tooget ezeket az értékeket, így azok a hello projekt Web.config fájlban, vagy hello Azure futtatókörnyezetben tárolható.</span><span class="sxs-lookup"><span data-stu-id="2761b-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="2761b-268">Az ASP.NET-alkalmazások futása közben az Azure App Service-ben, a környezet beállítások automatikusan felülbírálhatják a beállításokat a Web.config fájlból. A tesztkörnyezet beállításainak vannak általában egy [bizalmas adatok biztonságosabb módon toostore képest tooa Web.config fájl](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="2761b-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="2761b-269">Kattintson a **Save** (Mentés) gombra.</span><span class="sxs-lookup"><span data-stu-id="2761b-269">Click **Save**.</span></span>
   
    ![Kattintson a Save (Mentés) gombra.](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="2761b-271">Hello alkalmazás tesztelése</span><span class="sxs-lookup"><span data-stu-id="2761b-271">Test hello application</span></span>
1. <span data-ttu-id="2761b-272">Nyissa meg böngészőben toohello hello AngularJS előtér-webalkalmazás HTTPS URL-CÍMÉT.</span><span class="sxs-lookup"><span data-stu-id="2761b-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="2761b-273">Kattintson a hello **tooDo lista** lapra, és jelentkezzen be az Azure AD-bérlő a felhasználó hitelesítő adataival.</span><span class="sxs-lookup"><span data-stu-id="2761b-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="2761b-274">Vegye fel a tennivalók elemek tooverify hello alkalmazás működik.</span><span class="sxs-lookup"><span data-stu-id="2761b-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![tooDo lista lap](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="2761b-276">Ha hello alkalmazás a várt módon nem működik, gondosan ellenőrizze a megadott Azure-portálon hello hello-beállítások.</span><span class="sxs-lookup"><span data-stu-id="2761b-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="2761b-277">Ha hello beállítások jelennek meg a megfelelő toobe, lásd: hello [hibaelhárítás](#troubleshooting) szakasz az oktatóanyag későbbi részében.</span><span class="sxs-lookup"><span data-stu-id="2761b-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="2761b-278">Böngésző-hozzáférés elleni védelmének hello API-alkalmazás</span><span class="sxs-lookup"><span data-stu-id="2761b-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="2761b-279">A jelen oktatóanyag egy külön létrehozott hello ToDoListDataAPI (adatok réteg) API-alkalmazás az Azure AD-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="2761b-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="2761b-280">Most láthatta, amikor az App Service hoz létre egy AAD-alkalmazást, mert olyan módon, amely lehetővé teszi, hogy egy felhasználó toogo toohello API-alkalmazás URL-cím, egy böngésző és a napló a konfigurálja hello AAD-alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="2761b-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="2761b-281">Ez azt jelenti, lehetséges, hogy a felhasználó az Azure AD-bérlőn, nem csak egy egyszerű szolgáltatásnév, tooaccess hello API.</span><span class="sxs-lookup"><span data-stu-id="2761b-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="2761b-282">Ha azt szeretné tooprevent böngésző-hozzáférés nélküli programozás hello a védett API-alkalmazás, módosíthatja a hello **válasz URL-CÍMEN** hello AAD-alkalmazást úgy, hogy az eltérő hello API-alkalmazás alap URL.</span><span class="sxs-lookup"><span data-stu-id="2761b-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="2761b-283">Böngésző-hozzáférés letiltása</span><span class="sxs-lookup"><span data-stu-id="2761b-283">Disable browser access</span></span>
1. <span data-ttu-id="2761b-284">Hello klasszikus portál **konfigurálása** hello AAD-alkalmazást, amely az hello TodoListService készült lapján, módosítsa a hello hello értéket **válasz URL-CÍMEN** úgy, hogy egy érvényes URL-címet, de nem hello API alkalmazás mezőben URL-CÍME.</span><span class="sxs-lookup"><span data-stu-id="2761b-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="2761b-285">Kattintson a **Save** (Mentés) gombra.</span><span class="sxs-lookup"><span data-stu-id="2761b-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="2761b-286">Ellenőrizze a böngésző-hozzáférés nem működik.</span><span class="sxs-lookup"><span data-stu-id="2761b-286">Verify browser access no longer works</span></span>
<span data-ttu-id="2761b-287">Korábban ellenőrizte, hogy lépjen toohello API-alkalmazás URL-CÍMÉT a böngésző egyéni felhasználói hitelesítő adatokkal való bejelentkezés.</span><span class="sxs-lookup"><span data-stu-id="2761b-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="2761b-288">Ebben a szakaszban, ellenőrizze, hogy ez nem lehetséges.</span><span class="sxs-lookup"><span data-stu-id="2761b-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="2761b-289">Egy új böngészőablakban nyissa meg újra toohello hello API-alkalmazás URL-CÍMÉT.</span><span class="sxs-lookup"><span data-stu-id="2761b-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="2761b-290">Ha a napló toodo úgy kéri.</span><span class="sxs-lookup"><span data-stu-id="2761b-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="2761b-291">Bejelentkezés sikeresen befejeződik, de tooan hibalap vezet.</span><span class="sxs-lookup"><span data-stu-id="2761b-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="2761b-292">Hello AAD-alkalmazást, hogy a felhasználók az AAD-bérlőt hello nem jelentkezzen be és érhetik el hello API egy beállított.</span><span class="sxs-lookup"><span data-stu-id="2761b-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="2761b-293">API-alkalmazás hello szolgáltatás egyszerű jogkivonat használatával, amely toohello webes alkalmazás URL-CÍMÉT is, és vegye fel a további tennivaló ellenőrizheti továbbra is elérheti.</span><span class="sxs-lookup"><span data-stu-id="2761b-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="2761b-294">Hozzáférés tooa adott szolgáltatás egyszerű korlátozása</span><span class="sxs-lookup"><span data-stu-id="2761b-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="2761b-295">Jelenleg, bármely hívó, amely egy jogkivonatot kérhet egy felhasználó vagy az Azure AD-bérlőben egyszerű meghívhatja hello TodoListDataAPI (adatok réteg) API-alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="2761b-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="2761b-296">Érdemes lehet toomake meg arról, hogy hello API-alkalmazás adatrétegét csak hívások hello TodoListAPI (középső réteg) API-alkalmazást, és csak egy adott szolgáltatás egyszerű fogad el.</span><span class="sxs-lookup"><span data-stu-id="2761b-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="2761b-297">Ezek a korlátozások is hozzáadhat kód toovalidate hello hozzáadásával `appid` és `objectidentifier` jogcímet a bejövő hívások.</span><span class="sxs-lookup"><span data-stu-id="2761b-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="2761b-298">Ebben az oktatóanyagban hello kódot, amely ellenőrzi az alkalmazás és szolgáltatás egyszerű azonosító közvetlenül a tartományvezérlő műveletek a put.</span><span class="sxs-lookup"><span data-stu-id="2761b-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="2761b-299">Alternatívák toouse egyéni `Authorize` attribútum vagy toodo az ellenőrzés az a indítási sorozatok (pl. OWIN köztes).</span><span class="sxs-lookup"><span data-stu-id="2761b-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="2761b-300">Ez utóbbi hello példáért lásd: [a mintaalkalmazás](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="2761b-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="2761b-301">Ellenőrizze a következő módosításokat toohello TodoListDataAPI projektet hello.</span><span class="sxs-lookup"><span data-stu-id="2761b-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="2761b-302">Nyissa meg hello *Controllers/TodoListController.cs* fájlt.</span><span class="sxs-lookup"><span data-stu-id="2761b-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="2761b-303">Állítsa vissza a beállított hello sorok `trustedCallerClientId` és `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="2761b-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="2761b-304">Állítsa vissza a hello kód hello CheckCallerId metódust.</span><span class="sxs-lookup"><span data-stu-id="2761b-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="2761b-305">Ez a módszer minden műveletmetódus hello vezérlőben hello elején nevezik.</span><span class="sxs-lookup"><span data-stu-id="2761b-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="2761b-306">Telepítse újra a hello ToDoListDataAPI projektet tooAzure App Service.</span><span class="sxs-lookup"><span data-stu-id="2761b-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="2761b-307">A böngészőben nyissa meg toohello AngularJS előtér webalkalmazás HTTPS URL-címet, és a hello kezdőlapján kattintson a hello **tooDo lista** fülre.</span><span class="sxs-lookup"><span data-stu-id="2761b-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="2761b-308">hello alkalmazás nem működik, mert toohello vissza befejezéséhez hívás sikertelen.</span><span class="sxs-lookup"><span data-stu-id="2761b-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="2761b-309">Új kód hello tényleges appid és típusinformáció ellenőrzi, de még nem kapott hello helyes az értékük toocheck elleni őket.</span><span class="sxs-lookup"><span data-stu-id="2761b-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="2761b-310">a jelentés hello böngésző fejlesztői eszközök konzol hello kiszolgálón HTTP 401-es hibát adott vissza.</span><span class="sxs-lookup"><span data-stu-id="2761b-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Hiba történt a fejlesztői eszközök konzol](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="2761b-312">Az alábbi lépésekkel hello konfigurálja hello várt értékeket.</span><span class="sxs-lookup"><span data-stu-id="2761b-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="2761b-313">Az Azure AD PowerShell, a beolvasása hello szolgáltatás hello értékét egyszerű hello hello TodoListWebApp projekthez létrehozott Azure AD-alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="2761b-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="2761b-314">a.</span><span class="sxs-lookup"><span data-stu-id="2761b-314">a.</span></span> <span data-ttu-id="2761b-315">Útmutatást tooinstall Azure PowerShell és a csatlakozás tooyour előfizetés, lásd: [az Azure PowerShell használata Azure Resource Managerrel](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="2761b-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="2761b-316">b.</span><span class="sxs-lookup"><span data-stu-id="2761b-316">b.</span></span> <span data-ttu-id="2761b-317">szolgáltatás résztvevők listájának tooget hajtható végre hello `Login-AzureRmAccount` parancsot, és ezután hello `Get-AzureRmADServicePrincipal` parancsot.</span><span class="sxs-lookup"><span data-stu-id="2761b-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="2761b-318">c.</span><span class="sxs-lookup"><span data-stu-id="2761b-318">c.</span></span> <span data-ttu-id="2761b-319">Hello objectid keresése hello szolgáltatás egyszerű hello TodoListAPI alkalmazás, és mentse egy helyre másolhatja később.</span><span class="sxs-lookup"><span data-stu-id="2761b-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="2761b-320">A hello Azure-portálon keresse meg az API-alkalmazás paneljének toohello a hello API-alkalmazás telepített hello ToDoListDataAPI projektet.</span><span class="sxs-lookup"><span data-stu-id="2761b-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="2761b-321">Kattintson a **beállítások > Alkalmazásbeállítások**.</span><span class="sxs-lookup"><span data-stu-id="2761b-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="2761b-322">A hello **Alkalmazásbeállítások** területen írja be a következő hello kulcsok és értékek:</span><span class="sxs-lookup"><span data-stu-id="2761b-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="2761b-323">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="2761b-323">**Key**</span></span> | <span data-ttu-id="2761b-324">ToDo:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="2761b-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="2761b-325">**Érték**</span><span class="sxs-lookup"><span data-stu-id="2761b-325">**Value**</span></span> |<span data-ttu-id="2761b-326">Szolgáltatás résztvevő-azonosító az alkalmazás hívása</span><span class="sxs-lookup"><span data-stu-id="2761b-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="2761b-327">**Példa**</span><span class="sxs-lookup"><span data-stu-id="2761b-327">**Example**</span></span> |<span data-ttu-id="2761b-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="2761b-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="2761b-329">**Kulcs**</span><span class="sxs-lookup"><span data-stu-id="2761b-329">**Key**</span></span> | <span data-ttu-id="2761b-330">ToDo:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="2761b-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="2761b-331">**Érték**</span><span class="sxs-lookup"><span data-stu-id="2761b-331">**Value**</span></span> |<span data-ttu-id="2761b-332">Alkalmazás - hello TodoListAPI az Azure AD alkalmazás átmásolva hívása ügyfél-azonosítója</span><span class="sxs-lookup"><span data-stu-id="2761b-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="2761b-333">**Példa**</span><span class="sxs-lookup"><span data-stu-id="2761b-333">**Example**</span></span> |<span data-ttu-id="2761b-334">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="2761b-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="2761b-335">Kattintson a **Save** (Mentés) gombra.</span><span class="sxs-lookup"><span data-stu-id="2761b-335">Click **Save**.</span></span>
    
     ![Kattintson a Save (Mentés) gombra.](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="2761b-337">A böngészőben, térjen vissza a toohello webes alkalmazás URL-CÍMÉT, és a hello kezdőlapján kattintson a hello **tooDo lista** fülre.</span><span class="sxs-lookup"><span data-stu-id="2761b-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="2761b-338">Az idő hello alkalmazás megfelelően működik-e mert hello megbízható hívó alkalmazás és szolgáltatás egyszerű azonosító hello várt értékek.</span><span class="sxs-lookup"><span data-stu-id="2761b-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![tooDo lista lap](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="2761b-340">Teljesen új hello projektek felépítése</span><span class="sxs-lookup"><span data-stu-id="2761b-340">Building hello projects from scratch</span></span>
<span data-ttu-id="2761b-341">hello két Web API-projektet hello használatával létrehozott **Azure API App** projektek sablon és a ToDoList vezérlő tagjára hello alapértelmezett értékek vezérlő.</span><span class="sxs-lookup"><span data-stu-id="2761b-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="2761b-342">Az beszerzése az Azure AD szolgáltatás egyszerű jogkivonatok hello ToDoListAPI projektben, hello [Active Directory Authentication Library (ADAL) .NET-keretrendszerhez készült](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet-csomag lett telepítve.</span><span class="sxs-lookup"><span data-stu-id="2761b-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="2761b-343">Információ a túl hozzon létre egy AngularJS egyoldalas alkalmazást a Web API háttérből például a ToDoListAngular, lásd: [beavatkozás nélküli a labor: egy egyetlen oldal alkalmazás (SPA) az ASP.NET Web API és Angular.js Build](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="2761b-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="2761b-344">További információ tooadd az Azure AD hitelesítési kódot, lásd: [biztonságossá tétele AngularJS egyetlen oldal alkalmazások az Azure ad-val](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="2761b-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="2761b-345">Hibaelhárítás</span><span class="sxs-lookup"><span data-stu-id="2761b-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="2761b-346">Győződjön meg arról, hogy azt ne tévessze össze ToDoListAPI (középső réteg) és a ToDoListDataAPI (adatrétegbeli).</span><span class="sxs-lookup"><span data-stu-id="2761b-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="2761b-347">Például ebben az oktatóanyagban hozzáadhat hitelesítési toohello API-alkalmazás adatrétegét, **hello Alkalmazáskulcs hello Azure AD-alkalmazást, amelyet létrehozott hello középső rétegbeli API-alkalmazást kell származnia, de**.</span><span class="sxs-lookup"><span data-stu-id="2761b-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2761b-348">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="2761b-348">Next steps</span></span>
<span data-ttu-id="2761b-349">Ez az API Apps adatsorozat hello hello utolsó oktatóanyaga.</span><span class="sxs-lookup"><span data-stu-id="2761b-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="2761b-350">Azure Active Directoryval kapcsolatos további információkért tekintse meg a következő erőforrások hello.</span><span class="sxs-lookup"><span data-stu-id="2761b-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="2761b-351">Az Azure AD fejlesztői útmutatója</span><span class="sxs-lookup"><span data-stu-id="2761b-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="2761b-352">Az Azure AD-forgatókönyvek</span><span class="sxs-lookup"><span data-stu-id="2761b-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="2761b-353">Azure AD-minták</span><span class="sxs-lookup"><span data-stu-id="2761b-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="2761b-354">Hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) minta hasonlít toowhat jelenik meg ebben az oktatóanyagban, de az App Service hitelesítés nélkül.</span><span class="sxs-lookup"><span data-stu-id="2761b-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="2761b-355">Más módon információt a Visual Studio toodeploy tooAPI alkalmazások, projektek, vagy a Visual Studio használatával [telepítés automatizálásáról](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) a egy [Forráskezelő rendszerből](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), lásd: [hogyan toodeploy egy Azure App Service alkalmazás](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="2761b-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

