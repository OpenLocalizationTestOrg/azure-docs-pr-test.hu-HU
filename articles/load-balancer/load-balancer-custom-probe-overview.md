---
title: "Terheléselosztó egyéni mintavételt be, és a figyelési állapot |} Microsoft Docs"
description: "Ismerje meg, hogyan használható az Azure Load Balancer egyéni mintavételt terheléselosztó mögött példányok figyelése céljából"
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: cab028fed58d544a56f2f6b12b72364c7baf4d86
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 07/11/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="1190b-103">A Load Balancer vizsgálatok ismertetése</span><span class="sxs-lookup"><span data-stu-id="1190b-103">Understand load balancer probes</span></span>

<span data-ttu-id="1190b-104">Az Azure Load Balancer lehetőséget nyújt a figyelheti a kiszolgálópéldányok állapotát mintavételt használatával.</span><span class="sxs-lookup"><span data-stu-id="1190b-104">Azure Load Balancer offers the capability to monitor the health of server instances by using probes.</span></span> <span data-ttu-id="1190b-105">Egy mintavételt nem válaszol, a terheléselosztó leállítja, új kapcsolatok küld a nem megfelelő állapotú példány.</span><span class="sxs-lookup"><span data-stu-id="1190b-105">When a probe fails to respond, Load Balancer stops sending new connections to the unhealthy instance.</span></span> <span data-ttu-id="1190b-106">Nem érinti a meglévő kapcsolatokat, és új kapcsolatok küldött megfelelő példányok.</span><span class="sxs-lookup"><span data-stu-id="1190b-106">The existing connections are not affected, and new connections are sent to healthy instances.</span></span>

<span data-ttu-id="1190b-107">Felhőszolgáltatás szerepköreit (feldolgozói szerepköröket és webes szerepkörök) használja a vendégügynök mintavételi figyelésre.</span><span class="sxs-lookup"><span data-stu-id="1190b-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="1190b-108">TCP- vagy HTTP egyéni mintavételt terheléselosztó mögött a virtuális gépek használatakor be kell állítani.</span><span class="sxs-lookup"><span data-stu-id="1190b-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="1190b-109">Mintavételi száma és időtúllépés</span><span class="sxs-lookup"><span data-stu-id="1190b-109">Understand probe count and timeout</span></span>

<span data-ttu-id="1190b-110">Mintavételi viselkedés attól függ:</span><span class="sxs-lookup"><span data-stu-id="1190b-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="1190b-111">A sikeres mintavételek menüpontban, amelyek lehetővé teszik egy példányt kell címkével száma állapotúként.</span><span class="sxs-lookup"><span data-stu-id="1190b-111">The number of successful probes that allow an instance to be labeled as up.</span></span>
* <span data-ttu-id="1190b-112">Sikertelen mintavételek menüpontban, amelyek egy példányt kell címkével száma szerint lefelé.</span><span class="sxs-lookup"><span data-stu-id="1190b-112">The number of failed probes that cause an instance to be labeled as down.</span></span>

<span data-ttu-id="1190b-113">SuccessFailCount időkorlát és a gyakoriság értéke határozza meg, hogy példány megerősítik fut vagy nem működik.</span><span class="sxs-lookup"><span data-stu-id="1190b-113">The timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed to be running or not running.</span></span> <span data-ttu-id="1190b-114">Az Azure-portálon az időtúllépés értéke a gyakoriság értékének kétszer.</span><span class="sxs-lookup"><span data-stu-id="1190b-114">In the Azure portal, the timeout is set to two times the value of the frequency.</span></span>

<span data-ttu-id="1190b-115">A mintavétel konfigurációs terhelésű szoftverpéldányok a végpont (Ez azt jelenti, hogy egy elosztott terhelésű készlet) azonosnak kell lennie.</span><span class="sxs-lookup"><span data-stu-id="1190b-115">The probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be the same.</span></span> <span data-ttu-id="1190b-116">Ez azt jelenti, hogy nem kell minden szerepkörpéldányt vagy a virtuális gép egy másik mintavételi konfigurációs azonos üzemeltetett szolgáltatás egy adott végpont kombinációjához.</span><span class="sxs-lookup"><span data-stu-id="1190b-116">This means you cannot have a different probe configuration for each role instance or virtual machine in the same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="1190b-117">Például minden példány kell rendelkeznie, azonos helyi portok és időtúllépéseket okoz.</span><span class="sxs-lookup"><span data-stu-id="1190b-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1190b-118">A Load Balancer mintavételi 168.63.129.16 IP-címét használja.</span><span class="sxs-lookup"><span data-stu-id="1190b-118">A Load Balancer probe uses the IP address 168.63.129.16.</span></span> <span data-ttu-id="1190b-119">A nyilvános IP-cím elősegíti a kerüljön-a-saját-IP-cím az Azure virtuális hálózatot belső platform erőforrásokhoz való kommunikációt.</span><span class="sxs-lookup"><span data-stu-id="1190b-119">This public IP address facilitates communication to internal platform resources for the bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="1190b-120">A virtuális nyilvános IP-cím 168.63.129.16 minden régióban szolgál, és nem változik.</span><span class="sxs-lookup"><span data-stu-id="1190b-120">The virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="1190b-121">Azt javasoljuk, hogy lehetővé tegye az IP-címet a helyi tűzfal házirendekben.</span><span class="sxs-lookup"><span data-stu-id="1190b-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="1190b-122">Ez nem tekinthető biztonsági kockázatot jelent, mert csak a belső Azure platformon is forrás-, hogy a cím az üzenet.</span><span class="sxs-lookup"><span data-stu-id="1190b-122">It should not be considered a security risk because only the internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="1190b-123">Ha ezt nem teszi meg, a különböző helyzetekben, például az azonos IP-címtartomány 168.63.129.16, és hogy ismétlődő IP-címek konfigurálása váratlan viselkedést lesz.</span><span class="sxs-lookup"><span data-stu-id="1190b-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring the same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-the-types-of-probes"></a><span data-ttu-id="1190b-124">További tudnivalók a mintavételt típusú</span><span class="sxs-lookup"><span data-stu-id="1190b-124">Learn about the types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="1190b-125">Vendég ügynök mintavétele</span><span class="sxs-lookup"><span data-stu-id="1190b-125">Guest agent probe</span></span>

<span data-ttu-id="1190b-126">Ez a Hálózatfigyelő csak akkor használható Azure Cloud Services.</span><span class="sxs-lookup"><span data-stu-id="1190b-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="1190b-127">Terheléselosztó használja a virtuális gépen lévő vendégügynök figyeli és reagál HTTP 200 OK válasz csak akkor, ha a példány a kész állapotban van (Ez azt jelenti, hogy nem szerepel egy másik állapot például elfoglalt, újrahasznosítása vagy leállítása).</span><span class="sxs-lookup"><span data-stu-id="1190b-127">Load Balancer utilizes the guest agent inside the virtual machine, and then listens and responds with an HTTP 200 OK response only when the instance is in the Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="1190b-128">További információkért lásd: [a szolgáltatásdefiníciós fájlban (csdef) konfigurálása állapotteljesítmény](https://msdn.microsoft.com/library/azure/ee758710.aspx) vagy [létrehozásához, egy internetre irányuló terheléselosztót a felhőszolgáltatások](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="1190b-128">For more information, see [Configuring the service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="1190b-129">A Vendég ügynök mintavétele jelölje példánya sérültként hasznossá?</span><span class="sxs-lookup"><span data-stu-id="1190b-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="1190b-130">Ha a vendégügynök nem válaszol a HTTP 200 OK, a terheléselosztó jelöli meg a példány válaszol, és leállítja a forgalom küldése annak a példánynak.</span><span class="sxs-lookup"><span data-stu-id="1190b-130">If the guest agent fails to respond with HTTP 200 OK, the load balancer marks the instance as unresponsive and stops sending traffic to that instance.</span></span> <span data-ttu-id="1190b-131">A load balancer továbbra is fennáll, Pingelje meg a példány.</span><span class="sxs-lookup"><span data-stu-id="1190b-131">The load balancer continues to ping the instance.</span></span> <span data-ttu-id="1190b-132">Ha a vendégügynök válaszol egy HTTP 200, a terheléselosztó küld forgalom példánynak újra.</span><span class="sxs-lookup"><span data-stu-id="1190b-132">If the guest agent responds with an HTTP 200, the load balancer sends traffic to that instance again.</span></span>

<span data-ttu-id="1190b-133">A webes szerepkör használata esetén a webhely kód általában lefut a w3wp.exe, nem figyelt az Azure fabric vagy Vendég ügynök.</span><span class="sxs-lookup"><span data-stu-id="1190b-133">When you use a web role, the website code typically runs in w3wp.exe, which is not monitored by the Azure fabric or guest agent.</span></span> <span data-ttu-id="1190b-134">Ez azt jelenti, hogy a vendégügynök nem jelentett hibák w3wp.exe (például 500-as HTTP-válaszok), és a terheléselosztó nem lépnek kívül Elforgatás példányhoz.</span><span class="sxs-lookup"><span data-stu-id="1190b-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported to the guest agent, and the load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="1190b-135">Egyéni HTTP-vizsgálatot</span><span class="sxs-lookup"><span data-stu-id="1190b-135">HTTP custom probe</span></span>

<span data-ttu-id="1190b-136">Az egyéni HTTP terheléselosztó mintavétel felülbírálja az alapértelmezett Vendég ügynök mintavétel, ami azt jelenti, hogy a szerepkör-példány állapotának meghatározására a saját egyéni logika hozhat létre.</span><span class="sxs-lookup"><span data-stu-id="1190b-136">The custom HTTP Load Balancer probe overrides the default guest agent probe, which means that you can create your own custom logic to determine the health of the role instance.</span></span> <span data-ttu-id="1190b-137">A terheléselosztó-vizsgálat a végpont 15 másodpercenként alapértelmezés szerint.</span><span class="sxs-lookup"><span data-stu-id="1190b-137">The load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="1190b-138">A példány load balancer elforgatási találhatók, ha az időkorlát (alapértelmezés szerint 31 másodperc) belül az válaszol egy HTTP 200 tekinthető meg.</span><span class="sxs-lookup"><span data-stu-id="1190b-138">The instance is considered to be in the load balancer rotation if it responds with an HTTP 200 within the timeout period (31 seconds by default).</span></span>

<span data-ttu-id="1190b-139">Ez akkor lehet hasznos, ha azt szeretné, hogy a saját logikát példányt eltávolítja, a load balancer elforgatás végrehajtásához.</span><span class="sxs-lookup"><span data-stu-id="1190b-139">This can be useful if you want to implement your own logic to remove instances from load balancer rotation.</span></span> <span data-ttu-id="1190b-140">Például sikertelen eldöntheti, egy példányát eltávolítja, ha meghaladja a 90 % CPU, és nem 200 állapotot ad vissza.</span><span class="sxs-lookup"><span data-stu-id="1190b-140">For example, you could decide to remove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="1190b-141">Ha webes szerepkörök w3wp.exe, ez azt is jelenti automatikus kap a webhely megfigyeléséhez, mivel a webhely kódban hibák nem 200 állapot visszatér a terheléselosztói mintavétel.</span><span class="sxs-lookup"><span data-stu-id="1190b-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status to the load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="1190b-142">Az egyéni HTTP-vizsgálatot relatív elérési utakat, és csak a HTTP protokollt támogatja.</span><span class="sxs-lookup"><span data-stu-id="1190b-142">The HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="1190b-143">HTTPS nem támogatott.</span><span class="sxs-lookup"><span data-stu-id="1190b-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="1190b-144">Az egyéni HTTP-vizsgálatot, jelölje meg, hogy megsérült példány hasznossá?</span><span class="sxs-lookup"><span data-stu-id="1190b-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="1190b-145">A HTTP-alkalmazás eltérő (például a 403-as, 404 vagy 500) 200-as HTTP-válaszkód adja vissza.</span><span class="sxs-lookup"><span data-stu-id="1190b-145">The HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="1190b-146">Ez az a pozitív visszaigazolás, amely az alkalmazáspéldány azonnal kell tenni nem működik.</span><span class="sxs-lookup"><span data-stu-id="1190b-146">This is a positive acknowledgment that the application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="1190b-147">A HTTP-kiszolgáló válaszol a határidő után.</span><span class="sxs-lookup"><span data-stu-id="1190b-147">The HTTP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="1190b-148">Attól függően, hogy az időtúllépés értéke, amely be van állítva, ez azt jelentheti, hogy több mintavételi kérések nyissa meg nem érkezik válasz, mielőtt a mintavétel beolvasása jelölésű nem fut (Ez azt jelenti, hogy mielőtt SuccessFailCount mintavételt megkapja).</span><span class="sxs-lookup"><span data-stu-id="1190b-148">Depending on the timeout value that is set, this might mean that multiple probe requests go unanswered before the probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="1190b-149">A kiszolgáló megszünteti a kapcsolatot a TCP alaphelyzetbe állítása keresztül.</span><span class="sxs-lookup"><span data-stu-id="1190b-149">The server closes the connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="1190b-150">Egyéni TCP-Hálózatfigyelővel</span><span class="sxs-lookup"><span data-stu-id="1190b-150">TCP custom probe</span></span>

<span data-ttu-id="1190b-151">TCP mintavételt kezdeményeznek kapcsolatot a megadott port egy háromutas kézfogás elvégzésével.</span><span class="sxs-lookup"><span data-stu-id="1190b-151">TCP probes initiate a connection by performing a three-way handshake with the defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="1190b-152">Egy egyéni TCP-Hálózatfigyelővel, jelölje meg, hogy megsérült példány hasznossá?</span><span class="sxs-lookup"><span data-stu-id="1190b-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="1190b-153">A TCP-kiszolgáló válaszol a határidő után.</span><span class="sxs-lookup"><span data-stu-id="1190b-153">The TCP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="1190b-154">Ha a mintavételi van megjelölve, nem fut attól függ, hogy nem fut a mintavétel való megjelölése előtt nem érkezik válasz go konfigurált sikertelen mintavételi kérések száma.</span><span class="sxs-lookup"><span data-stu-id="1190b-154">When the probe is marked as not running depends on the number of failed probe requests that were configured to go unanswered before marking the probe as not running.</span></span>
* <span data-ttu-id="1190b-155">A mintavétel kap egy alaphelyzetbe állítja a szerepkörpéldány TCP.</span><span class="sxs-lookup"><span data-stu-id="1190b-155">The probe receives a TCP reset from the role instance.</span></span>

<span data-ttu-id="1190b-156">Egy HTTP állapotmintáihoz vagy a TCP-Hálózatfigyelővel konfigurálásával kapcsolatos további információkért lásd: [létrehozásához egy internetre irányuló terheléselosztót a Resource Manager PowerShell-lel](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="1190b-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="1190b-157">Adja hozzá a megfelelő példányok újra üzembe a load balancer Elforgatás</span><span class="sxs-lookup"><span data-stu-id="1190b-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="1190b-158">TCP- és HTTP mintavételt kifogástalan minősülnek, és jelölje meg a megfelelő when szerepkörpéldányon:</span><span class="sxs-lookup"><span data-stu-id="1190b-158">TCP and HTTP probes are considered healthy and mark the role instance as healthy when:</span></span>

* <span data-ttu-id="1190b-159">A load balancer lekérdezi egy pozitív mintavételt először a virtuális gép elindul.</span><span class="sxs-lookup"><span data-stu-id="1190b-159">The load balancer gets a positive probe the first time the VM boots.</span></span>
* <span data-ttu-id="1190b-160">A szám SuccessFailCount (lásd a korábbiakban) sikeres mintavételek menüpontban, jelölje meg a megfelelő szerepkörpéldányon szükséges értékének meghatározása.</span><span class="sxs-lookup"><span data-stu-id="1190b-160">The number SuccessFailCount (described earlier) defines the value of successful probes that are required to mark the role instance as healthy.</span></span> <span data-ttu-id="1190b-161">Ha a szerepkör példánya el lett távolítva, a sikeres, egymást követő mintavételek menüpontban száma kell egyenlő vagy megjelölni a szerepkörpéldányon futó SuccessFailCount értéke meghaladja.</span><span class="sxs-lookup"><span data-stu-id="1190b-161">If a role instance was removed, the number of successful, successive probes must equal or exceed the value of SuccessFailCount to mark the role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="1190b-162">Ha egy szerepkörpéldányt állapotának ingadozó van, a terheléselosztó már a kifogástalan állapotban a szerepkörpéldányt helyezése előtt vár.</span><span class="sxs-lookup"><span data-stu-id="1190b-162">If the health of a role instance is fluctuating, the load balancer waits longer before putting the role instance back in the healthy state.</span></span> <span data-ttu-id="1190b-163">Ez a felhasználó és az infrastruktúra védelme érdekében házirend használatával történik.</span><span class="sxs-lookup"><span data-stu-id="1190b-163">This is done via policy to protect the user and the infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="1190b-164">Naplóelemzési használ a Load Balancer</span><span class="sxs-lookup"><span data-stu-id="1190b-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="1190b-165">Használhat [analytics keresse meg a terheléselosztó](load-balancer-monitor-log.md) ellenőrizheti a mintavételi állapotát és a mintavételi száma.</span><span class="sxs-lookup"><span data-stu-id="1190b-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) to check on the probe health status and probe count.</span></span> <span data-ttu-id="1190b-166">Naplózás segítségével a Power bi-ban vagy az Azure Operational Insights adja meg a terheléselosztó állapot statisztikája.</span><span class="sxs-lookup"><span data-stu-id="1190b-166">Logging can be used with Power BI or Azure Operational Insights to provide statistics about Load Balancer health status.</span></span>
