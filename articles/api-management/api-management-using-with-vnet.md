---
title: "aaaHow toouse Azure API Management virtuális hálózatokat"
description: "Ismerje meg, hogyan toosetup kapcsolat tooa virtuális hálózatot az Azure API Management és az access web services rajta."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 426b3974e4fed7daffdb0c3f02381edbc326dc28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-azure-api-management-with-virtual-networks"></a><span data-ttu-id="2b2d2-103">Hogyan toouse Azure API Management virtuális hálózatokat</span><span class="sxs-lookup"><span data-stu-id="2b2d2-103">How toouse Azure API Management with virtual networks</span></span>
<span data-ttu-id="2b2d2-104">Az Azure virtuális hálózatokról (Vnetekről) teszik lehetővé, amelyek nem internetes routeable hálózat az Azure-erőforrások bármelyike elérhető tooplace.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-104">Azure Virtual Networks (VNETs) allow you tooplace any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="2b2d2-105">Ezek a hálózatok majd lehet különböző VPN technológiáin használatával csatlakoztatott tooyour helyszíni hálózatot.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-105">These networks can then be connected tooyour on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="2b2d2-106">több Azure virtuális hálózatokról kezdődnie hello információkat itt toolearn: [Azure virtuális hálózat áttekintése](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="2b2d2-106">toolearn more about Azure Virtual Networks start with hello information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="2b2d2-107">Az Azure API Management telepíthető hello virtuális hálózatban (VNET), így hozzáférhet háttér szolgáltatások hello hálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-107">Azure API Management can be deployed inside hello virtual network (VNET), so it can access backend services within hello network.</span></span> <span data-ttu-id="2b2d2-108">hello fejlesztői portálján és API-átjárón lehet konfigurált toobe elérhető hello Internet vagy csak hello virtuális hálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-108">hello developer portal and API gateway, can be configured toobe accessible either from hello Internet or only within hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="2b2d2-109">Az Azure API Management támogatja a classic és az Azure Resource Manager Vnetek.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="2b2d2-110"><a name="enable-vpn"></a>Kapcsolatcsoporttal engedélyezése</span><span class="sxs-lookup"><span data-stu-id="2b2d2-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="2b2d2-111">VNET-kapcsolatot érhető el hello **prémium** és **fejlesztői** rétegek.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-111">VNET connectivity is available in hello **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="2b2d2-112">hello rétegek közötti tooswitch nyissa meg az API Management szolgáltatás hello Azure-portálon, és nyissa meg hello **és az árképzés** fülre. A hello **tarifacsomag** szakasz hello támogatási vagy fejlesztői réteg között, kattintson a Mentés gombra.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-112">tooswitch between hello tiers, open your API Management service in hello Azure portal and then open hello **Scale and pricing** tab. Under hello **Pricing tier** section, select hello Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="2b2d2-113">tooenable VNET-kapcsolatot, nyissa meg az API Management szolgáltatás hello Azure-portálon, és nyissa meg a hello **virtuális hálózati** lap.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-113">tooenable VNET connectivity, open your API Management service in hello Azure portal and open hello **Virtual network** page.</span></span>

![Virtuális hálózati menü API Management][api-management-using-vnet-menu]

<span data-ttu-id="2b2d2-115">Válassza ki a kívánt hello hozzáférés típusát:</span><span class="sxs-lookup"><span data-stu-id="2b2d2-115">Select hello desired access type:</span></span>

* <span data-ttu-id="2b2d2-116">**Külső**: hello API Management gateway és fejlesztői portálon érhetők el a nyilvános interneten keresztül egy külső terheléselosztó hello.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-116">**External**: hello API Management gateway and developer portal are accessible from hello public internet via an external load balancer.</span></span> <span data-ttu-id="2b2d2-117">hello átjáró hello virtuális hálózaton belüli erőforrások eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-117">hello gateway can access resources within hello virtual network.</span></span>

![Nyilvános társviszony-létesítés][api-management-vnet-public]

* <span data-ttu-id="2b2d2-119">**Belső**: hello API Management-átjáró és a fejlesztői portálra csak a belső terheléselosztók virtuális hálózatát hello belülről érhetők el.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-119">**Internal**: hello API Management gateway and developer portal are accessible only from within hello virtual network via an internal load balancer.</span></span> <span data-ttu-id="2b2d2-120">hello átjáró hello virtuális hálózaton belüli erőforrások eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-120">hello gateway can access resources within hello virtual network.</span></span>

![Magánhálózati társviszony-létesítés][api-management-vnet-private]

<span data-ttu-id="2b2d2-122">Ekkor minden régióban, ahol az API Management szolgáltatás ki van építve listáját.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="2b2d2-123">Válassza ki a virtuális hálózat és alhálózat minden régióhoz.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="2b2d2-124">hello lista fel van töltve, a klasszikus és Resource Manager virtuális hálózatok az Azure-előfizetések, amelyek a telepítő konfigurálja a hello régióban elérhető.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-124">hello list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in hello region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="2b2d2-125">**Szolgáltatásvégpont** a fenti ábrán hello átjáró /-Proxy, Publisher Portal, fejlesztői portálján, GIT, és tartalmaz hello közvetlen felügyeleti végpontja.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-125">**Service Endpoint** in hello above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and hello Direct Management Endpoint.</span></span>
> <span data-ttu-id="2b2d2-126">**Felügyeleti végpont** a fenti ábrán hello hello végpont üzemeltetett toomanage szolgáltatáskonfiguráció hello Azure-portál és a Powershell segítségével.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-126">**Management Endpoint** in hello above diagram is hello endpoint hosted on hello service toomanage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="2b2d2-127">Vegye figyelembe azt is, amely akkor is, ha hello látható IP-címek a különböző végpontokhoz, az API Management szolgáltatás **csak** reagál a beállított állomásnevek a.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-127">Also, note, that, even though, hello diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2b2d2-128">Az Azure API Management példány tooa erőforrás-kezelő virtuális hálózat telepítésekor hello szolgáltatást az Azure API Management példányok kivételével nincs más erőforrásokat tartalmazó dedikált alhálózat kell lennie.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-128">When deploying an Azure API Management instance tooa Resource Manager VNET, hello service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="2b2d2-129">Ha toodeploy tett kísérlet az Azure API Management példány tooa más erőforrások, az hello telepítését tartalmazó erőforrás-kezelő virtuális hálózat alhálózati sikertelen lesz.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-129">If an attempt is made toodeploy an Azure API Management instance tooa Resource Manager VNET subnet that contains other resources, hello deployment will fail.</span></span>
>
>

![Jelölje ki a VPN][api-management-setup-vpn-select]

<span data-ttu-id="2b2d2-131">Kattintson a **mentése** üdvözlő képernyőt hello tetején.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-131">Click **Save** at hello top of hello screen.</span></span>

> [!NOTE]
> <span data-ttu-id="2b2d2-132">hello hello API Management-példány a címe változik minden alkalommal, amikor virtuális hálózat engedélyezve vagy letiltva.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-132">hello VIP address of hello API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="2b2d2-133">hello virtuális IP-cím is megváltozik az API Management mozgatásakor **külső** túl**belső** vagy fordítva</span><span class="sxs-lookup"><span data-stu-id="2b2d2-133">hello VIP address will also change when API Management is moved from **External** too**Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="2b2d2-134">Távolítsa el az API Management egy VNETET, vagy módosítsa egy telepítették hello, ha korábban használt VNET maradjanak hello zárolt too4 órában.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-134">If you remove API Management from a VNET or change hello one it is deployed in, hello previously used VNET can remain locked for up too4 hours.</span></span> <span data-ttu-id="2b2d2-135">Ebben az időszakban nem kell a lehetséges toodelete hello VNET és központi telepítése egy új erőforrás tooit.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-135">During this period it will not be possible toodelete hello VNET or deploy a new resource tooit.</span></span>

## <span data-ttu-id="2b2d2-136"><a name="enable-vnet-powershell"></a>Engedélyezése kapcsolatcsoporttal PowerShell-parancsmagok használatával</span><span class="sxs-lookup"><span data-stu-id="2b2d2-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="2b2d2-137">Engedélyezheti a virtuális hálózat kapcsolat hello PowerShell-parancsmagok használatával</span><span class="sxs-lookup"><span data-stu-id="2b2d2-137">You can also enable VNET connectivity using hello PowerShell cmdlets</span></span>

* <span data-ttu-id="2b2d2-138">**A VNETEN belül az API Management szolgáltatás létrehozása**: hello parancsmaggal [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate Azure API Management szolgáltatásnak a VNETEN belül.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-138">**Create an API Management service inside a VNET**: Use hello cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="2b2d2-139">**A VNETEN belül az meglévő API Management-szolgáltatások üzembe**: hello parancsmaggal [frissítés-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove egy meglévő Azure API Management szolgáltatást egy virtuális hálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-139">**Deploy an existing API Management service inside a VNET**: Use hello cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="2b2d2-140"><a name="connect-vnet"></a>Csatlakozzon a virtuális hálózaton belül futó tooa webszolgáltatás</span><span class="sxs-lookup"><span data-stu-id="2b2d2-140"><a name="connect-vnet"> </a>Connect tooa web service hosted within a virtual Network</span></span>
<span data-ttu-id="2b2d2-141">Miután az API Management szolgáltatás csatlakoztatott toohello VNET, benne háttér-szolgáltatások eléréséhez szükséges eltér nem nyilvános szolgáltatások eléréséhez szükséges.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-141">After your API Management service is connected toohello VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="2b2d2-142">Csak írja be a hello helyi IP-cím vagy hello állomásneve (ha hello virtuális hálózat DNS-kiszolgáló van konfigurálva) a webszolgáltatás rendszerbe hello **webszolgáltatás URL-címe** mezőben egy új API létrehozásakor vagy egy meglévőt.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-142">Just type in hello local IP address or hello host name (if a DNS server is configured for hello VNET) of your web service into hello **Web service URL** field when creating a new API or editing an existing one.</span></span>

![A VPN API hozzáadása][api-management-setup-vpn-add-api]

## <span data-ttu-id="2b2d2-144"><a name="network-configuration-issues"></a>Közös hálózati konfigurációs problémák</span><span class="sxs-lookup"><span data-stu-id="2b2d2-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="2b2d2-145">Az alábbiakban az API-kezelés szolgáltatás telepítése virtuális hálózatba során előforduló gyakori helytelen konfiguráció-problémák listáját.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="2b2d2-146">**Egyéni DNS-kiszolgáló beállításainak**: hello API-kezelés szolgáltatás több Azure-szolgáltatások függ.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-146">**Custom DNS server setup**: hello API Management service depends on several Azure services.</span></span> <span data-ttu-id="2b2d2-147">Az API Management egyéni DNS-kiszolgáló a VNETEN belül helyezkedik el, amikor jogcímadatokat tooresolve hello állomásnevek Azure szolgáltatások.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-147">When API Management is hosted in a VNET with a custom DNS server, it needs tooresolve hello hostnames of those Azure services.</span></span> <span data-ttu-id="2b2d2-148">Kövesse az [ez](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) egyéni DNS-beállításainak útmutatást.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="2b2d2-149">Lásd: hello portokat az alábbi táblázat és az egyéb hálózati követelmények hivatkozás.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-149">See hello ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2b2d2-150">Javasoljuk, hogy egy egyéni DNS-kiszolgálói használatakor a hello VNET beállítása, amely **előtt** bele az API Management szolgáltatás telepítéséhez.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-150">It is recommended that, if you are using a Custom DNS Server(s) for hello VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="2b2d2-151">Ellenkező esetben kell túl frissítenie hello API-kezelés szolgáltatás hello DNS-kiszolgálók (s) minden módosításakor hello futtatásával [alkalmazni a hálózati konfigurációs műveletet](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="2b2d2-151">Otherwise you need too update hello API Management service each time you change hello DNS Servers(s) by running hello [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="2b2d2-152">**Az API Management szükséges portok**: hello alhálózati API Management van telepítve a bejövő és kimenő forgalom vezérelhető [hálózati biztonsági csoport][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="2b2d2-152">**Ports required for API Management**: Inbound and Outbound traffic into hello Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="2b2d2-153">Ha ezeket a portokat bármelyike nem érhető el, az API Management nem fog megfelelően működni, és lehetnek nem elérhetők.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="2b2d2-154">Rendelkezik egy vagy több ezeket a portokat blokkolva helytelen konfigurálása más gyakori problémák használata esetén az API Management olyan virtuális hálózaton.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="2b2d2-155">Az API Management service-példány a VNETEN belül helyezkedik el, amikor a rendszer a következő táblázat hello hello portokat használja.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-155">When an API Management service instance is hosted in a VNET, hello ports in hello following table are used.</span></span>

| <span data-ttu-id="2b2d2-156">Forrás / cél port(ok)</span><span class="sxs-lookup"><span data-stu-id="2b2d2-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="2b2d2-157">Irány</span><span class="sxs-lookup"><span data-stu-id="2b2d2-157">Direction</span></span> | <span data-ttu-id="2b2d2-158">Átviteli protokoll</span><span class="sxs-lookup"><span data-stu-id="2b2d2-158">Transport protocol</span></span> | <span data-ttu-id="2b2d2-159">Cél</span><span class="sxs-lookup"><span data-stu-id="2b2d2-159">Purpose</span></span> | <span data-ttu-id="2b2d2-160">Forrás / cél</span><span class="sxs-lookup"><span data-stu-id="2b2d2-160">Source / Destination</span></span> | <span data-ttu-id="2b2d2-161">Hozzáférés típusa</span><span class="sxs-lookup"><span data-stu-id="2b2d2-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="2b2d2-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="2b2d2-162">* / 80, 443</span></span> |<span data-ttu-id="2b2d2-163">Bejövő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-163">Inbound</span></span> |<span data-ttu-id="2b2d2-164">TCP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-164">TCP</span></span> |<span data-ttu-id="2b2d2-165">Ügyfél-kommunikáció tooAPI kezelése</span><span class="sxs-lookup"><span data-stu-id="2b2d2-165">Client communication tooAPI Management</span></span> |<span data-ttu-id="2b2d2-166">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="2b2d2-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="2b2d2-167">Külső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-167">External</span></span> |
| <span data-ttu-id="2b2d2-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="2b2d2-168">* / 3443</span></span> |<span data-ttu-id="2b2d2-169">Bejövő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-169">Inbound</span></span> |<span data-ttu-id="2b2d2-170">TCP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-170">TCP</span></span> |<span data-ttu-id="2b2d2-171">Az Azure portál és a Powershell felügyeleti végpont</span><span class="sxs-lookup"><span data-stu-id="2b2d2-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="2b2d2-172">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="2b2d2-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="2b2d2-173">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-173">External & Internal</span></span> |
| <span data-ttu-id="2b2d2-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="2b2d2-174">* / 80, 443</span></span> |<span data-ttu-id="2b2d2-175">Kimenő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-175">Outbound</span></span> |<span data-ttu-id="2b2d2-176">TCP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-176">TCP</span></span> |<span data-ttu-id="2b2d2-177">Az Azure Storage és az Azure Service Bus függőség</span><span class="sxs-lookup"><span data-stu-id="2b2d2-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="2b2d2-178">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="2b2d2-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="2b2d2-179">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-179">External & Internal</span></span> |
| <span data-ttu-id="2b2d2-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="2b2d2-180">* / 1433</span></span> |<span data-ttu-id="2b2d2-181">Kimenő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-181">Outbound</span></span> |<span data-ttu-id="2b2d2-182">TCP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-182">TCP</span></span> |<span data-ttu-id="2b2d2-183">Az Azure SQL függőség</span><span class="sxs-lookup"><span data-stu-id="2b2d2-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="2b2d2-184">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="2b2d2-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="2b2d2-185">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-185">External & Internal</span></span> |
| <span data-ttu-id="2b2d2-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="2b2d2-186">* / 11000 - 11999</span></span> |<span data-ttu-id="2b2d2-187">Kimenő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-187">Outbound</span></span> |<span data-ttu-id="2b2d2-188">TCP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-188">TCP</span></span> |<span data-ttu-id="2b2d2-189">V12 Azure SQL függőség</span><span class="sxs-lookup"><span data-stu-id="2b2d2-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="2b2d2-190">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="2b2d2-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="2b2d2-191">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-191">External & Internal</span></span> |
| <span data-ttu-id="2b2d2-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="2b2d2-192">* / 14000 - 14999</span></span> |<span data-ttu-id="2b2d2-193">Kimenő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-193">Outbound</span></span> |<span data-ttu-id="2b2d2-194">TCP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-194">TCP</span></span> |<span data-ttu-id="2b2d2-195">V12 Azure SQL függőség</span><span class="sxs-lookup"><span data-stu-id="2b2d2-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="2b2d2-196">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="2b2d2-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="2b2d2-197">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-197">External & Internal</span></span> |
| <span data-ttu-id="2b2d2-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="2b2d2-198">* / 5671</span></span> |<span data-ttu-id="2b2d2-199">Kimenő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-199">Outbound</span></span> |<span data-ttu-id="2b2d2-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-200">AMQP</span></span> |<span data-ttu-id="2b2d2-201">A napló tooEvent központi házirend- és figyelési ügynök függőség</span><span class="sxs-lookup"><span data-stu-id="2b2d2-201">Dependency for Log tooEvent Hub policy and monitoring agent</span></span> |<span data-ttu-id="2b2d2-202">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="2b2d2-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="2b2d2-203">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-203">External & Internal</span></span> |
| <span data-ttu-id="2b2d2-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="2b2d2-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="2b2d2-205">Bejövő és kimenő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-205">Inbound & Outbound</span></span> |<span data-ttu-id="2b2d2-206">UDP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-206">UDP</span></span> |<span data-ttu-id="2b2d2-207">Redis gyorsítótár függőség</span><span class="sxs-lookup"><span data-stu-id="2b2d2-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="2b2d2-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="2b2d2-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="2b2d2-209">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-209">External & Internal</span></span> |-
| <span data-ttu-id="2b2d2-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="2b2d2-210">* / 445</span></span> |<span data-ttu-id="2b2d2-211">Kimenő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-211">Outbound</span></span> |<span data-ttu-id="2b2d2-212">TCP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-212">TCP</span></span> |<span data-ttu-id="2b2d2-213">Azure-fájlmegosztáshoz git függőség</span><span class="sxs-lookup"><span data-stu-id="2b2d2-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="2b2d2-214">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="2b2d2-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="2b2d2-215">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-215">External & Internal</span></span> |
| <span data-ttu-id="2b2d2-216">* / *</span><span class="sxs-lookup"><span data-stu-id="2b2d2-216">* / *</span></span> | <span data-ttu-id="2b2d2-217">Bejövő</span><span class="sxs-lookup"><span data-stu-id="2b2d2-217">Inbound</span></span> |<span data-ttu-id="2b2d2-218">TCP</span><span class="sxs-lookup"><span data-stu-id="2b2d2-218">TCP</span></span> |<span data-ttu-id="2b2d2-219">Az Azure infrastruktúra Terheléselosztóját</span><span class="sxs-lookup"><span data-stu-id="2b2d2-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="2b2d2-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="2b2d2-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="2b2d2-221">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="2b2d2-221">External & Internal</span></span> |

* <span data-ttu-id="2b2d2-222">**SSL-funkció**: tooenable SSL-tanúsítvány láncában épület és az érvényesítés hello API Management szolgáltatásnak kell kimenő hálózati kapcsolat tooocsp.msocsp.com, mscrl.microsoft.com és crl.microsoft.com. A függőség nincs szükség, ha bármelyik felügyeleti tooAPI feltöltött tanúsítvány nem tartalmaz hello teljes lánc toohello hitelesítésszolgáltató legfelső szintű.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-222">**SSL functionality**: tooenable SSL certificate chain building and validation hello API Management service needs Outbound network connectivity tooocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload tooAPI Management contain hello full chain toohello CA root.</span></span>

* <span data-ttu-id="2b2d2-223">**DNS hozzáférési**: 53-as port kimenő hozzáférést kell DNS-kiszolgálókkal való kommunikációhoz.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="2b2d2-224">Ha egy egyéni DNS-kiszolgáló létezik a VPN-átjáró másik végén hello, hello DNS-kiszolgálót futtató API Management hello alhálózatból elérhetőnek kell lennie.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-224">If a custom DNS server exists on hello other end of a VPN gateway, hello DNS server must be reachable from hello subnet hosting API Management.</span></span>

* <span data-ttu-id="2b2d2-225">**Metrikák és az állapotfigyelés**: kimenő hálózati kapcsolat tooAzure figyelés végpontok, amely alapján a következő tartományok hello feloldani: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-225">**Metrics and Health Monitoring**: Outbound network connectivity tooAzure Monitoring endpoints, which resolve under hello following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="2b2d2-226">**Útvonal gyorstelepítése**: egy közös felhasználói konfigurálása toodefine a saját alapértelmezett útvonalat (0.0.0.0/0), amely arra kényszeríti a kimenő Internet forgalom tooinstead folyamata a helyszíni van.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-226">**Express Route Setup**: A common customer configuration is toodefine their own default route (0.0.0.0/0) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="2b2d2-227">A forgalom áramlását tüntetnek megszakítja a kapcsolatot az Azure API Management, mert hello kimenő adatforgalmat a letiltott helyi, vagy NAT-d tooan felismerhetetlen címek, amelyek már nem használhatók a különböző Azure-végpontok készlete.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-227">This traffic flow invariably breaks connectivity with Azure API Management because hello outbound traffic is either blocked on-premises, or NAT'd tooan unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="2b2d2-228">hello megoldás egy (vagy több) toodefine felhasználó által definiált útvonalak ([udr-EK][UDRs]), amely tartalmazza az Azure API Management hello hello alhálózaton.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-228">hello solution is toodefine one (or more) user-defined routes ([UDRs][UDRs]) on hello subnet that contains hello Azure API Management.</span></span> <span data-ttu-id="2b2d2-229">Egy UDR hello alapértelmezett útvonal helyett szembeni szerződéses kötelezettségeket vonatkozó alhálózati útvonalakat határozza meg.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-229">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>
  <span data-ttu-id="2b2d2-230">Ha lehetséges a következő konfigurációs toouse hello ajánlott:</span><span class="sxs-lookup"><span data-stu-id="2b2d2-230">If possible, it is recommended toouse hello following configuration:</span></span>
 * <span data-ttu-id="2b2d2-231">hello ExpressRoute konfigurációs hirdeti 0.0.0.0/0, és alapértelmezés szerint kényszerített bújtatja minden kimenő forgalom helyszíni.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-231">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="2b2d2-232">hello alkalmazott UDR toohello alhálózati hello Azure API Management tartalmazó 0.0.0.0/0 az Internet egy következő ugrás típusa határozza meg.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-232">hello UDR applied toohello subnet containing hello Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="2b2d2-233">hello kombinált hatását, hogy ezeket a lépéseket az, hogy a hello alhálózat-szintű UDR elsőbbséget élvez hello ExpressRoute kényszerített bújtatás, biztosítva ezzel az Azure API Management hello kimenő Internet-hozzáféréssel.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-233">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="2b2d2-234">Az Azure API Management használata nem támogatott az ExpressRoute-konfigurációkat, amelyek **helytelenül hello nyilvános társviszony-létesítési elérési toohello magánhálózati társviszony-létesítési elérési útvonalak határokon hirdetési**.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="2b2d2-235">ExpressRoute-konfigurációk, amelyek rendelkeznek a nyilvános társviszony konfigurálva, a Microsoft Azure IP-címtartományok számos útvonal-hirdetéseinek kap Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="2b2d2-236">Ha ezek címtartományai helytelenül határokon meghirdetett hello magánhálózati társviszony-létesítési elérési úton, hello végeredménynek, hogy minden kimenő hálózati csomagok hello Azure API Management példány alhálózatból helytelenül kényszerített bújtatott tooa az ügyfél helyszíni hálózat infrastruktúra.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-236">If these address ranges are incorrectly cross-advertised on hello private peering path, hello end result is that all outbound network packets from hello Azure API Management instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="2b2d2-237">Hálózati folyamatot az Azure API Management megszakítja.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="2b2d2-238">hello megoldás toothis probléma a toostop cross-hirdetési útvonalak hello nyilvános társviszony-létesítési elérési toohello magánhálózati társviszony-létesítési elérési útról.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-238">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


## <span data-ttu-id="2b2d2-239"><a name="troubleshooting"></a>Hibaelhárítása</span><span class="sxs-lookup"><span data-stu-id="2b2d2-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="2b2d2-240">Módosítások tooyour hálózati meghozásakor tekintse meg a túl[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate Ha hello API-kezelés szolgáltatás nem csatlakozik hozzáférés tooany hello a kritikus erőforrásokat, amelyek függ.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-240">When making changes tooyour network, refer too[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate if hello API Management service has not lost access tooany of hello critical resources which it depends upon.</span></span> <span data-ttu-id="2b2d2-241">hello állapotának 15 percenként frissíteni kell.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-241">hello connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="2b2d2-242"><a name="limitations"></a>Korlátozásai</span><span class="sxs-lookup"><span data-stu-id="2b2d2-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="2b2d2-243">Az API Management-példányokat tartalmazó alhálózat bármely más Azure-erőforrás típusa nem tartalmazhat.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="2b2d2-244">hello alhálózati és hello szolgáltatást kell lennie az API Management hello ugyanahhoz az előfizetéshez.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-244">hello subnet and hello API Management service must be in hello same subscription.</span></span>
* <span data-ttu-id="2b2d2-245">Az API Management-példányokat tartalmazó alhálózat előfizetésekhez nem helyezhetők.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="2b2d2-246">Belső virtuális hálózat, használatával csak a belső IP-cím elérhető lesz a hello tartomány megadott [RFC 1918](https://tools.ietf.org/html/rfc1918), egy nyilvános IP-cím nem adható meg.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-246">When using an internal virtual network, only an internal IP address will be available from hello range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="2b2d2-247">Több területi API-kezelés központi telepítése esetén a konfigurált, belső virtuális hálózatok felhasználók felelősek hello DNS saját, a saját terheléselosztási kezelése.</span><span class="sxs-lookup"><span data-stu-id="2b2d2-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own hello DNS.</span></span>


## <span data-ttu-id="2b2d2-248"><a name="related-content"></a>Kapcsolódó tartalom</span><span class="sxs-lookup"><span data-stu-id="2b2d2-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="2b2d2-249">Csatlakozás a virtuális hálózati toobackend VPN-átjáró használatával</span><span class="sxs-lookup"><span data-stu-id="2b2d2-249">Connecting a Virtual Network toobackend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="2b2d2-250">Egy virtuális hálózathoz csatlakozó különböző üzembe helyezési modellel</span><span class="sxs-lookup"><span data-stu-id="2b2d2-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="2b2d2-251">Hogyan toouse hello API Inspector tootrace meghívja az Azure API Management</span><span class="sxs-lookup"><span data-stu-id="2b2d2-251">How toouse hello API Inspector tootrace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect tooa web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md
