---
title: "Virtuális hálózatok az Azure API Management használata"
description: "Útmutató a kapcsolatot az Azure API Management és az access webszolgáltatások rajta egy virtuális hálózathoz."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 268cee739188d81feffc36ac07fcdfa18ff95a4d
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-use-azure-api-management-with-virtual-networks"></a><span data-ttu-id="5d3d4-103">Virtuális hálózatok az Azure API Management használata</span><span class="sxs-lookup"><span data-stu-id="5d3d4-103">How to use Azure API Management with virtual networks</span></span>
<span data-ttu-id="5d3d4-104">Az Azure virtuális hálózatokról (Vnetekről) helyezze el az Azure-erőforrások bármelyike nem internetes routeable hálózati hozzáférést szabályozó teszik lehetővé.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-104">Azure Virtual Networks (VNETs) allow you to place any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="5d3d4-105">Ezek a hálózatok csatlakozhatnak különböző VPN technológiáin a helyszíni hálózatokhoz.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-105">These networks can then be connected to your on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="5d3d4-106">További információk az Azure virtuális hálózatok indítsa el az adatok Itt további: [Azure virtuális hálózat áttekintése](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="5d3d4-106">To learn more about Azure Virtual Networks start with the information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="5d3d4-107">Az Azure API Management telepítheti a virtuális hálózaton (VNET), így hozzáférhet a hálózaton belüli háttér-szolgáltatások.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-107">Azure API Management can be deployed inside the virtual network (VNET), so it can access backend services within the network.</span></span> <span data-ttu-id="5d3d4-108">A fejlesztői portálján és API-átjárón beállítható úgy, hogy érhető el, vagy az internetről, vagy csak a virtuális hálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-108">The developer portal and API gateway, can be configured to be accessible either from the Internet or only within the virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="5d3d4-109">Az Azure API Management támogatja a classic és az Azure Resource Manager Vnetek.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="5d3d4-110"><a name="enable-vpn"></a>Kapcsolatcsoporttal engedélyezése</span><span class="sxs-lookup"><span data-stu-id="5d3d4-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="5d3d4-111">VNET-kapcsolatot is elérhető a **prémium** és **fejlesztői** rétegek.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-111">VNET connectivity is available in the **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="5d3d4-112">A rétegek közötti váltáshoz nyissa meg az API Management szolgáltatás az Azure-portálon, és nyissa meg a **és az árképzés** fülre. Az a **tarifacsomag** szakaszt, válassza ki a támogatási vagy fejlesztői réteget, és kattintson a Mentés gombra.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-112">To switch between the tiers, open your API Management service in the Azure portal and then open the **Scale and pricing** tab. Under the **Pricing tier** section, select the Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="5d3d4-113">Ahhoz, hogy a VNET-kapcsolatot, nyissa meg az API Management szolgáltatás az Azure portál, és nyissa meg a **virtuális hálózati** lap.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-113">To enable VNET connectivity, open your API Management service in the Azure portal and open the **Virtual network** page.</span></span>

![Virtuális hálózati menü API Management][api-management-using-vnet-menu]

<span data-ttu-id="5d3d4-115">Válassza ki a kívánt hozzáférés típusát:</span><span class="sxs-lookup"><span data-stu-id="5d3d4-115">Select the desired access type:</span></span>

* <span data-ttu-id="5d3d4-116">**Külső**: az API Management-átjáró és a fejlesztői portálon keresztül egy külső terheléselosztó a nyilvános interneten keresztül érhetők el.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-116">**External**: the API Management gateway and developer portal are accessible from the public internet via an external load balancer.</span></span> <span data-ttu-id="5d3d4-117">Az átjáró a virtuális hálózaton lévő erőforrások eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-117">The gateway can access resources within the virtual network.</span></span>

![Nyilvános társviszony-létesítés][api-management-vnet-public]

* <span data-ttu-id="5d3d4-119">**Belső**: az API Management-átjáró és a fejlesztői portálon csak érhetők el a belső terheléselosztók használatával a virtuális hálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-119">**Internal**: the API Management gateway and developer portal are accessible only from within the virtual network via an internal load balancer.</span></span> <span data-ttu-id="5d3d4-120">Az átjáró a virtuális hálózaton lévő erőforrások eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-120">The gateway can access resources within the virtual network.</span></span>

![Magánhálózati társviszony-létesítés][api-management-vnet-private]

<span data-ttu-id="5d3d4-122">Ekkor minden régióban, ahol az API Management szolgáltatás ki van építve listáját.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="5d3d4-123">Válassza ki a virtuális hálózat és alhálózat minden régióhoz.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="5d3d4-124">A lista elkészült a klasszikus és Resource Manager virtuális hálózatok az Azure-előfizetések, amelyek a telepítő konfigurálja a régióban elérhető.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-124">The list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in the region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="5d3d4-125">**Szolgáltatásvégpont** a fenti ábrán például a átjáró /-Proxy, Publisher Portal, fejlesztői portálján, GIT, és a közvetlen felügyelet végpont.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-125">**Service Endpoint** in the above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and the Direct Management Endpoint.</span></span>
> <span data-ttu-id="5d3d4-126">**Felügyeleti végpont** a fenti ábrán a végpont-konfiguráció Azure-portál és a Powershell segítségével kezelheti a szolgáltatásban üzemeltetett.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-126">**Management Endpoint** in the above diagram is the endpoint hosted on the service to manage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="5d3d4-127">Vegye figyelembe azt is, amely akkor is, ha az ábrán látható IP-címek a különböző végpontokhoz, az API Management szolgáltatás **csak** reagál a beállított állomásnevek a.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-127">Also, note, that, even though, the diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5d3d4-128">Az Azure API Management-példány egy erőforrás-kezelő virtuális hálózatba való telepítésekor a szolgáltatás az Azure API Management példányok kivételével nincs más erőforrásokat tartalmazó dedikált alhálózat kell lennie.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-128">When deploying an Azure API Management instance to a Resource Manager VNET, the service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="5d3d4-129">Ha az Azure API Management-példányt telepítése egy erőforrás-kezelő virtuális hálózat alhálózathoz tett kísérlet, amely más erőforrások, a telepítés meghiúsul.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-129">If an attempt is made to deploy an Azure API Management instance to a Resource Manager VNET subnet that contains other resources, the deployment will fail.</span></span>
>
>

![Jelölje ki a VPN][api-management-setup-vpn-select]

<span data-ttu-id="5d3d4-131">Kattintson a **mentése** a képernyő tetején.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-131">Click **Save** at the top of the screen.</span></span>

> [!NOTE]
> <span data-ttu-id="5d3d4-132">Az API Management-példány a címe változik minden alkalommal, amikor virtuális hálózat engedélyezve vagy letiltva.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-132">The VIP address of the API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="5d3d4-133">A virtuális IP-cím is megváltozik az API Management mozgatásakor **külső** való **belső** vagy fordítva</span><span class="sxs-lookup"><span data-stu-id="5d3d4-133">The VIP address will also change when API Management is moved from **External** to **Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="5d3d4-134">Ha az API Management eltávolítása egy VNETET, vagy módosítsa a telepítik egy, a korábban használt virtuális hálózat maradjanak zárolt legfeljebb 4 órán keresztül.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-134">If you remove API Management from a VNET or change the one it is deployed in, the previously used VNET can remain locked for up to 4 hours.</span></span> <span data-ttu-id="5d3d4-135">Ebben az időszakban, nem lesz lehetséges a virtuális hálózat törlése vagy a központi telepítése egy új erőforrást.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-135">During this period it will not be possible to delete the VNET or deploy a new resource to it.</span></span>

## <span data-ttu-id="5d3d4-136"><a name="enable-vnet-powershell"></a>Engedélyezése kapcsolatcsoporttal PowerShell-parancsmagok használatával</span><span class="sxs-lookup"><span data-stu-id="5d3d4-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="5d3d4-137">Engedélyezheti a VNET-kapcsolatot a PowerShell-parancsmagok használatával</span><span class="sxs-lookup"><span data-stu-id="5d3d4-137">You can also enable VNET connectivity using the PowerShell cmdlets</span></span>

* <span data-ttu-id="5d3d4-138">**A VNETEN belül az API Management szolgáltatás létrehozása**: parancsmag [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) egy VNETEN belül Azure API Management szolgáltatás létrehozása.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-138">**Create an API Management service inside a VNET**: Use the cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) to create an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="5d3d4-139">**A VNETEN belül az meglévő API Management-szolgáltatások üzembe**: parancsmag [frissítés-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) helyezhető át egy meglévő Azure API Management szolgáltatást egy virtuális hálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-139">**Deploy an existing API Management service inside a VNET**: Use the cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) to move an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="5d3d4-140"><a name="connect-vnet"></a>Csatlakozás a virtuális hálózaton belül futó webszolgáltatás</span><span class="sxs-lookup"><span data-stu-id="5d3d4-140"><a name="connect-vnet"> </a>Connect to a web service hosted within a virtual Network</span></span>
<span data-ttu-id="5d3d4-141">Az API-kezelés szolgáltatás a virtuális hálózatba csatlakoztatása után belül háttér-szolgáltatások eléréséhez szükséges eltér nem nyilvános szolgáltatások eléréséhez szükséges.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-141">After your API Management service is connected to the VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="5d3d4-142">Csak a helyi IP-cím vagy a webszolgáltatás a állomásneve (Ha a virtuális hálózat DNS-kiszolgáló van konfigurálva) írja be a **webszolgáltatás URL-címe** mezőben egy új API létrehozásakor vagy egy meglévőt.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-142">Just type in the local IP address or the host name (if a DNS server is configured for the VNET) of your web service into the **Web service URL** field when creating a new API or editing an existing one.</span></span>

![A VPN API hozzáadása][api-management-setup-vpn-add-api]

## <span data-ttu-id="5d3d4-144"><a name="network-configuration-issues"></a>Közös hálózati konfigurációs problémák</span><span class="sxs-lookup"><span data-stu-id="5d3d4-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="5d3d4-145">Az alábbiakban az API-kezelés szolgáltatás telepítése virtuális hálózatba során előforduló gyakori helytelen konfiguráció-problémák listáját.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="5d3d4-146">**Egyéni DNS-kiszolgáló beállításainak**: az API Management szolgáltatás több Azure-szolgáltatások függ.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-146">**Custom DNS server setup**: The API Management service depends on several Azure services.</span></span> <span data-ttu-id="5d3d4-147">Amikor az API Management egyéni DNS-kiszolgáló a VNETEN belül üzemel kell feloldani a gazdagép neve az Azure szolgáltatások.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-147">When API Management is hosted in a VNET with a custom DNS server, it needs to resolve the hostnames of those Azure services.</span></span> <span data-ttu-id="5d3d4-148">Kövesse az [ez](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) egyéni DNS-beállításainak útmutatást.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="5d3d4-149">Tekintse meg a portokat az alábbi táblázat és az egyéb hálózati követelmények hivatkozás.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-149">See the ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5d3d4-150">Javasoljuk, hogy egy egyéni DNS-kiszolgálói használatakor a vnet beállítása, amely **előtt** bele az API Management szolgáltatás telepítéséhez.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-150">It is recommended that, if you are using a Custom DNS Server(s) for the VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="5d3d4-151">Ellenkező esetben frissítenie kell az API Management szolgáltatás minden alkalommal, amikor a DNS-kiszolgálók (s) módosításához futtassa a [alkalmazni a hálózati konfigurációs műveletet](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="5d3d4-151">Otherwise you need to update the API Management service each time you change the DNS Servers(s) by running the [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="5d3d4-152">**Az API Management szükséges portok**: az API Management telepítése alhálózat a bejövő és kimenő forgalom vezérelhető [hálózati biztonsági csoport][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="5d3d4-152">**Ports required for API Management**: Inbound and Outbound traffic into the Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="5d3d4-153">Ha ezeket a portokat bármelyike nem érhető el, az API Management nem fog megfelelően működni, és lehetnek nem elérhetők.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="5d3d4-154">Rendelkezik egy vagy több ezeket a portokat blokkolva helytelen konfigurálása más gyakori problémák használata esetén az API Management olyan virtuális hálózaton.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="5d3d4-155">Ha egy API-kezelés szolgáltatás példányát a VNETEN belül üzemel a portokat az alábbi táblázatban használ.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-155">When an API Management service instance is hosted in a VNET, the ports in the following table are used.</span></span>

| <span data-ttu-id="5d3d4-156">Forrás / cél port(ok)</span><span class="sxs-lookup"><span data-stu-id="5d3d4-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="5d3d4-157">Irány</span><span class="sxs-lookup"><span data-stu-id="5d3d4-157">Direction</span></span> | <span data-ttu-id="5d3d4-158">Átviteli protokoll</span><span class="sxs-lookup"><span data-stu-id="5d3d4-158">Transport protocol</span></span> | <span data-ttu-id="5d3d4-159">Cél</span><span class="sxs-lookup"><span data-stu-id="5d3d4-159">Purpose</span></span> | <span data-ttu-id="5d3d4-160">Forrás / cél</span><span class="sxs-lookup"><span data-stu-id="5d3d4-160">Source / Destination</span></span> | <span data-ttu-id="5d3d4-161">Hozzáférés típusa</span><span class="sxs-lookup"><span data-stu-id="5d3d4-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="5d3d4-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="5d3d4-162">* / 80, 443</span></span> |<span data-ttu-id="5d3d4-163">Bejövő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-163">Inbound</span></span> |<span data-ttu-id="5d3d4-164">TCP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-164">TCP</span></span> |<span data-ttu-id="5d3d4-165">Ügyfél-kommunikációt kíván API Management</span><span class="sxs-lookup"><span data-stu-id="5d3d4-165">Client communication to API Management</span></span> |<span data-ttu-id="5d3d4-166">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="5d3d4-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="5d3d4-167">Külső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-167">External</span></span> |
| <span data-ttu-id="5d3d4-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="5d3d4-168">* / 3443</span></span> |<span data-ttu-id="5d3d4-169">Bejövő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-169">Inbound</span></span> |<span data-ttu-id="5d3d4-170">TCP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-170">TCP</span></span> |<span data-ttu-id="5d3d4-171">Az Azure portál és a Powershell felügyeleti végpont</span><span class="sxs-lookup"><span data-stu-id="5d3d4-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="5d3d4-172">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="5d3d4-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="5d3d4-173">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-173">External & Internal</span></span> |
| <span data-ttu-id="5d3d4-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="5d3d4-174">* / 80, 443</span></span> |<span data-ttu-id="5d3d4-175">Kimenő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-175">Outbound</span></span> |<span data-ttu-id="5d3d4-176">TCP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-176">TCP</span></span> |<span data-ttu-id="5d3d4-177">Az Azure Storage és az Azure Service Bus függőség</span><span class="sxs-lookup"><span data-stu-id="5d3d4-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="5d3d4-178">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="5d3d4-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="5d3d4-179">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-179">External & Internal</span></span> |
| <span data-ttu-id="5d3d4-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="5d3d4-180">* / 1433</span></span> |<span data-ttu-id="5d3d4-181">Kimenő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-181">Outbound</span></span> |<span data-ttu-id="5d3d4-182">TCP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-182">TCP</span></span> |<span data-ttu-id="5d3d4-183">Az Azure SQL függőség</span><span class="sxs-lookup"><span data-stu-id="5d3d4-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="5d3d4-184">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="5d3d4-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="5d3d4-185">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-185">External & Internal</span></span> |
| <span data-ttu-id="5d3d4-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="5d3d4-186">* / 11000 - 11999</span></span> |<span data-ttu-id="5d3d4-187">Kimenő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-187">Outbound</span></span> |<span data-ttu-id="5d3d4-188">TCP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-188">TCP</span></span> |<span data-ttu-id="5d3d4-189">V12 Azure SQL függőség</span><span class="sxs-lookup"><span data-stu-id="5d3d4-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="5d3d4-190">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="5d3d4-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="5d3d4-191">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-191">External & Internal</span></span> |
| <span data-ttu-id="5d3d4-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="5d3d4-192">* / 14000 - 14999</span></span> |<span data-ttu-id="5d3d4-193">Kimenő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-193">Outbound</span></span> |<span data-ttu-id="5d3d4-194">TCP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-194">TCP</span></span> |<span data-ttu-id="5d3d4-195">V12 Azure SQL függőség</span><span class="sxs-lookup"><span data-stu-id="5d3d4-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="5d3d4-196">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="5d3d4-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="5d3d4-197">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-197">External & Internal</span></span> |
| <span data-ttu-id="5d3d4-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="5d3d4-198">* / 5671</span></span> |<span data-ttu-id="5d3d4-199">Kimenő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-199">Outbound</span></span> |<span data-ttu-id="5d3d4-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-200">AMQP</span></span> |<span data-ttu-id="5d3d4-201">Az Event Hubs házirend- és figyelési ügynök napló függőség</span><span class="sxs-lookup"><span data-stu-id="5d3d4-201">Dependency for Log to Event Hub policy and monitoring agent</span></span> |<span data-ttu-id="5d3d4-202">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="5d3d4-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="5d3d4-203">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-203">External & Internal</span></span> |
| <span data-ttu-id="5d3d4-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="5d3d4-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="5d3d4-205">Bejövő és kimenő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-205">Inbound & Outbound</span></span> |<span data-ttu-id="5d3d4-206">UDP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-206">UDP</span></span> |<span data-ttu-id="5d3d4-207">Redis gyorsítótár függőség</span><span class="sxs-lookup"><span data-stu-id="5d3d4-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="5d3d4-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="5d3d4-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="5d3d4-209">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-209">External & Internal</span></span> |-
| <span data-ttu-id="5d3d4-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="5d3d4-210">* / 445</span></span> |<span data-ttu-id="5d3d4-211">Kimenő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-211">Outbound</span></span> |<span data-ttu-id="5d3d4-212">TCP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-212">TCP</span></span> |<span data-ttu-id="5d3d4-213">Azure-fájlmegosztáshoz git függőség</span><span class="sxs-lookup"><span data-stu-id="5d3d4-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="5d3d4-214">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="5d3d4-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="5d3d4-215">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-215">External & Internal</span></span> |
| <span data-ttu-id="5d3d4-216">* / *</span><span class="sxs-lookup"><span data-stu-id="5d3d4-216">* / *</span></span> | <span data-ttu-id="5d3d4-217">Bejövő</span><span class="sxs-lookup"><span data-stu-id="5d3d4-217">Inbound</span></span> |<span data-ttu-id="5d3d4-218">TCP</span><span class="sxs-lookup"><span data-stu-id="5d3d4-218">TCP</span></span> |<span data-ttu-id="5d3d4-219">Az Azure infrastruktúra Terheléselosztóját</span><span class="sxs-lookup"><span data-stu-id="5d3d4-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="5d3d4-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="5d3d4-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="5d3d4-221">Külső és belső</span><span class="sxs-lookup"><span data-stu-id="5d3d4-221">External & Internal</span></span> |

* <span data-ttu-id="5d3d4-222">**SSL-funkció**: SSL-tanúsítvány láncának felépítése és -ellenőrzés az API Management engedélyezéséhez szolgáltatásnak kell a kimenő hálózati kapcsolat ocsp.msocsp.com, mscrl.microsoft.com és crl.microsoft.com. A függőség nincs szükség, ha bármely olyan tanúsítvány, az API Management-be feltölteni a teljes lánc és a legfelső szintű tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-222">**SSL functionality**: To enable SSL certificate chain building and validation the API Management service needs Outbound network connectivity to ocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload to API Management contain the full chain to the CA root.</span></span>

* <span data-ttu-id="5d3d4-223">**DNS hozzáférési**: 53-as port kimenő hozzáférést kell DNS-kiszolgálókkal való kommunikációhoz.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="5d3d4-224">Ha egy egyéni DNS-kiszolgáló létezik a VPN-átjáró másik végén, a DNS-kiszolgáló elérhető-e az API Management üzemeltető alhálózatból kell lennie.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-224">If a custom DNS server exists on the other end of a VPN gateway, the DNS server must be reachable from the subnet hosting API Management.</span></span>

* <span data-ttu-id="5d3d4-225">**Metrikák és az állapotfigyelés**: Azure figyelési végpontok, amelyek oldja meg a következő tartományokkal a kimenő hálózati kapcsolat: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-225">**Metrics and Health Monitoring**: Outbound network connectivity to Azure Monitoring endpoints, which resolve under the following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="5d3d4-226">**Útvonal gyorstelepítése**: egy közös felhasználói konfigurálás az, hogy a saját alapértelmezett útvonalat (0.0.0.0/0), amely arra kényszeríti a kimenő Internet forgalmat inkább a helyszínen.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-226">**Express Route Setup**: A common customer configuration is to define their own default route (0.0.0.0/0) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="5d3d4-227">A forgalom áramlását tüntetnek megsérti kapcsolat az Azure API Management szolgáltatással, mert a kimenő adatforgalmat a letiltott helyi, vagy NAT-címek, amelyek már nem használhatók a különböző Azure-végpontok egy felismerhetetlen készletéhez lenne.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-227">This traffic flow invariably breaks connectivity with Azure API Management because the outbound traffic is either blocked on-premises, or NAT'd to an unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="5d3d4-228">A megoldás, hogy egy (vagy több) felhasználó által definiált útvonalak megadása ([udr-EK][UDRs]), amely tartalmazza az Azure API Management az alhálózaton.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-228">The solution is to define one (or more) user-defined routes ([UDRs][UDRs]) on the subnet that contains the Azure API Management.</span></span> <span data-ttu-id="5d3d4-229">Egy UDR helyett az alapértelmezett útvonal szembeni szerződéses kötelezettségeket vonatkozó alhálózati útvonalakat határozza meg.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-229">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>
  <span data-ttu-id="5d3d4-230">Ha lehetséges javasoljuk, hogy az alábbi konfigurációt használja:</span><span class="sxs-lookup"><span data-stu-id="5d3d4-230">If possible, it is recommended to use the following configuration:</span></span>
 * <span data-ttu-id="5d3d4-231">Az ExpressRoute konfigurációs hirdeti 0.0.0.0/0, és alapértelmezés szerint kényszerített bújtatja minden kimenő forgalom helyszíni.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-231">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="5d3d4-232">Az Azure API Management tartalmazó alkalmazva UDR 0.0.0.0/0 az Internet egy következő ugrás típusa határozza meg.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-232">The UDR applied to the subnet containing the Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="5d3d4-233">A kombinált hatását, hogy ezeket a lépéseket az, hogy az alhálózat-szintű UDR elsőbbséget élvez az ExpressRoute kényszerített bújtatás, biztosítva ezzel az Azure API Management a kimenő Internet-hozzáféréssel.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-233">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="5d3d4-234">Az Azure API Management használata nem támogatott az ExpressRoute-konfigurációkat, amelyek **helytelenül kereszt-hirdetményt a magánhálózati társviszony-létesítési elérési utat a nyilvános társviszony-létesítési elérési útvonalak**.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="5d3d4-235">ExpressRoute-konfigurációk, amelyek rendelkeznek a nyilvános társviszony konfigurálva, a Microsoft Azure IP-címtartományok számos útvonal-hirdetéseinek kap Microsoft.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="5d3d4-236">Ha ezen címtartomány helytelenül határokon meghirdetett a magánhálózati társviszony-létesítési elérési úton, a záró eredménye, hogy minden kimenő hálózati rendszer érkező csomagokat, az Azure API Management példány alhálózati helytelenül kényszerített-tunneled az ügyfél a helyi hálózati infrastruktúra.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-236">If these address ranges are incorrectly cross-advertised on the private peering path, the end result is that all outbound network packets from the Azure API Management instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="5d3d4-237">Hálózati folyamatot az Azure API Management megszakítja.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="5d3d4-238">Ez a probléma megoldása, hogy állítsa le a kereszt-hirdetési útvonalak a nyilvános társviszony-létesítési elérési útról a magánhálózati társviszony-létesítési elérési utat.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-238">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


## <span data-ttu-id="5d3d4-239"><a name="troubleshooting"></a>Hibaelhárítása</span><span class="sxs-lookup"><span data-stu-id="5d3d4-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="5d3d4-240">Ha módosítja a hálózathoz, tekintse meg [NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), ellenőrizze, hogy az API-kezelés szolgáltatás nem rendelkezik már nem fér hozzá a kritikus erőforrásokat, amelyek azt határozzák meg.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-240">When making changes to your network, refer to [NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), to validate if the API Management service has not lost access to any of the critical resources which it depends upon.</span></span> <span data-ttu-id="5d3d4-241">A kapcsolati állapot 15 percenként frissíteni kell.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-241">The connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="5d3d4-242"><a name="limitations"></a>Korlátozásai</span><span class="sxs-lookup"><span data-stu-id="5d3d4-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="5d3d4-243">Az API Management-példányokat tartalmazó alhálózat bármely más Azure-erőforrás típusa nem tartalmazhat.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="5d3d4-244">Az alhálózat és az API Management szolgáltatás ugyanahhoz az előfizetéshez kell lennie.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-244">The subnet and the API Management service must be in the same subscription.</span></span>
* <span data-ttu-id="5d3d4-245">Az API Management-példányokat tartalmazó alhálózat előfizetésekhez nem helyezhetők.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="5d3d4-246">Belső virtuális hálózat használatával, csak egy belső IP-cím lesz elérhető a megadott tartomány [RFC 1918](https://tools.ietf.org/html/rfc1918), egy nyilvános IP-cím nem adható meg.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-246">When using an internal virtual network, only an internal IP address will be available from the range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="5d3d4-247">Több területi API Management telepítések esetén konfigurált, belső virtuális hálózatok a felhasználók felelőssége saját terheléselosztási, a DNS saját kezelése.</span><span class="sxs-lookup"><span data-stu-id="5d3d4-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own the DNS.</span></span>


## <span data-ttu-id="5d3d4-248"><a name="related-content"></a>Kapcsolódó tartalom</span><span class="sxs-lookup"><span data-stu-id="5d3d4-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="5d3d4-249">A virtuális hálózati kapcsolódás kiszolgáló VPN-átjáró használatával</span><span class="sxs-lookup"><span data-stu-id="5d3d4-249">Connecting a Virtual Network to backend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="5d3d4-250">Egy virtuális hálózathoz csatlakozó különböző üzembe helyezési modellel</span><span class="sxs-lookup"><span data-stu-id="5d3d4-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="5d3d4-251">A követni kívánt API-Inspector használatával meghívja az Azure API Management</span><span class="sxs-lookup"><span data-stu-id="5d3d4-251">How to use the API Inspector to trace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect to a web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md
