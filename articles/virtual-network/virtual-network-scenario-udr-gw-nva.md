---
title: "2-rétegbeli alkalmazás aaaHybrid kapcsolatot |} Microsoft Docs"
description: "Megtudhatja, hogyan toodeploy virtuális készülékek és UDR toocreate egy többrétegű alkalmazást környezet az Azure-ban"
services: virtual-network
documentationcenter: na
author: jimdial
manager: carmonm
editor: tysonn
ms.assetid: 1f509bec-bdd1-470d-8aa4-3cf2bb7f6134
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/05/2016
ms.author: jdial
ms.openlocfilehash: 53599862289dbf9c6ab3289b0cb8dda6430f20f7
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="virtual-appliance-scenario"></a><span data-ttu-id="df230-103">Virtuális készülék forgatókönyv</span><span class="sxs-lookup"><span data-stu-id="df230-103">Virtual appliance scenario</span></span>
<span data-ttu-id="df230-104">Egy általános forgatókönyv nagyobb Azure felhasználói között hello kell tooprovide a kétféle közzétett alkalmazáshoz toohello Internet, miközben lehetővé teszi a hozzáférési toohello hátsó réteg a egy helyszíni adatközpontot.</span><span class="sxs-lookup"><span data-stu-id="df230-104">A common scenario among larger Azure customer is hello need tooprovide a two-tiered application exposed toohello Internet, while allowing access toohello back tier from an on-premises datacenter.</span></span> <span data-ttu-id="df230-105">Ez a dokumentum végigvezeti felhasználó definiált útvonalakat (UDR), a VPN-átjáró és a hálózati virtuális készülékek toodeploy használatát egy kétrétegű környezetben, amely megfelel a követelményeknek hello:</span><span class="sxs-lookup"><span data-stu-id="df230-105">This document will walk you through a scenario using User Defined Routes (UDR), a VPN Gateway, and network virtual appliances toodeploy a two-tier environment that meets hello following requirements:</span></span>

* <span data-ttu-id="df230-106">Webalkalmazás elérhetőknek kell lenniük hello csak a nyilvános internethez.</span><span class="sxs-lookup"><span data-stu-id="df230-106">Web application must be accessible from hello public Internet only.</span></span>
* <span data-ttu-id="df230-107">Web server üzemeltetési hello alkalmazás képes tooaccess egy háttér-alkalmazáskiszolgáló kell lennie.</span><span class="sxs-lookup"><span data-stu-id="df230-107">Web server hosting hello application must be able tooaccess a backend application server.</span></span>
* <span data-ttu-id="df230-108">Hello Internet toohello webalkalmazás származó összes forgalmat a virtuális készülékként egy tűzfalat kell végrehajtania.</span><span class="sxs-lookup"><span data-stu-id="df230-108">All traffic from hello Internet toohello web application must go through a firewall virtual appliance.</span></span> <span data-ttu-id="df230-109">A virtuális készüléknek csak az internetes forgalmat fog történni.</span><span class="sxs-lookup"><span data-stu-id="df230-109">This virtual appliance will be used for Internet traffic only.</span></span>
* <span data-ttu-id="df230-110">Teljes forgalmat toohello alkalmazáskiszolgáló virtuális készülékként egy tűzfalat kell végrehajtania.</span><span class="sxs-lookup"><span data-stu-id="df230-110">All traffic going toohello application server must go through a firewall virtual appliance.</span></span> <span data-ttu-id="df230-111">A virtuális készüléknek hozzáférés toohello háttér-kiszolgálófiók, és hozzáférés adatforrásból származó hello a helyi hálózaton keresztül VPN-átjáró használható.</span><span class="sxs-lookup"><span data-stu-id="df230-111">This virtual appliance will be used for access toohello backend end server, and access coming in from hello on-premises network via a VPN Gateway.</span></span>
* <span data-ttu-id="df230-112">Rendszergazdák képesek toomanage hello tűzfal virtuális készülékek a helyi számítógépükön kell lennie, a harmadik tűzfal kizárólag felügyeleti szempontból használt virtuális készülék.</span><span class="sxs-lookup"><span data-stu-id="df230-112">Administrators must be able toomanage hello firewall virtual appliances from their on-premises computers, by using a third firewall virtual appliance used exclusively for management purposes.</span></span>

<span data-ttu-id="df230-113">Ez egy webfarmos szabványos DMZ DMZ és a védett hálózati.</span><span class="sxs-lookup"><span data-stu-id="df230-113">This is a standard DMZ scenario with a DMZ and a protected network.</span></span> <span data-ttu-id="df230-114">Ilyen eset lehet létrehozni az Azure-ban a NSG-ket, virtuális tűzfalkészülékek, vagy mindkettőt.</span><span class="sxs-lookup"><span data-stu-id="df230-114">Such scenario can be constructed in Azure by using NSGs, firewall virtual appliances, or a combination of both.</span></span> <span data-ttu-id="df230-115">hello az alábbi táblázat néhány hello előnyei és hátrányai NSG-k és a tűzfalon virtuális készülékek között.</span><span class="sxs-lookup"><span data-stu-id="df230-115">hello table below shows some of hello pros and cons between NSGs and firewall virtual appliances.</span></span>

|  | <span data-ttu-id="df230-116">Informatikai szakemberek</span><span class="sxs-lookup"><span data-stu-id="df230-116">Pros</span></span> | <span data-ttu-id="df230-117">Hátrányok</span><span class="sxs-lookup"><span data-stu-id="df230-117">Cons</span></span> |
| --- | --- | --- |
| <span data-ttu-id="df230-118">NSG</span><span class="sxs-lookup"><span data-stu-id="df230-118">NSG</span></span> |<span data-ttu-id="df230-119">Költség nélkül.</span><span class="sxs-lookup"><span data-stu-id="df230-119">No cost.</span></span> <br/><span data-ttu-id="df230-120">Az Azure RBAC integrálva.</span><span class="sxs-lookup"><span data-stu-id="df230-120">Integrated into Azure RBAC.</span></span> <br/><span data-ttu-id="df230-121">Szabályok ARM-sablonokkal hozhatók létre.</span><span class="sxs-lookup"><span data-stu-id="df230-121">Rules can be created in ARM templates.</span></span> |<span data-ttu-id="df230-122">Nagyobb környezetekben eltérőek lehetnek a összetettségét.</span><span class="sxs-lookup"><span data-stu-id="df230-122">Complexity could vary in larger environments.</span></span> |
| <span data-ttu-id="df230-123">Tűzfal</span><span class="sxs-lookup"><span data-stu-id="df230-123">Firewall</span></span> |<span data-ttu-id="df230-124">Adatok vezérlősík teljes ellenőrzést.</span><span class="sxs-lookup"><span data-stu-id="df230-124">Full control over data plane.</span></span> <br/><span data-ttu-id="df230-125">Központi felügyeleti tűzfal konzolon keresztül.</span><span class="sxs-lookup"><span data-stu-id="df230-125">Central management through firewall console.</span></span> |<span data-ttu-id="df230-126">Tűzfal készülék költségét.</span><span class="sxs-lookup"><span data-stu-id="df230-126">Cost of firewall appliance.</span></span> <br/><span data-ttu-id="df230-127">Nincs integrálva az Azure RBAC.</span><span class="sxs-lookup"><span data-stu-id="df230-127">Not integrated with Azure RBAC.</span></span> |

<span data-ttu-id="df230-128">hello megoldás az alábbi tűzfal virtuális készülékek tooimplement egy Szegélyhálózaton/védett hálózati forgatókönyv használ.</span><span class="sxs-lookup"><span data-stu-id="df230-128">hello solution below uses firewall virtual appliances tooimplement a DMZ/protected network scenario.</span></span>

## <a name="considerations"></a><span data-ttu-id="df230-129">Megfontolandó szempontok</span><span class="sxs-lookup"><span data-stu-id="df230-129">Considerations</span></span>
<span data-ttu-id="df230-130">Az Azure-ban elérhető különböző szolgáltatások ma, az alábbiak szerint fenti hello környezet telepítése.</span><span class="sxs-lookup"><span data-stu-id="df230-130">You can deploy hello environment explained above in Azure using different features available today, as follows.</span></span>

* <span data-ttu-id="df230-131">**Virtuális hálózathoz (VNet)**.</span><span class="sxs-lookup"><span data-stu-id="df230-131">**Virtual network (VNet)**.</span></span> <span data-ttu-id="df230-132">Egy Azure virtuális hálózatot hasonló módon tooan a helyi hálózaton működik, és egy vagy több alhálózatok tooprovide adatforgalom-elkülönítést és aggályokat elválasztását is lehet szegmentált.</span><span class="sxs-lookup"><span data-stu-id="df230-132">An Azure VNet acts in similar fashion tooan on-premises network, and can be segmented into one or more subnets tooprovide traffic isolation, and separation of concerns.</span></span>
* <span data-ttu-id="df230-133">**Virtuális készülék**.</span><span class="sxs-lookup"><span data-stu-id="df230-133">**Virtual appliance**.</span></span> <span data-ttu-id="df230-134">Több partnerek adja meg a virtuális készülékek hello Azure piactér hello a fent leírt három tűzfalak használható.</span><span class="sxs-lookup"><span data-stu-id="df230-134">Several partners provide virtual appliances in hello Azure Marketplace that can be used for hello three firewalls described above.</span></span> 
* <span data-ttu-id="df230-135">**Felhasználó által megadott útvonalak (UDR)**.</span><span class="sxs-lookup"><span data-stu-id="df230-135">**User Defined Routes (UDR)**.</span></span> <span data-ttu-id="df230-136">Az útvonaltáblák tartalmazhat udr-EK Azure hálózati toocontrol hello áramló csomagok egy Vneten belül használják.</span><span class="sxs-lookup"><span data-stu-id="df230-136">Route tables can contain UDRs used by Azure networking toocontrol hello flow of packets within a VNet.</span></span> <span data-ttu-id="df230-137">Ezek az útvonaltáblák alkalmazott toosubnets lehet.</span><span class="sxs-lookup"><span data-stu-id="df230-137">These route tables can be applied toosubnets.</span></span> <span data-ttu-id="df230-138">Hello legújabb funkciókat az Azure-ban egyik hello képességét tooapply egy útvonal tábla toohello GatewaySubnet hello képességét tooforward összes adatforgalma hello Azure virtuális hálózatot az egy hibrid kapcsolat tooa virtuális készülék biztosítása.</span><span class="sxs-lookup"><span data-stu-id="df230-138">One of hello newest features in Azure is hello ability tooapply a route table toohello GatewaySubnet, providing hello ability tooforward all traffic coming into hello Azure VNet from a hybrid connection tooa virtual appliance.</span></span>
* <span data-ttu-id="df230-139">**IP-továbbítás**.</span><span class="sxs-lookup"><span data-stu-id="df230-139">**IP Forwarding**.</span></span> <span data-ttu-id="df230-140">Alapértelmezés szerint hello Azure hálózati motor továbbítsa a csomagokat toovirtual hálózati adapterek (NIC) csak akkor, ha a hello csomag cél IP-címe megegyezik hello hálózati adapter IP-címet.</span><span class="sxs-lookup"><span data-stu-id="df230-140">By default, hello Azure networking engine forward packets toovirtual network interface cards (NICs) only if hello packet destination IP address matches hello NIC IP address.</span></span> <span data-ttu-id="df230-141">Ezért egy UDR határozza meg, hogy egy csomagot kell küldeni virtuális készülék megadott tooa, hello Azure hálózati motor csomagban csökkenne.</span><span class="sxs-lookup"><span data-stu-id="df230-141">Therefore, if a UDR defines that a packet must be sent tooa given virtual appliance, hello Azure networking engine would drop that packet.</span></span> <span data-ttu-id="df230-142">tooensure hello csomagot a rendszer tooa virtuális Gépet (ebben az esetben a virtuális készülék), amely nincs hello tényleges cél hello csomagok számára, az IP-továbbítás tooenable hello virtuális készülékre van szüksége.</span><span class="sxs-lookup"><span data-stu-id="df230-142">tooensure hello packet is delivered tooa VM (in this case a virtual appliance) that is not hello actual destination for hello packet, you need tooenable IP Forwarding for hello virtual appliance.</span></span>
* <span data-ttu-id="df230-143">**Hálózati biztonsági csoportokkal (NSG-k)**.</span><span class="sxs-lookup"><span data-stu-id="df230-143">**Network Security Groups (NSGs)**.</span></span> <span data-ttu-id="df230-144">az alábbi példa hello tegye az NSG-k használatát, de az NSG-k alkalmazott toohello alhálózatok és/vagy a hálózati adapterek használhatja a megoldás toofurther szűrő hello forgalom mindkét ezek alhálózatok és a hálózati adapterek.</span><span class="sxs-lookup"><span data-stu-id="df230-144">hello example below does not make use of NSGs, but you could use NSGs applied toohello subnets and/or NICs in this solution toofurther filter hello traffic in and out of those subnets and NICs.</span></span>

![IPv6-kapcsolatot](./media/virtual-network-scenario-udr-gw-nva/figure01.png)

<span data-ttu-id="df230-146">Ebben a példában nincs olyan előfizetést, amelyet hello következő tartalmazza:</span><span class="sxs-lookup"><span data-stu-id="df230-146">In this example there is a subscription that contains hello following:</span></span>

* <span data-ttu-id="df230-147">2 erőforráscsoportok, hello ábrán nem látható.</span><span class="sxs-lookup"><span data-stu-id="df230-147">2 resource groups, not shown in hello diagram.</span></span> 
  * <span data-ttu-id="df230-148">**ONPREMRG**.</span><span class="sxs-lookup"><span data-stu-id="df230-148">**ONPREMRG**.</span></span> <span data-ttu-id="df230-149">Minden erőforrások szükséges egy helyszíni hálózat toosimulate tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="df230-149">Contains all resources necessary toosimulate an on-premises network.</span></span>
  * <span data-ttu-id="df230-150">**AZURERG**.</span><span class="sxs-lookup"><span data-stu-id="df230-150">**AZURERG**.</span></span> <span data-ttu-id="df230-151">Hello Azure-beli virtuális hálózat környezethez szükséges összes erőforrást tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="df230-151">Contains all resources necessary for hello Azure virtual network environment.</span></span> 
* <span data-ttu-id="df230-152">Egy VNet nevű **onpremvnet** egy helyszíni adatközpontot szegmentált az alább felsorolt toomimic használt.</span><span class="sxs-lookup"><span data-stu-id="df230-152">A VNet named **onpremvnet** used toomimic an on-premises datacenter segmented as listed below.</span></span>
  * <span data-ttu-id="df230-153">**onpremsn1**.</span><span class="sxs-lookup"><span data-stu-id="df230-153">**onpremsn1**.</span></span> <span data-ttu-id="df230-154">Ubuntu toomimic egy helyszíni kiszolgálón futó virtuális gép (VM) tartalmazó alhálózat.</span><span class="sxs-lookup"><span data-stu-id="df230-154">Subnet containing a virtual machine (VM) running Ubuntu toomimic an on-premises server.</span></span>
  * <span data-ttu-id="df230-155">**onpremsn2**.</span><span class="sxs-lookup"><span data-stu-id="df230-155">**onpremsn2**.</span></span> <span data-ttu-id="df230-156">A rendszergazda által használt helyi számítógépet futtat Ubuntu toomimic virtuális gép tartalmazó alhálózat.</span><span class="sxs-lookup"><span data-stu-id="df230-156">Subnet containing a VM running Ubuntu toomimic an on-premises computer used by an administrator.</span></span>
* <span data-ttu-id="df230-157">Van egy tűzfal virtuális készülék nevű **OPFW** a **onpremvnet** toomaintain alagutat túl használt**azurevnet**.</span><span class="sxs-lookup"><span data-stu-id="df230-157">There is one firewall virtual appliance named **OPFW** on **onpremvnet** used toomaintain a tunnel too**azurevnet**.</span></span>
* <span data-ttu-id="df230-158">Egy VNet nevű **azurevnet** szegmentált az alábbiak szerint.</span><span class="sxs-lookup"><span data-stu-id="df230-158">A VNet named **azurevnet** segmented as listed below.</span></span>
  * <span data-ttu-id="df230-159">**azsn1**.</span><span class="sxs-lookup"><span data-stu-id="df230-159">**azsn1**.</span></span> <span data-ttu-id="df230-160">Külső tűzfal alhálózati kizárólag hello külső tűzfal használja.</span><span class="sxs-lookup"><span data-stu-id="df230-160">External firewall subnet used exclusively for hello external firewall.</span></span> <span data-ttu-id="df230-161">Minden internetes forgalomhoz határozza meg az alhálózat keresztül.</span><span class="sxs-lookup"><span data-stu-id="df230-161">All Internet traffic will come in through this subnet.</span></span> <span data-ttu-id="df230-162">Az alhálózathoz társított hálózati adapter toohello külső tűzfalat csak tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="df230-162">This subnet only contains a NIC linked toohello external firewall.</span></span>
  * <span data-ttu-id="df230-163">**azsn2**.</span><span class="sxs-lookup"><span data-stu-id="df230-163">**azsn2**.</span></span> <span data-ttu-id="df230-164">A kiszolgáló fogják elérni az internetes hello futtató virtuális gép futtató előtér alhálózat.</span><span class="sxs-lookup"><span data-stu-id="df230-164">Front end subnet hosting a VM running as a web server that will be accessed from hello Internet.</span></span>
  * <span data-ttu-id="df230-165">**azsn3**.</span><span class="sxs-lookup"><span data-stu-id="df230-165">**azsn3**.</span></span> <span data-ttu-id="df230-166">Backend alhálózathoz üzemeltető virtuális gép fut, egy háttér-alkalmazáskiszolgáló hello előtér-webkiszolgálón kell elérnie.</span><span class="sxs-lookup"><span data-stu-id="df230-166">Backend subnet hosting a VM running a backend application server that will be accessed by hello front end web server.</span></span>
  * <span data-ttu-id="df230-167">**azsn4**.</span><span class="sxs-lookup"><span data-stu-id="df230-167">**azsn4**.</span></span> <span data-ttu-id="df230-168">Felügyeleti alhálózati használt kizárólag tooprovide felügyeleti hozzáférés tooall tűzfal virtuális készülékek.</span><span class="sxs-lookup"><span data-stu-id="df230-168">Management subnet used exclusively tooprovide management access tooall firewall virtual appliances.</span></span> <span data-ttu-id="df230-169">Ez az alhálózat csak egy hálózati Adapterhez hello megoldásban használt egyes tűzfal virtuális készülék tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="df230-169">This subnet only contains a NIC for each firewall virtual appliance used in hello solution.</span></span>
  * <span data-ttu-id="df230-170">**A GatewaySubnet**.</span><span class="sxs-lookup"><span data-stu-id="df230-170">**GatewaySubnet**.</span></span> <span data-ttu-id="df230-171">Azure hibrid kapcsolat alhálózat az Azure Vnetekhez és más hálózatokkal között ExpressRoute- és VPN-átjáró tooprovide kapcsolat szükséges.</span><span class="sxs-lookup"><span data-stu-id="df230-171">Azure hybrid connection subnet required for ExpressRoute and VPN Gateway tooprovide connectivity between Azure VNets and other networks.</span></span> 
* <span data-ttu-id="df230-172">Nincsenek 3 tűzfal virtuális készülékek hello **azurevnet** hálózati.</span><span class="sxs-lookup"><span data-stu-id="df230-172">There are 3 firewall virtual appliances in hello **azurevnet** network.</span></span> 
  * <span data-ttu-id="df230-173">**AZF1**.</span><span class="sxs-lookup"><span data-stu-id="df230-173">**AZF1**.</span></span> <span data-ttu-id="df230-174">Külső tűzfal kitett toohello az Azure-ban egy nyilvános IP-cím erőforrás a nyilvános internethez.</span><span class="sxs-lookup"><span data-stu-id="df230-174">External firewall exposed toohello public Internet by using a public IP address resource in Azure.</span></span> <span data-ttu-id="df230-175">Tooensure hello piactér, illetve közvetlenül a készülék forgalmazójával, hogy rendelkezések sablon 3-NIC virtuális készülékre van szüksége.</span><span class="sxs-lookup"><span data-stu-id="df230-175">You need tooensure you have a template from hello Marketplace, or directly from your appliance vendor, that provisions a 3-NIC virtual appliance.</span></span>
  * <span data-ttu-id="df230-176">**AZF2**.</span><span class="sxs-lookup"><span data-stu-id="df230-176">**AZF2**.</span></span> <span data-ttu-id="df230-177">Belső tűzfal használt közötti forgalom toocontrol **azsn2** és **azsn3**.</span><span class="sxs-lookup"><span data-stu-id="df230-177">Internal firewall used toocontrol traffic between **azsn2** and **azsn3**.</span></span> <span data-ttu-id="df230-178">Ez egyben a 3-NIC virtuális készülék.</span><span class="sxs-lookup"><span data-stu-id="df230-178">This is also a 3-NIC virtual appliance.</span></span>
  * <span data-ttu-id="df230-179">**AZF3**.</span><span class="sxs-lookup"><span data-stu-id="df230-179">**AZF3**.</span></span> <span data-ttu-id="df230-180">Felügyeleti tűzfal elérhető tooadministrators hello a helyszíni adatközpontban, és csatlakoztatott tooa felügyeleti alhálózati használt toomanage összes tűzfalkészülékek.</span><span class="sxs-lookup"><span data-stu-id="df230-180">Management firewall accessible tooadministrators from hello on-premises datacenter, and connected tooa management subnet used toomanage all firewall appliances.</span></span> <span data-ttu-id="df230-181">2-NIC virtuális készülék sablonok hello piactér található, vagy közvetlenül a készülék szállítótól kérhet.</span><span class="sxs-lookup"><span data-stu-id="df230-181">You can find 2-NIC virtual appliance templates in hello Marketplace, or request one directly from your appliance vendor.</span></span>

## <a name="user-defined-routing-udr"></a><span data-ttu-id="df230-182">Felhasználó által definiált útválasztási (UDR)</span><span class="sxs-lookup"><span data-stu-id="df230-182">User Defined Routing (UDR)</span></span>
<span data-ttu-id="df230-183">Minden Azure alhálózatban lehet csatolt tooa UDR használt tábla toodefine hogyan alhálózat kezdeményezett továbbítódik.</span><span class="sxs-lookup"><span data-stu-id="df230-183">Each subnet in Azure can be linked tooa UDR table used toodefine how traffic initiated in that subnet is routed.</span></span> <span data-ttu-id="df230-184">Ha nincs udr-EK vannak meghatározva, Azure használja alapértelmezett útvonalak tooallow forgalom tooflow az egyik alhálózat tooanother.</span><span class="sxs-lookup"><span data-stu-id="df230-184">If no UDRs are defined, Azure uses default routes tooallow traffic tooflow from one subnet tooanother.</span></span> <span data-ttu-id="df230-185">toobetter udr-EK megértéséhez, látogasson el [Mik azok a felhasználó által megadott útvonalak és IP-továbbítás](virtual-networks-udr-overview.md#ip-forwarding).</span><span class="sxs-lookup"><span data-stu-id="df230-185">toobetter understand UDRs, visit [What are User Defined Routes and IP Forwarding](virtual-networks-udr-overview.md#ip-forwarding).</span></span>

<span data-ttu-id="df230-186">tooensure kommunikációs hello megfelelő tűzfal, rendszerre épülő készüléknek meg a fenti utolsó követelmény hello segítségével történik, toocreate hello következőkre lesz szüksége a udr-EK tartalmazó útvonaltábla **azurevnet**.</span><span class="sxs-lookup"><span data-stu-id="df230-186">tooensure communication is done through hello right firewall appliance, based on hello last requirement above, you need toocreate hello following route table containing UDRs in **azurevnet**.</span></span>

### <a name="azgwudr"></a><span data-ttu-id="df230-187">azgwudr</span><span class="sxs-lookup"><span data-stu-id="df230-187">azgwudr</span></span>
<span data-ttu-id="df230-188">Ebben a forgatókönyvben hello csak a helyszíni tooAzure áramlanak forgalom lesz használt toomanage hello tűzfalak túl csatlakoztatásával**AZF3**, és hogy forgalom be kell lépnie hello belső tűzfalon keresztül, **AZF2**.</span><span class="sxs-lookup"><span data-stu-id="df230-188">In this scenario, hello only traffic flowing from on-premises tooAzure will be used toomanage hello firewalls by connecting too**AZF3**, and that traffic must go through hello internal firewall, **AZF2**.</span></span> <span data-ttu-id="df230-189">Ezért csak egy útvonal hello szükség az **GatewaySubnet** alább látható módon.</span><span class="sxs-lookup"><span data-stu-id="df230-189">Therefore, only one route is necessary in hello **GatewaySubnet** as shown below.</span></span>

| <span data-ttu-id="df230-190">Cél</span><span class="sxs-lookup"><span data-stu-id="df230-190">Destination</span></span> | <span data-ttu-id="df230-191">Következő ugrás</span><span class="sxs-lookup"><span data-stu-id="df230-191">Next hop</span></span> | <span data-ttu-id="df230-192">Magyarázat</span><span class="sxs-lookup"><span data-stu-id="df230-192">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="df230-193">10.0.4.0/24</span><span class="sxs-lookup"><span data-stu-id="df230-193">10.0.4.0/24</span></span> |<span data-ttu-id="df230-194">10.0.3.11</span><span class="sxs-lookup"><span data-stu-id="df230-194">10.0.3.11</span></span> |<span data-ttu-id="df230-195">Lehetővé teszi, hogy a helyszíni forgalom tooreach felügyeleti tűzfal **AZF3**</span><span class="sxs-lookup"><span data-stu-id="df230-195">Allows on-premises traffic tooreach management firewall **AZF3**</span></span> |

### <a name="azsn2udr"></a><span data-ttu-id="df230-196">azsn2udr</span><span class="sxs-lookup"><span data-stu-id="df230-196">azsn2udr</span></span>
| <span data-ttu-id="df230-197">Cél</span><span class="sxs-lookup"><span data-stu-id="df230-197">Destination</span></span> | <span data-ttu-id="df230-198">Következő ugrás</span><span class="sxs-lookup"><span data-stu-id="df230-198">Next hop</span></span> | <span data-ttu-id="df230-199">Magyarázat</span><span class="sxs-lookup"><span data-stu-id="df230-199">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="df230-200">10.0.3.0/24</span><span class="sxs-lookup"><span data-stu-id="df230-200">10.0.3.0/24</span></span> |<span data-ttu-id="df230-201">10.0.2.11</span><span class="sxs-lookup"><span data-stu-id="df230-201">10.0.2.11</span></span> |<span data-ttu-id="df230-202">Lehetővé teszi, hogy a forgalom toohello backend alhálózathoz hello alkalmazáskiszolgáló keresztül üzemeltető **AZF2**</span><span class="sxs-lookup"><span data-stu-id="df230-202">Allows traffic toohello backend subnet hosting hello application server through **AZF2**</span></span> |
| <span data-ttu-id="df230-203">0.0.0.0/0</span><span class="sxs-lookup"><span data-stu-id="df230-203">0.0.0.0/0</span></span> |<span data-ttu-id="df230-204">10.0.2.10</span><span class="sxs-lookup"><span data-stu-id="df230-204">10.0.2.10</span></span> |<span data-ttu-id="df230-205">Lehetővé teszi, hogy minden keresztül más forgalom toobe **AZF1**</span><span class="sxs-lookup"><span data-stu-id="df230-205">Allows all other traffic toobe routed through **AZF1**</span></span> |

### <a name="azsn3udr"></a><span data-ttu-id="df230-206">azsn3udr</span><span class="sxs-lookup"><span data-stu-id="df230-206">azsn3udr</span></span>
| <span data-ttu-id="df230-207">Cél</span><span class="sxs-lookup"><span data-stu-id="df230-207">Destination</span></span> | <span data-ttu-id="df230-208">Következő ugrás</span><span class="sxs-lookup"><span data-stu-id="df230-208">Next hop</span></span> | <span data-ttu-id="df230-209">Magyarázat</span><span class="sxs-lookup"><span data-stu-id="df230-209">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="df230-210">10.0.2.0/24</span><span class="sxs-lookup"><span data-stu-id="df230-210">10.0.2.0/24</span></span> |<span data-ttu-id="df230-211">10.0.3.10</span><span class="sxs-lookup"><span data-stu-id="df230-211">10.0.3.10</span></span> |<span data-ttu-id="df230-212">Lehetővé teszi a forgalom túl**azsn2** app server toohello webkiszolgáló keresztül tooflow **AZF2**</span><span class="sxs-lookup"><span data-stu-id="df230-212">Allows traffic too**azsn2** tooflow from app server toohello webserver through **AZF2**</span></span> |

<span data-ttu-id="df230-213">Hello alhálózatai toocreate útválasztási táblázattal is szüksége **onpremvnet** toomimic hello helyszíni adatközpontban.</span><span class="sxs-lookup"><span data-stu-id="df230-213">You also need toocreate route tables for hello subnets in **onpremvnet** toomimic hello on-premises datacenter.</span></span>

### <a name="onpremsn1udr"></a><span data-ttu-id="df230-214">onpremsn1udr</span><span class="sxs-lookup"><span data-stu-id="df230-214">onpremsn1udr</span></span>
| <span data-ttu-id="df230-215">Cél</span><span class="sxs-lookup"><span data-stu-id="df230-215">Destination</span></span> | <span data-ttu-id="df230-216">Következő ugrás</span><span class="sxs-lookup"><span data-stu-id="df230-216">Next hop</span></span> | <span data-ttu-id="df230-217">Magyarázat</span><span class="sxs-lookup"><span data-stu-id="df230-217">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="df230-218">192.168.2.0/24</span><span class="sxs-lookup"><span data-stu-id="df230-218">192.168.2.0/24</span></span> |<span data-ttu-id="df230-219">192.168.1.4</span><span class="sxs-lookup"><span data-stu-id="df230-219">192.168.1.4</span></span> |<span data-ttu-id="df230-220">Lehetővé teszi a forgalom túl**onpremsn2** keresztül **OPFW**</span><span class="sxs-lookup"><span data-stu-id="df230-220">Allows traffic too**onpremsn2** through **OPFW**</span></span> |

### <a name="onpremsn2udr"></a><span data-ttu-id="df230-221">onpremsn2udr</span><span class="sxs-lookup"><span data-stu-id="df230-221">onpremsn2udr</span></span>
| <span data-ttu-id="df230-222">Cél</span><span class="sxs-lookup"><span data-stu-id="df230-222">Destination</span></span> | <span data-ttu-id="df230-223">Következő ugrás</span><span class="sxs-lookup"><span data-stu-id="df230-223">Next hop</span></span> | <span data-ttu-id="df230-224">Magyarázat</span><span class="sxs-lookup"><span data-stu-id="df230-224">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="df230-225">10.0.3.0/24</span><span class="sxs-lookup"><span data-stu-id="df230-225">10.0.3.0/24</span></span> |<span data-ttu-id="df230-226">192.168.2.4</span><span class="sxs-lookup"><span data-stu-id="df230-226">192.168.2.4</span></span> |<span data-ttu-id="df230-227">Lehetővé teszi, hogy a forgalom biztonsági toohello alhálózati keresztül az Azure-ban **OPFW**</span><span class="sxs-lookup"><span data-stu-id="df230-227">Allows traffic toohello backed subnet in Azure through **OPFW**</span></span> |
| <span data-ttu-id="df230-228">192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="df230-228">192.168.1.0/24</span></span> |<span data-ttu-id="df230-229">192.168.2.4</span><span class="sxs-lookup"><span data-stu-id="df230-229">192.168.2.4</span></span> |<span data-ttu-id="df230-230">Lehetővé teszi a forgalom túl**onpremsn1** keresztül **OPFW**</span><span class="sxs-lookup"><span data-stu-id="df230-230">Allows traffic too**onpremsn1** through **OPFW**</span></span> |

## <a name="ip-forwarding"></a><span data-ttu-id="df230-231">IP-továbbítás</span><span class="sxs-lookup"><span data-stu-id="df230-231">IP Forwarding</span></span>
<span data-ttu-id="df230-232">UDR és IP-továbbítás olyan funkciókat, amelyek kombinációja tooallow virtuális készülékek használt toobe toocontrol forgalom áramlását az egy Azure virtuális hálózatot is használhat.</span><span class="sxs-lookup"><span data-stu-id="df230-232">UDR and IP Forwarding are features that you can use in combination tooallow virtual appliances toobe used toocontrol traffic flow in an Azure VNet.</span></span>  <span data-ttu-id="df230-233">A virtuális készülék értéke "Nothing" több mint egy virtuális Gépet, amelyen az alkalmazás toohandle hálózati forgalom valamilyen módon, például egy tűzfal vagy NAT-eszköz.</span><span class="sxs-lookup"><span data-stu-id="df230-233">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="df230-234">A virtuális gép kell lennie, amely képes tooreceive bejövő forgalom virtuális készüléknek tooitself nem foglalkozik.</span><span class="sxs-lookup"><span data-stu-id="df230-234">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="df230-235">a virtuális gépek tooreceive forgalma tooallow címzett tooother a célok, engedélyeznie kell az IP-továbbítás az hello VM.</span><span class="sxs-lookup"><span data-stu-id="df230-235">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="df230-236">Ez az egy Azure beállítás, nem a megfelelő értéket hello vendég operációs rendszer.</span><span class="sxs-lookup"><span data-stu-id="df230-236">This is an Azure setting, not a setting in hello guest operating system.</span></span> <span data-ttu-id="df230-237">A virtuális készülék továbbra is kell toorun bizonyos típusú alkalmazás toohandle hello bejövő forgalmat, és megfelelően irányítja.</span><span class="sxs-lookup"><span data-stu-id="df230-237">Your virtual appliance still needs toorun some type of application toohandle hello incoming traffic, and route it appropriately.</span></span>

<span data-ttu-id="df230-238">További információ az IP-továbbítást, toolearn látogasson el [Mik azok a felhasználó által megadott útvonalak és IP-továbbítás](virtual-networks-udr-overview.md#ip-forwarding).</span><span class="sxs-lookup"><span data-stu-id="df230-238">toolearn more about IP Forwarding, visit [What are User Defined Routes and IP Forwarding](virtual-networks-udr-overview.md#ip-forwarding).</span></span>

<span data-ttu-id="df230-239">Tegyük fel képzelhető el, egy Azure virtuális hálózatot a telepítő a következő hello rendelkezik:</span><span class="sxs-lookup"><span data-stu-id="df230-239">As an example, imagine you have hello following setup in an Azure vnet:</span></span>

* <span data-ttu-id="df230-240">Alhálózati **onpremsn1** tartalmaz egy nevű virtuális gép **onpremvm1**.</span><span class="sxs-lookup"><span data-stu-id="df230-240">Subnet **onpremsn1** contains a VM named **onpremvm1**.</span></span>
* <span data-ttu-id="df230-241">Alhálózati **onpremsn2** tartalmaz egy nevű virtuális gép **onpremvm2**.</span><span class="sxs-lookup"><span data-stu-id="df230-241">Subnet **onpremsn2** contains a VM named **onpremvm2**.</span></span>
* <span data-ttu-id="df230-242">A virtuális készülék nevű **OPFW** túl csatlakozik-e**onpremsn1** és **onpremsn2**.</span><span class="sxs-lookup"><span data-stu-id="df230-242">A virtual appliance named **OPFW** is connected too**onpremsn1** and **onpremsn2**.</span></span>
* <span data-ttu-id="df230-243">A felhasználó által megadott útvonal túl kapcsolódó**onpremsn1** határozza meg, hogy minden túl forgalomnak**onpremsn2** túl el kell küldeni**OPFW**.</span><span class="sxs-lookup"><span data-stu-id="df230-243">A user defined route linked too**onpremsn1** specifies that all traffic too**onpremsn2** must be sent too**OPFW**.</span></span>

<span data-ttu-id="df230-244">At a pont, ha **onpremvm1** tooestablish megpróbál kapcsolatot **onpremvm2**, hello UDR fogja használni, és a forgalom túl küld**OPFW** hello következő ugrásként.</span><span class="sxs-lookup"><span data-stu-id="df230-244">At this point, if **onpremvm1** tries tooestablish a connection with **onpremvm2**, hello UDR will be used and traffic will be sent too**OPFW** as hello next hop.</span></span> <span data-ttu-id="df230-245">Ne feledje, hogy a tényleges csomagban cél hello nem módosul, továbbra is felirat látható **onpremvm2** hello cél.</span><span class="sxs-lookup"><span data-stu-id="df230-245">Keep in mind that hello actual packet destination is not being changed, it still says **onpremvm2** is hello destination.</span></span> 

<span data-ttu-id="df230-246">Az IP-továbbítás engedélyezve nélkül **OPFW**, hello Azure virtuális hálózati logika eldobja hello csomagok, mivel csak lehetővé teszi a csomagok küldése toobe tooa VM Ha hello a virtuális gép IP-cím-e a hello csomagok hello célját.</span><span class="sxs-lookup"><span data-stu-id="df230-246">Without IP Forwarding enabled for **OPFW**, hello Azure virtual networking logic will drop hello packets, since it only allows packets toobe sent tooa VM if hello VM’s IP address is hello destination for hello packet.</span></span>

<span data-ttu-id="df230-247">Az IP-továbbítást hello Azure-beli virtuális hálózat logika továbbításához hello csomagok tooOPFW, eredeti cél címének módosítása nélkül.</span><span class="sxs-lookup"><span data-stu-id="df230-247">With IP Forwarding, hello Azure virtual network logic will forward hello packets tooOPFW, without changing its original destination address.</span></span> <span data-ttu-id="df230-248">**OPFW** kell hello csomagok kezeli, és határozza meg, milyen toodo.</span><span class="sxs-lookup"><span data-stu-id="df230-248">**OPFW** must handle hello packets and determine what toodo with them.</span></span>

<span data-ttu-id="df230-249">A fenti toowork hello esetben engedélyeznie kell az IP-továbbítás hello hálózati adaptereket a **OPFW**, **AZF1**, **AZF2**, és **AZF3** szolgáló az útválasztási (hálózati adapterek összes hello néhányat a meglévők közül csatolt toohello felügyeleti alhálózati kivételével).</span><span class="sxs-lookup"><span data-stu-id="df230-249">For hello scenario above toowork, you must enable IP Forwarding on hello NICs for **OPFW**, **AZF1**, **AZF2**, and **AZF3** that are used for routing (all NICs except hello ones linked toohello management subnet).</span></span> 

## <a name="firewall-rules"></a><span data-ttu-id="df230-250">Tűzfalszabályok</span><span class="sxs-lookup"><span data-stu-id="df230-250">Firewall Rules</span></span>
<span data-ttu-id="df230-251">A fent leírtaknak megfelelően biztosítja az IP-továbbítás csak csomagok küldése toohello virtuális készülékek.</span><span class="sxs-lookup"><span data-stu-id="df230-251">As described above, IP Forwarding only ensures packets are sent toohello virtual appliances.</span></span> <span data-ttu-id="df230-252">A készülék továbbra is hozzá kell toodecide milyen toodo az ezeket a csomagokat.</span><span class="sxs-lookup"><span data-stu-id="df230-252">Your appliance still needs toodecide what toodo with those packets.</span></span> <span data-ttu-id="df230-253">Hello a fenti esetben szüksége lesz toocreate hello készülékeinek szabályai a következő:</span><span class="sxs-lookup"><span data-stu-id="df230-253">In hello scenario above, you will need toocreate hello following rules in your appliances:</span></span>

### <a name="opfw"></a><span data-ttu-id="df230-254">OPFW</span><span class="sxs-lookup"><span data-stu-id="df230-254">OPFW</span></span>
<span data-ttu-id="df230-255">OPFW egy a helyszíni eszközöket, amelyek szabályainak hello jelöli:</span><span class="sxs-lookup"><span data-stu-id="df230-255">OPFW represents an on-premises device containing hello following rules:</span></span>

* <span data-ttu-id="df230-256">**Útvonal**: minden forgalomnak too10.0.0.0/16 (**azurevnet**) alagúton keresztül kell küldeni **ONPREMAZURE**.</span><span class="sxs-lookup"><span data-stu-id="df230-256">**Route**: All traffic too10.0.0.0/16 (**azurevnet**) must be sent through tunnel **ONPREMAZURE**.</span></span>
* <span data-ttu-id="df230-257">**Házirend**: közötti összes kétirányú forgalmat engedélyezi **port2** és **ONPREMAZURE**.</span><span class="sxs-lookup"><span data-stu-id="df230-257">**Policy**: Allow all bidirectional traffic between **port2** and **ONPREMAZURE**.</span></span>

### <a name="azf1"></a><span data-ttu-id="df230-258">AZF1</span><span class="sxs-lookup"><span data-stu-id="df230-258">AZF1</span></span>
<span data-ttu-id="df230-259">AZF1 tartalmazó szabályainak hello Azure virtuális készülék jelöli:</span><span class="sxs-lookup"><span data-stu-id="df230-259">AZF1 represents an Azure virtual appliance containing hello following rules:</span></span>

* <span data-ttu-id="df230-260">**Házirend**: közötti összes kétirányú forgalmat engedélyezi **port1** és **port2**.</span><span class="sxs-lookup"><span data-stu-id="df230-260">**Policy**: Allow all bidirectional traffic between **port1** and **port2**.</span></span>

### <a name="azf2"></a><span data-ttu-id="df230-261">AZF2</span><span class="sxs-lookup"><span data-stu-id="df230-261">AZF2</span></span>
<span data-ttu-id="df230-262">AZF2 tartalmazó szabályainak hello Azure virtuális készülék jelöli:</span><span class="sxs-lookup"><span data-stu-id="df230-262">AZF2 represents an Azure virtual appliance containing hello following rules:</span></span>

* <span data-ttu-id="df230-263">**Útvonal**: minden forgalomnak too10.0.0.0/16 (**onpremvnet**) el kell küldeni toohello Azure átjáró IP-címe (például 10.0.0.1) keresztül **port1**.</span><span class="sxs-lookup"><span data-stu-id="df230-263">**Route**: All traffic too10.0.0.0/16 (**onpremvnet**) must be sent toohello Azure gateway IP address (i.e. 10.0.0.1) through **port1**.</span></span>
* <span data-ttu-id="df230-264">**Házirend**: közötti összes kétirányú forgalmat engedélyezi **port1** és **port2**.</span><span class="sxs-lookup"><span data-stu-id="df230-264">**Policy**: Allow all bidirectional traffic between **port1** and **port2**.</span></span>

## <a name="network-security-groups-nsgs"></a><span data-ttu-id="df230-265">Hálózati biztonsági csoportokkal (NSG-k)</span><span class="sxs-lookup"><span data-stu-id="df230-265">Network Security Groups (NSGs)</span></span>
<span data-ttu-id="df230-266">Ebben a forgatókönyvben az NSG-k nincsenek használatban.</span><span class="sxs-lookup"><span data-stu-id="df230-266">In this scenario, NSGs are not being used.</span></span> <span data-ttu-id="df230-267">Azonban alkalmazhat az NSG-k tooeach toorestrict bejövő és kimenő forgalmat.</span><span class="sxs-lookup"><span data-stu-id="df230-267">However, you could apply NSGs tooeach subnet toorestrict incoming and outgoing traffic.</span></span> <span data-ttu-id="df230-268">Például alkalmazhat a következő NSG szabályok toohello külső FW alhálózati hello.</span><span class="sxs-lookup"><span data-stu-id="df230-268">For instance, you could apply hello following NSG rules toohello external FW subnet.</span></span>

<span data-ttu-id="df230-269">**Bejövő**</span><span class="sxs-lookup"><span data-stu-id="df230-269">**Incoming**</span></span>

* <span data-ttu-id="df230-270">Hello alhálózati hello Internet tooport 80 bármely virtuális gépen a TCP-forgalom engedélyezése.</span><span class="sxs-lookup"><span data-stu-id="df230-270">Allow all TCP traffic from hello Internet tooport 80 on any VM in hello subnet.</span></span>
* <span data-ttu-id="df230-271">Hello Internet megtagadása az összes többi forgalom.</span><span class="sxs-lookup"><span data-stu-id="df230-271">Deny all other traffic from hello Internet.</span></span>

<span data-ttu-id="df230-272">**Kimenő**</span><span class="sxs-lookup"><span data-stu-id="df230-272">**Outgoing**</span></span>

* <span data-ttu-id="df230-273">Az összes forgalom toohello Internet megtagadja.</span><span class="sxs-lookup"><span data-stu-id="df230-273">Deny all traffic toohello Internet.</span></span>

## <a name="high-level-steps"></a><span data-ttu-id="df230-274">Magas szintű lépései</span><span class="sxs-lookup"><span data-stu-id="df230-274">High level steps</span></span>
<span data-ttu-id="df230-275">toodeploy ebben az esetben kövesse hello magas szintű lépéseket.</span><span class="sxs-lookup"><span data-stu-id="df230-275">toodeploy this scenario, follow hello high level steps below.</span></span>

1. <span data-ttu-id="df230-276">Bejelentkezési tooyour Azure-előfizetést.</span><span class="sxs-lookup"><span data-stu-id="df230-276">Login tooyour Azure Subscription.</span></span>
2. <span data-ttu-id="df230-277">Ha azt szeretné, hogy a virtuális hálózat toomimic hello toodeploy a helyszíni hálózat, kiépítése hello erőforrások részét képező **ONPREMRG**.</span><span class="sxs-lookup"><span data-stu-id="df230-277">If you want toodeploy a VNet toomimic hello on-premises network, provision hello resources that are part of **ONPREMRG**.</span></span>
3. <span data-ttu-id="df230-278">Hello erőforrások részét képező biztosításához **AZURERG**.</span><span class="sxs-lookup"><span data-stu-id="df230-278">Provision hello resources that are part of **AZURERG**.</span></span>
4. <span data-ttu-id="df230-279">Kiépítés hello alagút a **onpremvnet** túl**azurevnet**.</span><span class="sxs-lookup"><span data-stu-id="df230-279">Provision hello tunnel from **onpremvnet** too**azurevnet**.</span></span>
5. <span data-ttu-id="df230-280">Amennyiben az összes erőforrás törlődnek, jelentkezzen be túl**onpremvm2** ping 10.0.3.101 tootest közötti kapcsolatot, **onpremsn2** és **azsn3**.</span><span class="sxs-lookup"><span data-stu-id="df230-280">Once all resources are provisioned, log on too**onpremvm2** and ping 10.0.3.101 tootest connectivity between **onpremsn2** and **azsn3**.</span></span>

