---
title: "A felhőalapú szolgáltatás életciklus-események kezelésére |} Microsoft Docs"
description: "Ismerje meg, hogyan életciklusának egy felhőalapú szolgáltatás szerepkör is használható a .NET"
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: eb78c05df3b3cdf3887334c11bdabd5cebb74747
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 08/03/2017
---
# <a name="customize-the-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="30288-103">Webes és feldolgozói szerepkörök életciklusának testreszabása a .NET-ben</span><span class="sxs-lookup"><span data-stu-id="30288-103">Customize the Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="30288-104">A feldolgozói szerepkör létrehozásakor kiterjeszti a [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) osztály, amely felülbírálhatja használatos metódusok biztosítása, amelyek lehetővé teszik az életciklus-események válaszolni.</span><span class="sxs-lookup"><span data-stu-id="30288-104">When you create a worker role, you extend the [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you to override that let you respond to lifecycle events.</span></span> <span data-ttu-id="30288-105">A webes szerepkörök Ez az osztály nem kötelező, így életciklus-események válaszolni kell használni.</span><span class="sxs-lookup"><span data-stu-id="30288-105">For web roles this class is optional, so you must use it to respond to lifecycle events.</span></span>

## <a name="extend-the-roleentrypoint-class"></a><span data-ttu-id="30288-106">A RoleEntryPoint osztály</span><span class="sxs-lookup"><span data-stu-id="30288-106">Extend the RoleEntryPoint class</span></span>
<span data-ttu-id="30288-107">A [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) osztály tartalmazza a módszereket, amelyek az Azure által meghívott amikor azt **elindul**, **fut**, vagy **leállítja** egy webes vagy feldolgozói szerepkörrel.</span><span class="sxs-lookup"><span data-stu-id="30288-107">The [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="30288-108">Ezek a módszerek inicializálási szerepkör, szerepkör leállítási sorozatok vagy a végrehajtási szál a szerepkör felügyeletéhez szükség felülbírálható.</span><span class="sxs-lookup"><span data-stu-id="30288-108">You can optionally override these methods to manage role initialization, role shutdown sequences, or the execution thread of the role.</span></span> 

<span data-ttu-id="30288-109">Amikor bővíti **RoleEntryPoint**, érdemes figyelembe az alábbi viselkedésmódok módszerek:</span><span class="sxs-lookup"><span data-stu-id="30288-109">When extending **RoleEntryPoint**, you should be aware of the following behaviors of the methods:</span></span>

* <span data-ttu-id="30288-110">A [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) és [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) módszerek egy logikai értéket adja vissza, így a visszaadandó **hamis** az ezen módszerek.</span><span class="sxs-lookup"><span data-stu-id="30288-110">The [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible to return **false** from these methods.</span></span>
  
   <span data-ttu-id="30288-111">Ha a kódot adja vissza **hamis**, a szerepkör-folyamat váratlanul megszakadt, bármely leállítási folyamat futtatása nélkül előfordulhat, hogy teljesülnek.</span><span class="sxs-lookup"><span data-stu-id="30288-111">If your code returns **false**, the role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="30288-112">Általában kerülendő visszaadó **hamis** a a **OnStart** metódust.</span><span class="sxs-lookup"><span data-stu-id="30288-112">In general, you should avoid returning **false** from the **OnStart** method.</span></span>
* <span data-ttu-id="30288-113">A nem kezelt kivétel belül egy túlterhelése egy **RoleEntryPoint** metódus nem kezelt kivételt a rendszer.</span><span class="sxs-lookup"><span data-stu-id="30288-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="30288-114">Kivétel az életciklus módszerek belül előfordul, ha az Azure emeli az [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) esemény, és a folyamat megszakadt.</span><span class="sxs-lookup"><span data-stu-id="30288-114">If an exception occurs within one of the lifecycle methods, Azure will raise the [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then the process is terminated.</span></span> <span data-ttu-id="30288-115">A szerepkör offline állapotban van, után újraindul az Azure-ban.</span><span class="sxs-lookup"><span data-stu-id="30288-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="30288-116">Ha nem kezelt kivétel lép, a [leállítása](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) nem egy esemény jelenik meg, és a **OnStop** metódus nem lett meghívva.</span><span class="sxs-lookup"><span data-stu-id="30288-116">When an unhandled exception occurs, the [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and the **OnStop** method is not called.</span></span>

<span data-ttu-id="30288-117">Ha a szerepkör nem indul el, vagy az újrahasznosítás inicializálása, foglalt, és leállításával állapotok között, akkor a kód kiváltása az életciklus-események minden alkalommal, amikor a szerepkör újraindul egy nem kezelt kivétel.</span><span class="sxs-lookup"><span data-stu-id="30288-117">If your role does not start, or is recycling between the initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of the lifecycle events each time the role restarts.</span></span> <span data-ttu-id="30288-118">Ebben az esetben használja a [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) esemény a kivétel a hiba okának megállapításához, és megfelelően kezelje.</span><span class="sxs-lookup"><span data-stu-id="30288-118">In this case, use the [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event to determine the cause of the exception and handle it appropriately.</span></span> <span data-ttu-id="30288-119">A szerepkör is visszatérése a [futtatása](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) metódus, amely azt eredményezi, indítsa újra a szerepkört.</span><span class="sxs-lookup"><span data-stu-id="30288-119">Your role may also be returning from the [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes the role to restart.</span></span> <span data-ttu-id="30288-120">További információ a központi telepítési állapotok: [gyakori problémák amely ok szerepkörök újrahasznosítását](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="30288-120">For more information about deployment states, see [Common Issues Which Cause Roles to Recycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="30288-121">Ha használja a **Azure eszközök a Microsoft Visual Studio** fejlesztéséhez az alkalmazást, a szerepkör projekt sablonok automatikus kiterjesztése a **RoleEntryPoint** osztályt, a  *WebRole.cs* és *WorkerRole.cs* fájlokat.</span><span class="sxs-lookup"><span data-stu-id="30288-121">If you are using the **Azure Tools for Microsoft Visual Studio** to develop your application, the role project templates automatically extend the **RoleEntryPoint** class for you, in the *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="30288-122">OnStart metódus</span><span class="sxs-lookup"><span data-stu-id="30288-122">OnStart method</span></span>
<span data-ttu-id="30288-123">A **OnStart** metódus lehívásra kerül, amikor a szerepkör példánya online állapotba az Azure-ban.</span><span class="sxs-lookup"><span data-stu-id="30288-123">The **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="30288-124">A OnStart kód végrehajtása folyik, amíg a szerepkör példánya van megjelölve, **foglalt** és külső forgalmat a rendszer kéri, a terheléselosztó által.</span><span class="sxs-lookup"><span data-stu-id="30288-124">While the OnStart code is executing, the role instance is marked as **Busy** and no external traffic will be directed to it by the load balancer.</span></span> <span data-ttu-id="30288-125">Ez a metódus inicializálási feladatok, például a végrehajtási eseménykezelők és elindítása végrehajtására felülbírálhatja [Azure Diagnostics](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="30288-125">You can override this method to perform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="30288-126">Ha **OnStart** adja vissza **igaz**, a példány sikeresen inicializálva, és Azure meghívja a **RoleEntryPoint.Run** metódust.</span><span class="sxs-lookup"><span data-stu-id="30288-126">If **OnStart** returns **true**, the instance is successfully initialized and Azure calls the **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="30288-127">Ha **OnStart** adja vissza **hamis**, a szerepkör leállítása azonnal, minden tervezett leállás sorozatok végrehajtása nélkül.</span><span class="sxs-lookup"><span data-stu-id="30288-127">If **OnStart** returns **false**, the role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="30288-128">Az alábbi példakód bemutatja, hogyan bírálja felül a **OnStart** metódust.</span><span class="sxs-lookup"><span data-stu-id="30288-128">The following code example shows how to override the **OnStart** method.</span></span> <span data-ttu-id="30288-129">Ez a módszer konfigurálja, és egy diagnosztikai figyelő akkor kezdődik, amikor a szerepkör példánya elindul, és beállítja a naplózási adatok átvitele a storage-fiókok:</span><span class="sxs-lookup"><span data-stu-id="30288-129">This method configures and starts a diagnostic monitor when the role instance starts and sets up a transfer of logging data to a storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="30288-130">OnStop módszer</span><span class="sxs-lookup"><span data-stu-id="30288-130">OnStop method</span></span>
<span data-ttu-id="30288-131">A **OnStop** módszer neve után a szerepkörpéldány offline állapotban van az Azure-ban, és a folyamat kilép, mielőtt.</span><span class="sxs-lookup"><span data-stu-id="30288-131">The **OnStop** method is called after a role instance has been taken offline by Azure and before the process exits.</span></span> <span data-ttu-id="30288-132">Ha szeretné felülbírálni az ezt a metódust a szerepkörpéldányon bezárva, a szükséges kód hívása.</span><span class="sxs-lookup"><span data-stu-id="30288-132">You can override this method to call code required for your role instance to cleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="30288-133">Futó kód a **OnStop** metódusnak egy korlátozott ideig ennek oka nem egy felhasználó által kezdeményezett leállítást meghívásakor.</span><span class="sxs-lookup"><span data-stu-id="30288-133">Code running in the **OnStop** method has a limited time to finish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="30288-134">Ezen idő eltelte után a folyamat megszakadt, ezért meg kell győződnie arról, hogy a kód a **OnStop** metódus eltűr befejezéséig nem fut, vagy gyorsan futtathatók.</span><span class="sxs-lookup"><span data-stu-id="30288-134">After this time elapses, the process is terminated, so you must make sure that code in the **OnStop** method can run quickly or tolerates not running to completion.</span></span> <span data-ttu-id="30288-135">A **OnStop** módszer neve után a **leállítása** egy esemény jelenik meg.</span><span class="sxs-lookup"><span data-stu-id="30288-135">The **OnStop** method is called after the **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="30288-136">Run metódus</span><span class="sxs-lookup"><span data-stu-id="30288-136">Run method</span></span>
<span data-ttu-id="30288-137">Felülírhatja a **futtatása** módszer a hosszan futó szál a szerepkörpéldányhoz végrehajtásához.</span><span class="sxs-lookup"><span data-stu-id="30288-137">You can override the **Run** method to implement a long-running thread for your role instance.</span></span>

<span data-ttu-id="30288-138">Felülbírálja a **futtatása** metódus nincs szükség; az alapértelmezett implementációja elindítja a szál, amelyek örökre alvó állapotban van.</span><span class="sxs-lookup"><span data-stu-id="30288-138">Overriding the **Run** method is not required; the default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="30288-139">Ha felülírják a **futtatása** metódus, a kódot kell blokkolása határozatlan ideig.</span><span class="sxs-lookup"><span data-stu-id="30288-139">If you do override the **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="30288-140">Ha a **futtatása** metódus ad vissza, a szerepkör automatikusan szabályosan újrahasznosított; más szóval Azure kiváltja a **leállítása** esemény és hívások a **OnStop** metódust, hogy a Leállítás sorozatok is végrehajtható, előtt a szerepkört offline állapotba kerül.</span><span class="sxs-lookup"><span data-stu-id="30288-140">If the **Run** method returns, the role is automatically gracefully recycled; in other words, Azure raises the **Stopping** event and calls the **OnStop** method so that your shutdown sequences may be executed before the role is taken offline.</span></span>

### <a name="implementing-the-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="30288-141">Az ASP.NET életciklus módszerek a webes szerepkör megvalósítása</span><span class="sxs-lookup"><span data-stu-id="30288-141">Implementing the ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="30288-142">Az ASP.NET életciklus módszerekkel által biztosított naplókon felül léteznek a **RoleEntryPoint** osztály egy webes szerepkör inicializálási és leállítási feladatütemezések kezelése.</span><span class="sxs-lookup"><span data-stu-id="30288-142">You can use the ASP.NET lifecycle methods, in addition to those provided by the **RoleEntryPoint** class, to manage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="30288-143">Ez kompatibilitási célokra hasznos lehet, ha meg vannak eljárás egy létező ASP.NET-alkalmazás az Azure-bA.</span><span class="sxs-lookup"><span data-stu-id="30288-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application to Azure.</span></span> <span data-ttu-id="30288-144">Az ASP.NET életciklus módszerek nevezzük belül a **RoleEntryPoint** módszerek.</span><span class="sxs-lookup"><span data-stu-id="30288-144">The ASP.NET lifecycle methods are called from within the **RoleEntryPoint** methods.</span></span> <span data-ttu-id="30288-145">A **alkalmazás\_Start** módszer neve után a **RoleEntryPoint.OnStart** metódus befejeződik.</span><span class="sxs-lookup"><span data-stu-id="30288-145">The **Application\_Start** method is called after the **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="30288-146">A **alkalmazás\_End** módszer neve előtt a **RoleEntryPoint.OnStop** metódust.</span><span class="sxs-lookup"><span data-stu-id="30288-146">The **Application\_End** method is called before the **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="30288-147">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="30288-147">Next steps</span></span>
<span data-ttu-id="30288-148">Megtudhatja, hogyan [cloud service-csomag létrehozása](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="30288-148">Learn how to [create a cloud service package](cloud-services-model-and-package.md).</span></span>

