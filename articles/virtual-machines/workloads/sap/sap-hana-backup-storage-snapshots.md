---
title: "A storage-pillanatfelvételekkel alapján SAP HANA Azure biztonsági mentés |} Microsoft Docs"
description: "Két fő biztonsági mentési lehetőség SAP Hana az Azure virtuális gépeken, ez a cikk ismerteti a storage-pillanatfelvételekkel alapján SAP HANA biztonsági mentése"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: f332b8ac091b75a23489ac27f15ad1fd10d24ec6
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 08/18/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="e93af-103">Tárolási pillanatképeken alapuló biztonsági mentés SAP HANA-hoz</span><span class="sxs-lookup"><span data-stu-id="e93af-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="e93af-104">Bevezetés</span><span class="sxs-lookup"><span data-stu-id="e93af-104">Introduction</span></span>

<span data-ttu-id="e93af-105">Ez egy SAP HANA biztonsági másolaton kapcsolódó cikkek háromrészes sorozatát része.</span><span class="sxs-lookup"><span data-stu-id="e93af-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="e93af-106">[Biztonsági mentési útmutató SAP Hana Azure virtuális gépeken](sap-hana-backup-guide.md) áttekintése és információkat nyújt a kezdeti lépések, és [SAP HANA Azure biztonsági mentési fájl szinten](sap-hana-backup-file-level.md) tartalmazza a fájl alapú biztonsági mentési beállítás.</span><span class="sxs-lookup"><span data-stu-id="e93af-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers the file-based backup option.</span></span>

<span data-ttu-id="e93af-107">Egypéldányos mindent egy bemutató rendszer esetén egy virtuális gép biztonsági mentési funkció használata esetén egy vegye figyelembe ennek során a virtuális gép biztonsági mentése HANA biztonsági mentés az operációs rendszer szintjén kezelése helyett.</span><span class="sxs-lookup"><span data-stu-id="e93af-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at the OS level.</span></span> <span data-ttu-id="e93af-108">A másik lehetőség az egyes virtuális lemezek, a virtuális gép csatlakozik, másolatait létrehozása az Azure blob pillanatképek és a HANA adatfájlok.</span><span class="sxs-lookup"><span data-stu-id="e93af-108">An alternative is to take Azure blob snapshots to create copies of individual virtual disks, which are attached to a virtual machine, and keep the HANA data files.</span></span> <span data-ttu-id="e93af-109">De a kritikus pont app konzisztencia, amikor egy virtuális gép biztonsági mentési vagy a lemez pillanatkép létrehozásához, miközben a rendszer működik-e és fut.</span><span class="sxs-lookup"><span data-stu-id="e93af-109">But a critical point is app consistency when creating a VM backup or disk snapshot while the system is up and running.</span></span> <span data-ttu-id="e93af-110">Lásd: _SAP HANA adatkonzisztencia véve a storage-pillanatfelvételekkel_ a kapcsolódó cikkben [biztonsági útmutató SAP Hana Azure virtuális gépeken](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="e93af-110">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="e93af-111">SAP HANA rendelkezik egy szolgáltatás, amely támogatja az ilyen típusú storage-pillanatfelvételekkel.</span><span class="sxs-lookup"><span data-stu-id="e93af-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="e93af-112">SAP HANA-pillanatképek</span><span class="sxs-lookup"><span data-stu-id="e93af-112">SAP HANA snapshots</span></span>

<span data-ttu-id="e93af-113">Egy szolgáltatás található SAP HANA, amely támogatja a tárolási pillanatkép létrehozása van folyamatban.</span><span class="sxs-lookup"><span data-stu-id="e93af-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="e93af-114">Azonban 2016. December, nincs korlátozás single-tároló rendszereken.</span><span class="sxs-lookup"><span data-stu-id="e93af-114">However, as of December 2016, there is a restriction to single-container systems.</span></span> <span data-ttu-id="e93af-115">Több-bérlős tároló konfigurációk nem támogatják ilyen típusú adatbázis-pillanatkép (lásd: [(SAP HANA Studio) tárolási pillanatkép létrehozása](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="e93af-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="e93af-116">Azt a következőképpen működik:</span><span class="sxs-lookup"><span data-stu-id="e93af-116">It works as follows:</span></span>

- <span data-ttu-id="e93af-117">Az SAP HANA-pillanatkép kezdeményezése készíti elő tárolási pillanatkép</span><span class="sxs-lookup"><span data-stu-id="e93af-117">Prepare for a storage snapshot by initiating the SAP HANA snapshot</span></span>
- <span data-ttu-id="e93af-118">Futtassa a tárolási pillanatkép (az Azure blob pillanatkép, például)</span><span class="sxs-lookup"><span data-stu-id="e93af-118">Run the storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="e93af-119">Erősítse meg a SAP HANA-pillanatkép</span><span class="sxs-lookup"><span data-stu-id="e93af-119">Confirm the SAP HANA snapshot</span></span>

![Ezen a képernyőfelvételen látható, hogy egy SAP HANA-adatok pillanatképének elkészítéséhez SQL-utasítás használatával hozhatók létre](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="e93af-121">Ezen a képernyőfelvételen látható jeleníti meg, hogy egy SAP HANA-adatok pillanatképének elkészítéséhez SQL-utasítás használatával hozhatók létre.</span><span class="sxs-lookup"><span data-stu-id="e93af-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![A pillanatkép majd is megjelennek a biztonsági mentési katalógusban SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="e93af-123">A pillanatkép majd is megjelenik a biztonságimásolat-katalógus SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="e93af-123">The snapshot then also appears in the backup catalog in SAP HANA Studio.</span></span>

![A lemezen a pillanatkép megjelennek az SAP HANA-adatainak könyvtára](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="e93af-125">A lemezen a pillanatkép megjelennek a SAP HANA adatkönyvtárat.</span><span class="sxs-lookup"><span data-stu-id="e93af-125">On disk, the snapshot shows up in the SAP HANA data directory.</span></span>

<span data-ttu-id="e93af-126">Egy rendelkezik győződjön meg arról, hogy a fájlrendszer-konzisztenciával is garantáltan előtt, a tárolási pillanatkép, miközben SAP HANA a pillanatkép elkészítése módban van.</span><span class="sxs-lookup"><span data-stu-id="e93af-126">One has to ensure that the file system consistency is also guaranteed before running the storage snapshot while SAP HANA is in the snapshot preparation mode.</span></span> <span data-ttu-id="e93af-127">Lásd: _SAP HANA adatkonzisztencia véve a storage-pillanatfelvételekkel_ a kapcsolódó cikkben [biztonsági útmutató SAP Hana Azure virtuális gépeken](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="e93af-127">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="e93af-128">Ha végzett a tárolási pillanatkép, fontos, a SAP HANA-pillanatkép megerősítéséhez.</span><span class="sxs-lookup"><span data-stu-id="e93af-128">Once the storage snapshot is done, it is critical to confirm the SAP HANA snapshot.</span></span> <span data-ttu-id="e93af-129">Nincs a megfelelő SQL-utasítás futtatása: biztonsági MENTÉSI adatok Bezárás PILLANATKÉP (lásd: [biztonsági MENTÉSI adatok Bezárás SNAPSHOT utasítás (biztonsági mentés és helyreállítás)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="e93af-129">There is a corresponding SQL statement to run: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e93af-130">Erősítse meg a HANA pillanatkép.</span><span class="sxs-lookup"><span data-stu-id="e93af-130">Confirm the HANA snapshot.</span></span> <span data-ttu-id="e93af-131">Miatt &quot;másolási módosításkor,&quot; SAP HANA előfordulhat, hogy további lemezterületet a pillanatkép-előkészítése módot, és nincs lehetőség, hogy új biztonsági mentést elindítani, amíg a rendszer meggyőződött róla, a SAP HANA-pillanatkép.</span><span class="sxs-lookup"><span data-stu-id="e93af-131">Due to &quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible to start new backups until the SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="e93af-132">HANA virtuális gép biztonsági mentése Azure Backup szolgáltatáson keresztül</span><span class="sxs-lookup"><span data-stu-id="e93af-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="e93af-133">Az Azure biztonsági mentési szolgáltatás biztonsági mentési ügynök nincs Linux virtuális gépekhez elérhető 2016. December.</span><span class="sxs-lookup"><span data-stu-id="e93af-133">As of December 2016, the backup agent of the Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="e93af-134">Hogy a fájl vagy könyvtár szinten Azure biztonsági mentés, az egyik akkor másolja a SAP HANA biztonságimásolat-fájlt egy Windows virtuális gépre, majd a biztonságimásolat-készítő ügynök.</span><span class="sxs-lookup"><span data-stu-id="e93af-134">To make use of Azure backup on the file/directory level, one would copy SAP HANA backup files to a Windows VM and then use the backup agent.</span></span> <span data-ttu-id="e93af-135">Ellenkező esetben csak a teljes Linux virtuális gép biztonsági mentés az Azure Backup szolgáltatáson keresztül lehetséges.</span><span class="sxs-lookup"><span data-stu-id="e93af-135">Otherwise, only a full Linux VM backup is possible via the Azure Backup service.</span></span> <span data-ttu-id="e93af-136">Lásd: [Azure Backup funkcióinak áttekintése](../../../backup/backup-introduction-to-azure-backup.md) további.</span><span class="sxs-lookup"><span data-stu-id="e93af-136">See [Overview of the features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) to find out more.</span></span>

<span data-ttu-id="e93af-137">Az Azure Backup szolgáltatás biztonsági mentése és visszaállítása egy virtuális Gépet egy lehetőséget is kínál.</span><span class="sxs-lookup"><span data-stu-id="e93af-137">The Azure Backup service offers an option to back up and restore a VM.</span></span> <span data-ttu-id="e93af-138">Ezt a szolgáltatást, és annak működéséről további információt a cikkben található [tervezze meg a virtuális gép biztonsági mentési infrastruktúra az Azure-ban](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="e93af-138">More information about this service and how it works can be found in the article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="e93af-139">Nincsenek megfelelően, ha a cikkben két fontos szempontokat:</span><span class="sxs-lookup"><span data-stu-id="e93af-139">There are two important considerations according to that article:</span></span>

<span data-ttu-id="e93af-140">_&quot;Linux virtuális gépek esetében csak a fájlkonzisztens biztonsági mentések is előfordulhatnak, Linux nem tartozik egy egyenértékű platform VSS&quot;_</span><span class="sxs-lookup"><span data-stu-id="e93af-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform to VSS.&quot;_</span></span>

<span data-ttu-id="e93af-141">_&quot;Alkalmazások kell megvalósítani a saját &quot;javítása&quot; mechanizmus a helyreállított adatokra.&quot;_</span><span class="sxs-lookup"><span data-stu-id="e93af-141">_&quot;Applications need to implement their own &quot;fix-up&quot; mechanism on the restored data.&quot;_</span></span>

<span data-ttu-id="e93af-142">Ezért egy is ellenőrizze, hogy SAP HANA lemezen konzisztens állapotban van, amikor a biztonsági mentés elindul.</span><span class="sxs-lookup"><span data-stu-id="e93af-142">Therefore, one has to make sure SAP HANA is in a consistent state on disk when the backup starts.</span></span> <span data-ttu-id="e93af-143">Lásd: _SAP HANA-pillanatképek_ a dokumentum a korábban ismertetett.</span><span class="sxs-lookup"><span data-stu-id="e93af-143">See _SAP HANA snapshots_ described earlier in the document.</span></span> <span data-ttu-id="e93af-144">De van egy potenciális problémát, ha a SAP HANA marad a pillanatkép-előkészítés módja.</span><span class="sxs-lookup"><span data-stu-id="e93af-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="e93af-145">Lásd: [(SAP HANA Studio) tárolási pillanatkép létrehozása](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) további információt.</span><span class="sxs-lookup"><span data-stu-id="e93af-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="e93af-146">Jelzi, hogy a cikk:</span><span class="sxs-lookup"><span data-stu-id="e93af-146">That article states:</span></span>

<span data-ttu-id="e93af-147">_&quot;Erősítse meg, vagy tárolási pillanatkép minél hamarabb abandon a létrehozásukat követően erősen ajánlott. A tárolási pillanatkép közben előkészítve, vagy létrehozott, a pillanatkép-vonatkozó adatokat zárolva van. A pillanatkép-vonatkozó adatokat zárolt állapotban marad, amíg még módosíthatók az adatbázisban. Ezek a változások nem okoz módosítani a rögzített pillanatkép-vonatkozó adatokat. Ehelyett a módosításokat pozíciók az adatterületen, amelyek külön, a tárolási pillanatképből írja. Módosításokat is írja a naplót. Azonban minél hosszabb a pillanatkép-vonatkozó adatokat tartják zárolt, annál adatmennyiség növelhető.&quot;_</span><span class="sxs-lookup"><span data-stu-id="e93af-147">_&quot;It is strongly recommended to confirm or abandon a storage snapshot as soon as possible after it has been created. While the storage snapshot is being prepared or created, the snapshot-relevant data is frozen. While the snapshot-relevant data remains frozen, changes can still be made in the database. Such changes will not cause the frozen snapshot-relevant data to be changed. Instead, the changes are written to positions in the data area that are separate from the storage snapshot. Changes are also written to the log. However, the longer the snapshot-relevant data is kept frozen, the more the data volume can grow.&quot;_</span></span>

<span data-ttu-id="e93af-148">Az Azure Backup gondoskodik a fájlrendszer-konzisztenciával Azure Virtuálisgép-bővítmények keresztül.</span><span class="sxs-lookup"><span data-stu-id="e93af-148">Azure Backup takes care of the file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="e93af-149">Ezek a bővítmények nem érhető el önálló, és csak az Azure Backup szolgáltatás együtt működik.</span><span class="sxs-lookup"><span data-stu-id="e93af-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="e93af-150">Ettől függetlenül is továbbra is kezelheti egy alkalmazás konzisztencia biztosításához SAP HANA-pillanatkép követelmény.</span><span class="sxs-lookup"><span data-stu-id="e93af-150">Nevertheless, it is still a requirement to manage an SAP HANA snapshot to guarantee app consistency.</span></span>

<span data-ttu-id="e93af-151">Azure biztonsági mentés két fő fázisa van:</span><span class="sxs-lookup"><span data-stu-id="e93af-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="e93af-152">Pillanatkép készítése</span><span class="sxs-lookup"><span data-stu-id="e93af-152">Take Snapshot</span></span>
- <span data-ttu-id="e93af-153">Átviteli adatokat tároló</span><span class="sxs-lookup"><span data-stu-id="e93af-153">Transfer data to vault</span></span>

<span data-ttu-id="e93af-154">Az SAP HANA-pillanatkép ezért az egyik megerősítené, amikor befejeződött a pillanatkép létrehozása van folyamatban az Azure Backup szolgáltatás fázisában.</span><span class="sxs-lookup"><span data-stu-id="e93af-154">So one could confirm the SAP HANA snapshot once the Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="e93af-155">Tekintse meg az Azure portálon több percig is eltarthat.</span><span class="sxs-lookup"><span data-stu-id="e93af-155">It might take several minutes to see in the Azure portal.</span></span>

![Az ábrán látható, a biztonsági mentési feladat listáját az Azure Backup szolgáltatás része](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="e93af-157">Az ábrán látható, az Azure Backup szolgáltatás, amelynek használatával készítsen biztonsági másolatot a HANA tesztelése a virtuális gép biztonsági mentési feladat listája részét.</span><span class="sxs-lookup"><span data-stu-id="e93af-157">This figure shows part of the backup job list of an Azure Backup service, which was used to back up the HANA test VM.</span></span>

![A feladat részleteinek megjelenítéséhez kattintson a biztonsági mentési feladat, az Azure-portálon](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="e93af-159">A feladat részleteinek megjelenítéséhez kattintson a biztonsági mentési feladat, az Azure portálon.</span><span class="sxs-lookup"><span data-stu-id="e93af-159">To show the job details, click the backup job in the Azure portal.</span></span> <span data-ttu-id="e93af-160">Itt egy tekintheti meg a két fázisban történik.</span><span class="sxs-lookup"><span data-stu-id="e93af-160">Here, one can see the two phases.</span></span> <span data-ttu-id="e93af-161">Eltarthat néhány percig, amíg azt mutatja, hogy a pillanatkép fázis Befejezett állapotúvá válik.</span><span class="sxs-lookup"><span data-stu-id="e93af-161">It might take a few minutes until it shows the snapshot phase as completed.</span></span> <span data-ttu-id="e93af-162">Az esetek többségében az adatok átvitel fázis telik.</span><span class="sxs-lookup"><span data-stu-id="e93af-162">Most of the time is spent in the data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="e93af-163">Biztonsági mentési automation HANA VM Azure Backup szolgáltatáson keresztül</span><span class="sxs-lookup"><span data-stu-id="e93af-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="e93af-164">Az SAP HANA-pillanatkép manuálisan egy megerősítené, után az Azure biztonsági mentési pillanatkép fázis befejeződött, a fentebb leírt módon, de hasznos lehet automation fontolja meg, mert a rendszergazda nem lehet, hogy figyeli a biztonsági mentési feladat listáján, az Azure-portálon.</span><span class="sxs-lookup"><span data-stu-id="e93af-164">One could manually confirm the SAP HANA snapshot once the Azure Backup snapshot phase is completed, as described earlier, but it is helpful to consider automation because an admin might not monitor the backup job list in the Azure portal.</span></span>

<span data-ttu-id="e93af-165">Ez magyarázattal hogyan azt megvalósítható Azure PowerShell-parancsmagok használatával.</span><span class="sxs-lookup"><span data-stu-id="e93af-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Egy Azure Backup szolgáltatás létrejött hana-backup-tárolóban neve](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="e93af-167">Egy Azure Backup szolgáltatás létrejött nevű &quot;hana-backup-tárolóba.&quot; A PS parancs **Get-AzureRmRecoveryServicesVault-Name hana-backup-tárolóba** kéri le a megfelelő objektum.</span><span class="sxs-lookup"><span data-stu-id="e93af-167">An Azure Backup service was created with the name &quot;hana-backup-vault.&quot; The PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves the corresponding object.</span></span> <span data-ttu-id="e93af-168">Ez az objektum majd segítségével állítsa be a biztonsági környezet az alábbi ábrán látható módon.</span><span class="sxs-lookup"><span data-stu-id="e93af-168">This object is then used to set the backup context as seen on the next figure.</span></span>

![Egy ellenőrizheti a biztonsági mentési feladat jelenleg folyamatban van](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="e93af-170">Miután beállította a megfelelő környezetben, egy is ellenőrizze a biztonsági mentési feladat jelenleg folyamatban van, és keresse meg a feladat részleteit.</span><span class="sxs-lookup"><span data-stu-id="e93af-170">After setting the correct context, one can check for the backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="e93af-171">A részfeladatnál annak regisztrálása listán látható, ha a pillanatkép fázis az Azure biztonsági mentési feladat már kész:</span><span class="sxs-lookup"><span data-stu-id="e93af-171">The subtask list shows if the snapshot phase of the Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Kérdezze le a hurok található értékkel, amíg kész értékre változik](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="e93af-173">Ha a feladat részleteit egy változó tárolja, egyszerűen PS szintaxis első tömb bejegyzést, és az állapot értéke.</span><span class="sxs-lookup"><span data-stu-id="e93af-173">Once the job details are stored in a variable, it is simply PS syntax to get to the first array entry and retrieve the status value.</span></span> <span data-ttu-id="e93af-174">Az automatizálási parancsfájl befejezéséhez kérdezze le az ismétlődő értéket, amíg ez &quot;befejezve.&quot;</span><span class="sxs-lookup"><span data-stu-id="e93af-174">To complete the automation script, poll the value in a loop until it turns to &quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="e93af-175">HANA licenckulcs és a virtuális gép visszaállítása Azure Backup szolgáltatáson keresztül</span><span class="sxs-lookup"><span data-stu-id="e93af-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="e93af-176">Az Azure Backup szolgáltatás célja, hogy hozzon létre egy új virtuális Gépet a visszaállítás során.</span><span class="sxs-lookup"><span data-stu-id="e93af-176">The Azure Backup service is designed to create a new VM during restore.</span></span> <span data-ttu-id="e93af-177">Nincs a terv most tegye egy &quot;helyben&quot; egy meglévő Azure virtuális gép visszaállítását.</span><span class="sxs-lookup"><span data-stu-id="e93af-177">There is no plan right now to do an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Az ábrán látható, a helyreállítás az Azure szolgáltatás az Azure-portálon](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="e93af-179">Az ábrán látható, a helyreállítás az Azure szolgáltatás az Azure portálon.</span><span class="sxs-lookup"><span data-stu-id="e93af-179">This figure shows the restore option of the Azure service in the Azure portal.</span></span> <span data-ttu-id="e93af-180">Egyet választhat egy virtuális gép létrehozása a visszaállítás során vagy a lemezek visszaállítása.</span><span class="sxs-lookup"><span data-stu-id="e93af-180">One can choose between creating a VM during restore or restoring the disks.</span></span> <span data-ttu-id="e93af-181">A lemezek visszaállítása, után fontos továbbra is hozzon létre egy új virtuális Gépet utasítást.</span><span class="sxs-lookup"><span data-stu-id="e93af-181">After restoring the disks, it is still necessary to create a new VM on top of it.</span></span> <span data-ttu-id="e93af-182">Amikor új virtuális gép jön létre az Azure-on a egyedi változik-e a virtuális gép azonosítója (lásd: [elérése és használata Azure virtuális gép egyedi azonosítója](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="e93af-182">Whenever a new VM gets created on Azure the unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Az ábrán látható, az Azure virtuális gép egyedi Azonosítót előtt és után a visszaállítás Azure Backup szolgáltatáson keresztül](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="e93af-184">Az ábrán látható az Azure virtuális gép egyedi azonosítója, előtt és után a visszaállítás Azure Backup szolgáltatáson keresztül.</span><span class="sxs-lookup"><span data-stu-id="e93af-184">This figure shows the Azure VM unique ID before and after the restore via Azure Backup service.</span></span> <span data-ttu-id="e93af-185">Az SAP hardver kulcs, használja a licencelési SAP, használja a virtuális gép azonosítóját</span><span class="sxs-lookup"><span data-stu-id="e93af-185">The SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="e93af-186">Következésképpen új SAP licencet telepítve van a virtuális gépek visszaállítása után.</span><span class="sxs-lookup"><span data-stu-id="e93af-186">As a consequence, a new SAP license has to be installed after a VM restore.</span></span>

<span data-ttu-id="e93af-187">Ez az útmutató biztonsági másolat létrehozásakor egy új Azure biztonsági mentési szolgáltatás előzetes üzemmódban adtak meg.</span><span class="sxs-lookup"><span data-stu-id="e93af-187">A new Azure Backup feature was presented in preview mode during the creation of this backup guide.</span></span> <span data-ttu-id="e93af-188">Lehetővé teszi a virtuális gép pillanatkép készült a virtuális gép biztonsági mentési alapján szintű fájlvisszaállításra.</span><span class="sxs-lookup"><span data-stu-id="e93af-188">It allows a file level restore based on the VM snapshot that was taken for the VM backup.</span></span> <span data-ttu-id="e93af-189">Ezzel elkerülhető, hogy telepítse egy új virtuális Gépet, hogy szükség van, ezért a virtuális gép egyedi azonosítója ugyanaz marad, és nem új SAP HANA-licenc kulcsot meg kell adni.</span><span class="sxs-lookup"><span data-stu-id="e93af-189">This avoids the need to deploy a new VM, and therefore the unique VM ID stays the same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="e93af-190">Ez a szolgáltatás további dokumentációiért nyújtanak után lett teljes körűen tesztelve.</span><span class="sxs-lookup"><span data-stu-id="e93af-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="e93af-191">Azure biztonsági mentés lehetővé teszi a idővel biztonsági másolatot az egyes Azure virtuális lemezek és fájlok és könyvtárak innen: a virtuális Gépen belül.</span><span class="sxs-lookup"><span data-stu-id="e93af-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside the VM.</span></span> <span data-ttu-id="e93af-192">Egy Azure Backup fő előnye az összes biztonsági mentés, az ügyfél ne kelljen mentése kezelését.</span><span class="sxs-lookup"><span data-stu-id="e93af-192">A major advantage of Azure Backup is its management of all the backups, saving the customer from having to do it.</span></span> <span data-ttu-id="e93af-193">Ha a visszaállítás szükségessé válik, Azure biztonsági mentési fogják kiválasztani a helyes biztonsági másolat.</span><span class="sxs-lookup"><span data-stu-id="e93af-193">If a restore becomes necessary, Azure Backup will select the correct backup to use.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="e93af-194">SAP HANA virtuális gép biztonsági mentése a lemezek manuális pillanatkép keresztül</span><span class="sxs-lookup"><span data-stu-id="e93af-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="e93af-195">Az Azure Backup szolgáltatás helyett egy sikerült konfigurálása egy egyedi biztonsági mentési megoldás blob pillanatképeinek Azure virtuális merevlemezek manuálisan a PowerShell segítségével.</span><span class="sxs-lookup"><span data-stu-id="e93af-195">Instead of using the Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="e93af-196">Lásd: [blob pillanatképei Using PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) lépések leírását.</span><span class="sxs-lookup"><span data-stu-id="e93af-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of the steps.</span></span>

<span data-ttu-id="e93af-197">Nagyobb rugalmasságot nyújt, de nem oldja meg a problémákat a jelen dokumentum korábbi alapján:</span><span class="sxs-lookup"><span data-stu-id="e93af-197">It provides more flexibility but does not resolve the issues explained earlier in this document:</span></span>

- <span data-ttu-id="e93af-198">Egy továbbra is kell ügyeljen arra, hogy SAP HANA konzisztens állapotban</span><span class="sxs-lookup"><span data-stu-id="e93af-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="e93af-199">Az operációsrendszer-lemez nem írható felül, még akkor is, ha a virtuális gép felszabadítása figyelmezteti a felhasználókat arra, hogy létezik-e a címbérlet-hiba miatt.</span><span class="sxs-lookup"><span data-stu-id="e93af-199">The OS disk cannot be overwritten even if the VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="e93af-200">Ez csak akkor működik a virtuális Gépet, amelyek virtuális gép új egyedi azonosító és a telepítése egy új SAP-licenc szükséges törlését követően.</span><span class="sxs-lookup"><span data-stu-id="e93af-200">It only works after deleting the VM, which would lead to a new unique VM ID and the need to install a new SAP license.</span></span>

![Lehetséges, csak az Azure virtuális gép adatlemezek visszaállítása](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="e93af-202">Csak egy Azure virtuális Gépre, az első virtuális gép új egyedi azonosító a probléma elkerülése adatlemezek visszaállíthat, és ezért érvényteleníti az SAP-licenc:</span><span class="sxs-lookup"><span data-stu-id="e93af-202">It is possible to restore only the data disks of an Azure VM, avoiding the problem of getting a new unique VM ID and, therefore, invalidated the SAP license:</span></span>

- <span data-ttu-id="e93af-203">A teszteket két Azure adatlemezek volt a virtuális Géphez csatlakozik, és szoftveres RAID platformképességeivel lett definiálva</span><span class="sxs-lookup"><span data-stu-id="e93af-203">For the test, two Azure data disks were attached to a VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="e93af-204">Ez volt megerősítette, hogy SAP HANA konzisztens állapotban SAP HANA-pillanatkép szolgáltatás</span><span class="sxs-lookup"><span data-stu-id="e93af-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="e93af-205">Fájlrendszer rögzítése (lásd: _SAP HANA adatkonzisztencia véve a storage-pillanatfelvételekkel_ a kapcsolódó cikkben [biztonsági útmutató SAP Hana Azure virtuális gépeken](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="e93af-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="e93af-206">A BLOB pillanatképek vették mindkét adatlemezek</span><span class="sxs-lookup"><span data-stu-id="e93af-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="e93af-207">Fájlrendszer rögzítésének feloldása</span><span class="sxs-lookup"><span data-stu-id="e93af-207">File system unfreeze</span></span>
- <span data-ttu-id="e93af-208">SAP HANA-pillanatkép megerősítése</span><span class="sxs-lookup"><span data-stu-id="e93af-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="e93af-209">Az adatlemezek visszaállításához a virtuális gép le volt állítva, és mindkét lemez leválasztása</span><span class="sxs-lookup"><span data-stu-id="e93af-209">To restore the data disks, the VM was shut down and both disks detached</span></span>
- <span data-ttu-id="e93af-210">Leválasztása a lemezeket, miután azok felülírva a korábbi blob pillanatképekkel</span><span class="sxs-lookup"><span data-stu-id="e93af-210">After detaching the disks, they were overwritten with the former blob snapshots</span></span>
- <span data-ttu-id="e93af-211">Ezután a visszaállított virtuális lemezek volt újra a virtuális Géphez csatlakozik</span><span class="sxs-lookup"><span data-stu-id="e93af-211">Then the restored virtual disks were attached again to the VM</span></span>
- <span data-ttu-id="e93af-212">A virtuális gép elindítása, után minden, a szoftverfrissítési RAID működött, és vissza lett állítva a blob pillanatkép idő:</span><span class="sxs-lookup"><span data-stu-id="e93af-212">After starting the VM, everything on the software RAID worked fine and was set back to the blob snapshot time</span></span>
- <span data-ttu-id="e93af-213">HANA vissza lett-e állítva a HANA pillanatkép:</span><span class="sxs-lookup"><span data-stu-id="e93af-213">HANA was set back to the HANA snapshot</span></span>

<span data-ttu-id="e93af-214">Ha sikerült a blob pillanatképek előtt állítsa le a SAP HANA, az eljárás kevésbé összetett lesz.</span><span class="sxs-lookup"><span data-stu-id="e93af-214">If it was possible to shut down SAP HANA before the blob snapshots, the procedure would be less complex.</span></span> <span data-ttu-id="e93af-215">Ebben az esetben egy sikerült hagyja ki a HANA pillanatkép és, ha nincs más zajlik a rendszer is hagyhatja a fájl rendszer rögzíteni.</span><span class="sxs-lookup"><span data-stu-id="e93af-215">In that case, one could skip the HANA snapshot and, if nothing else is going on in the system, also skip the file system freeze.</span></span> <span data-ttu-id="e93af-216">A képbe hozzáadott összetettsége származik, közben minden online pillanatképek ehhez szükség esetén.</span><span class="sxs-lookup"><span data-stu-id="e93af-216">Added complexity comes into the picture when it is necessary to do snapshots while everything is online.</span></span> <span data-ttu-id="e93af-217">Lásd: _SAP HANA adatkonzisztencia véve a storage-pillanatfelvételekkel_ a kapcsolódó cikkben [biztonsági útmutató SAP Hana Azure virtuális gépeken](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="e93af-217">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e93af-218">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="e93af-218">Next steps</span></span>
* <span data-ttu-id="e93af-219">[Biztonsági mentési útmutató SAP Hana Azure virtuális gépeken](sap-hana-backup-guide.md) áttekintése és bevezető információkat biztosít.</span><span class="sxs-lookup"><span data-stu-id="e93af-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="e93af-220">[SAP HANA biztonsági másolat alapján fájlszintű](sap-hana-backup-file-level.md) tartalmazza a fájl alapú biztonsági mentési beállítás.</span><span class="sxs-lookup"><span data-stu-id="e93af-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers the file-based backup option.</span></span>
* <span data-ttu-id="e93af-221">Magas rendelkezésre állás és az Azure (nagy példány) az SAP HANA vész-helyreállítási terv létrehozásához, lásd: [SAP HANA (nagy példányok) magas rendelkezésre állási és vészhelyreállítási helyreállítási Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="e93af-221">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
