---
title: "aaaAdd figyelési & diagnosztikai tooan Azure virtuális gép |} Microsoft Docs"
description: "Egy Azure resource manager sablon toocreate egy új Windows rendszerű virtuális gép használja az Azure diagnostics-bővítménnyel."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="c72a6-103">Figyelés és diagnosztika használata egy Windows virtuális gép és az Azure Resource Manager sablonok</span><span class="sxs-lookup"><span data-stu-id="c72a6-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="c72a6-104">hello Azure Diagnostics bővítmény hello figyelést biztosít, és diagnosztikai képességek a Windows Azure virtuális gép alapján.</span><span class="sxs-lookup"><span data-stu-id="c72a6-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="c72a6-105">Hello hello azure resource manager-sablon része belefoglalja engedélyezheti ezeket a képességeket hello virtuális gépen.</span><span class="sxs-lookup"><span data-stu-id="c72a6-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="c72a6-106">Lásd: [Azure Resource Manager sablonok készítése a Virtuálisgép-bővítmények](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) további információ a virtuálisgép-sablon részeként bármely kiterjesztéssel együtt.</span><span class="sxs-lookup"><span data-stu-id="c72a6-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="c72a6-107">Ez a cikk azt ismerteti, hogyan adhat meg hello Azure Diagnostics bővítmény tooa windows virtuális gépre vonatkozó sablont.</span><span class="sxs-lookup"><span data-stu-id="c72a6-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="c72a6-108">Hello Azure Diagnostics bővítmény toohello VM erőforrás-definíció hozzáadása</span><span class="sxs-lookup"><span data-stu-id="c72a6-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="c72a6-109">tooenable hello diagnosztika kiterjesztése a Windows virtuális gépként kell tooadd hello bővítmény VM erőforrásként a Resource manager-sablon hello.</span><span class="sxs-lookup"><span data-stu-id="c72a6-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="c72a6-110">Az egyszerű erőforrás-kezelő alapú virtuális gép hozzáadása hello bővítmény konfigurációs toohello *erőforrások* tömbhöz a virtuális gép hello:</span><span class="sxs-lookup"><span data-stu-id="c72a6-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="c72a6-111">Egy másik közös egyezmény van hozzáadása hello bővítménykonfiguráció erőforrások gyökércsomópont hello hello sablon helyett definiáló hello virtuális gép erőforrások csomópont alatt.</span><span class="sxs-lookup"><span data-stu-id="c72a6-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="c72a6-112">Ezt a módszert használja az informatikai részleg a hierarchikus kapcsolat hello bővítmény és hello virtuális gép között meg hello tooexplicitly *neve* és *típus* értékeket.</span><span class="sxs-lookup"><span data-stu-id="c72a6-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="c72a6-113">Példa:</span><span class="sxs-lookup"><span data-stu-id="c72a6-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="c72a6-114">hello bővítmény mindig hello virtuális géphez kapcsolódó, lehetősége van közvetlenül közvetlenül meghatározása hello virtuális gép erőforrás csomópont alatt vagy adjon meg egy hello talál szinten, majd hello hierarchikus elnevezési egyezmény tooassociate használja a virtuális hello gép.</span><span class="sxs-lookup"><span data-stu-id="c72a6-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="c72a6-115">Virtuálisgép-méretezési csoportok hello bővítmények konfiguráció van megadva a hello *extensionProfile* hello tulajdonságának *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="c72a6-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="c72a6-116">Hello *publisher* hello értékű tulajdonság **Microsoft.Azure.Diagnostics** és hello *típus* hello értékű tulajdonság **IaaSDiagnostics** hello Azure Diagnostics bővítmény egyedi módon azonosítja.</span><span class="sxs-lookup"><span data-stu-id="c72a6-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="c72a6-117">hello értékének hello *neve* tulajdonság lehet használt toorefer toohello bővítmény hello erőforráscsoportban.</span><span class="sxs-lookup"><span data-stu-id="c72a6-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="c72a6-118">Beállítás kifejezetten túl**Microsoft.Insights.VMDiagnosticsSettings** engedélyezi azt toobe hello Azure portálon győződjön meg arról, amely figyelési diagramok belül megjelennek a megfelelő hello Azure-portálon hello alapján.</span><span class="sxs-lookup"><span data-stu-id="c72a6-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="c72a6-119">Hello *typeHandlerVersion* megadja hello verzióját hello bővítmény toouse szeretné.</span><span class="sxs-lookup"><span data-stu-id="c72a6-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="c72a6-120">Beállítás *autoUpgradeMinorVersion* alverziót túl**igaz** biztosítja, hogy elérhetővé válik a hello legújabb alverzió hello bővítmény érhető el.</span><span class="sxs-lookup"><span data-stu-id="c72a6-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="c72a6-121">Javasoljuk, hogy mindig állítsa *autoUpgradeMinorVersion* tooalways kell **igaz** úgy, hogy be mindig toouse hello legújabb érhető el diagnosztika bővítmény összes hello új szolgáltatásokkal és hiba javítások.</span><span class="sxs-lookup"><span data-stu-id="c72a6-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="c72a6-122">Hello *beállítások* elem hello bővítményt, amely beállítása és olvasni hello bővítmény (néha hivatkozott tooas nyilvános konfigurációs) konfigurációk tulajdonságait tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="c72a6-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="c72a6-123">Hello *xmlcfg* tulajdonsága tartalmazza XML-alapú konfigurációs hello diagnosztika naplókhoz, teljesítményszámlálók hello diagnosztikai ügynök által gyűjtendő stb.</span><span class="sxs-lookup"><span data-stu-id="c72a6-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="c72a6-124">Lásd: [diagnosztika konfigurációs séma](https://msdn.microsoft.com/library/azure/dn782207.aspx) hello XML-séma maga további információt.</span><span class="sxs-lookup"><span data-stu-id="c72a6-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="c72a6-125">A gyakori eljárás megegyezik toostore hello tényleges XML-konfiguráció egy változó hello Azure Resource Manager-sablon és majd ÖSSZEFŰZ és base64 kódolása őket tooset hello értéke *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="c72a6-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="c72a6-126">Hello című rész a [diagnosztika konfigurációs változók](#diagnostics-configuration-variables) toounderstand hogyan toostore hello változók xml többet.</span><span class="sxs-lookup"><span data-stu-id="c72a6-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="c72a6-127">Hello *storageAccount* tulajdonság határozza meg a hello tárolási fiók toowhich diagnosztikai adatok hello neve lesz áthelyezve.</span><span class="sxs-lookup"><span data-stu-id="c72a6-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="c72a6-128">a Tulajdonságok hello *protectedSettings* (néha hivatkozott tooas privát konfigurációjának) állítható be, de nem lehet olvasni a beállítása után vissza.</span><span class="sxs-lookup"><span data-stu-id="c72a6-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="c72a6-129">csak írható jellege hello *protectedSettings* teszi például hello tárfiók kulcsa titkos kulcsok tárolásának ahová hello diagnosztikai adatok kerülnek.</span><span class="sxs-lookup"><span data-stu-id="c72a6-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="c72a6-130">Diagnosztikai tárfiók paraméter megadása</span><span class="sxs-lookup"><span data-stu-id="c72a6-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="c72a6-131">hello diagnosztika bővítmény json részlet fenti azt feltételezi, hogy a két paraméter *existingdiagnosticsStorageAccountName* és *existingdiagnosticsStorageResourceGroup* toospecify hello diagnosztika diagnosztikai adatok tárolására szolgáló tárfiókot.</span><span class="sxs-lookup"><span data-stu-id="c72a6-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="c72a6-132">Adja meg a hello diagnosztikai tárfiók, egy paraméter segítségével könnyen toochange hello diagnosztikai tárfiók különböző környezetek között például érdemes lehet egy másik diagnosztikai tárfiók toouse a teszteléshez és egy másikat pedig az a éles környezet.</span><span class="sxs-lookup"><span data-stu-id="c72a6-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="c72a6-133">Bevált gyakorlat toospecify egy diagnosztikai tárfiók egy másik erőforráscsoportban található, mint hello erőforráscsoport hello virtuális gép.</span><span class="sxs-lookup"><span data-stu-id="c72a6-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="c72a6-134">Erőforráscsoport tekinthető toobe egy telepítési egység saját élettartamú, a virtuális gép telepítése és újratelepítése az új konfigurációt frissítések azt válnak, tooit, de azt szeretné, hogy hello diagnosztikai adatok tárolását hello toocontinue ugyanazt a tárfiókot különböző ezen virtuális gépek telepítéséhez.</span><span class="sxs-lookup"><span data-stu-id="c72a6-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="c72a6-135">Egy másik erőforráscsoportban lehetővé teszi, hogy hello tárolási tooaccept származó adatokat különböző virtuális gépek telepítéséhez, így könnyen tootroubleshoot hello tárfiók rendelkező problémák között hello különböző verzióit.</span><span class="sxs-lookup"><span data-stu-id="c72a6-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="c72a6-136">Ha egy windows virtuális gépre vonatkozó sablont hoz létre a Visual Studio eszközből hello alapértelmezett tárfiókot is be lehet állítani a toouse hello ugyanazt a tárfiókot, ahol hello virtuális gép virtuális Merevlemeze feltöltődött.</span><span class="sxs-lookup"><span data-stu-id="c72a6-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="c72a6-137">Ez a virtuális gép hello toosimplify kezdeti telepítése.</span><span class="sxs-lookup"><span data-stu-id="c72a6-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="c72a6-138">Újra kell figyelembe hello sablon toouse során eltérő tárfiók is lehet az átadott paraméterként.</span><span class="sxs-lookup"><span data-stu-id="c72a6-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="c72a6-139">Diagnosztikai konfiguráció változók</span><span class="sxs-lookup"><span data-stu-id="c72a6-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="c72a6-140">hello diagnosztika bővítmény json részlet fenti definiál egy *accountid* változó toosimplify első hello tárfiók kulcsa hello diagnosztika tárolására:</span><span class="sxs-lookup"><span data-stu-id="c72a6-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="c72a6-141">Hello *xmlcfg* hello diagnosztika bővítmény tulajdonság van definiálva, amelyek együtt halmaz zónanevének több változók használata.</span><span class="sxs-lookup"><span data-stu-id="c72a6-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="c72a6-142">hello ezek a változók értékei az XML-ben, escape-karaktersorozatot megfelelően hello json változók beállításakor toobe van szükségük.</span><span class="sxs-lookup"><span data-stu-id="c72a6-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="c72a6-143">hello következő szakasz ismerteti a hello diagnosztika konfigurációs XML-t, a standard szint rendszerteljesítmény-számlálók együtt egyes windows-Eseménynapló és a diagnosztika infrastruktúra naplókat gyűjt.</span><span class="sxs-lookup"><span data-stu-id="c72a6-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="c72a6-144">Lett escape-karakterrel megjelölve, és így hello konfigurációs közvetlenül beilleszthető hello változók szakaszban a sablon megfelelő formátumú.</span><span class="sxs-lookup"><span data-stu-id="c72a6-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="c72a6-145">Lásd: hello [diagnosztika konfigurációs séma](https://msdn.microsoft.com/library/azure/dn782207.aspx) hello konfigurációs XML-t több emberi olvasható példát.</span><span class="sxs-lookup"><span data-stu-id="c72a6-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="c72a6-146">hello metrikák definition XML-csomópont a fenti konfigurációs hello fontos konfigurációs elem, mint azt határozza meg, hogyan hello teljesítményszámlálókat meghatározott hello XML-t a korábbi *PerformanceCounter* csomópont összegzik és tárolja.</span><span class="sxs-lookup"><span data-stu-id="c72a6-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="c72a6-147">A metrikák meghajtó hello figyelési diagramok és a riasztásokat a hello Azure-portálon.</span><span class="sxs-lookup"><span data-stu-id="c72a6-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="c72a6-148">Hello **metrikák** hello csomópont *resourceID* és **MetricAggregation** hello diagnosztika a virtuális gép konfigurációja a kell szerepelnie, ha azt szeretné, hogy a virtuális gép toosee hello figyelési adatok hello Azure-portálon.</span><span class="sxs-lookup"><span data-stu-id="c72a6-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="c72a6-149">hello következő metrikák definíciók hello xml példája:</span><span class="sxs-lookup"><span data-stu-id="c72a6-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="c72a6-150">Hello *resourceID* attribútum egyedileg azonosítja a hello virtuális gépet az előfizetésben.</span><span class="sxs-lookup"><span data-stu-id="c72a6-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="c72a6-151">Győződjön meg arról, hogy toouse hello subscription() és resourceGroup() működik, hogy hello sablon automatikusan frissíti hello előfizetés és az erőforrás-csoport alapján telepíti ezeket az értékeket.</span><span class="sxs-lookup"><span data-stu-id="c72a6-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="c72a6-152">Ha ismétlődő több virtuális gépet hoz létre, akkor meg kell toopopulate hello *resourceID* értéket egy copyIndex() függvény toocorrectly különböztetni az egyes virtuális gépek.</span><span class="sxs-lookup"><span data-stu-id="c72a6-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="c72a6-153">Hello *xmlCfg* érték lehet frissített toosupport a következőképpen:</span><span class="sxs-lookup"><span data-stu-id="c72a6-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="c72a6-154">hello MetricAggregation értékének *PT1H* és *PT1M* összesítést egy perc alatt, és akár egy óráig összesítést jelölésére.</span><span class="sxs-lookup"><span data-stu-id="c72a6-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="c72a6-155">A tárolási WADMetrics táblák</span><span class="sxs-lookup"><span data-stu-id="c72a6-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="c72a6-156">a fenti hello metrikák konfigurációs az alábbi elnevezési konvenciókat hello eredményez a diagnosztikai tárfiók táblák:</span><span class="sxs-lookup"><span data-stu-id="c72a6-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="c72a6-157">**WADMetrics** : szabványos előtag WADMetrics táblák</span><span class="sxs-lookup"><span data-stu-id="c72a6-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="c72a6-158">**PT1H** vagy **PT1M** : azt jelzi, hogy hello táblát tartalmazza az összesített adatok több mint 1 óra vagy 1 perc</span><span class="sxs-lookup"><span data-stu-id="c72a6-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="c72a6-159">**P10D** : azt jelzi, hogy hello tábla fog adatokat tartalmazni bekapcsolásakor a adatgyűjtés hello tábla számított 10 napig</span><span class="sxs-lookup"><span data-stu-id="c72a6-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="c72a6-160">**V2S** : karakterlánc-konstansra</span><span class="sxs-lookup"><span data-stu-id="c72a6-160">**V2S** : String constant</span></span>
* <span data-ttu-id="c72a6-161">**ÉÉÉÉHHNN** : hello dátum mely hello tábla kezdésének adatok gyűjtése</span><span class="sxs-lookup"><span data-stu-id="c72a6-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="c72a6-162">Példa: *WADMetricsPT1HP10DV2S20151108* metrikai adatok indítása a 11-november-2015-10 napja egy óra alatt összesített értéket fogja tartalmazni.</span><span class="sxs-lookup"><span data-stu-id="c72a6-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="c72a6-163">Minden egyes WADMetrics tábla a következő oszlopok hello fogja tartalmazni:</span><span class="sxs-lookup"><span data-stu-id="c72a6-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="c72a6-164">**PartitionKey**: hello partitionkey összeállított hello alapján *resourceID* érték toouniquely hello VM erőforrás azonosítására.</span><span class="sxs-lookup"><span data-stu-id="c72a6-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="c72a6-165">a pl.: 002Fsubscriptions:<subscriptionID>: 002FresourceGroups:002F<ResourceGroupName>: 002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="c72a6-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="c72a6-166">**RowKey** : hello formátumot követi <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="c72a6-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="c72a6-167">idő osztásjelek számítása csökkenő hello maximális idő ticks mínusz hello hello összesítési időszak kezdő időpontja hello.</span><span class="sxs-lookup"><span data-stu-id="c72a6-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="c72a6-168">Például</span><span class="sxs-lookup"><span data-stu-id="c72a6-168">E.g.</span></span> <span data-ttu-id="c72a6-169">Ha a 10-november-2015 elindult hello mintavételi időszak 00:00Hrs UTC majd hello számítási lenne: DateTime.MaxValue.Ticks - (új DateTime(2015,11,10,0,0,0,DateTimeKind.Utc). Ticks).</span><span class="sxs-lookup"><span data-stu-id="c72a6-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="c72a6-170">A hello memória rendelkezésre álló bájtok teljesítmény számláló hello sorkulcsa jelenik meg, például: 2519551871999999999__:005CMemory:005CAvailable:0020 bájt</span><span class="sxs-lookup"><span data-stu-id="c72a6-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="c72a6-171">**CounterName** : hello teljesítményszámláló hello neve.</span><span class="sxs-lookup"><span data-stu-id="c72a6-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="c72a6-172">Ez megegyezik hello *counterSpecifier* hello XML-konfiguráció sémaellenőrzése definiálva.</span><span class="sxs-lookup"><span data-stu-id="c72a6-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="c72a6-173">**Maximális** : hello teljesítményszámláló maximális értékének hello hello összesítési időszakban.</span><span class="sxs-lookup"><span data-stu-id="c72a6-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="c72a6-174">**Minimális** : hello teljesítményszámláló minimális értékének hello hello összesítési időszakban.</span><span class="sxs-lookup"><span data-stu-id="c72a6-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="c72a6-175">**Teljes** : hello teljesítményszámláló az összes értékek összegét hello jelentett hello összesítési időszakban.</span><span class="sxs-lookup"><span data-stu-id="c72a6-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="c72a6-176">**Count** : hello teljesítményszámláló jelentett értékek hello teljes száma.</span><span class="sxs-lookup"><span data-stu-id="c72a6-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="c72a6-177">**Átlagos** : hello teljesítményszámláló átlagos (összesen és száma) értékének hello hello összesítési időszakban.</span><span class="sxs-lookup"><span data-stu-id="c72a6-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c72a6-178">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="c72a6-178">Next Steps</span></span>
* <span data-ttu-id="c72a6-179">További diagnosztikai kiterjesztésű Windows virtuális gép teljes mintasablon: [201-vm-figyelési-diagnosztika-bővítmény](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="c72a6-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="c72a6-180">Szabályzatsablonokat hello resource manager sablon [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) vagy [Azure parancssori felülettel](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="c72a6-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="c72a6-181">További információ [Azure Resource Manager sablonok készítése](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="c72a6-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

