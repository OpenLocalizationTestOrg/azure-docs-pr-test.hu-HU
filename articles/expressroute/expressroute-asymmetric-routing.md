---
title: "Aszimmetrikus útválasztás | Microsoft Docs"
description: "Ez a cikk végigvezeti Önt azokon a problémákon, amelyekkel az ügyfeleknek szembe kell nézniük, amikor aszimmetrikus útválasztást állítanak be olyan hálózatokon, amelyek több kapcsolattal is rendelkeznek a célhoz."
documentationcenter: na
services: expressroute
author: osamazia
manager: carmonm
editor: 
ms.assetid: a754bff9-95c9-44b5-9796-377fc21e8322
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/10/2016
ms.author: osamam
ms.openlocfilehash: 8568c13d2834a0643e15ab1814a35c92123837d1
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 07/11/2017
---
# <a name="asymmetric-routing-with-multiple-network-paths"></a><span data-ttu-id="ec80c-103">Aszimmetrikus útválasztás több hálózati elérési úttal</span><span class="sxs-lookup"><span data-stu-id="ec80c-103">Asymmetric routing with multiple network paths</span></span>
<span data-ttu-id="ec80c-104">A cikk leírja, hogy hogyan követhet a kimenő és a bejövő hálózati forgalom különböző utakat, amikor a hálózati forrás és cél között több elérési út is rendelkezésre áll.</span><span class="sxs-lookup"><span data-stu-id="ec80c-104">This article explains how forward and return network traffic might take different routes when multiple paths are available between network source and destination.</span></span>

<span data-ttu-id="ec80c-105">Az aszimmetrikus útválasztás megértéséhez két koncepciót kell átlátnunk.</span><span class="sxs-lookup"><span data-stu-id="ec80c-105">It's important to understand two concepts to understand asymmetric routing.</span></span> <span data-ttu-id="ec80c-106">Elsőként azt, hogy milyen hatással van a hálózatra, ha több elérési út is létezik.</span><span class="sxs-lookup"><span data-stu-id="ec80c-106">One is the effect of multiple network paths.</span></span> <span data-ttu-id="ec80c-107">A másik pedig az, hogy az eszközök, például a tűzfalak, hogyan őrzik meg állapotukat.</span><span class="sxs-lookup"><span data-stu-id="ec80c-107">The other is how devices, like a firewall, keep state.</span></span> <span data-ttu-id="ec80c-108">Az ilyen típusú eszközöket állapot-nyilvántartó eszközöknek nevezzük.</span><span class="sxs-lookup"><span data-stu-id="ec80c-108">These types of devices are called stateful devices.</span></span> <span data-ttu-id="ec80c-109">E két tényező kombinációja olyan helyzeteket teremthet, amikor a hálózati forgalmat egy állapot-nyilvántartó eszköz elveti, mivel nem észleli, hogy a forgalom kiindulópontja saját maga.</span><span class="sxs-lookup"><span data-stu-id="ec80c-109">A combination of these two factors creates scenarios in which network traffic is dropped by a stateful device because the stateful device didn't detect that traffic originated with the device itself.</span></span>

## <a name="multiple-network-paths"></a><span data-ttu-id="ec80c-110">Több hálózati elérési út</span><span class="sxs-lookup"><span data-stu-id="ec80c-110">Multiple network paths</span></span>
<span data-ttu-id="ec80c-111">Ha a vállalati hálózat csupán egyetlen, az internetszolgáltatón átmenő kapcsolattal rendelkezik az internethez, az internet felé irányuló, illetve az internetről visszaérkező minden forgalom ugyanazt az utat járja be.</span><span class="sxs-lookup"><span data-stu-id="ec80c-111">When an enterprise network has only one link to the Internet through their Internet service provider, all traffic to and from the Internet travels the same path.</span></span> <span data-ttu-id="ec80c-112">A vállalatok azonban gyakran több kapcsolatcsoportot is vásárolnak, mivel ezek redundáns elérési útként szolgálhatnak, illetve hozzájárulnak a hálózat állásidejének csökkentéséhez.</span><span class="sxs-lookup"><span data-stu-id="ec80c-112">Often, companies purchase multiple circuits, as redundant paths, to improve network uptime.</span></span> <span data-ttu-id="ec80c-113">Ebben az esetben előfordulhat, hogy a hálózatról kilépő, az internet felé irányuló forgalom az egyik kapcsolaton, míg a visszatérő forgalom egy másik kapcsolaton halad át.</span><span class="sxs-lookup"><span data-stu-id="ec80c-113">When this happens, it's possible that traffic that goes outside of the network, to the Internet, goes through one link, and the return traffic goes through a different link.</span></span> <span data-ttu-id="ec80c-114">Ezt a helyzetet nevezik közkeletűen aszimmetrikus útválasztásnak.</span><span class="sxs-lookup"><span data-stu-id="ec80c-114">This is commonly known as asymmetric routing.</span></span> <span data-ttu-id="ec80c-115">Az aszimmetrikus útválasztás esetén a fordított irányú hálózati forgalom egy másik elérési utat vesz igénybe, mint az eredeti adatfolyam.</span><span class="sxs-lookup"><span data-stu-id="ec80c-115">In asymmetric routing, reverse network traffic takes a different path from the original flow.</span></span>

![Több elérési úttal rendelkező hálózatok](./media/expressroute-asymmetric-routing/AsymmetricRouting3.png)

<span data-ttu-id="ec80c-117">Bár ez elsősorban az internet elérésekor használatos, az aszimmetrikus útválasztás az elérési utak egyéb kombinációit is jelölheti.</span><span class="sxs-lookup"><span data-stu-id="ec80c-117">Although it primarily occurs on the Internet, asymmetric routing also applies to other combinations of multiple paths.</span></span> <span data-ttu-id="ec80c-118">Ilyenek például azok az esetek, amikor ugyanahhoz a célhoz internetes és privát útvonal is vezet, amikor ugyanahhoz a célhoz több privát útvonal vezet stb.</span><span class="sxs-lookup"><span data-stu-id="ec80c-118">It applies, for example, both to an Internet path and a private path that go to the same destination, and to multiple private paths that go to the same destination.</span></span>

<span data-ttu-id="ec80c-119">A forrás és a cél közötti elérési úton elhelyezkedő minden egyes útválasztó a lehető legjobb útvonalat számítja ki a cél eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="ec80c-119">Each router along the way, from source to destination, computes the best path to reach a destination.</span></span> <span data-ttu-id="ec80c-120">Az útválasztó két fontos tényezőt vesz figyelembe a lehető legjobb útvonal meghatározásakor:</span><span class="sxs-lookup"><span data-stu-id="ec80c-120">The router's determination of best possible path is based on two main factors:</span></span>

* <span data-ttu-id="ec80c-121">A külső hálózatok közötti útválasztást az általában csak BGP néven emlegetett útválasztási protokoll, a peremátjáró protokoll (Border Gateway Protocol) határozza meg.</span><span class="sxs-lookup"><span data-stu-id="ec80c-121">Routing between external networks is based on a routing protocol, Border Gateway Protocol (BGP).</span></span> <span data-ttu-id="ec80c-122">A BGP átveszi a szomszédok hirdetményeit, és különböző műveleteket futtat rajtuk annak érdekében, hogy megállapítsa a célhoz vezető legjobb utat.</span><span class="sxs-lookup"><span data-stu-id="ec80c-122">BGP takes advertisements from neighbors and runs them through a series of steps to determine the best path to the intended destination.</span></span> <span data-ttu-id="ec80c-123">A legjobb útvonalat az útválasztó beírja az útvonaltáblába.</span><span class="sxs-lookup"><span data-stu-id="ec80c-123">It stores the best path in its routing table.</span></span>
* <span data-ttu-id="ec80c-124">Az útvonalhoz társított alhálózati maszk hossza befolyásolja az útválasztási útvonalakat.</span><span class="sxs-lookup"><span data-stu-id="ec80c-124">The length of a subnet mask associated with a route influences routing paths.</span></span> <span data-ttu-id="ec80c-125">Ha az útválasztó ugyanahhoz az IP-címhez több hirdetményt kap különböző alhálózati maszkokkal, akkor a hosszabb alhálózati maszkkal rendelkező hirdetményt részesíti előnyben, mivel ezt tartja pontosabb útvonalnak.</span><span class="sxs-lookup"><span data-stu-id="ec80c-125">If a router receives multiple advertisements for the same IP address but with different subnet masks, the router prefers the advertisement with a longer subnet mask because it's considered a more specific route.</span></span>

## <a name="stateful-devices"></a><span data-ttu-id="ec80c-126">Állapot-nyilvántartó eszközök</span><span class="sxs-lookup"><span data-stu-id="ec80c-126">Stateful devices</span></span>
<span data-ttu-id="ec80c-127">Az útválasztók az útválasztás megállapítása során a csomag IP-fejlécét veszik alapul.</span><span class="sxs-lookup"><span data-stu-id="ec80c-127">Routers look at the IP header of a packet for routing purposes.</span></span> <span data-ttu-id="ec80c-128">Bizonyos eszközök még mélyebben megvizsgálják a csomagot.</span><span class="sxs-lookup"><span data-stu-id="ec80c-128">Some devices look even deeper inside the packet.</span></span> <span data-ttu-id="ec80c-129">Általában ezek az eszközök a 4. rétegbeli (Transmission Control Protocol, azaz TCP vagy User Datagram Protocol, azaz UDP), sőt akár a 7. rétegbeli (alkalmazási réteg) fejléceket vizsgálják.</span><span class="sxs-lookup"><span data-stu-id="ec80c-129">Typically, these devices look at Layer4 (Transmission Control Protocol, or TCP; or User Datagram Protocol, or UDP), or even Layer7 (Application Layer) headers.</span></span> <span data-ttu-id="ec80c-130">Ezek az eszközök általában biztonsági vagy sávszélesség-optimalizáló eszközök.</span><span class="sxs-lookup"><span data-stu-id="ec80c-130">These kinds of devices are either security devices or bandwidth-optimization devices.</span></span> 

<span data-ttu-id="ec80c-131">Gyakori állapot-nyilvántartó eszközök például a tűzfalak.</span><span class="sxs-lookup"><span data-stu-id="ec80c-131">A firewall is a common example of a stateful device.</span></span> <span data-ttu-id="ec80c-132">A tűzfalak különböző mezők, például a protokoll, a TCP/UDP-port vagy az URL-fejlécek alapján engedik át vagy fordítják vissza a felületekre érkező csomagokat.</span><span class="sxs-lookup"><span data-stu-id="ec80c-132">A firewall allows or denies a packet to pass through its interfaces based on various fields such as protocol, TCP/UDP port, and URL headers.</span></span> <span data-ttu-id="ec80c-133">A csomagok vizsgálata jelentős számítási terhelést ró az eszközre.</span><span class="sxs-lookup"><span data-stu-id="ec80c-133">This level of packet inspection puts a heavy processing load on the device.</span></span> <span data-ttu-id="ec80c-134">A teljesítmény javítása érdekében a tűzfalak általában csak az adatfolyamok első csomagját vizsgálják meg.</span><span class="sxs-lookup"><span data-stu-id="ec80c-134">To improve performance, the firewall inspects the first packet of a flow.</span></span> <span data-ttu-id="ec80c-135">Ha a tűzfal átengedi a csomagot, akkor az állapottáblázatában megőrzi az adatfolyam információit.</span><span class="sxs-lookup"><span data-stu-id="ec80c-135">If it allows the packet to proceed, it keeps the flow information in its state table.</span></span> <span data-ttu-id="ec80c-136">Az adatfolyamhoz tartozó további csomagokat az első csomag alapján hozott döntésnek megfelelően engedélyezi vagy tiltja a tűzfal.</span><span class="sxs-lookup"><span data-stu-id="ec80c-136">All subsequent packets related to this flow are allowed based on the initial determination.</span></span> <span data-ttu-id="ec80c-137">Tegyük fel, hogy egy már létező adatfolyamhoz tartozó csomag érkezik a tűzfalra.</span><span class="sxs-lookup"><span data-stu-id="ec80c-137">A packet that is part of an existing flow might arrive at the firewall.</span></span> <span data-ttu-id="ec80c-138">Amennyiben a tűzfal nem rendelkezik a csomagról előzetes állapotinformációkkal, eldobja.</span><span class="sxs-lookup"><span data-stu-id="ec80c-138">If the firewall has no prior state information about it, the firewall drops the packet.</span></span>

## <a name="asymmetric-routing-with-expressroute"></a><span data-ttu-id="ec80c-139">Aszimmetrikus útválasztás az ExpressRoute-tal</span><span class="sxs-lookup"><span data-stu-id="ec80c-139">Asymmetric routing with ExpressRoute</span></span>
<span data-ttu-id="ec80c-140">Ha az Azure ExpressRoute segítségével csatlakozik a Microsofthoz, a hálózata az alábbiak szerint módosul:</span><span class="sxs-lookup"><span data-stu-id="ec80c-140">When you connect to Microsoft through Azure ExpressRoute, your network changes like this:</span></span>

* <span data-ttu-id="ec80c-141">Több kapcsolat jön létre a Microsofthoz.</span><span class="sxs-lookup"><span data-stu-id="ec80c-141">You have multiple links to Microsoft.</span></span> <span data-ttu-id="ec80c-142">Az egyik kapcsolat a meglévő internetkapcsolat, a másik pedig az ExpressRoute-on keresztüli kapcsolat.</span><span class="sxs-lookup"><span data-stu-id="ec80c-142">One link is your existing Internet connection, and the other is via ExpressRoute.</span></span> <span data-ttu-id="ec80c-143">Előfordulhat, hogy a forgalom egy része az interneten keresztül jut el a Microsofthoz, de az ExpressRoute-on át tér vissza, vagy fordítva.</span><span class="sxs-lookup"><span data-stu-id="ec80c-143">Some traffic to Microsoft might go through the Internet but come back via ExpressRoute, or vice versa.</span></span>
* <span data-ttu-id="ec80c-144">Az ExpressRoute konkrétabb IP-címeket küld.</span><span class="sxs-lookup"><span data-stu-id="ec80c-144">You receive more specific IP addresses via ExpressRoute.</span></span> <span data-ttu-id="ec80c-145">Így az ExpressRoute-on keresztül kínált szolgáltatásokra vonatkozó, a hálózat és a Microsoft közötti forgalom esetén az útválasztók mindig az ExpressRoute-ot fogják előnyben részesíteni.</span><span class="sxs-lookup"><span data-stu-id="ec80c-145">So, for traffic from your network to Microsoft for services offered via ExpressRoute, routers always prefer ExpressRoute.</span></span>

<span data-ttu-id="ec80c-146">E két változás hálózatra gyakorolt hatásának megértéséhez gondoljunk át néhány forgatókönyvet.</span><span class="sxs-lookup"><span data-stu-id="ec80c-146">To understand the effect these two changes have on a network, let’s consider some scenarios.</span></span> <span data-ttu-id="ec80c-147">Példaképpen tegyük fel, hogy csak egyetlen internet felé néző kapcsolatcsoport van a birtokában, és az összes Microsoft-szolgáltatást az interneten keresztül használja.</span><span class="sxs-lookup"><span data-stu-id="ec80c-147">As an example, you have only one circuit to the Internet and you consume all Microsoft services via the Internet.</span></span> <span data-ttu-id="ec80c-148">Az Ön hálózatáról a Microsoft felé küldött, majd visszatérő forgalom ugyanazon az internetes kapcsolaton halad át, és egy tűzfalon is keresztülmegy.</span><span class="sxs-lookup"><span data-stu-id="ec80c-148">The traffic from your network to Microsoft and back traverses the same Internet link and passes through the firewall.</span></span> <span data-ttu-id="ec80c-149">A tűzfal az első csomag észlelésekor rögzíti az adatfolyamot, és engedélyezi a visszatérő csomagokat is, mivel za adatfolyam már szerepel az állapottáblázatban.</span><span class="sxs-lookup"><span data-stu-id="ec80c-149">The firewall records the flow as it sees the first packet and return packets are allowed because the flow exists in the state table.</span></span>

![Aszimmetrikus útválasztás az ExpressRoute-tal](./media/expressroute-asymmetric-routing/AsymmetricRouting1.png)

<span data-ttu-id="ec80c-151">Ezután bekapcsolja az ExpressRoute-ot, és a Microsoft-szolgáltatásokat az ExpressRoute-on keresztül veszi igénybe.</span><span class="sxs-lookup"><span data-stu-id="ec80c-151">Then, you turn on ExpressRoute and consume services offered by Microsoft over ExpressRoute.</span></span> <span data-ttu-id="ec80c-152">A többi Microsoft-szolgáltatást az interneten keresztül használjuk fel.</span><span class="sxs-lookup"><span data-stu-id="ec80c-152">All other services from Microsoft are consumed over the Internet.</span></span> <span data-ttu-id="ec80c-153">A peremen egy különálló tűzfalat helyez üzembe, amely csatlakozik az ExpressRoute-hoz.</span><span class="sxs-lookup"><span data-stu-id="ec80c-153">You deploy a separate firewall at your edge that is connected to ExpressRoute.</span></span> <span data-ttu-id="ec80c-154">A Microsoft bizonyos szolgáltatásokhoz az ExpressRoute-on keresztül konkrétabb előtagokat hirdet meg a hálózaton.</span><span class="sxs-lookup"><span data-stu-id="ec80c-154">Microsoft advertises more specific prefixes to your network over ExpressRoute for specific services.</span></span> <span data-ttu-id="ec80c-155">Az útválasztási infrastruktúra ezért ezeknél az előtagoknál az ExpressRoute elérés utat fogja előnyben részesíteni.</span><span class="sxs-lookup"><span data-stu-id="ec80c-155">Your routing infrastructure chooses ExpressRoute as the preferred path for those prefixes.</span></span> <span data-ttu-id="ec80c-156">Ha Ön nem az ExpressRoute-on keresztül hirdeti meg nyilvános IP-címeit a Microsoft számára, akkor a Microsoft az interneten keresztül fog kommunikálni ezekkel a nyilvános IP-címekkel.</span><span class="sxs-lookup"><span data-stu-id="ec80c-156">If you are not advertising your public IP addresses to Microsoft over ExpressRoute, Microsoft communicates with your public IP addresses via the Internet.</span></span> <span data-ttu-id="ec80c-157">A hálózatából a Microsoft felé irányuló kimenő forgalom az ExpressRoute-ot fogja használni, míg a Microsofttól visszaérkező forgalom az internetet.</span><span class="sxs-lookup"><span data-stu-id="ec80c-157">Forward traffic from your network to Microsoft uses ExpressRoute, and reverse traffic from Microsoft uses the Internet.</span></span> <span data-ttu-id="ec80c-158">Ha a peremen működő tűzfal az állapottáblázatban nem szereplő adatfolyamhoz tartozó válaszcsomagot észlel, eldobja a visszatérő forgalmat.</span><span class="sxs-lookup"><span data-stu-id="ec80c-158">When the firewall at the edge sees a response packet for a flow that it does not find in the state table, it drops the return traffic.</span></span>

<span data-ttu-id="ec80c-159">Ha ugyanazt a hálózati címfordítási (NAT) készletet használja az ExpressRoute-hoz és az internethez, hasonló problémák léphetnek fel a hálózatán belüli, privát IP-címmel rendelkező ügyfeleknél.</span><span class="sxs-lookup"><span data-stu-id="ec80c-159">If you choose to use the same network address translation (NAT) pool for ExpressRoute and for the Internet, you'll see similar issues with the clients in your network on private IP addresses.</span></span> <span data-ttu-id="ec80c-160">A Windows Update-re és más hasonló szolgáltatásokra irányuló kérelmeket az interneten keresztül küldi el a hálózat, mivel ezeknek a szolgáltatásoknak az IP-címét nem az ExpressRoute-on keresztül hirdeti meg a rendszer.</span><span class="sxs-lookup"><span data-stu-id="ec80c-160">Requests for services like Windows Update go via the Internet because IP addresses for these services are not advertised via ExpressRoute.</span></span> <span data-ttu-id="ec80c-161">A visszatérő forgalom azonban az ExpressRoute-on keresztül fog érkezni.</span><span class="sxs-lookup"><span data-stu-id="ec80c-161">However, the return traffic comes back via ExpressRoute.</span></span> <span data-ttu-id="ec80c-162">Ha a Microsoft az internettől és az ExpressRoute-tól megegyező alhálózati maszkkal rendelkező IP-címet kap, az ExpressRoute-ot részesíti előnyben.</span><span class="sxs-lookup"><span data-stu-id="ec80c-162">If Microsoft receives an IP address with the same subnet mask from the Internet and ExpressRoute, it prefers ExpressRoute over the Internet.</span></span> <span data-ttu-id="ec80c-163">Ha a peremhálózatban működő, az ExpressRoute felé néző tűzfalnak vagy más állapot-nyilvántartó eszköznek nincs előzetes információja egy adatfolyamról, eldobja az adott adatfolyamhoz tartozó csomagokat.</span><span class="sxs-lookup"><span data-stu-id="ec80c-163">If a firewall or another stateful device that is on your network edge and facing ExpressRoute has no prior information about the flow, it drops the packets that belong to that flow.</span></span>

## <a name="asymmetric-routing-solutions"></a><span data-ttu-id="ec80c-164">Megoldások az aszimmetrikus útválasztásra</span><span class="sxs-lookup"><span data-stu-id="ec80c-164">Asymmetric routing solutions</span></span>
<span data-ttu-id="ec80c-165">Az aszimmetrikus útválasztás problémájának megoldásához alapvetően két lehetőség áll rendelkezésére.</span><span class="sxs-lookup"><span data-stu-id="ec80c-165">You have two main options to solve the problem of asymmetric routing.</span></span> <span data-ttu-id="ec80c-166">Az egyik az útválasztás, a másik pedig a forrásalapú hálózati címfordítás (SNAT) használata.</span><span class="sxs-lookup"><span data-stu-id="ec80c-166">One is through routing, and the other is by using source-based NAT (SNAT).</span></span>

### <a name="routing"></a><span data-ttu-id="ec80c-167">Útválasztás</span><span class="sxs-lookup"><span data-stu-id="ec80c-167">Routing</span></span>
<span data-ttu-id="ec80c-168">Gondoskodjon róla, hogy a nyilvános IP-címeit a megfelelő távoli hálózati (NAT) kapcsolatoknak hirdesse meg.</span><span class="sxs-lookup"><span data-stu-id="ec80c-168">Ensure that your public IP addresses are advertised to appropriate wide area network (WAN) links.</span></span> <span data-ttu-id="ec80c-169">Ha például az internetet szeretné használni a hitelesítési forgalomhoz és az ExpressRoute-ot a levelezési forgalomhoz, akkor ne hirdesse meg az Active Directory összevonási szolgáltatások (AD FS) nyilvános IP-címeit az ExpressRoute-on keresztül.</span><span class="sxs-lookup"><span data-stu-id="ec80c-169">For example, if you want to use the Internet for authentication traffic and ExpressRoute for your mail traffic, you should not advertise your Active Directory Federation Services (AD FS) public IP addresses over ExpressRoute.</span></span> <span data-ttu-id="ec80c-170">Hasonlóképpen ügyeljen arra is, hogy ne tegye közzé a helyszíni AD FS-kiszolgálót olyan IP-címek számára, amelyek az útválasztó az ExpressRoute-on keresztül kap.</span><span class="sxs-lookup"><span data-stu-id="ec80c-170">Similarly, be sure not to expose an on-premises AD FS server to IP addresses that the router receives over ExpressRoute.</span></span> <span data-ttu-id="ec80c-171">Az ExpressRoute-on keresztül kapott útvonalak konkrétabbak, ezért a rendszer az ExpressRoute-on keresztüli elérési utat részesíti előnyben a Microsoft felé irányuló hitelesítési forgalom esetén.</span><span class="sxs-lookup"><span data-stu-id="ec80c-171">Routes received over ExpressRoute are more specific so they make ExpressRoute the preferred path for authentication traffic to Microsoft.</span></span> <span data-ttu-id="ec80c-172">Ez aszimmetrikus útválasztáshoz vezet.</span><span class="sxs-lookup"><span data-stu-id="ec80c-172">This causes asymmetric routing.</span></span>

<span data-ttu-id="ec80c-173">Ha az ExpressRoute-ot szeretné használni a hitelesítéshez, ügyeljen rá, hogy az AD FS nyilvános IP-címeit az ExpressRoute-on keresztül, NAT nélkül hirdesse meg.</span><span class="sxs-lookup"><span data-stu-id="ec80c-173">If you want to use ExpressRoute for authentication, make sure that you are advertising AD FS public IP addresses over ExpressRoute without NAT.</span></span> <span data-ttu-id="ec80c-174">Ezzel a módszerrel a Microsofttól érkező, és egy helyszíni AD FS-kiszolgálóra irányuló forgalom az ExpressRoute-on halad keresztül.</span><span class="sxs-lookup"><span data-stu-id="ec80c-174">This way, traffic that originates from Microsoft and goes to an on-premises AD FS server goes over ExpressRoute.</span></span> <span data-ttu-id="ec80c-175">Az ügyféltől a Microsoft felé irányuló forgalom az ExpressRoute-ot használja, mivel az az előnyben részesített elérési út.</span><span class="sxs-lookup"><span data-stu-id="ec80c-175">Return traffic from customer to Microsoft uses ExpressRoute because it's the preferred route over the Internet.</span></span>

### <a name="source-based-nat"></a><span data-ttu-id="ec80c-176">Forrásalapú NAT</span><span class="sxs-lookup"><span data-stu-id="ec80c-176">Source-based NAT</span></span>
<span data-ttu-id="ec80c-177">Az aszimmetrikus útválasztás által okozott problémák megoldásának másik módját az SNAT használata jelenti.</span><span class="sxs-lookup"><span data-stu-id="ec80c-177">Another way of solving asymmetric routing issues is by using SNAT.</span></span> <span data-ttu-id="ec80c-178">Tegyük fel, hogy nem hirdette meg egy helyszíni SMTP-kiszolgáló nyilvános IP-címét az ExpressRoute-on keresztül, mert az ilyen típusú kommunikációhoz az internetet szeretné használni.</span><span class="sxs-lookup"><span data-stu-id="ec80c-178">For example, you have not advertised the public IP address of an on-premises Simple Mail Transfer Protocol (SMTP) server over ExpressRoute because you intend to use the Internet for this type of communication.</span></span> <span data-ttu-id="ec80c-179">A Microsoft felől érkező, a helyszíni SMTP-kiszolgáló irányába tartó kérés az interneten halad keresztül.</span><span class="sxs-lookup"><span data-stu-id="ec80c-179">A request that originates with Microsoft and then goes to your on-premises SMTP server traverses the Internet.</span></span> <span data-ttu-id="ec80c-180">A beérkező kérelmet az SNAT használatával egy belső IP-címre irányítja át.</span><span class="sxs-lookup"><span data-stu-id="ec80c-180">You SNAT the incoming request to an internal IP address.</span></span> <span data-ttu-id="ec80c-181">Az SMTP-kiszolgálótól származó, fordított irányú forgalom az ExpressRoute helyett a peremhálózati tűzfalra érkezik (mivel ezt használja az SNAT megvalósításához).</span><span class="sxs-lookup"><span data-stu-id="ec80c-181">Reverse traffic from the SMTP server goes to the edge firewall (which you use for NAT) instead of through ExpressRoute.</span></span> <span data-ttu-id="ec80c-182">A visszafelé irányuló forgalom az interneten halad keresztül.</span><span class="sxs-lookup"><span data-stu-id="ec80c-182">The return traffic goes back via the Internet.</span></span>

![A forrásalapú NAT hálózati konfigurációja](./media/expressroute-asymmetric-routing/AsymmetricRouting2.png)

## <a name="asymmetric-routing-detection"></a><span data-ttu-id="ec80c-184">Az aszimmetrikus útválasztás észlelése</span><span class="sxs-lookup"><span data-stu-id="ec80c-184">Asymmetric routing detection</span></span>
<span data-ttu-id="ec80c-185">A Traceroute a legjobb módszer annak vizsgálatához, hogy a forgalom a várt útvonalat járja-e be.</span><span class="sxs-lookup"><span data-stu-id="ec80c-185">Traceroute is the best way to make sure that your network traffic is traversing the expected path.</span></span> <span data-ttu-id="ec80c-186">Ha azt várja, hogy a helyszíni SMTP-kiszolgálóról a Microsoft felé irányuló forgalom az interneten haladjon keresztül, a traceroute által megjelenített útvonalnak az SMTP-kiszolgálótól kell indulnia és az Office 365 szolgáltatásnál kell végződnie.</span><span class="sxs-lookup"><span data-stu-id="ec80c-186">If you expect traffic from your on-premises SMTP server to Microsoft to take the Internet path, the expected traceroute is from the SMTP server to Office 365.</span></span> <span data-ttu-id="ec80c-187">Az eredmény alapján ellenőrizheti, hogy a forgalom valóban az internet felé, és nem az ExpressRoute irányában hagyja el a hálózatot.</span><span class="sxs-lookup"><span data-stu-id="ec80c-187">The result validates that traffic is indeed leaving your network toward the Internet and not toward ExpressRoute.</span></span>

