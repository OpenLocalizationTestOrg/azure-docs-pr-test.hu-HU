---
title: "Az ExpressRoute-útválasztás optimalizálása: Azure | Microsoft Docs"
description: "Ezen a lapon biztosít részletek hogyan toooptimize útválasztási, ha egynél több ExpressRoute áramkörök, amely a csatlakozás a Microsoft és a vállalati hálózat között."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="bf868-103">Az ExpressRoute-útválasztás optimalizálása</span><span class="sxs-lookup"><span data-stu-id="bf868-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="bf868-104">Ha egyszerre több ExpressRoute-Kapcsolatcsoportok, hogy egynél több elérési út tooconnect tooMicrosoft.</span><span class="sxs-lookup"><span data-stu-id="bf868-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="bf868-105">Ennek eredményeképpen optimálisnál útválasztási fordulhat - ez azt jelenti, hogy a forgalom eltarthat hosszabb elérési tooreach Microsoft, és a Microsoft tooyour hálózat.</span><span class="sxs-lookup"><span data-stu-id="bf868-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="bf868-106">hello hosszabb hello hálózati elérési út hello nagyobb hello késleltetéssel járhat.</span><span class="sxs-lookup"><span data-stu-id="bf868-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="bf868-107">A késés közvetlen hatással van az alkalmazások teljesítményére és a felhasználói élményre.</span><span class="sxs-lookup"><span data-stu-id="bf868-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="bf868-108">Ez a cikk azt mutatják be, a probléma, és a azt ismertetik, hogyan útválasztás használatával toooptimize hello szabványos útválasztási technológiákat.</span><span class="sxs-lookup"><span data-stu-id="bf868-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="bf868-109">Az ügyfél tooMicrosoft útválasztási optimálisnál</span><span class="sxs-lookup"><span data-stu-id="bf868-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="bf868-110">Most tekintsen meg Bezárás hello útválasztási probléma példa szerint.</span><span class="sxs-lookup"><span data-stu-id="bf868-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="bf868-111">Tegyük fel, két rendelkező hello USA, a másik Debrecenben és egy Győri.</span><span class="sxs-lookup"><span data-stu-id="bf868-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="bf868-112">Az irodák egy nagykiterjedésű hálózaton (WAN) keresztül csatlakoznak, amely lehet a saját gerinchálózata vagy a szolgáltatója IP-alapú VPN hálózata.</span><span class="sxs-lookup"><span data-stu-id="bf868-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="bf868-113">Két ExpressRoute-Kapcsolatcsoportok egy, Nyugat-India és egy US-keleti, hello WAN is csatlakozó rendelkezik.</span><span class="sxs-lookup"><span data-stu-id="bf868-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="bf868-114">Természetesen két elérési utak tooconnect toohello Microsoft hálózattal rendelkezik.</span><span class="sxs-lookup"><span data-stu-id="bf868-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="bf868-115">Most tegyük fel, hogy az USA nyugati régiójában és az USA keleti régiójában is rendelkezik egy Azure üzemelő példánnyal (például az Azure App Service-szel).</span><span class="sxs-lookup"><span data-stu-id="bf868-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="bf868-116">A levelezéshez nem tooconnect a másik Debrecenben tooAzure Velünk nyugati és a felhasználók a győri tooAzure amerikai keleti, mert a szolgáltatás-rendszergazdák kihirdeti, hogy minden egyes office access felhasználói hello Azure-szolgáltatások optimális élmény közelben.</span><span class="sxs-lookup"><span data-stu-id="bf868-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="bf868-117">Sajnos hello tervnek megfelelően működik jól hello keleti part felhasználók azonban nem hello nyugati part felhasználók.</span><span class="sxs-lookup"><span data-stu-id="bf868-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="bf868-118">hello hello oka hello következő.</span><span class="sxs-lookup"><span data-stu-id="bf868-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="bf868-119">Minden egyes ExpressRoute-kapcsolatcsoportot azt helyüket tooyou hello előtag Azure US-keleti (23.100.0.0/16), mind hello előtag Azure, Nyugat-India (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="bf868-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="bf868-120">Ha nem tudja, melyik régióban mely előtag tartozik, még nem tud tootreat azt másképp.</span><span class="sxs-lookup"><span data-stu-id="bf868-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="bf868-121">A WAN hálózaton elképzelhető, hogy az előtagok hello mint Velünk nyugati szorosabb tooUS keleti, és ezért útvonal-amerikai keleti mindkét office felhasználók toohello ExpressRoute-kapcsolatcsoportot.</span><span class="sxs-lookup"><span data-stu-id="bf868-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="bf868-122">Hello célból Szomorú sokan hello másik Debrecenben office fog.</span><span class="sxs-lookup"><span data-stu-id="bf868-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![1. eset ExpressRoute probléma - optimálisnál ügyfél tooMicrosoft az Útválasztás](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="bf868-124">Megoldás: BGP-közösségek használata</span><span class="sxs-lookup"><span data-stu-id="bf868-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="bf868-125">toooptimize útválasztási mindkét felhasználók számára, mely előtag származik Azure Velünk nyugati és amelyhez Azure amerikai keleti tooknow kell.</span><span class="sxs-lookup"><span data-stu-id="bf868-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="bf868-126">Ezt az információt a [BGP-közösség értékeivel](expressroute-routing.md) kódoljuk.</span><span class="sxs-lookup"><span data-stu-id="bf868-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="bf868-127">Azt például hozzárendelt egy egyedi BGP közösségi érték tooeach az Azure-régió, „12076:51004” előtagot az USA keleti régiójához, a „12076:51006” előtagot az USA nyugati régiójához.</span><span class="sxs-lookup"><span data-stu-id="bf868-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="bf868-128">Most, hogy tudja, melyik előtag melyik Azure-régióból származik, konfigurálhatja, hogy melyik ExpressRoute-kapcsolatcsoportot részesíti előnyben.</span><span class="sxs-lookup"><span data-stu-id="bf868-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="bf868-129">Hello BGP tooexchange útválasztási információ használjuk, mert a BGP által helyi preferencia tooinfluence útválasztási is használhatja.</span><span class="sxs-lookup"><span data-stu-id="bf868-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="bf868-130">A példa kedvéért rendelhet, Nyugat-India-amerikai keleti-nál nagyobb helyi beállításokat szabályozó érték too13.100.0.0/16, és ehhez hasonlóan a helyi beállításokat szabályozó magasabb érték too23.100.0.0/16 US-keleti mint, Nyugat-India.</span><span class="sxs-lookup"><span data-stu-id="bf868-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="bf868-131">Ez a konfiguráció lesz győződjön meg arról, hogy mindkét elérési utak tooMicrosoft érhetők el, amikor a felhasználók, a másik Debrecenben érvénybe hello ExpressRoute-kapcsolatcsoportot a US nyugati tooconnect tooAzure Velünk nyugati mivel a felhasználók Győri hello ExpressRoute az Amerikai keleti tooAzure amerikai keleti régiója .</span><span class="sxs-lookup"><span data-stu-id="bf868-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="bf868-132">Az útválasztás minkét oldalon optimalizálva van.</span><span class="sxs-lookup"><span data-stu-id="bf868-132">Routing is optimized on both sides.</span></span> 

![1. ExpressRoute-eset megoldása – BGP-közösségek használata](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="bf868-134">hello azonos technika, helyi prioritást lehet a virtuális hálózati ügyfél tooAzure alkalmazott toorouting.</span><span class="sxs-lookup"><span data-stu-id="bf868-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="bf868-135">Jelenleg nem címke BGP közösségi érték toohello előtagok Azure tooyour hálózatról hirdetve.</span><span class="sxs-lookup"><span data-stu-id="bf868-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="bf868-136">Azonban mivel tudja, hogy a virtuális hálózat telepítés közül melyik Bezárás toowhich az Office, konfigurálhatja az útválasztók ennek megfelelően tooprefer egy ExpressRoute-kapcsolatcsoport tooanother.</span><span class="sxs-lookup"><span data-stu-id="bf868-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="bf868-137">A Microsoft toocustomer útválasztási optimálisnál</span><span class="sxs-lookup"><span data-stu-id="bf868-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="bf868-138">Íme egy másik példa, ahol kapcsolatok a Microsoft használják a hosszabb elérési tooreach a hálózaton.</span><span class="sxs-lookup"><span data-stu-id="bf868-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="bf868-139">Ebben az esetben helyszíni Exchange-kiszolgálókat és az Exchange Online-t használja egy [hibrid környezetben](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="bf868-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="bf868-140">A használt csatlakoztatott tooa WAN.</span><span class="sxs-lookup"><span data-stu-id="bf868-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="bf868-141">Hogy hirdesse meg hello előtagjait, a helyszíni kiszolgálók mind az irodák tooMicrosoft hello két ExpressRoute-Kapcsolatcsoportok keresztül.</span><span class="sxs-lookup"><span data-stu-id="bf868-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="bf868-142">Exchange Online kapcsolatok toohello a helyszíni kiszolgálók azokban az esetekben, például a postaláda áttelepítési kezdeményez.</span><span class="sxs-lookup"><span data-stu-id="bf868-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="bf868-143">Sajnos hello kapcsolat tooyour másik Debrecenben office irányított toohello ExpressRoute-kapcsolatcsoport-amerikai keleti hello teljes kontinensre hátsó toohello nyugati part áthaladó előtt áll.</span><span class="sxs-lookup"><span data-stu-id="bf868-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="bf868-144">hello hello oka hasonló toohello először egy.</span><span class="sxs-lookup"><span data-stu-id="bf868-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="bf868-145">Bármely mutató nélkül hello Microsoft hálózati nem sikerült megállapítani, mely felhasználói előtag Bezárás tooUS keleti, és melyik tooUS nyugati bezárásához.</span><span class="sxs-lookup"><span data-stu-id="bf868-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="bf868-146">Ez akkor fordul elő, toopick hello megfelelő elérési tooyour irodában másik Debrecenben.</span><span class="sxs-lookup"><span data-stu-id="bf868-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![Az ExpressRoute eset 2 - optimálisnál a Microsoft toocustomer Útválasztás](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="bf868-148">Megoldás: AS PATH előtag-beillesztés</span><span class="sxs-lookup"><span data-stu-id="bf868-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="bf868-149">Két megoldások toohello probléma van.</span><span class="sxs-lookup"><span data-stu-id="bf868-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="bf868-150">hello először egyik, hogy a másik Debrecenben Office 177.2.0.0/31 hello ExpressRoute körön, Nyugat-India egyszerűen hirdetményt a helyszíni előtag és a helyszíni előtag a győri Office 177.2.0.2/31 hello ExpressRoute körön-amerikai keleti.</span><span class="sxs-lookup"><span data-stu-id="bf868-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="bf868-151">Ennek eredményeképpen nincs Microsoft tooconnect tooeach meg a esetén csak egy elérési útját.</span><span class="sxs-lookup"><span data-stu-id="bf868-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="bf868-152">Nincs félreérthetőség, és az útválasztás optimalizálva van.</span><span class="sxs-lookup"><span data-stu-id="bf868-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="bf868-153">Ezzel a kialakítással toothink vonatkozó feladatátvételi stratégiát kell.</span><span class="sxs-lookup"><span data-stu-id="bf868-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="bf868-154">A hello eseményt, amely az elérési út tooMicrosoft keresztül ExpressRoute hello hibás, akkor kell, hogy, hogy az Exchange Online továbbra is csatlakozni tud tooyour a helyszíni kiszolgálók toomake.</span><span class="sxs-lookup"><span data-stu-id="bf868-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="bf868-155">hello második megoldás, hogy folytatja tooadvertise mindkét hello előtaglistát kezel a mindkét ExpressRoute-Kapcsolatcsoportok, de emellett akkor biztosítják mely előtag van Bezárás toowhich egy, a használt javaslat.</span><span class="sxs-lookup"><span data-stu-id="bf868-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="bf868-156">Támogatott BGP-AS elérési fertőző, mert a előtag tooinfluence irányításához konfigurálhatja hello AS elérési útja.</span><span class="sxs-lookup"><span data-stu-id="bf868-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="bf868-157">Ebben a példában az US-keleti 172.2.0.0/31 AS ELÉRÉSI hello úgy, hogy azt főként a hello ExpressRoute-kapcsolatcsoportot, Nyugat-India szánt ezt az előtagot (mivel a hálózati fog gondolja, hogy hello elérési toothis előtag hello Nyugat-India rövidebb) forgalom növelheti meg.</span><span class="sxs-lookup"><span data-stu-id="bf868-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="bf868-158">Hasonlóképpen meghosszabbíthatja hello AS elérési ÚTJA a 172.2.0.2/31, Nyugat-India, hogy azt fogja inkább-amerikai keleti hello ExpressRoute-kapcsolatcsoportot.</span><span class="sxs-lookup"><span data-stu-id="bf868-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="bf868-159">Az útválasztás mindkét iroda esetében optimalizálva van.</span><span class="sxs-lookup"><span data-stu-id="bf868-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="bf868-160">Ezzel a kialakítással, ha az egyik ExpressRoute-kör megszakad, az Exchange Online továbbra is elérheti az Ön hálózatát a másik ExpressRoute-kapcsolatcsoporton és a WAN hálózaton keresztül.</span><span class="sxs-lookup"><span data-stu-id="bf868-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="bf868-161">Tudjuk eltávolítani saját, a Microsoft Peering kapott hello AS elérési ÚTJA a hello előtagok szereplő számok.</span><span class="sxs-lookup"><span data-stu-id="bf868-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="bf868-162">Tooappend szüksége nyilvános hello AS ELÉRÉSI tooinfluence útválasztást Microsoft Peering SZÁMKÉNT.</span><span class="sxs-lookup"><span data-stu-id="bf868-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![2. ExpressRoute-eset megoldása – AS PATH előtag-beillesztés](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="bf868-164">Az alábbi hello többek között a Microsoft és a nyilvános társviszony, amíg támogatjuk hello ugyanazokat a képességeket a hello magánhálózati társviszony-létesítés.</span><span class="sxs-lookup"><span data-stu-id="bf868-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="bf868-165">Hello AS elérési fertőző belül is működik egy egyszeri ExpressRoute-kapcsolatcsoportot, tooinfluence hello kijelölés hello elsődleges és másodlagos elérési utak közül.</span><span class="sxs-lookup"><span data-stu-id="bf868-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="bf868-166">Az optimálisnál rosszabb útválasztás a virtuális hálózatok között</span><span class="sxs-lookup"><span data-stu-id="bf868-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="bf868-167">Az ExpressRoute, engedélyezheti a virtuális hálózati tooVirtual (amely más néven "VNet") hálózati kommunikációs tooan ExpressRoute-kapcsolatcsoportot létrehozhatja őket.</span><span class="sxs-lookup"><span data-stu-id="bf868-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="bf868-168">Toomultiple ExpressRoute-Kapcsolatcsoportok kapcsolja őket, amikor optimálisnál útválasztási akkor fordulhat elő, hello Vnetek között.</span><span class="sxs-lookup"><span data-stu-id="bf868-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="bf868-169">Vegyünk egy példát.</span><span class="sxs-lookup"><span data-stu-id="bf868-169">Let's consider an example.</span></span> <span data-ttu-id="bf868-170">Két ExpressRoute-kapcsolatcsoporttal rendelkezik, az egyik az USA nyugati régiójában, a másik az USA keleti régiójában található.</span><span class="sxs-lookup"><span data-stu-id="bf868-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="bf868-171">Mindkét régióban két VNet van.</span><span class="sxs-lookup"><span data-stu-id="bf868-171">In each region, you have two VNets.</span></span> <span data-ttu-id="bf868-172">A kiszolgálók egy Vneten belül vannak telepítve, és az alkalmazáskiszolgálók hello más.</span><span class="sxs-lookup"><span data-stu-id="bf868-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="bf868-173">A redundancia érdekében csatolunk hello két Vnetek szereplő minden egyes régió tooboth hello helyi ExpressRoute-kapcsolatcsoportot, és hello távoli ExpressRoute-kapcsolatcsoportot.</span><span class="sxs-lookup"><span data-stu-id="bf868-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="bf868-174">Az alább is látható, minden egyes vnet nincsenek két elérési utak toohello más virtuális hálózat.</span><span class="sxs-lookup"><span data-stu-id="bf868-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="bf868-175">hello Vnetek nem tudja, melyik ExpressRoute-kapcsolatcsoportot helyi, és azt, amelyiket távoli.</span><span class="sxs-lookup"><span data-stu-id="bf868-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="bf868-176">Ennek következtében, mint egyenlő-költség-Multi-Path (ECMP) útválasztási tooload-egyenleg többek VNet forgalmát, egyes adatforgalmakat érvénybe hello elérési útja hosszabb és lekérése irányítása: hello távoli ExpressRoute-kapcsolatcsoportot.</span><span class="sxs-lookup"><span data-stu-id="bf868-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![3. ExpressRoute-eset – az optimálisnál rosszabb útválasztás a virtuális hálózatok között](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="bf868-178">Megoldás: a nagy súlyozással toolocal kapcsolat hozzárendelése</span><span class="sxs-lookup"><span data-stu-id="bf868-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="bf868-179">hello megoldás felettébb egyszerű.</span><span class="sxs-lookup"><span data-stu-id="bf868-179">hello solution is simple.</span></span> <span data-ttu-id="bf868-180">Tudjuk, ahol hello virtuális hálózatokat és hello Kapcsolatcsoportok, mivel részleteket megosztani mely minden egyes virtuális hálózaton kell inkább elérési útja.</span><span class="sxs-lookup"><span data-stu-id="bf868-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="bf868-181">Kifejezetten ebben a példában a rendeljen magasabb súly toohello helyi kapcsolat mint toohello távoli kapcsolat (hello konfigurációs példa [Itt](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="bf868-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="bf868-182">Ha egy virtuális hálózat kap hello hello előtagja más azt a hello legmagasabb súly toosend szánt forgalom ezt az előtagot főként a hello kapcsolat több kapcsolatot a virtuális hálózat.</span><span class="sxs-lookup"><span data-stu-id="bf868-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Az ExpressRoute eset 3 megoldás - hozzárendelése magas súly toolocal kapcsolat](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="bf868-184">Ha több ExpressRoute-Kapcsolatcsoportok hello súly AS ELÉRÉSI prepending, hello második forgatókönyv fent leírt módszer alkalmazása helyett kapcsolat konfigurálásával a virtuális hálózat tooyour helyszíni hálózatról, Útválasztás is befolyásolják.</span><span class="sxs-lookup"><span data-stu-id="bf868-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="bf868-185">Az egyes előtag követően mindig áttekintjük hello kapcsolat súly előtt hello AS elérési útra meghatározásakor hogyan toosend forgalmat.</span><span class="sxs-lookup"><span data-stu-id="bf868-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
