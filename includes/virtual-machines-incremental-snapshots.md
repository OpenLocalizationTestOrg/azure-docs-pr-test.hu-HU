# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="c1db8-101">Készítsen biztonsági másolatot az Azure nem felügyelt méretű lemezek növekményes pillanatképek</span><span class="sxs-lookup"><span data-stu-id="c1db8-101">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="c1db8-102">Áttekintés</span><span class="sxs-lookup"><span data-stu-id="c1db8-102">Overview</span></span>
<span data-ttu-id="c1db8-103">Az Azure Storage blobs tootake pillanatkép-készítési hello képességet nyújt.</span><span class="sxs-lookup"><span data-stu-id="c1db8-103">Azure Storage provides hello capability tootake snapshots of blobs.</span></span> <span data-ttu-id="c1db8-104">A pillanatképek hello blob állapot ezen a ponton az idő rögzítése.</span><span class="sxs-lookup"><span data-stu-id="c1db8-104">Snapshots capture hello blob state at that point in time.</span></span> <span data-ttu-id="c1db8-105">Ez a cikk azt ismerteti egy olyan forgatókönyvet, amelyben akkor is fenntartható a pillanatképek használata virtuális gépek lemezeinek biztonsági másolatait.</span><span class="sxs-lookup"><span data-stu-id="c1db8-105">In this article, we describe a scenario in which you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="c1db8-106">Ez a módszer használható, ha úgy dönt, hogy nem toouse Azure biztonsági mentési és helyreállítási szolgáltatás, és szeretné toocreate a virtuális gépek lemezeit egyéni biztonsági mentési stratégiáját.</span><span class="sxs-lookup"><span data-stu-id="c1db8-106">You can use this methodology when you choose not toouse Azure Backup and Recovery Service, and wish toocreate a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="c1db8-107">Azure virtuális gépek lemezeit, az Azure Storage lapblobokat tárolódnak.</span><span class="sxs-lookup"><span data-stu-id="c1db8-107">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="c1db8-108">Azt is leíró virtuális gépek lemezeit a cikkben egy biztonsági mentési stratégiája, mivel azt tekintse meg a toosnapshots lapblobokat hello környezetében.</span><span class="sxs-lookup"><span data-stu-id="c1db8-108">Since we are describing a backup strategy for virtual machine disks in this article, we refer toosnapshots in hello context of page blobs.</span></span> <span data-ttu-id="c1db8-109">toolearn pillanatképeket kapcsolatos további információkért tekintse meg a túl[egy pillanatképet készíteni egy Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span><span class="sxs-lookup"><span data-stu-id="c1db8-109">toolearn more about snapshots, refer too[Creating a Snapshot of a Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="c1db8-110">Mi az a pillanatképet?</span><span class="sxs-lookup"><span data-stu-id="c1db8-110">What is a snapshot?</span></span>
<span data-ttu-id="c1db8-111">Egy blob pillanatképet egy időben rögzített blob csak olvasható verziója telepítve.</span><span class="sxs-lookup"><span data-stu-id="c1db8-111">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="c1db8-112">Pillanatkép létrehozása, azt is kell olvasni, másolja, vagy törölni, de nem módosított.</span><span class="sxs-lookup"><span data-stu-id="c1db8-112">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="c1db8-113">Pillanatképek adja meg egy módon tooback blob be időben a jelenleg megjelenített.</span><span class="sxs-lookup"><span data-stu-id="c1db8-113">Snapshots provide a way tooback up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="c1db8-114">REST 2015-04-05-ös verzióját, amíg nem volt hello képességét toocopy teljes pillanatképek.</span><span class="sxs-lookup"><span data-stu-id="c1db8-114">Until REST version 2015-04-05, you had hello ability toocopy full snapshots.</span></span> <span data-ttu-id="c1db8-115">Az hello REST verzió 2015-07-08 és újabb, akkor is másolhatja növekményes pillanatképek.</span><span class="sxs-lookup"><span data-stu-id="c1db8-115">With hello REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="c1db8-116">Teljes pillanatkép másolása</span><span class="sxs-lookup"><span data-stu-id="c1db8-116">Full snapshot copy</span></span>
<span data-ttu-id="c1db8-117">Pillanatképek másolja a program tooanother tárfiók a blob tookeep hello alap blob biztonsági másolatait.</span><span class="sxs-lookup"><span data-stu-id="c1db8-117">Snapshots can be copied tooanother storage account as a blob tookeep backups of hello base blob.</span></span> <span data-ttu-id="c1db8-118">Az alap blob, amely hello blob tooan visszaállítása keresztül is másolhatja pillanatkép korábbi verzióját.</span><span class="sxs-lookup"><span data-stu-id="c1db8-118">You can also copy a snapshot over its base blob, which is like restoring hello blob tooan earlier version.</span></span> <span data-ttu-id="c1db8-119">Amikor a pillanatképet egy tárolási fiók tooanother átmásolva, ugyanaz, mint hello alap oldalakra vonatkozó blob tér hello foglal el.</span><span class="sxs-lookup"><span data-stu-id="c1db8-119">When a snapshot is copied from one storage account tooanother, it occupies hello same space as hello base page blob.</span></span> <span data-ttu-id="c1db8-120">Ezért teljes pillanatképek másolását egy tárolási fiók tooanother lassú és hello cél tárfiókja mekkora területet használ.</span><span class="sxs-lookup"><span data-stu-id="c1db8-120">Therefore, copying whole snapshots from one storage account tooanother is slow and consumes much space in hello target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="c1db8-121">Ha hello alap blob tooanother cél másolja, hello pillanatképek hello BLOB nem kerülnek.</span><span class="sxs-lookup"><span data-stu-id="c1db8-121">If you copy hello base blob tooanother destination, hello snapshots of hello blob are not copied along with it.</span></span> <span data-ttu-id="c1db8-122">Hasonló módon ha base blob egy másolatot felülírja, hello alap blob tartozó pillanatképet nem érinti és hello alap blob neve alatt érintetlen marad.</span><span class="sxs-lookup"><span data-stu-id="c1db8-122">Similarly, if you overwrite a base blob with a copy, snapshots associated with hello base blob are not affected and stay intact under hello base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="c1db8-123">Készítsen biztonsági másolatot készített pillanatfelvételek segítségével történő lemezek</span><span class="sxs-lookup"><span data-stu-id="c1db8-123">Back up disks using snapshots</span></span>
<span data-ttu-id="c1db8-124">A virtuális gépek lemezeit a biztonsági mentési stratégia, mint rendszeres időközönként pillanatképek készítése hello lemez vagy a lap blob, és másolja őket hasonló eszközökkel tooanother tárfiók [másolási Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) művelet vagy [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="c1db8-124">As a backup strategy for your virtual machine disks, you can take periodic snapshots of hello disk or page blob, and copy them tooanother storage account using tools like [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operation or [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span></span> <span data-ttu-id="c1db8-125">Pillanatkép tooa cél oldalakra vonatkozó blob egy eltérő nevű másolhatja.</span><span class="sxs-lookup"><span data-stu-id="c1db8-125">You can copy a snapshot tooa destination page blob with a different name.</span></span> <span data-ttu-id="c1db8-126">hello eredményül kapott cél oldalakra vonatkozó blob írható oldalakra vonatkozó blob és a pillanatkép nem.</span><span class="sxs-lookup"><span data-stu-id="c1db8-126">hello resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="c1db8-127">A cikk későbbi részében azt ismertetik lépéseket tootake pillanatképek használata virtuális gépek lemezeinek biztonsági másolatait.</span><span class="sxs-lookup"><span data-stu-id="c1db8-127">Later in this article, we describe steps tootake backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="c1db8-128">A lemezek pillanatképek visszaállítása</span><span class="sxs-lookup"><span data-stu-id="c1db8-128">Restore disks using snapshots</span></span>
<span data-ttu-id="c1db8-129">Ha a lemez tooa stabil verzióját, egy biztonsági mentési pillanatképek hello rögzítésének idő toorestore, másolhatja a pillanatkép hello alap oldalakra vonatkozó blob keresztül.</span><span class="sxs-lookup"><span data-stu-id="c1db8-129">When it is time toorestore your disk tooa stable version that was previously captured in one of hello backup snapshots, you can copy a snapshot over hello base page blob.</span></span> <span data-ttu-id="c1db8-130">Miután hello pillanatkép előléptetett toohello alap oldalakra vonatkozó blob, hello pillanatkép marad, de a forrás, amely képes is olvashatók és írhatók másolatot felülírja.</span><span class="sxs-lookup"><span data-stu-id="c1db8-130">After hello snapshot is promoted toohello base page blob, hello snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="c1db8-131">A cikk azt lépéseket toorestore egy korábbi verzióját a lemez a pillanatképből írják le.</span><span class="sxs-lookup"><span data-stu-id="c1db8-131">Later in this article we describe steps toorestore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="c1db8-132">Végrehajtási teljes pillanatkép másolása</span><span class="sxs-lookup"><span data-stu-id="c1db8-132">Implementing full snapshot copy</span></span>
<span data-ttu-id="c1db8-133">Megvalósíthat egy teljes pillanatképet másolatot hello következő tevékenységek végrehajtásával</span><span class="sxs-lookup"><span data-stu-id="c1db8-133">You can implement a full snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="c1db8-134">Először készítsen pillanatképet hello alap BLOB hello használata [pillanatkép Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) műveletet.</span><span class="sxs-lookup"><span data-stu-id="c1db8-134">First, take a snapshot of hello base blob using hello [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operation.</span></span>
* <span data-ttu-id="c1db8-135">Ezt követően másolási hello pillanatkép tooa cél tárolási fiók használatával [másolási Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="c1db8-135">Then, copy hello snapshot tooa target storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span>
* <span data-ttu-id="c1db8-136">Ismételje meg a folyamat toomaintain biztonsági másolat az alap-blobba.</span><span class="sxs-lookup"><span data-stu-id="c1db8-136">Repeat this process toomaintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="c1db8-137">Növekményes pillanatképet másolása</span><span class="sxs-lookup"><span data-stu-id="c1db8-137">Incremental snapshot copy</span></span>
<span data-ttu-id="c1db8-138">új funkciója hello hello [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API biztosít egy sokkal jobb módon tooback hello pillanatképek a lapblobokat és lemezek fel.</span><span class="sxs-lookup"><span data-stu-id="c1db8-138">hello new feature in hello [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API provides a much better way tooback up hello snapshots of your page blobs or disks.</span></span> <span data-ttu-id="c1db8-139">hello API visszaadása hello azokat a változásokat hello alap blob és hello pillanatképeket, amely csökkenti a biztonsági mentési fiók hello felhasznált tárterület hello mennyiségét.</span><span class="sxs-lookup"><span data-stu-id="c1db8-139">hello API returns hello list of changes between hello base blob and hello snapshots, which reduces hello amount of storage space used on hello backup account.</span></span> <span data-ttu-id="c1db8-140">hello API támogatja a lapblobokat prémium szintű Storage, valamint a standard szintű tárolót.</span><span class="sxs-lookup"><span data-stu-id="c1db8-140">hello API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="c1db8-141">Ez az API használatával, Azure virtuális gépek biztonsági mentési megoldások gyorsabb és hatékonyabb hozhat létre.</span><span class="sxs-lookup"><span data-stu-id="c1db8-141">Using this API, you can build faster and more efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="c1db8-142">Ez az API rendelkezésre álljanak, 2015-07-08 hello REST verziójával és magasabb.</span><span class="sxs-lookup"><span data-stu-id="c1db8-142">This API will be available with hello REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="c1db8-143">Növekményes pillanatképet másolási lehetővé teszi egy tárolási fiók tooanother hello közötti különbséget, a toocopy</span><span class="sxs-lookup"><span data-stu-id="c1db8-143">Incremental Snapshot Copy allows you toocopy from one storage account tooanother hello difference between,</span></span>

* <span data-ttu-id="c1db8-144">Alap blob és a pillanatkép vagy</span><span class="sxs-lookup"><span data-stu-id="c1db8-144">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="c1db8-145">Bármely két pillanatképek hello alap BLOB</span><span class="sxs-lookup"><span data-stu-id="c1db8-145">Any two snapshots of hello base blob</span></span>

<span data-ttu-id="c1db8-146">Megadott hello a következő feltételek teljesülése esetén</span><span class="sxs-lookup"><span data-stu-id="c1db8-146">Provided hello following conditions are met,</span></span>

* <span data-ttu-id="c1db8-147">hello blob Jan-1-2016 vagy újabb hozták létre.</span><span class="sxs-lookup"><span data-stu-id="c1db8-147">hello blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="c1db8-148">hello blob nem írja felül a [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) vagy [másolási Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) két pillanatképek között.</span><span class="sxs-lookup"><span data-stu-id="c1db8-148">hello blob was not overwritten with [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) or [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) between two snapshots.</span></span>

<span data-ttu-id="c1db8-149">**Megjegyzés:**: Ez a funkció érhető el prémium és Standard Azure Lapblobokat.</span><span class="sxs-lookup"><span data-stu-id="c1db8-149">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="c1db8-150">Ha egy egyéni biztonsági mentési stratégia készített pillanatfelvételek segítségével történő, hello pillanatképek másolása egy tárolási fiók tooanother lassú lehet, és sok tárhelyet vehet igénybe.</span><span class="sxs-lookup"><span data-stu-id="c1db8-150">When you have a custom backup strategy using snapshots, copying hello snapshots from one storage account tooanother can be slow and can consume much storage space.</span></span> <span data-ttu-id="c1db8-151">Másolás hello teljes pillanatkép tooa biztonsági mentési tárfiókot, helyett írhat egymást követő pillanatképek tooa biztonsági mentési oldalakra vonatkozó blob hello különbsége.</span><span class="sxs-lookup"><span data-stu-id="c1db8-151">Instead of copying hello entire snapshot tooa backup storage account, you can write hello difference between consecutive snapshots tooa backup page blob.</span></span> <span data-ttu-id="c1db8-152">Ezzel a módszerrel hello idő toocopy és hello terület toostore biztonsági mentések jelentősen csökken.</span><span class="sxs-lookup"><span data-stu-id="c1db8-152">This way, hello time toocopy and hello space toostore backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="c1db8-153">Végrehajtási növekményes pillanatképet másolása</span><span class="sxs-lookup"><span data-stu-id="c1db8-153">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="c1db8-154">Hello következő tevékenységek végrehajtásával Megvalósíthat növekményes pillanatképet másolása</span><span class="sxs-lookup"><span data-stu-id="c1db8-154">You can implement incremental snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="c1db8-155">Pillanatkép készítése hello alap blob használatával [pillanatkép Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span><span class="sxs-lookup"><span data-stu-id="c1db8-155">Take a snapshot of hello base blob using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span></span>
* <span data-ttu-id="c1db8-156">Másolás hello pillanatkép toohello cél biztonsági másolatok tárolási fiók használatával [másolási Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="c1db8-156">Copy hello snapshot toohello target backup storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span> <span data-ttu-id="c1db8-157">Ez a biztonsági mentési oldalakra vonatkozó blob hello.</span><span class="sxs-lookup"><span data-stu-id="c1db8-157">This is hello backup page blob.</span></span> <span data-ttu-id="c1db8-158">Pillanatkép készítése hello biztonsági mentési oldalakra vonatkozó blob, és hello biztonsági mentési fiók tárolja.</span><span class="sxs-lookup"><span data-stu-id="c1db8-158">Take a snapshot of hello backup page blob and store it in hello backup account.</span></span>
* <span data-ttu-id="c1db8-159">Egy másik pillanatképet, hello alap blob pillanatkép Blob használatával.</span><span class="sxs-lookup"><span data-stu-id="c1db8-159">Take another snapshot of hello base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="c1db8-160">Hello különbségének hello első és második pillanatképek hello alap blob használatának első [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span><span class="sxs-lookup"><span data-stu-id="c1db8-160">Get hello difference between hello first and second snapshots of hello base blob using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span></span> <span data-ttu-id="c1db8-161">Hello új paraméterrel **prevsnapshot**, toospecify hello hello pillanatkép kívánt tooget hello különbség a DateTime típusú érték.</span><span class="sxs-lookup"><span data-stu-id="c1db8-161">Use hello new parameter **prevsnapshot**, toospecify hello DateTime value of hello snapshot you want tooget hello difference with.</span></span> <span data-ttu-id="c1db8-162">Ha ez a paraméter meg adva, hello REST válasz lapjain csak hello cél pillanatkép és a korábbi pillanatképből, többek között a tiszta lapok között megváltozott.</span><span class="sxs-lookup"><span data-stu-id="c1db8-162">When this parameter is present, hello REST response includes only hello pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="c1db8-163">Használjon [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) tooapply e módosítások toohello biztonsági mentési oldalakra vonatkozó blob.</span><span class="sxs-lookup"><span data-stu-id="c1db8-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) tooapply these changes toohello backup page blob.</span></span>
* <span data-ttu-id="c1db8-164">Végezetül pillanatképet készít, hello biztonsági mentési oldalakra vonatkozó blob, és hello biztonsági mentési tárfiók tárolja.</span><span class="sxs-lookup"><span data-stu-id="c1db8-164">Finally, take a snapshot of hello backup page blob and store it in hello backup storage account.</span></span>

<span data-ttu-id="c1db8-165">Hello a következő szakaszban azt ismerteti, részletesebben hogyan kezelheti a biztonsági mentések lemezek növekményes pillanatképet-másolással</span><span class="sxs-lookup"><span data-stu-id="c1db8-165">In hello next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="c1db8-166">Forgatókönyv</span><span class="sxs-lookup"><span data-stu-id="c1db8-166">Scenario</span></span>
<span data-ttu-id="c1db8-167">Ez a szakasz azt ismerteti olyan forgatókönyvekben, amelyek a virtuális gépek lemezeit készített pillanatfelvételek segítségével történő egyéni biztonsági mentési stratégiája magában foglalja.</span><span class="sxs-lookup"><span data-stu-id="c1db8-167">In this section, we describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="c1db8-168">Vegye figyelembe a DS sorozatnak Azure virtuális gépek csatolt prémium szintű storage P30 lemezzel.</span><span class="sxs-lookup"><span data-stu-id="c1db8-168">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="c1db8-169">hello P30 lemez néven *mypremiumdisk* tárolódik a prémium szintű storage-fiók neve *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-169">hello P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="c1db8-170">Standard szintű tárfiók nevű *mybackupstdaccount* hello biztonsági másolatának tárolásához használt *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-170">A standard storage account called *mybackupstdaccount* is used for storing hello backup of *mypremiumdisk*.</span></span> <span data-ttu-id="c1db8-171">Szeretnénk tookeep pillanatképet a *mypremiumdisk* 12 óránként.</span><span class="sxs-lookup"><span data-stu-id="c1db8-171">We would like tookeep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="c1db8-172">toolearn tárfiók és a lemezek létrehozásával kapcsolatban tekintse meg a túl[tudnivalók az Azure storage-fiókok](../articles/storage/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="c1db8-172">toolearn about creating storage account and disks, refer too[About Azure storage accounts](../articles/storage/storage-create-storage-account.md).</span></span>

<span data-ttu-id="c1db8-173">az Azure virtuális gépek biztonsági mentéséről toolearn tekintse meg a túl[tervezze meg az Azure virtuális gép biztonsági mentések](../articles/backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="c1db8-173">toolearn about backing up Azure VMs, refer too[Plan Azure VM backups](../articles/backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-toomaintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="c1db8-174">Lépéseket toomaintain biztonsági másolatokat, növekményes pillanatképek használata lemez</span><span class="sxs-lookup"><span data-stu-id="c1db8-174">Steps toomaintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="c1db8-175">hello következő lépések bemutatják, hogyan tootake pillanatkép-készítési *mypremiumdisk* és karbantartása hello a biztonsági másolatok *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-175">hello following steps describe how tootake snapshots of *mypremiumdisk* and maintain hello backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="c1db8-176">hello áll biztonsági másolat nevű szabványos oldalakra vonatkozó blob *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-176">hello backup is a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="c1db8-177">hello biztonsági mentési oldalakra vonatkozó blob mindig tükrözi ugyanaz a hello utolsó pillanatképként állapot hello *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-177">hello backup page blob always reflects hello same state as hello last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="c1db8-178">Pillanatkép készítése a biztonsági mentési lapblobját hello a prémium szintű tároló lemez létrehozása *mypremiumdisk* nevű *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-178">Create hello backup page blob for your premium storage disk, by taking a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="c1db8-179">Másolja a pillanatkép toomybackupstdaccount nevű oldalblobként *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-179">Copy this snapshot toomybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="c1db8-180">Pillanatkép készítése *mybackupstdpageblob* nevű *mybackupstdpageblob_ss1*használatával [pillanatkép Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) és tárolja a *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-180">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="c1db8-181">Során hello biztonsági mentési ablakot, hozzon létre egy másik pillanatképe *mypremiumdisk*, azaz *mypremiumdisk_ss2*, és tárolja a *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-181">During hello backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="c1db8-182">Hello növekményes módosult között két hello pillanatképek *mypremiumdisk_ss2* és *mypremiumdisk_ss1*használatával [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) a  *mypremiumdisk_ss2* a hello **prevsnapshot** paraméterkészlet toohello időbélyegzője *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-182">Get hello incremental changes between hello two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) on *mypremiumdisk_ss2* with hello **prevsnapshot** parameter set toohello timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="c1db8-183">Ezek a növekményes változásokat toohello biztonsági mentési oldalakra vonatkozó blob írási *mybackupstdpageblob* a *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-183">Write these incremental changes toohello backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="c1db8-184">Ha hello a növekményes változásokat törölt tartománya, akkor törölni kell a biztonsági mentési oldalakra vonatkozó blob hello.</span><span class="sxs-lookup"><span data-stu-id="c1db8-184">If there are deleted ranges in hello incremental changes, they must be cleared from hello backup page blob.</span></span> <span data-ttu-id="c1db8-185">Használjon [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) toowrite a növekményes változásokat toohello biztonsági mentési oldalakra vonatkozó blob.</span><span class="sxs-lookup"><span data-stu-id="c1db8-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) toowrite incremental changes toohello backup page blob.</span></span>
6. <span data-ttu-id="c1db8-186">Pillanatkép készítése a biztonsági mentési oldalakra vonatkozó blob hello *mybackupstdpageblob*néven *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-186">Take a snapshot of hello backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="c1db8-187">Törölje az előző pillanatképet hello *mypremiumdisk_ss1* a prémium szintű storage-fiók.</span><span class="sxs-lookup"><span data-stu-id="c1db8-187">Delete hello previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="c1db8-188">Minden biztonsági mentés időszakának ismételje meg a 4 – 6.</span><span class="sxs-lookup"><span data-stu-id="c1db8-188">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="c1db8-189">Így akkor is fenntartható a biztonsági másolatainak *mypremiumdisk* szabványos tárfiókokban.</span><span class="sxs-lookup"><span data-stu-id="c1db8-189">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Készítsen biztonsági másolatot növekményes pillanatképek használatával](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-toorestore-a-disk-from-snapshots"></a><span data-ttu-id="c1db8-191">A pillanatképek lemezméret lépéseket toorestore</span><span class="sxs-lookup"><span data-stu-id="c1db8-191">Steps toorestore a disk from snapshots</span></span>
<span data-ttu-id="c1db8-192">hello lépéseket követve, ismertetik, hogyan toorestore hello prémium szintű lemez *mypremiumdisk* hello biztonsági mentési tárfiók korábbi pillanatképet tooan *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-192">hello following steps, describe how toorestore hello premium disk, *mypremiumdisk* tooan earlier snapshot from hello backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="c1db8-193">Hello pontot azonosító toorestore hello prémium szintű lemez kívánja időben.</span><span class="sxs-lookup"><span data-stu-id="c1db8-193">Identify hello point in time that you wish toorestore hello premium disk to.</span></span> <span data-ttu-id="c1db8-194">Tegyük fel a pillanatkép van *mybackupstdpageblob_ss2*, amely hello biztonsági mentési tárfiók tárolja *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-194">Let's say that it is snapshot *mybackupstdpageblob_ss2*, which is stored in hello backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="c1db8-195">Mybackupstdaccount, az előléptetés hello pillanatkép *mybackupstdpageblob_ss2* hello új biztonsági mentési alap oldalakra vonatkozó blob, *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-195">In mybackupstdaccount, promote hello snapshot *mybackupstdpageblob_ss2* as hello new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="c1db8-196">Pillanatkép készítése a visszaállított biztonsági mentési oldalakra vonatkozó blob, úgynevezett *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-196">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="c1db8-197">Másolás hello visszaállítani az oldalakra vonatkozó blob *mybackupstdpageblobrestored* a *mybackupstdaccount* túl*mypremiumaccount* lemezként hello új premium  *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="c1db8-197">Copy hello restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* too*mypremiumaccount* as hello new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="c1db8-198">Pillanatkép készítése *mypremiumdiskrestored*néven *mypremiumdiskrestored_ss1* jövőbeli növekményes biztonsági mentést készíteni.</span><span class="sxs-lookup"><span data-stu-id="c1db8-198">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="c1db8-199">Hello DS adatsorozat VM vissza toohello lemez pont *mypremiumdiskrestored* és leválasztási régi hello *mypremiumdisk* a virtuális gép hello.</span><span class="sxs-lookup"><span data-stu-id="c1db8-199">Point hello DS series VM toohello restored disk *mypremiumdiskrestored* and detach hello old *mypremiumdisk* from hello VM.</span></span>
7. <span data-ttu-id="c1db8-200">Megkezdéséhez hello biztonsági másolat visszaállítása hello lemez előző szakaszban leírt *mypremiumdiskrestored*, hello segítségével *mybackupstdpageblobrestored* , hello biztonsági mentési oldalakra vonatkozó blob.</span><span class="sxs-lookup"><span data-stu-id="c1db8-200">Begin hello Backup process described in previous section for hello restored disk *mypremiumdiskrestored*, using hello *mybackupstdpageblobrestored* as hello backup page blob.</span></span>

![A pillanatképek lemez visszaállítása](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="c1db8-202">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="c1db8-202">Next Steps</span></span>
<span data-ttu-id="c1db8-203">Használjon hello következő toolearn pillanatképeinek blob és a virtuális gép biztonsági mentési infrastruktúrájának megtervezésével kapcsolatos további hivatkozásokat tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="c1db8-203">Use hello following links toolearn more about creating snapshots of a blob and planning your VM backup infrastructure.</span></span>

* [<span data-ttu-id="c1db8-204">Egy BLOB pillanatkép létrehozása</span><span class="sxs-lookup"><span data-stu-id="c1db8-204">Creating a Snapshot of a Blob</span></span>](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)
* [<span data-ttu-id="c1db8-205">A virtuális gép biztonsági mentési infrastruktúra megtervezése</span><span class="sxs-lookup"><span data-stu-id="c1db8-205">Plan your VM Backup Infrastructure</span></span>](../articles/backup/backup-azure-vms-introduction.md)

